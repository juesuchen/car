Ext.define("Ext.easy.CommonData",{singleton:true,alternateClassName:"CDM",currency:[["RMB","人民币-RMB"],["HKD","港币-HKD"],["NTD","台币-NTD"],["USD","美元-USD"],["EUR","欧元-EUR"],["GBP","英镑-GBP"]],orgType:[["FR","法人"],["FZJG","分支机构(中资行)"],["ZCX","分支机构(政策性)"]],assessYear:[],assessIndexs:[],noFitIndexFor:{FR:[],FZJG:[],ZCX:[]},indexPre:"indx",pageSize:[[15,15],[30,30],[50,50],[100,100],[300,300],[500,500],[1000,1000]],});var loadBaseDataFailureFun=function(){Ext.Msg.alert("操作提示","服务不可用,读取基础数据失败!")};
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Ext.easy.BaseElementsConfigs",{extend:"Ext.util.MixedCollection",constructor:function(a){a=a||{};Ext.apply(this,a);this.callParent();this.initCommonCfg();if(Ext.isFunction(this.loadBaseData)){this.loadBaseData()}},initCommonCfg:function(){this.addCfg(EasyUtil.getBaseConfig("id","id",{xtype:"hidden"}));this.addCfg(EasyUtil.getBaseConfig("创建人","creator",{readOnly:true}));this.addCfg(EasyUtil.getBaseConfig("创建时间","createTime",{readOnly:true,columnWidth:150}));this.addCfg(EasyUtil.getBaseConfig("修改人","updator",{disabled:true}));this.addCfg(EasyUtil.getBaseConfig("修改时间","updateTime",{disabled:true,columnWidth:150}))},addCfg:function(a,b){b=b||a.name;this.add(b,a)},getConfigByName:function(b,c){var a=Ext.apply({},this.get(b));if(a.required){Ext.apply(a,{allowBlank:false,blankText:"此字段不能为空",labelSeparator:'<font color="red">*</font>'})}if(c){a=Ext.apply(a,{colspan:c,width:650,grow:false})}return a},getBaseConfigByName:function(a){return Ext.apply({},this.get(a))}});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Ext.orgMgr.AssessOrgMgr",{extend:"Ext.ux.desktop.Module",uses:["Ext.orgMgr.AssessOrgMgrMainPanel"],init:function(){this.launcher={text:this.launcherText,iconCls:this.iconCls,handler:this.createWindow,scope:this}},createWindow:function(){var d=this.app.getDesktop();var c=d.getWindow(this.id);if(!c){var b=minwindowWidth;var a=new Ext.orgMgr.AssessOrgMgrMainPanel({parentWinWidth:b,desktop:d});c=d.createWindow({id:this.id,title:this.launcher.text,width:b,height:windowHight,iconCls:this.iconCls,animCollapse:false,border:false,hideMode:"offsets",layout:"fit",items:a});a.parentWin=c;c.on("beforeclose",function(f,e){f.minimize()})}c.show();return c}});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Ext.orgMgr.AssessOrgMgrElementsConfigs",{extend:"Ext.easy.BaseElementsConfigs",init:function(){this.addCfg(EasyUtil.getEasyComboCfg("机构类型","orgType",CDM.orgType,{required:true,renderer:true}));this.addCfg(EasyUtil.getBaseConfig("机构名称","orgName",{required:true}));this.addCfg(EasyUtil.getEasyComboCfg("机构名称","orgName",[],{required:true,editable:true}),"orgNameCombo")},getQueryFormItems:function(){return[this.getBaseConfigByName("orgType"),this.getBaseConfigByName("orgName")]},getQueryGridFileds:function(){var a=new Ext.util.MixedCollection();a.add(this.getConfigByName("orgType"));a.add(this.getConfigByName("orgName"));a.add(this.getConfigByName("updator"));a.add(this.getConfigByName("updateTime"));a.add(this.getConfigByName("id"));return a}});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Ext.orgMgr.AssessOrgMgrMainPanel",{extend:"Ext.panel.Panel",requires:["Ext.orgMgr.AssessOrgMgrElementsConfigs","Ext.ux.EasyGrid"],initComponent:function(){this.border=false;this.layout="border";this.callParent();var b=assessOrgMgrElementsConfigs.getQueryFormItems();this.queryForm=EasyUtil.getEasyQueryForm(Ext.bind(this.doQuery,this),b);var a={subWindowTitle:"机构信息",showTbar:true,region:"center",parentPanel:this,baseParams:{queryId:"AssessOrgMapper.queryAssessOrg"},fields:assessOrgMgrElementsConfigs.getQueryGridFileds()};this.queryGrid=new Ext.ux.EasyGrid(a);this.add(this.queryForm,this.queryGrid)},doQuery:function(){EasyUtil.doEasyQuery(this.queryGrid,this.queryForm)},addRecord:function(b,c,a){EasyUtil.submitForm(c,"extjsoncontrollersuport/save.do",this,{entity:"AssessOrg",isDoQuery:true})},updateRecord:function(b,d,a,c){EasyUtil.submitForm(c,"extjsoncontrollersuport/update.do",this,{entity:"AssessOrg",isDoQuery:true})},removeRecord:function(a,b){var c=false;EasyUtil.easyAjax("extjsoncontrollersuport/remove.do",{id:b.get("id"),entity:"AssessOrg",isDoQuery:true},function(d,e){var f=Ext.decode(d.responseText);c=f.success},this,true);return c}});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Ext.indexMgr.AssessIndexMgr",{extend:"Ext.ux.desktop.Module",uses:["Ext.indexMgr.AssessIndexMgrMainPanel"],init:function(){this.launcher={text:this.launcherText,iconCls:this.iconCls,handler:this.createWindow,scope:this}},createWindow:function(){var d=this.app.getDesktop();var c=d.getWindow(this.id);if(!c){var b=minwindowWidth;var a=new Ext.indexMgr.AssessIndexMgrMainPanel({parentWinWidth:b,desktop:d});c=d.createWindow({id:this.id,title:this.launcher.text,width:b,height:windowHight,iconCls:this.iconCls,animCollapse:false,border:false,hideMode:"offsets",layout:"fit",items:a});a.parentWin=c;c.on("beforeclose",function(f,e){f.minimize()})}c.show();return c}});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Ext.indexMgr.AssessIndexMgrMainPanel",{extend:"Ext.panel.Panel",requires:["Ext.orgMgr.AssessOrgMgrElementsConfigs","Ext.ux.EasyGrid"],initComponent:function(){this.border=false;this.layout="border";this.callParent();var b=assessDataMgrElementsConfigs.getQueryIndexFormItems();this.queryForm=EasyUtil.getEasyQueryForm(Ext.bind(this.doQuery,this),b,1);var a={subWindowTitle:"指标信息",region:"center",parentPanel:this,formItemsReadOnly:true,noAutoLoad:true,fields:assessDataMgrElementsConfigs.getQueryIndexGridFileds(),baseParams:{queryId:"AssessDataMapper.queryAssessIndexNotPagin"}};this.queryGrid=new Ext.ux.EasyGrid(a);this.add(this.queryForm,this.queryGrid)},doQuery:function(){EasyUtil.doEasyQuery(this.queryGrid,this.queryForm)},addRecord:function(b,c,a){EasyUtil.submitForm(c,"extjsoncontrollersuport/save.do",this,{entity:"AssessIndex"})},updateRecord:function(b,d,a,c){EasyUtil.submitForm(c,"extjsoncontrollersuport/update.do",this,{entity:"AssessIndex"})},removeRecord:function(a,b){var c=false;EasyUtil.easyAjax("extjsoncontrollersuport/remove.do",{id:b.get("id"),entity:"AssessIndex"},function(d,e){var f=Ext.decode(d.responseText);c=f.success},this,true);return c}});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Ext.dataMgr.AssessDataMgr",{extend:"Ext.ux.desktop.Module",uses:["Ext.dataMgr.AssessDataMgrMainPanel"],init:function(){this.launcher={text:this.launcherText,iconCls:this.iconCls,handler:this.createWindow,scope:this}},createWindow:function(){var d=this.app.getDesktop();var c=d.getWindow(this.id);if(!c){var b=midwindowWidth;var a=new Ext.dataMgr.AssessDataMgrMainPanel({parentWinWidth:b,desktop:d});c=d.createWindow({id:this.id,title:this.launcher.text,width:b,height:windowHight,iconCls:this.iconCls,animCollapse:false,border:false,hideMode:"offsets",layout:"fit",items:a});a.parentWin=c;c.on("beforeclose",function(f,e){f.minimize()})}c.show();return c}});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Ext.dataMgr.AssessDataMgrElementsConfigs",{extend:"Ext.easy.BaseElementsConfigs",loadBaseData:function(){EasyUtil.easyAjax("extjsoncontrollersuport/findOrQuery.do",{doQuery:true,entity:"AssessIndex"},function(a,b){var c=Ext.decode(a.responseText);if(c.success){Ext.each(c.obj,function(e,d){CDM.assessIndexs.push({idxNo:e.idxNo,idxName:e.idxName,toTypeFR:e.toTypeFR,toTypeFZJG:e.toTypeFZJG,toTypeZCX:e.toTypeZCX});if(e.toTypeFR==0){CDM.noFitIndexFor.FR.push(e.idxNo)}if(e.toTypeFZJG==0){CDM.noFitIndexFor.FZJG.push(e.idxNo)}if(e.toTypeZCX==0){CDM.noFitIndexFor.ZCX.push(e.idxNo)}})}},this,true)},init:function(){for(var a=2012;a<2020;a++){CDM.assessYear.push([a,a])}this.addCfg(EasyUtil.getBaseConfig("指标名称","idxName"));this.addCfg(EasyUtil.getEasyComboCfg("适用"+CDM.orgType[0][1],"toTypeFR",null,{renderer:true}));this.addCfg(EasyUtil.getEasyComboCfg("适用"+CDM.orgType[1][1],"toTypeFZJG",null,{renderer:true}));this.addCfg(EasyUtil.getEasyComboCfg("适用"+CDM.orgType[2][1],"toTypeZCX",null,{renderer:true}));this.addCfg(EasyUtil.getEasyComboCfg("评估年份","assessYear",CDM.assessYear,{required:true}));this.addCfg(EasyUtil.getBaseConfig("综合评分","score"));this.addCfg(EasyUtil.getBaseConfig("稳健等级","grade"));this.addCfg(EasyUtil.getBaseConfig("稳健性调整参数值","gradeRef"))},getQueryFormItems:function(){return[assessOrgMgrElementsConfigs.getBaseConfigByName("orgType"),assessOrgMgrElementsConfigs.getBaseConfigByName("orgName"),this.getBaseConfigByName("assessYear")]},getQueryIndexFormItems:function(){return[this.getBaseConfigByName("idxName"),]},getQueryIndexGridFileds:function(){var a=new Ext.util.MixedCollection();a.add(this.getConfigByName("idxName"));a.add(this.getConfigByName("toTypeFR"));a.add(this.getConfigByName("toTypeFZJG"));a.add(this.getConfigByName("toTypeZCX"));a.add(this.getConfigByName("id"));return a},getQueryGridFileds:function(b){var a=new Ext.util.MixedCollection();a.add(assessOrgMgrElementsConfigs.getConfigByName("orgType"));a.add(assessOrgMgrElementsConfigs.getConfigByName("orgName"));a.add(this.getConfigByName("assessYear"));if(b){a.add(this.getConfigByName("score"));a.add(this.getConfigByName("grade"));a.add(this.getConfigByName("gradeRef"))}a.add(this.getConfigByName("updator"));a.add(this.getConfigByName("updateTime"));a.add(this.getConfigByName("id"));return a},getBaseFiledItems:function(){return[assessOrgMgrElementsConfigs.getConfigByName("orgType"),assessOrgMgrElementsConfigs.getConfigByName("orgNameCombo"),this.getConfigByName("assessYear"),this.getConfigByName("id")]},getIndexsFiledItems:function(e,b){var a=[];for(var d=e;d<b;d++){var c=CDM.assessIndexs[d];a.push(EasyUtil.getBaseConfig(c.idxName,CDM.indexPre+c.idxNo,{xtype:"numberfield",hideTrigger:true,width:198,allowBlank:false,labelWidth:143}))}return a}});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Ext.dataMgr.AssessDataMgrMainPanel",{extend:"Ext.tab.Panel",requires:["Ext.dataMgr.AssessDataMgrElementsConfigs","Ext.ux.EasyGridQuery"],initComponent:function(){var a=this;this.border=false;a.callParent();this.createRawDataMgrPanle();this.createDataProcessMgrPanle();this.setActiveTab(0);this.on("tabchange",Ext.bind(this.onTabActive,this))},onTabActive:function(b,a){this[a.tabName].doQuery()},createAssessIndexMgrPanle:function(){this.assessIndexMgrPanle=new Ext.dataMgr.AssessIndexMgrPanle({parentPanel:this,desktop:this.desktop});this.add({title:"评估指标管理",layout:"fit",border:false,tabName:"assessIndexMgrPanle",items:this.assessIndexMgrPanle})},createRawDataMgrPanle:function(){this.rawDataMgrPanle=new Ext.dataMgr.RawDataMgrPanle({parentPanel:this,desktop:this.desktop});this.add({title:"原始数据管理",layout:"fit",border:false,tabName:"rawDataMgrPanle",items:this.rawDataMgrPanle})},createDataProcessMgrPanle:function(){this.dataProcessMgrPanle=new Ext.dataMgr.DataProcessMgrPanle({parentPanel:this,desktop:this.desktop});this.add({title:"数据处理及结果管理",layout:"fit",border:false,tabName:"dataProcessMgrPanle",items:this.dataProcessMgrPanle})}});Ext.define("Ext.dataMgr.AssessIndexMgrPanle",{extend:"Ext.panel.Panel",initComponent:function(){this.border=false;this.layout="border";this.callParent();var b=assessDataMgrElementsConfigs.getQueryIndexFormItems();this.queryForm=EasyUtil.getEasyQueryForm(Ext.bind(this.doQuery,this),b,1);var a={subWindowTitle:"指标信息",region:"center",parentPanel:this,formItemsReadOnly:true,noAutoLoad:true,fields:assessDataMgrElementsConfigs.getQueryIndexGridFileds(),baseParams:{queryId:"AssessDataMapper.queryAssessIndexNotPagin"}};this.queryGrid=new Ext.ux.EasyGrid(a);this.add(this.queryForm,this.queryGrid)},doQuery:function(){EasyUtil.doEasyQuery(this.queryGrid,this.queryForm)},addRecord:function(b,c,a){EasyUtil.submitForm(c,"extjsoncontrollersuport/save.do",this,{entity:"AssessIndex"})},updateRecord:function(b,d,a,c){EasyUtil.submitForm(c,"extjsoncontrollersuport/update.do",this,{entity:"AssessIndex"})},removeRecord:function(a,b){var c=false;EasyUtil.easyAjax("extjsoncontrollersuport/remove.do",{id:b.get("id"),entity:"AssessIndex"},function(d,e){var f=Ext.decode(d.responseText);c=f.success},this,true);return c}});Ext.define("Ext.dataMgr.RawDataMgrPanle",{extend:"Ext.panel.Panel",initComponent:function(){this.border=false;this.layout="border";this.callParent();var b=assessDataMgrElementsConfigs.getQueryFormItems();this.queryForm=EasyUtil.getEasyQueryForm(Ext.bind(this.doQuery,this),b,3);var a={subWindowTitle:"原始数据",subWindowWidth:midwindowWidth+200,subWindowHeight:windowHight,showTbar:true,showBbar:true,showUpateBtn:true,showRemoveBtn:true,viewPanelClass:"Ext.dataMgr.RawDataViewPanel",region:"center",parentPanel:this,desktop:this.desktop,fields:assessDataMgrElementsConfigs.getQueryGridFileds(),baseParams:{queryId:"AssessDataMapper.queryRawData"}};this.queryGrid=new Ext.ux.EasyGridQuery(a);this.add(this.queryForm,this.queryGrid)},doQuery:function(){EasyUtil.doEasyQuery(this.queryGrid,this.queryForm)},removeRecord:function(a,b){var c=false;EasyUtil.easyAjax("extjsoncontrollersuport/remove.do",{id:b.get("id"),entity:"RawData"},function(d,e){var f=Ext.decode(d.responseText);c=f.success},this,true);return c}});Ext.define("Ext.dataMgr.RawDataViewPanel",{extend:"Ext.panel.Panel",initComponent:function(){this.border=false;this.layout="border";this.autoScroll=true;this.callParent();var b=[EasyUtil.getEasyFieldSetCfg("机构及年份",assessDataMgrElementsConfigs.getBaseFiledItems(),3),EasyUtil.getEasyFieldSetCfg("风险管理体系建设及执行有效性",assessDataMgrElementsConfigs.getIndexsFiledItems(0,15),4),EasyUtil.getEasyFieldSetCfg("经营审慎性",assessDataMgrElementsConfigs.getIndexsFiledItems(15,35),4),EasyUtil.getEasyFieldSetCfg("公司治理、管理层素质及合规性",assessDataMgrElementsConfigs.getIndexsFiledItems(35,44),4),EasyUtil.getEasyFieldSetCfg("资本、人员及系统稳定性",assessDataMgrElementsConfigs.getIndexsFiledItems(44,50),4),EasyUtil.getEasyFieldSetCfg("核心指标稳健性",assessDataMgrElementsConfigs.getIndexsFiledItems(50,CDM.assessIndexs.length),4)];this.formPanel=EasyUtil.getEasyFieldSetForm({items:b,fbar:[EasyUtil.getCloseWinBtnCfg(this),{text:"保存",iconCls:"save",handler:Ext.bind(this.save,this)}]});this.orgNameCombo=this.formPanel.getForm().findField("orgName");var a=function(f,e,d){var c=CDM.noFitIndexFor[f];Ext.each(c,function(g){var h=this.findField(CDM.indexPre+g);h.setValue(null);h.setDisabled(e)},d)};this.formPanel.getForm().findField("orgType").on("change",function(d,e,c){if(!Ext.isEmpty(c)){a(c,false,this.formPanel.getForm())}if(!Ext.isEmpty(e)){var g={entity:"AssessOrg",orgType:e,valueField:"orgName"};EasyUtil.onMyTriggerClick(this.orgNameCombo,e,g);this.orgNameCombo.setValue(null);a(e,true,this.formPanel.getForm())}},this);this.add(this.formPanel)},setIsView:function(a){this.isView=a},save:function(){var a="rawdata/saveRawData.do";if(this.isView){a="rawdata/updateRawData.do"}EasyUtil.submitForm(this.formPanel.getForm(),a,this,{entity:"RawData",isDoQuery:true,isCloseWin:true})},loadFormRecord:function(a){EasyUtil.easyAjax("extjsoncontrollersuport/findOrQuery.do",{id:a,entity:"RawData"},function(b,c){var d=Ext.decode(b.responseText);if(d.success){this.formPanel.getForm().setValues(d.obj)}},this)}});Ext.define("Ext.dataMgr.DataProcessMgrPanle",{extend:"Ext.panel.Panel",initComponent:function(){this.border=false;this.layout="border";this.callParent();var b=assessDataMgrElementsConfigs.getQueryFormItems();this.queryForm=EasyUtil.getEasyQueryForm(Ext.bind(this.doQuery,this),b,3);var a={subWindowTitle:"评估结果",showTbar:true,showBbar:true,noShowAddBtn:true,noShowUpdateBtn:true,noShowRemoveBtn:true,showReportBtn:true,region:"center",noAutoLoad:true,parentPanel:this,fields:assessDataMgrElementsConfigs.getQueryGridFileds(true),baseParams:{queryId:"AssessDataMapper.queryRawData"}};this.queryGrid=new Ext.ux.EasyGrid(a);this.add(this.queryForm,this.queryGrid)},doQuery:function(){EasyUtil.doEasyQuery(this.queryGrid,this.queryForm)},reportToExcel:function(a){var b=a.getSelectedRecord();if(b){window.open("rawdata/download.do?id="+b.get("id"),"downloadWin")}}});Ext.define("Ext.Privilege.FunctionNodes",{singleton:true,alternateClassName:"PRIFNS",functionNodes:[{text:"评估机构管理",funCode:"assessOrgMgr",iconCls:"option",checked:false},{text:"评估指标管理",funCode:"assessIndexMgr",iconCls:"option",checked:false},{text:"评估数据管理",funCode:"assessDataMgr",iconCls:"option",checked:false},{text:"用户权限管理",funCode:"privilegeMgr",iconCls:"option",checked:false}]});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Ext.Privilege.PrivilegeData",{extend:"Ext.ux.desktop.Module",uses:["Ext.Privilege.PrivilegeDataMainPanel"],init:function(){this.launcher={text:this.launcherText,iconCls:this.iconCls,handler:this.createWindow,scope:this}},createWindow:function(){var d=this.app.getDesktop();var c=d.getWindow(this.id);if(!c){var b=midwindowWidth;var a=new Ext.Privilege.PrivilegeDataMainPanel({parentWinWidth:b,desktop:d});c=d.createWindow({id:this.id,title:this.launcher.text,width:b,height:windowHight,iconCls:this.iconCls,animCollapse:false,border:false,hideMode:"offsets",layout:"fit",items:a});a.parentWin=c;c.on("beforeclose",function(f,e){f.minimize()})}c.show();return c}});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Ext.Privilege.PrivilegeDataElementsConfigs",{extend:"Ext.easy.BaseElementsConfigs",constructor:function(a){a=a||{};Ext.apply(this,a);this.callParent();this.init()},init:function(){this.addCfg(EasyUtil.getBaseConfig("用户名","userName",{required:true}));this.addCfg(EasyUtil.getBaseConfig("登陆名","loginName",{required:true}));this.addCfg(EasyUtil.getBaseConfig("密码","password",{required:true,inputType:"password",hiddenColumn:true}));this.addCfg(EasyUtil.getBaseConfig("电话","phone",{hiddenColumn:true}));this.addCfg(EasyUtil.getBaseConfig("手机","mobile"));this.addCfg(EasyUtil.getBaseConfig("邮箱","email",{vtype:"email",hiddenColumn:true}))},getQueryFormItems:function(){return[this.getBaseConfigByName("userName"),this.getBaseConfigByName("loginName"),this.getBaseConfigByName("mobile")]},getQueryStaffFields:function(){var a=new Ext.util.MixedCollection();a.add(this.getConfigByName("loginName"));a.add(this.getConfigByName("userName"));a.add(this.getConfigByName("password"));a.add(this.getConfigByName("phone"));a.add(this.getConfigByName("mobile"));a.add(this.getConfigByName("email"));a.add(this.getConfigByName("updator"));a.add(this.getConfigByName("updateTime"));a.add(this.getConfigByName("id"));return a}});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Ext.Privilege.PrivilegeDataMainPanel",{extend:"Ext.panel.Panel",requires:["Ext.Privilege.PrivilegeDataElementsConfigs","Ext.Privilege.FunctionNodes"],initComponent:function(){var a=this;this.border=false;this.frame=false;this.layout="border";a.callParent();this.addPrivilegePanel()},addPrivilegePanel:function(){this.queryForm=EasyUtil.getEasyQueryForm(Ext.bind(this.doQuery,this),privilegeDataElementsConfigs.getQueryFormItems(),3);var c={xtype:"easygrid",noAutoLoad:true,region:"center",showTbar:true,showBbar:true,parentPanel:this,noNeddForceFit:true,needCheckboxColumn:true,subWindowTitle:"人员信息详情",baseParams:{queryId:"SysInfoMapper.queryUserInfo"},fields:privilegeDataElementsConfigs.getQueryStaffFields()};this.easyGrid=new Ext.ux.EasyGrid(c);var d=[];Ext.each(PRIFNS.functionNodes,function(f){var g=[];Ext.each(f.children,function(h){g.push(Ext.apply({},h))});var e={children:g};d.push(Ext.applyIf(e,f))});var b=false;var a=Ext.create("Ext.tree.Panel",{region:"east",width:200,store:Ext.create("Ext.data.TreeStore",{root:{expanded:true,children:d}}),rootVisible:false,listeners:{checkchange:function(f,e){if(f.isLeaf()){if(e){this.parentcheckchange=false;f.parentNode.set("checked",true)}else{var g=true;f.parentNode.eachChild(function(h){if(h.get("checked")){g=false;return}});if(g){this.parentcheckchange=false;f.parentNode.set("checked",false)}}}else{if(this.parentcheckchange){f.eachChild(function(h){h.set("checked",e)})}}this.parentcheckchange=true;a.getStore().sort("checked","DESC")}},dockedItems:[{xtype:"toolbar",dock:"bottom",ui:"footer",items:[{text:"收起/展开全部",iconCls:"accept",handler:function(){if(b){a.expandAll()}else{a.collapseAll()}b=!b}},{text:"保存更改",iconCls:"save",handler:Ext.bind(this.save,this)}]}]});this.tree=a;this.add([this.queryForm,this.easyGrid,this.tree])},doQuery:function(){this.tree.expandAll();EasyUtil.doEasyQuery(this.easyGrid,this.queryForm)},save:function(){var d=this.easyGrid.getSelectionModel().getSelection();if(d.length==0){Ext.Msg.alert("操作提示","请选择人员!");return}var b="";Ext.each(d,function(f){if(b.length>0){b+=","}b+=f.get("id")});var c="",a=this.tree.getChecked();Ext.each(a,function(f){if(c.length>0){c+=","}c+=f.raw.funCode});var e="sysinfo/savePrivilege.do";EasyUtil.easyAjax(e,{userIds:b,privileges:c},function(g,h){var i=Ext.decode(g.responseText);this.doQuery();var f=this.tree.getView().getRecords(this.tree.getView().getNodes());Ext.each(f,function(j){j.set("checked",false)},this);EasyUtil.alertMsg(i.success)},this)},dbClickFun:function(b){var a="sysinfo/getPrivilege.do";EasyUtil.easyAjax(a,{userId:b.get("id")},function(e,f){var d=Ext.decode(e.responseText);var c=this.tree.getView().getRecords(this.tree.getView().getNodes());Ext.each(c,function(g){g.set("checked",d[g.raw.funCode])},this)},this)},addRecord:function(a,b){EasyUtil.submitForm(b,"extjsoncontrollersuport/save.do",this,{entity:"base.UserInfo",isDoQuery:true})},updateRecord:function(b,d,a,c){EasyUtil.submitForm(c,"extjsoncontrollersuport/update.do",this,{entity:"base.UserInfo",isDoQuery:true})},afterWinShow:function(a){a.findField("loginName").setDisabled(!a.baseParams.create)},removeRecord:function(b,d,a,c){var e=false;EasyUtil.easyAjax("extjsoncontrollersuport/remove.do",{id:d.get("id"),entity:"base.UserInfo",isDoQuery:true},function(f,g){var h=Ext.decode(f.responseText);e=h.success},this,true);return e}});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("MyDesktop.Settings",{extend:"Ext.window.Window",uses:["Ext.tree.Panel","Ext.data.TreeStore","Ext.tree.View","Ext.form.field.Checkbox","Ext.layout.container.Anchor","Ext.layout.container.Border","Ext.ux.desktop.Wallpaper","MyDesktop.WallpaperModel"],layout:"anchor",title:"Change Settings",modal:true,width:640,height:480,border:false,initComponent:function(){var a=this;a.selected=a.desktop.getWallpaper();a.stretch=a.desktop.wallpaper.stretch;a.preview=Ext.create("widget.wallpaper");a.preview.setWallpaper(a.selected);a.tree=a.createTree();a.buttons=[{text:"OK",handler:a.onOK,scope:a},{text:"Cancel",handler:a.close,scope:a}];a.items=[{anchor:"0 -30",border:false,layout:"border",items:[a.tree,{xtype:"panel",title:"Preview",region:"center",layout:"fit",items:[a.preview]}]},{xtype:"checkbox",boxLabel:"Stretch to fit",checked:a.stretch,listeners:{change:function(b){a.stretch=b.checked}}}];a.callParent()},createTree:function(){var b=this;function c(d){return{img:d,text:b.getTextOfWallpaper(d),iconCls:"",leaf:true}}var a=new Ext.tree.Panel({title:"Desktop Background",rootVisible:false,lines:false,autoScroll:true,width:150,region:"west",split:true,minWidth:100,listeners:{afterrender:{fn:this.setInitialSelection,delay:100},select:this.onSelect,scope:this},store:new Ext.data.TreeStore({model:"MyDesktop.WallpaperModel",root:{text:"Wallpaper",expanded:true,children:[{text:"None",iconCls:"",leaf:true},c("farm.jpg"),c("highbuild.jpg"),c("hua.jpg"),c("blue.jpg"),c("desk.jpg"),c("desktop.jpg"),c("windows.jpg"),c("sky.jpg"),c("shine.jpg")]}})});return a},getTextOfWallpaper:function(c){var d=c,b=c.lastIndexOf("/");if(b>=0){d=d.substring(b+1)}var a=d.lastIndexOf(".");d=Ext.String.capitalize(d.substring(0,a));d=d.replace(/[-]/g," ");return d},onOK:function(){var a=this;if(a.selected){a.desktop.setWallpaper(a.selected,a.stretch)}Ext.util.Cookies.set("wallpaper",a.selected,Ext.Easy.getNewDate(28));a.destroy()},onSelect:function(a,b){var c=this;if(b.data.img){c.selected="resources/wallpapers/"+b.data.img}else{c.selected=Ext.BLANK_IMAGE_URL}c.preview.setWallpaper(c.selected)},setInitialSelection:function(){var a=this.desktop.getWallpaper();if(a){var b="/Wallpaper/"+this.getTextOfWallpaper(a);this.tree.selectPath(b,"text")}}});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("MyDesktop.WallpaperModel",{extend:"Ext.data.Model",fields:[{name:"text"},{name:"img"}]});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("MyDesktop.App",{extend:"Ext.ux.desktop.App",requires:["Ext.ux.desktop.ShortcutModel","Ext.ux.Util","Ext.easy.CommonData","MyDesktop.Settings","Ext.orgMgr.AssessOrgMgr","Ext.dataMgr.AssessDataMgr","Ext.indexMgr.AssessIndexMgr","Ext.Privilege.PrivilegeData"],init:function(){this.callParent();windowHight=Ext.getBody().getHeight()-38},getModules:function(){var modules=[];Ext.each(modelDatas,function(item){var cls=eval(item.className);modules.push(new cls({id:item.type,launcherText:item.name,iconCls:item.type}))});return modules},getDesktopConfig:function(){var c=this,b=c.callParent();var a=Ext.util.Cookies.get("wallpaper");if(!Ext.isEmpty(a)){Ext.apply(b,{wallpaper:a})}return Ext.applyIf(b,{contextMenuItems:[{text:"桌面设置",handler:c.onSettings,scope:c}],shortcuts:Ext.create("Ext.data.Store",{model:"Ext.ux.desktop.ShortcutModel",data:modelDatas}),wallpaper:"resources/wallpapers/desk.jpg",wallpaperStretch:true})},getStartConfig:function(){var b=this,a=b.callParent();return Ext.apply(a,{title:"欢迎您, "+c_privileges.loginUser+" ,今天是 "+Ext.util.Format.date(new Date(),"Y-m-d"),iconCls:"user",height:300,toolConfig:{width:100,items:[{text:"设置",iconCls:"settings",handler:b.onSettings,scope:b},"-",{text:"注销",iconCls:"logout",handler:b.onLogout,scope:b}]}})},getTaskbarConfig:function(){var a=this.callParent();return Ext.apply(a,{quickStart:[],trayItems:[{xtype:"trayclock",flex:1}]})},onLogout:function(){Ext.Msg.confirm("登出","确认退出登陆?",function(a){if(a=="yes"){window.location="login.html"}})},onSettings:function(){var a=new MyDesktop.Settings({desktop:this.desktop});a.show()}});Ext.Loader.setConfig({enabled:true});Ext.Loader.setPath({"Ext.ux.desktop":"js/core","Ext.ux":"js/ux",MyDesktop:"modules/desktop","Ext.easy":"modules/common","Ext.Sample":"modules/sample","Ext.orgMgr":"modules/assessOrgMgr","Ext.dataMgr":"modules/assessDataMgr","Ext.indexMgr":"modules/assessIndexMgr","Ext.Privilege":"modules/privilege"});Ext.require("MyDesktop.App");var myDesktopApp;var tabHeight=508;var delayTime=558;var windowHight;var windowWidth;var midwindowWidth;var miderwindowWidth;var minwindowWidth;var modelDatas=[];var c_baseDataMix;var c_privileges;var assessOrgMgrElementsConfigs;var assessDataMgrElementsConfigs;var privilegeDataElementsConfigs;Ext.onReady(function(){windowWidth=Ext.getBody().getWidth()-100;midwindowWidth=Ext.getBody().getWidth()*2/3;miderwindowWidth=Ext.getBody().getWidth()*4/5;minwindowWidth=Ext.getBody().getWidth()*3/5;var a=[{name:"评估机构管理",type:"assessOrgMgr",className:"Ext.orgMgr.AssessOrgMgr"},{name:"评估指标管理",type:"assessIndexMgr",className:"Ext.indexMgr.AssessIndexMgr"},{name:"评估数据管理",type:"assessDataMgr",className:"Ext.dataMgr.AssessDataMgr"},{name:"用户权限管理",type:"privilegeMgr",className:"Ext.Privilege.PrivilegeData"}];modelDatas=[];Ext.Ajax.request({url:"sysinfo/getLoginUser.do",async:false,success:function(b,c){c_privileges=Ext.decode(b.responseText);Ext.each(a,function(d){if(c_privileges[d.type]){modelDatas.push(d)}})}});myDesktopApp=new MyDesktop.App();new Ext.util.DelayedTask(function(){initElementsConfigs();c_baseDataMix=new Ext.util.MixedCollection();Ext.Ajax.on("requestcomplete",function(d,b,c){var e=Ext.decode(b.responseText);if(e.forwardToLogin){Ext.Msg.alert("提示信息","登陆已过期，请重新登陆!");new Ext.util.DelayedTask(function(){window.location="login.html"}).delay(2000)}})},this).delay(1000)});function initElementsConfigs(){assessOrgMgrElementsConfigs=new Ext.orgMgr.AssessOrgMgrElementsConfigs();assessDataMgrElementsConfigs=new Ext.dataMgr.AssessDataMgrElementsConfigs();privilegeDataElementsConfigs=new Ext.Privilege.PrivilegeDataElementsConfigs();privilegeDataElementsConfigs.init();assessOrgMgrElementsConfigs.init();assessDataMgrElementsConfigs.init()};