Ext.define("Ext.easy.CommonData",{singleton:true,alternateClassName:"CDM",currency:[["RMB","人民币-RMB"],["HKD","港币-HKD"],["NTD","台币-NTD"],["USD","美元-USD"],["EUR","欧元-EUR"],["GBP","英镑-GBP"]],gender:[["F","女-F"],["M","男-M"],["B","BOTH-B"]],category:[],brandName:[],sizeGroup:[],season:[],productLevel:[["1","一等品"]],exeStandard:[["1","执行标准一"],["2","执行标准二"]],safetyType:[["1","安全类别一"],["2","安全类别二"]],neckType:[["1","领形一"],["2","领形二"]],origin:[["1","货品来源一"],["2","货品来源二"]],channel:[["NT","网站"],["TB","淘宝"],["PP","拍拍"],["JD","京东"]],color:[],oneType:[],twoType:[],threeType:[],auditStatus:[[1,"待审核"],[2,"已通过"],[3,"未通过"]],warehouse:[["ZS","中山仓"],["DG","东莞仓"],["SH","上海仓"],["BJ","北京仓"]],promotionType:[["all","全场活动"],["only","产品活动"],["suit","套装活动"]],modelType:[["1","全场活动"],["2","产品活动"]],InsteadMoney:[["20","20"],["50","50"],["100","100"]],suitThingNum:[["2","2"],["3","3"],["4","4"],["5","5"]],productSource:[["ZSFty","中山工厂"],["DGFty","东莞工厂"],["SHFty","上海工厂"]],imageType:[["zoom","放大镜图(zoom)"],["index","首页图(index)"],["model","详情模特图(model)"],["order","订单小图(order)"],["back","后台展示(back)"]],imageOrder:[[1,1],[2,2],[3,3],[4,4],[5,5],[6,6],[7,7],[8,8],[9,9],[10,10]],isFreight:[["1","是"],["0","否"]],logType:[["1","模版日志"],["2","活动日志"]],operationType:[["1","新增"],["2","修改"],["3","假删除"]],enterState:[["1","待验收"],["2","待审核"],["3","审核完成"]],modelItemType:[["2","购买总金额满X免运费"],["4","购买总金额满X可享Y折"],["5","购买总金额满X立减Y元"],["7","商品直接打折"]],source:[["CC","CC"],["NT","网站"],["TB","淘宝"],["PP","拍拍"]],orderType:[[1,"订货单"],[2,"取消单"],[3,"退换货单"]],paymentMethod:[["1","货到付款"],["2","在线支付"],["3","代金券"],["4","虚拟账户"]],onlinePayment:[[1,"支付宝"],[2,"财付通"],[3,"快钱"],[4,"银联"]],invoiceType:[[1,"服装"],[2,"鞋子"],[3,"配饰"],[4,"家具"]],confirmationStatus:[[1,"待客人确认"],[2,"客人已确认"],[3,"客人不确认"]],expressCompany:[["SF","顺丰"],["EMS","EMS"]],storagType:[["1","成衣仓"],["2","辅料仓"],["3","原料仓"],["4","配料仓"]],storagState:[["1","正常"],["2","取消"]],shelfState:[["1","正常"],["2","取消"]],payStatus:[[1,"未支付"],[2,"支付成功"],[3,"待退款"],[4,"退款成功"]],prepareGoodsStatus:[[1,"未配货"],[2,"配货中"],[3,"已出库"]],logisticsStatus:[[1,"未发货"],[2,"已发货"],[3,"配送成功"],[4,"配送失败"]],refundStatus:[[1,"待退库"],[2,"已退库"]],receivingStatus:[[1,"未收货"],[2,"确认收货"]],orderStatus:[[1,"待处理"],[2,"处理中"],[3,"完成"]],priceDetailType:[[1,"产品"],[2,"活动"],[3,"订单"]],orderItemStatus:[[1,"待退"],[2,"已退"],[3,"待换"],[4,"已换"]],logisticsState:[["","请选择"],[1,"未发货"],[2,"已发货"],[3,"已收货"]],logisticsType:[["","请选择"],[1,"发货"],[2,"退货"]],refundType:[["T","退货"],["H","换货"]],invoiceState:[["","请选择"],["1","未发货"],["2","已发货"]],payItemType:[[1,"支付"],[2,"退款"]],refundsMethod:[[1,"虚拟账户"],[3,"银行转账"]],chgOrRefudReason:[["1","尺码不合适"],["2","质量问题"]],rejectionReason:[["1","尺码不合适"],["2","质量问题"],["3","快递无法送达"],["4","客人无法收货"]],deliveryTime:[[1,"工作日、双休日或假日均可送货 "],[2,"只工作日送货"],[3,"只双休日、假日送货"],[4,"只晚上或其它时间送货 (可能会超出预计送货天数)"]],returnedGoods:[["1","是"]],refundSource:[["CC","CC"],["NT","网站"]],applicationStatus:[["1","申请中"],["2","通过"],["3","未通过"]],categoryLevel:[[1,"一级大类"],[2,"二级种类"],[3,"三级种类"]],rankType:[["HOT","热销排行"],["NEW","新品区"],["SPE","特价区"]],isAdjust:[["","请选择"],[1,"无"],[2,"有"]],adjustState:[["","请选择"],[1,"盘点中"],[2,"已盘点"]],returnSignState:[["","请选择"],[1,"未签收"],[2,"已签收"]],areaLevel:[[1,"国家级"],[2,"省级"],[3,"市级"],[4,"区（县）级"]],materialType:[[1,"面料"],[2,"里料"],[3,"内料"],[4,"全部"]],sourceNoney:[["TH","退货"],["CO","撤单"],["OT","其他"]],noneyStatus:[[1,"待审核"],[2,"待退款"],[3,"已退款"],[4,"未通过"]],enterState:[["1","待验收"],["2","待审核"],["3","审核完成"],["4","已取消"]],isBuy:[[0,"否"],[1,"是"]],isDifference:[[0,"否"],[1,"是"]],isProject:[[0,"计划外"],[1,"计划内"]],sellState:[["1","未拣货 "],["2","拣货中"],["3","拣货完成"]],outState:[["1","未出库 "],["2","已出库"]],checkType:[["1","其它入库 "],["2","其它出库"]],checkState:[["1","未完成 "],["2","已完成"]],allocateState:[["1","调拨中"],["2","调拨完成"]],storagInfo:[]});var loadBaseDataFailureFun=function(){Ext.Msg.alert("操作提示","服务不可用,读取基础数据失败!")};Ext.define("Ext.easy.MemberCommonData",{singleton:true,alternateClassName:"memberCDM",sex:[["","请选择"],[1,"男"],[2,"女"]],memberLevel:[[1,"普通会员"],[2,"黄金会员"],[3,"白金会员"],[4,"钻石会员"],[5,"黑钻会员"]],addressType:[["","请选择"],["家庭地址","家庭地址"],["公司地址","公司地址"],["学校地址","学校地址"],["其它","其它"]],marriage:[["","请选择"],[1,"未婚"],[2,"已婚"]],education:[["","请选择"],["高中及以下","高中及以下"],["大学专科","大学专科"],["大学本科","大学本科"],["硕士/博士及以上","硕士/博士及以上"]],work:[["","请选择"],["企业雇主/企业经营者","企业雇主/企业经营者"],["高级行政人员(行政总裁、总经理、董事等)","高级行政人员(行政总裁、总经理、董事等)"],["中层管理人员(总监、经理、主任等)","中层管理人员(总监、经理、主任等)"],["专业人士(会计师、律师、工程师、医生、教师等)","专业人士(会计师、律师、工程师、医生、教师等)"],["办公职员(一般文职、业务、办事人员等)工人、蓝领","办公职员(一般文职、业务、办事人员等)工人、蓝领"],["工人/蓝领","工人/蓝领"],["公务员、公共事业单位员工","公务员、公共事业单位员工"],["自由职业者","自由职业者"],["军人","军人"],["学生","学生"],["退休/无业人员","退休/无业人员"],["家庭主妇","家庭主妇"],["其他","其他"]],trade:[["","请选择"],["政府机关/社会团体","政府机关/社会团体"],["邮电通讯","邮电通讯"],["IT业/互联网","IT业/互联网"],["商业/贸易","商业/贸易"],["旅游/餐饮/酒店","旅游/餐饮/酒店"],["银行/金融/证券/保险/投资","银行/金融/证券/保险/投资"],["健康/医疗服务","健康/医疗服务"],["建筑/房地产","建筑/房地产"],["交通运输/物流仓储","交通运输/物流仓储"],["法律/司法","法律/司法"],["文化/娱乐/体育","文化/娱乐/体育"],["媒介/广告/咨询","媒介/广告/咨询"],["教育/科研","教育/科研"],["林业/农业/牧业/渔业","林业/农业/牧业/渔业"],["制造业(轻工业)","制造业(轻工业)"],["制造业(重工业)","制造业(重工业)"],["能源/公用事业","能源/公用事业"],["其他","其他"]],monthlyPay:[["","请选择"],["无收入","无收入"],["2000 元以下","2000 元以下"],["2000～3999 元","2000～3999 元"],["4000～5999 元","4000～5999 元"],["6000～7999 元","6000～7999 元"],["8000～9999 元","8000～9999 元"],["10000～15000 元","10000～15000 元"],["15000 元以上","15000 元以上"]],shoesSize:[["","请选择"],["35","35"],["36","36"],["37","37"],["38","38"],["39","39"],["40","40"],["41","41"],["42","42"],["43","43"],["44","44"],["45","45"],["46","46"]],high:[["","请选择"],["150CM 以下","150CM 以下"],["150～159CM","150～159CM"],["160～164CM","160～164CM"],["165～169CM","165～169CM"],["170～174CM","170～174CM"],["175～179CM","175～179CM"],["180～184CM","180～184CM"],["185～189CM","185～189CM"],["190CM 以上","190CM 以上"]],weight:[["","请选择"],["40KG 以下","40KG 以下"],["41KG～50KG","41KG～50KG"],["51KG～55KG","51KG～55KG"],["56KG～60KG","56KG～60KG"],["61KG～70KG","61KG～70KG"],["71KG～80KG","71KG～80KG"],["81KG～100KG","81KG～100KG"],["100KG 以上","100KG 以上"]],activityType:[["","请选择"],[1,"市场促销"],[2,"项目合作"],[3,"产品促销"]],activityKind:[["","请选择"],[1,"短期"],[2,"长期"]],gainArea:[["","请选择"],[1,"网站"],[2,"CC"],[3,"零售"]],useArea:[["","请选择"],[1,"网站"],[2,"CC"],[2,"零售"]],joinLimit:[["","请选择"],[1,"不限制"],[2,"限制"]],useLimit:[["","请选择"],[1,"不限制"],[2,"限制"]],codeType:[["","请选择"],[1,"系统产生"],[2,"自定义"]],activation:[["","请选择"],[1,"是"],[2,"否"]],needPassword:[["","请选择"],[1,"是"],[2,"否"]],activateMode:[["","请选择"],[1,"网站"],[2,"短信"]],voucherStatus:[["","请选择"],[1,"未激活"],[2,"已激活"],[3,"锁定"],[4,"已使用"],[5,"已过期"]],bindMemberStatus:[["","请选择"],[1,"未绑定"],[2,"已绑定"]],usefulLife:[["","请选择"],[1,"1个月"],[2,"3个月"],[3,"6个月"],[4,"一年"],[5,"两年"]],integralSource:[["",""],[1,"注册"],[2,"购物"],[3,"完善个人资料"],[4,"评论"],[5,"邀请好友注册"],[6,"推荐会员产生第一次消费"]],integralStatus:[["",""],[1,"有效"],[2,"无效"]],integralTradeType:[["",""],[1,"新增"],[2,"扣减"],[2,"失效"]],acceptSpread:[[1,"参加"],[2,"不参加"]]});Ext.define("Ext.easy.Util",{singleton:true,alternateClassName:"Ext.Easy",requires:["Ext.ux.EasyCombo","Ext.ux.MultiSelectCombo"],getEasyQueryForm:function(d,b,c){if(!Ext.isArray(b)||b.length==0){return}var a=Ext.create("Ext.form.Panel",{border:false,region:"north",bodyStyle:"padding: 3px",defaultType:"textfield",style:"background-color: white;width:100%;",layout:{type:"table",columns:c},defaults:{labelAlign:"right",labelWidth:80},items:b,fbar:[{xtype:"button",text:"重置",handler:function(){a.getForm().reset()},iconCls:"edit"},{xtype:"button",text:"查询",iconCls:"query",handler:d}]});return a},doEasyQuery:function(b,a,d){var c=b.getStore();c.proxy.extraParams={queryId:c.proxy.extraParams.queryId};if(a){Ext.apply(c.proxy.extraParams,a.getForm().getValues())}else{if(d){Ext.apply(c.proxy.extraParams,d)}}c.loadPage(1)},getCopyConfig:function(a){return Ext.apply({},a)},getEasyForm:function(b){var a={region:b.region||"center",bodyPadding:"10 20",defaultType:"textfield",autoScroll:true,layout:{type:"table",columns:b.columnSize},defaults:{width:b.width||280,style:{marginBottom:"5px"}},items:b.items};if(b.fbar){a.fbar=b.fbar}if(b.readOnly){a.defaults.readOnly=true}if(b.labelAlign){a.defaults.labelAlign=b.labelAlign}var c=Ext.create("Ext.form.Panel",a);return c},getEasyDateCfg:function(c,b,d,e){var a={xtype:"datefield",fieldLabel:c,editable:false,width:218,name:b,format:e||"Y-m-d"};if(d){a.value=d}return a},getEasyFieldSetCfg:function(f,b,c,e,d){var a={xtype:"fieldset",title:f,collapsible:true,collapsed:e,defaultType:"textfield",autoScroll:true,layout:{type:"table",columns:c},items:b||[]};if(d){a.id=d}return a},getTextAreaCfg:function(c,b,d,e){var a={xtype:"textareafield",fieldLabel:c,name:b,colspan:2,width:d||600};if(e){a.value=e}return a},getEasyComboCfg:function(a,b,i,f,h,c,d,e){f=f||[[1,"是"],[0,"否"]];var g={xtype:"easycombo",fieldLabel:a,name:b,width:e||218,data:f};if(!Ext.isEmpty(i)){g.value=i}if(h){g.renderer=function(j){return Ext.Easy.getComboDesc(f,j)}}if(c){g.labelStyle="color:red"}if(d){g.editable=d}return g},getFieldcontainer:function(c,a,b,d){if(!d){Ext.apply(a[0],{listeners:{change:function(g,f){if(Ext.isEmpty(f)){return}var e=g.nextSibling("textfield");var h=Ext.Easy.getComboDesc(g.data,f);if(h.indexOf("-")!=-1){h=h.substring(0,h.indexOf("-"))}e.setValue(h)}}});Ext.apply(a[1],{readOnly:true})}return{xtype:"fieldcontainer",fieldLabel:c,defaultType:"textfield",layout:"column",fieldDefaults:{hideLabel:true,columnWidth:1/b},items:a}},getRandFields:function(c){var b,a;if(!c.type){var f={xtype:"datefield",format:"Y-m-d",width:100,editable:false};b=Ext.apply({name:c.name1||"beginDate",value:c.value1},f);a=Ext.apply({name:c.name2||"endDate",value:c.value2},f)}else{if(c.type=="combo"){var e={xtype:"easycombo",width:100,data:c.data};b=Ext.apply({name:c.name1||"begin",value:c.value1},e);a=Ext.apply({name:c.name2||"end",value:c.value2},e)}else{if(c.type=="number"){var e={xtype:"numberfield",hideTrigger:true,width:80};b=Ext.apply({name:c.name1||"minnum",value:c.value1},e);a=Ext.apply({name:c.name2||"maxnum",value:c.value2},e)}}}var d=[b,{xtype:"displayfield",value:"-"},a];return{xtype:"fieldcontainer",fieldLabel:c.fieldLabel,defaultType:"textfield",layout:{type:"table",columns:3},items:d}},getNewDate:function(b,a){a=a||new Date();return new Date(a.getFullYear(),a.getMonth(),a.getDate()+b)},getEasyLabel:function(b,a){return{xtype:"label",cls:a||"greenLabelTxtCls",text:b}},isFormValid:function(a){if(!a.getForm().isValid()){Ext.Msg.alert("错误提示","有必输项未填写!");return false}return true},alertMsg:function(b,a){Ext.Msg.alert("操作提示",(b?"操作成功!":"操作失败!"+(a||"")))},setFieldValue:function(k,d,e){var j=k.modifyParams;var b=k.modifyCount;var a=d.fieldLabel;var h=d.getValue();if(d.isXType("radiogroup")){d=d.getChecked()[0];h=d.initialConfig.inputValue}if(d.isXType("datefield")){h=d.rawValue}if(b==0){j.name=d.getName();j.fieldLabel=a;j.newValue=h;if(d.isXType("radiofield")){j.boxLabel=d.boxLabel}else{if(d.isXType("easycombo")){j.boxLabel=Ext.Easy.getComboDesc(d.data,h)}}k.modifyCount++}else{var g=false;for(var c=0;c<b;c++){if(c==0){if(j.name==d.getName()){j.newValue=h;j.fieldLabel=a;if(d.isXType("radiofield")){j.boxLabel=d.boxLabel}else{if(d.isXType("easycombo")){j.boxLabel=Ext.Easy.getComboDesc(d.data,h)}}g=true}}else{if(j["name_"+c]==d.getName()){j["newValue_"+c]=h;j["fieldLabel_"+c]=a;if(d.isXType("radiofield")){j["boxLabel_"+c]=d.boxLabel}else{if(d.isXType("easycombo")){j["boxLabel_"+c]=Ext.Easy.getComboDesc(d.data,h)}}g=true}}}if(!g){j["name_"+b]=d.getName();j["fieldLabel_"+b]=a;j["newValue_"+b]=h;if(d.isXType("radiofield")){j["boxLabel_"+b]=d.boxLabel}else{if(d.isXType("easycombo")){j["boxLabel_"+b]=Ext.Easy.getComboDesc(d.data,h)}}k.modifyCount++}}},initFormEvents:function(a,d){d.modifyCount=0;d.isListenable=false;d.modifyParams={};var e=a.getForm().getFields();var c=function(i){if(!this.isListenable){return}var g=i.startValue;var h=i.getValue();if(g==h){return}Ext.Easy.setFieldValue(this,i)};var b=function(h,i,g){if(!this.isListenable||i[h.items.items[0].name].length>1){return}Ext.Easy.setFieldValue(this,h,i)};var f=function(g){if(g.isXType("radiogroup")){g.on("change",Ext.bind(b,this))}else{if(!g.isXType("radiofield")){g.on("blur",Ext.bind(c,this))}}};e.each(f,d)},suspendOrResumeEvents:function(c,b){if(c){b.modifyCount=0;b.modifyParams={};var a=new Ext.util.DelayedTask(function(d){this.isListenable=d},b,[c]);a.delay(800)}else{b.isListenable=c}},setFormFieldsReaOnly:function(a,f,e){var b=e||{};var c=a.getForm().items;var d=function(g){if(!b[g.getName()]){if(g.isXType("radiogroup")){g.setDisabled(f)}else{if(g.isXType("compositefield")){g.items.each(d)}else{g.setReadOnly(f)}}}};c.each(d)},getSelectedRecord:function(a,b){var c=a.getSelectionModel();if(c.getCount()==0){Ext.Msg.alert("提示",b||"请选择一行数据");return false}else{return c.getLastSelected()}},getColumnsConfigAndFields:function(e,d,a,b,c){if(!b){d.push(Ext.create("Ext.grid.RowNumberer"))}e.each(function(h){if(d){var g={header:h.fieldLabel,dataIndex:h.name,align:"center"};if(h.hidden||h.xtype=="hidden"){g.hidden=true}if(h.renderer){Ext.apply(g,{renderer:h.renderer})}if(h.editor){if(h.editor=="date"){g.editor={xtype:"datefield",allowBlank:false,editable:false,format:h.format}}else{if(h.editor=="text"){g.editor={}}else{if(h.editor=="combo"){g.editor=Ext.apply({allowBlank:false},Ext.Easy.getEasyComboCfg("",h.name,null,h.data,h.renderer,null,h.editable))}else{if(h.editor=="number"){g.editor={xtype:"numberfield",allowBlank:!h.required,hideTrigger:true,minValue:h.minValue,allowDecimals:h.allowDecimals}}}}}}if(h.xtype=="datefield"){Ext.apply(g,{xtype:"datecolumn",format:h.format,width:c||85})}if(h.columnWidth){g.width=h.columnWidth}if(c){g.width=c}if(h.flex){g.flex=h.flex}d.push(g)}if(a){a.push({name:h.name})}return true})},createMyGrid:function(e,h,a,i,d,c,g){var j=Ext.create("Ext.data.Store",{fields:e,proxy:{type:"ajax",url:a,reader:{type:"json",root:"result"}}});var f={region:i||"center",store:j,columns:h};if(g){f.forceFit=true}if(c){f.tbar=c}if(d){f.plugins=d}var b=Ext.create("Ext.grid.Panel",f);return b},grid:function(a,d,b){var e=Ext.create("Ext.data.Store",{fields:a,proxy:{type:"ajax",url:b,reader:{type:"json",root:"result"}},autoLoad:true});var c=Ext.create("Ext.grid.Panel",{store:e,stateful:true,stateId:"stateGrid",columns:d,height:300,width:600,region:"north",viewConfig:{stripeRows:true}});return c},getRecordsToParams:function(e,g,d,f,c){d=d||"Id";f=f||false;var b=0,a=0;e.each(function(h){var l=h.get(d);if(f&&!(Ext.isEmpty(l)||h.dirty)){return true}var k=h.fields.keys;var i=h.modified;var j=true;Ext.each(k,function(o){var n=h.fields.get(o);var q=h.get(o);if(Ext.isDate(q)){q=Ext.util.Format.date(q,"Y-m-d")}if(!Ext.isEmpty(l)){var m=i[o];if(Ext.isDefined(m)){j=false;var p;if(Ext.isFunction(c.getForm)){p=c.getForm().findField(o)}if(a==0){g.itemId=l;g.itemName=o;g.itemNewValue=q;if(p){g.itemFieldLabel=p.fieldLabel;if(p.isXType("easycombo")){g.itemBoxLabel=Ext.Easy.getComboDesc(p.data,q)}}}else{g["itemId_"+a]=l;g["itemName_"+a]=o;g["itemNewValue_"+a]=q;if(p){g["itemFieldLabel_"+a]=p.fieldLabel;if(p.isXType("easycombo")){g["itemBoxLabel_"+a]=Ext.Easy.getComboDesc(p.data,q)}}}a++}}else{if(b==0){g[o]=q}else{g[o+"_"+b]=q}}return true});if(j){b++}});return[b,a]},showOrHideMask:function(b,a){if(a){if(!b.myMask){b.myMask=new Ext.LoadMask(b.getId(),{msg:"正在提交..."})}b.myMask.show()}else{b.myMask.hide()}},getComboDesc:function(a,c,d){if(!a){a=[[0,"否"],[1,"是"]]}var b=c;Ext.each(a,function(e){if((Ext.typeOf(e[0])==Ext.typeOf(c))&&c==e[0]){b=e[1];return false}return true});if(Ext.isDefined(d)&&d==c){return'<font color="red">'+b+"</font>"}return b=="请选择"?"":b},loadGridData:function(a,b){a.loadData(b||[])},easyAjax:function(b,e,a,c,d){Ext.Ajax.request({url:b,params:e,success:a,async:!d,failure:function(f,g){Ext.Msg.alert("操作提示","服务不可用,操作失败!")},scope:c})},reConfigGridBySizes:function(b,c,f,e){var d=[],a=[],g;if(f){Ext.Easy.getColumnsConfigAndFields(f,d,a,false,70);g=f}else{g=new Ext.util.MixedCollection()}Ext.each(c,function(i){d.push({header:i.sizeName,dataIndex:i.sizeCode,align:"center",width:60});a.push({name:i.sizeCode});g.add(i.sizeCode,{fieldLabel:i.sizeName,name:i.sizeCode})});if(e){Ext.Easy.getColumnsConfigAndFields(e,d,a,true,60);g.addAll(e.items)}var h=Ext.create("Ext.data.Store",{fields:a,proxy:{type:"ajax",reader:{type:"json",root:"result"}}});b.reconfigure(h,d);return g}})
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
;Ext.define("Ext.NeoEc.BaseData",{extend:"Ext.ux.desktop.Module",uses:["Ext.NeoEc.BaseDataMainPanel"],id:"basedata-win",init:function(){this.launcher={text:"基础数据管理",iconCls:"basedata",handler:this.createWindow,scope:this}},createWindow:function(){var b=this.app.getDesktop();var a=b.getWindow(this.id);if(!a){a=b.createWindow({id:this.id,title:this.launcher.text,width:minwindowWidth,height:windowHight,iconCls:this.launcher.iconCls,animCollapse:false,border:false,hideMode:"offsets",layout:"fit",items:new Ext.NeoEc.BaseDataMainPanel({desktop:b})})}a.show();return a}});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Ext.NeoEc.BaseDataElementsConfigs",{extend:"Ext.util.MixedCollection",mixins:{observable:"Ext.util.Observable",field:"Ext.form.field.Field",state:"Ext.state.Stateful",labelable:"Ext.form.Labelable"},categoryConfig:null,constructor:function(a){a=a||{};Ext.apply(this,a);this.callParent();this.init()},init:function(){var b=110;var a=[60,80,60];this.add("id",{fieldLabel:"ID",name:"id",xtype:"hidden"});this.add("updateBy",{fieldLabel:"修改人",name:"updateBy"});this.add("updateTime",{fieldLabel:"修改时间",name:"updateTime"});this.add("colorCode",{fieldLabel:"颜色编码",name:"colorCode",required:true});this.add("chnDesc",{fieldLabel:"中文描述",name:"chnDesc",required:true});this.add("engDesc",{fieldLabel:"英文描述",name:"engDesc",required:true});this.add("seasonCode",{fieldLabel:"季节编码",name:"seasonCode",required:true});this.add("seasonName",{fieldLabel:"季节名称",name:"seasonName",required:true});this.add("beginMonth",{fieldLabel:"开始月份",name:"beginMonth"});this.add("endMonth",{fieldLabel:"结束月份",name:"endMonth"});this.add("parentId",{fieldLabel:"上级编码",name:"parentId",required:true});this.add("areaLevel",Ext.apply(Ext.Easy.getEasyComboCfg("地址级别","areaLevel",null,CDM.areaLevel,true),{required:true}));this.add("areaCode",{fieldLabel:"地址编码",name:"areaCode",required:true});this.add("areaName",{fieldLabel:"地址名称",name:"areaName",required:true});this.add("chnName",{fieldLabel:"中文名称",name:"chnName"});this.add("engName",{fieldLabel:"英文名称",name:"engName"});this.add("materialCode",{fieldLabel:"材料编码",name:"materialCode",required:true});this.add("materialType",Ext.apply(Ext.Easy.getEasyComboCfg("材料类型","materialType",null,CDM.materialType,true),{required:true}));this.add("categoryCode",{fieldLabel:"种类编码",name:"categoryCode",required:true});this.add("categoryName",{fieldLabel:"种类名称",name:"categoryName",required:true});this.add("categoryLevel",Ext.apply(Ext.Easy.getEasyComboCfg("种类级别","categoryLevel",null,CDM.categoryLevel,true),{required:true}));this.add("currency",{fieldLabel:"币种",name:"currency",required:true});this.add("currencyName",{fieldLabel:"币种名称",name:"currencyName",required:true});this.add("rate",{fieldLabel:"货率",name:"rate"});this.add("brandCode",{fieldLabel:"品牌编码",name:"brandCode",required:true});this.add("brandName",{fieldLabel:"品牌名称",name:"brandName",required:true});this.add("brandDesc",{fieldLabel:"品牌描述",name:"brandDesc"});this.add("sizeGroupCode",{fieldLabel:"尺码组编码",name:"sizeGroupCode",required:true});this.add("sizeGroupName",{fieldLabel:"尺码组名称",name:"sizeGroupName",required:true});this.add("groupDesc",{fieldLabel:"尺码组描述",name:"groupDesc"});this.add("sizeCode",{fieldLabel:"尺码编码",name:"sizeCode",required:true});this.add("sizeName",{fieldLabel:"尺码名称",name:"sizeName",required:true});this.add("sizeGroupId",{fieldLabel:"尺码组ID",name:"sizeGroupId",xtype:"hidden"});this.add("baseDataTypeId",{fieldLabel:"基础数据类型ID",name:"baseDataTypeId",xtype:"hidden"});this.add("baseDataCode",{fieldLabel:"数据编码",name:"baseDataCode"});this.add("typeCode",{fieldLabel:"类型编码",name:"typeCode"})},getConfigByName:function(a,b){return Ext.apply({},this.get(a))},getValConfigByName:function(b,c){var a=Ext.apply({},this.get(b));if(a.required){Ext.apply(a,{allowBlank:false,blankText:"此字段不能为空",labelSeparator:'<font color="red">*</font>'})}if(c){a=Ext.apply(a,{colspan:c,anchor:"85%"})}if(a.name=="brandId"||a.name=="sizeGroupId"){Ext.apply(a,{readOnly:true,labelStyle:"notRequired",value:""})}return a},getBaseConfigByName:function(a){return Ext.apply({},this.get(a))},getColor:function(){var a=new Ext.util.MixedCollection();a.add(this.getValConfigByName("colorCode"));a.add(this.getValConfigByName("chnDesc"));a.add(this.getValConfigByName("engDesc"));a.add(this.get("id"));return a},getSeason:function(){var a=new Ext.util.MixedCollection();a.add(this.getValConfigByName("seasonCode"));a.add(this.getValConfigByName("seasonName"));a.add(this.get("beginMonth"));a.add(this.get("endMonth"));a.add(this.get("id"));return a},getArea:function(){var a=new Ext.util.MixedCollection();a.add(this.get("parentId"));a.add(this.getValConfigByName("areaLevel"));a.add(this.getValConfigByName("areaName"));a.add(this.getValConfigByName("areaCode"));a.add(this.get("id"));return a},getMaterial:function(){var a=new Ext.util.MixedCollection();a.add(this.getValConfigByName("materialCode"));a.add(this.getValConfigByName("materialType"));a.add(this.getValConfigByName("chnName"));a.add(this.getValConfigByName("engName"));a.add(this.get("id"));return a},getCategory:function(){var a=new Ext.util.MixedCollection();a.add(this.getValConfigByName("categoryCode"));a.add(this.getValConfigByName("categoryName"));a.add(this.getValConfigByName("categoryLevel"));a.add(this.get("id"));return a},getCurrency:function(){var a=new Ext.util.MixedCollection();a.add(this.getValConfigByName("currencyName"));a.add(this.getValConfigByName("currency"));a.add(this.getValConfigByName("rate"));a.add(this.get("id"));return a},getBrand:function(){var a=new Ext.util.MixedCollection();a.add(this.getValConfigByName("brandCode"));a.add(this.getValConfigByName("brandName"));a.add(this.getValConfigByName("brandDesc"));a.add(this.get("id"));return a},getSizeGroup:function(){var a=new Ext.util.MixedCollection();a.add(this.getValConfigByName("sizeGroupCode"));a.add(this.getValConfigByName("sizeGroupName"));a.add(this.get("groupDesc"));a.add(this.get("id"));return a},getSizeRatio:function(){var a=new Ext.util.MixedCollection();a.add(this.getValConfigByName("sizeCode"));a.add(this.getValConfigByName("sizeName"));a.add(this.get("sizeGroupId"));a.add(this.get("id"));return a},getBaseDataType:function(){var a=new Ext.util.MixedCollection();a.add(this.getValConfigByName("typeCode"));a.add(this.getValConfigByName("engDesc"));a.add(this.getValConfigByName("chnDesc"));a.add(this.get("id"));return a},getBaseData:function(){var a=new Ext.util.MixedCollection();a.add(this.getValConfigByName("baseDataCode"));a.add(this.getValConfigByName("chnDesc"));a.add(this.getValConfigByName("engDesc"));a.add(this.getValConfigByName("baseDataTypeId"));a.add(this.get("id"));return a}});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Ext.NeoEc.BaseDataMainPanel",{extend:"Ext.tab.Panel",requires:["Ext.NeoEc.BaseDataElementsConfigs","Ext.ux.EasyGrid","Ext.ux.EasyGridQuery","Ext.Component","Ext.tab.Panel","Ext.form.*"],initComponent:function(){var a=this;this.border=false;this.frame=false;this.activeTab=0;a.callParent();this.createColorPanel();this.createSeasonPanel();this.createAreaPanel();this.createMaterilPanel();this.createCategoryPanel();this.createCurrencyPanel();this.createBrandPanel();this.createSizeGroupPanel();this.createBaseDataTypePanel()},createSizeGroupPanel:function(){this.QuerySizePanel=new Ext.Base.QuerySizePanel({parentPanel:this});this.add({title:"尺码数据",tabName:"sizePanel",layout:"fit",items:this.QuerySizePanel})},createBaseDataTypePanel:function(){this.QueryBasePanel=new Ext.Base.QueryBasePanel({parentPanel:this});this.add({title:"基础数据",tabName:"basePanel",layout:"fit",items:this.QueryBasePanel})},createColorPanel:function(){var a=[baseDataElementsConfigs.getBaseConfigByName("colorCode"),baseDataElementsConfigs.getBaseConfigByName("chnDesc"),baseDataElementsConfigs.getBaseConfigByName("engDesc")];var b=Ext.Easy.getEasyQueryForm(Ext.bind(this.doColorQuery,this),a,3);this.QueryColorForm=b;var c={region:"center",xtype:"easygrid",fields:baseDataElementsConfigs.getColor(),noAutoLoad:true,showTbar:true,showBbar:true,showRemoveBtn:true,showUpateBtn:true,showSaveBtn:false,recordId:"id",overrideRemove:true,parentPanel:this,subWindowWidth:800,subWindowHeight:550,gridName:"Color",subWindowTitle:"颜色信息",desktop:this.desktop,baseParams:{queryId:"backsys.mapper.CommonDataMapper.queryColorPlan"}};this.ColorGrid=new Ext.ux.EasyGrid(c);this.add({title:"颜色数据",layout:"border",items:[this.QueryColorForm,this.ColorGrid]})},doColorQuery:function(){Ext.Easy.doEasyQuery(this.ColorGrid,this.QueryColorForm)},createSeasonPanel:function(){var a=[baseDataElementsConfigs.getBaseConfigByName("seasonCode"),baseDataElementsConfigs.getBaseConfigByName("seasonName")];var c=Ext.Easy.getEasyQueryForm(Ext.bind(this.doSeasonQuery,this),a,2);this.SeasonForm=c;var b={region:"center",xtype:"easygrid",fields:baseDataElementsConfigs.getSeason(),viewPanelClass:"Ext.Base.Season",noAutoLoad:true,showTbar:true,showBbar:true,showUpateBtn:true,showRemoveBtn:true,showSaveBtn:false,overrideRemove:true,parentPanel:this,recordId:"id",subWindowWidth:800,subWindowHeight:550,gridName:"Season",subWindowTitle:"季节信息",desktop:this.desktop,baseParams:{queryId:"backsys.mapper.CommonDataMapper.querySeasonPlan"}};this.SeasonGrid=new Ext.ux.EasyGrid(b);this.add({title:"季节数据",layout:"border",items:[this.SeasonForm,this.SeasonGrid]})},doSeasonQuery:function(){Ext.Easy.doEasyQuery(this.SeasonGrid,this.SeasonForm)},createAreaPanel:function(){var a=[baseDataElementsConfigs.getBaseConfigByName("areaCode"),baseDataElementsConfigs.getBaseConfigByName("areaName"),baseDataElementsConfigs.getBaseConfigByName("parentId"),baseDataElementsConfigs.getBaseConfigByName("areaLevel")];var b=Ext.Easy.getEasyQueryForm(Ext.bind(this.doAreaQuery,this),a,2);this.AreaForm=b;var c={region:"center",xtype:"easygrid",fields:baseDataElementsConfigs.getArea(),viewPanelClass:"Ext.Base.Area",noAutoLoad:true,showTbar:true,showBbar:true,showUpateBtn:true,showRemoveBtn:true,showSaveBtn:false,overrideRemove:true,parentPanel:this,recordId:"id",subWindowWidth:800,subWindowHeight:550,gridName:"Area",subWindowTitle:"地址信息",desktop:this.desktop,baseParams:{queryId:"backsys.mapper.CommonDataMapper.queryAreaPlan"}};this.AreaGridConfig=new Ext.ux.EasyGrid(c);this.add({title:"地址数据",layout:"border",items:[this.AreaForm,this.AreaGridConfig]})},doAreaQuery:function(){Ext.Easy.doEasyQuery(this.AreaGridConfig,this.AreaForm)},createMaterilPanel:function(){var b=[baseDataElementsConfigs.getBaseConfigByName("materialCode"),baseDataElementsConfigs.getBaseConfigByName("materialType"),baseDataElementsConfigs.getBaseConfigByName("chnName"),baseDataElementsConfigs.getBaseConfigByName("engName")];var a=Ext.Easy.getEasyQueryForm(Ext.bind(this.doMaterialQuery,this),b,2);this.MaterialForm=a;var c={region:"center",xtype:"easygrid",fields:baseDataElementsConfigs.getMaterial(),viewPanelClass:"Ext.Base.Material",noAutoLoad:true,showTbar:true,showBbar:true,showUpateBtn:true,showRemoveBtn:true,showSaveBtn:false,overrideRemove:true,parentPanel:this,recordId:"id",subWindowWidth:800,subWindowHeight:550,gridName:"Material",subWindowTitle:"材料信息",desktop:this.desktop,baseParams:{queryId:"backsys.mapper.CommonDataMapper.queryMaterialPlan"}};this.MaterialGridConfig=new Ext.ux.EasyGrid(c);this.add({title:"材料数据",layout:"border",items:[this.MaterialForm,this.MaterialGridConfig]})},doMaterialQuery:function(){Ext.Easy.doEasyQuery(this.MaterialGridConfig,this.MaterialForm)},createCategoryPanel:function(){var a=[baseDataElementsConfigs.getBaseConfigByName("categoryCode"),baseDataElementsConfigs.getBaseConfigByName("categoryName"),baseDataElementsConfigs.getBaseConfigByName("categoryLevel")];var c=Ext.Easy.getEasyQueryForm(Ext.bind(this.doCategroyQuery,this),a,3);this.CategoryForm=c;var b={region:"center",xtype:"easygrid",fields:baseDataElementsConfigs.getCategory(),noAutoLoad:true,showTbar:true,showBbar:true,showUpateBtn:true,showRemoveBtn:true,showSaveBtn:false,overrideRemove:true,parentPanel:this,recordId:"id",subWindowWidth:800,subWindowHeight:550,gridName:"Category",subWindowTitle:"种类信息",desktop:this.desktop,baseParams:{queryId:"backsys.mapper.CommonDataMapper.queryCategoryPlan"}};this.CategoryGrid=new Ext.ux.EasyGrid(b);this.add({title:"种类数据",layout:"border",items:[this.CategoryForm,this.CategoryGrid]})},doCategroyQuery:function(){Ext.Easy.doEasyQuery(this.CategoryGrid,this.CategoryForm)},createCurrencyPanel:function(){var a=[baseDataElementsConfigs.getBaseConfigByName("currencyName"),baseDataElementsConfigs.getBaseConfigByName("currency"),baseDataElementsConfigs.getBaseConfigByName("rate")];var b=Ext.Easy.getEasyQueryForm(Ext.bind(this.doCurrencyQuery,this),a,2);this.CurrencyForm=b;var c={region:"center",xtype:"easygrid",fields:baseDataElementsConfigs.getCurrency(),noAutoLoad:true,showTbar:true,showBbar:true,showRemoveBtn:true,showSaveBtn:false,overrideRemove:true,showUpateBtn:true,parentPanel:this,recordId:"id",subWindowWidth:800,subWindowHeight:550,gridName:"Currency",subWindowTitle:"币种信息",desktop:this.desktop,baseParams:{queryId:"backsys.mapper.CommonDataMapper.queryCurrencyPlan"}};this.CurrencyGridConfig=new Ext.ux.EasyGrid(c);this.add({title:"币种数据",layout:"border",items:[this.CurrencyForm,this.CurrencyGridConfig]})},doCurrencyQuery:function(){Ext.Easy.doEasyQuery(this.CurrencyGridConfig,this.CurrencyForm)},createBrandPanel:function(){this.QueryBrandPanel=new Ext.Base.QueryBrandPanel({parentPanel:this});this.add({title:"品牌数据",tabName:"brandPanel",layout:"fit",items:this.QueryBrandPanel})},removeRecord:function(c,b,a){var e="commonDataAction!deleteById.action";var d=false;Ext.Easy.easyAjax(e,{id:b.get("id"),model:a},function(f,g){var h=Ext.decode(f.responseText);d=h.success},this,true);return d},addRecord:function(c,d,b,a){d.submit({url:"commonDataAction!save.action?model="+a,success:function(e,f){Ext.Easy.alertMsg(true)},failure:function(e,f){Ext.Easy.alertMsg(false)},scope:this})},updateRecord:function(d,f,b,e,a){e.submit({url:"commonDataAction!save.action?model="+a,success:function(g,h){Ext.Easy.alertMsg(true)},failure:function(g,h){Ext.Easy.alertMsg(false)},scope:this});for(var c in b){f.set(c,b[c])}}});Ext.define("Ext.Base.QueryBrandPanel",{extend:"Ext.panel.Panel",initComponent:function(){this.border=false;this.layout="border";this.callParent();var d=[baseDataElementsConfigs.getBaseConfigByName("brandCode"),baseDataElementsConfigs.getBaseConfigByName("brandName"),baseDataElementsConfigs.getBaseConfigByName("brandDesc")];var b=Ext.Easy.getEasyQueryForm(Ext.bind(this.doBrandQuery,this),d,3);this.brandFormPanel=b;var c={region:"east",xtype:"easygridquery",fields:baseDataElementsConfigs.getCategory(),showTbar:true,showBbar:true,recordId:"id",showRemoveBtn:true,noShowUpdateBtn:true,noNeedDbClick:true,overrideRemove:true,noAutoLoad:true,overrideView:true,gridName:"BrandCategory",disabledBtn:true,subWindowWidth:380,subWindowHeight:130,subWindowTitle:"品牌种类选择窗口",viewPanelClass:"Ext.Base.BrandCategoryPanel",parentPanel:this,width:400,baseParams:{queryId:"backsys.mapper.CommonDataMapper.queryBrandCategoryPlan"},desktop:this.desktop};this.brandCategoryGrid=new Ext.ux.EasyGridQuery(c);var a={region:"center",xtype:"easygrid",fields:baseDataElementsConfigs.getBrand(),showTbar:true,showBbar:true,noAutoLoad:true,recordId:"id",showRemoveBtn:true,showUpateBtn:true,overrideRemove:true,parentPanel:this,gridName:"Brand",subWindowTitle:"品牌信息",baseParams:{queryId:"backsys.mapper.CommonDataMapper.queryBrandPlan"},desktop:this.desktop};this.brandGrid=new Ext.ux.EasyGrid(a);this.add(this.brandFormPanel);this.add(this.brandGrid);this.add(this.brandCategoryGrid)},doBrandQuery:function(){this.brandCategoryGrid.setDisabledBtn(true);Ext.Easy.doEasyQuery(this.brandGrid,this.brandFormPanel)},dbClickFun:function(a){this.brandCategoryGrid.setDisabledBtn(false);var b=this.brandCategoryGrid.getStore();b.proxy.extraParams={queryId:b.proxy.extraParams.queryId};Ext.apply(b.proxy.extraParams,{id:a.get("id"),model:"brandCategory"});b.loadPage(1)},updateRecord:function(d,e,a){for(var c in a){e.set(c,a[c])}var b=false;url="commonDataAction!save.action";Ext.Easy.easyAjax(url,{model:"Brand",id:e.get("id"),brandCode:e.get("brandCode"),brandName:e.get("brandName"),brandDesc:e.get("brandDesc")},function(f,g){var h=Ext.decode(f.responseText);b=h.success},this,true);Ext.Easy.alertMsg(b);return b},addRecord:function(b,c,a){c.submit({url:"commonDataAction!save.action?model=Brand",success:function(d,e){Ext.Easy.alertMsg(true)},failure:function(d,e){Ext.Easy.alertMsg(false)},scope:this})},removeRecord:function(c,b,a){if(a=="Brand"){var e="commonDataAction!deleteById.action";var d=false;Ext.Easy.easyAjax(e,{id:b.get("id"),model:"BrandToCategory"},function(f,g){var h=Ext.decode(f.responseText);d=h.success},this,true);Ext.Easy.easyAjax(e,{id:b.get("id"),model:a},function(f,g){var h=Ext.decode(f.responseText);d=h.success},this,true);return d}else{var e="commonDataAction!deleteById.action";var d=false;Ext.Easy.easyAjax(e,{id:b.get("id"),model:a},function(f,g){var h=Ext.decode(f.responseText);d=h.success},this,true);return d}}});Ext.define("Ext.Base.QuerySizePanel",{extend:"Ext.panel.Panel",initComponent:function(){this.border=false;this.layout="border";this.callParent();var b=[baseDataElementsConfigs.getBaseConfigByName("sizeGroupCode"),baseDataElementsConfigs.getBaseConfigByName("sizeGroupName"),baseDataElementsConfigs.getBaseConfigByName("groupDesc")];var c=Ext.Easy.getEasyQueryForm(Ext.bind(this.doSizeQuery,this),b,3);this.SizeGroupForm=c;var d={region:"center",xtype:"easygrid",fields:baseDataElementsConfigs.getSizeGroup(),viewPanelClass:"Ext.Base.Season",noAutoLoad:true,showTbar:true,showBbar:true,showUpateBtn:true,showRemoveBtn:true,showSaveBtn:false,overrideRemove:true,parentPanel:this,recordId:"id",subWindowWidth:800,subWindowHeight:550,gridName:"SizeGroup",subWindowTitle:"尺码组信息",desktop:this.desktop,baseParams:{queryId:"backsys.mapper.CommonDataMapper.querySizeGroupPlan"}};this.SizeGroupGrid=new Ext.ux.EasyGrid(d);var a={region:"east",xtype:"easygrid",fields:baseDataElementsConfigs.getSizeRatio(),viewPanelClass:"Ext.Base.Season",noAutoLoad:true,showTbar:true,showUpateBtn:true,showRemoveBtn:true,showSaveBtn:false,overrideRemove:true,parentPanel:this,recordId:"id",width:300,subWindowWidth:800,noNeedDbClick:true,disabledBtn:true,superior:"sizeGroupId",subWindowHeight:550,gridName:"SizeRatio",subWindowTitle:"尺码信息",desktop:this.desktop,url:"commonDataAction!queryData.action"};this.SizeGroRatioGrid=new Ext.ux.EasyGrid(a);this.add(this.SizeGroupForm);this.add(this.SizeGroupGrid);this.add(this.SizeGroRatioGrid)},doSizeQuery:function(){this.SizeGroRatioGrid.setDisabledBtn(true);Ext.Easy.doEasyQuery(this.SizeGroupGrid,this.SizeGroupForm)},dbClickFun:function(a){this.SizeGroRatioGrid.setDisabledBtn(false);this.SizeGroRatioGrid.getStore().load({params:{id:a.get("id"),model:"SizeRatio"}})},getSuperId:function(){return this.SizeGroupGrid.getSelectedRecord().get("id")},updateRecord:function(d,f,b,e,a){e.submit({url:"commonDataAction!save.action?model="+a,success:function(g,h){Ext.Easy.alertMsg(true)},failure:function(g,h){Ext.Easy.alertMsg(false)},scope:this});for(var c in b){f.set(c,b[c])}},addRecord:function(c,d,b,a){d.submit({url:"commonDataAction!save.action?model="+a,success:function(e,f){Ext.Easy.alertMsg(true)},failure:function(e,f){Ext.Easy.alertMsg(false)},scope:this})},removeRecord:function(c,b,a){if(a=="SizeGroup"){var e="commonDataAction!deleteById.action";var d=false;Ext.Easy.easyAjax(e,{id:b.get("id"),model:a+"ToList"},function(f,g){var h=Ext.decode(f.responseText);d=h.success},this,true);Ext.Easy.easyAjax(e,{id:b.get("id"),model:a},function(f,g){var h=Ext.decode(f.responseText);d=h.success},this,true);return d}else{var e="commonDataAction!deleteById.action";var d=false;Ext.Easy.easyAjax(e,{id:b.get("id"),model:a},function(f,g){var h=Ext.decode(f.responseText);d=h.success},this,true);return d}}});Ext.define("Ext.Base.QueryBasePanel",{extend:"Ext.panel.Panel",initComponent:function(){this.border=false;this.layout="border";this.callParent();var a=[baseDataElementsConfigs.getBaseConfigByName("typeCode"),baseDataElementsConfigs.getBaseConfigByName("engDesc"),baseDataElementsConfigs.getBaseConfigByName("chnDesc")];var c=Ext.Easy.getEasyQueryForm(Ext.bind(this.doBaseQuery,this),a,3);this.BaseDataTypeForm=c;var d={region:"center",xtype:"easygrid",fields:baseDataElementsConfigs.getBaseDataType(),noAutoLoad:true,showTbar:true,showBbar:true,showUpateBtn:true,showRemoveBtn:true,showSaveBtn:false,overrideRemove:true,parentPanel:this,recordId:"id",subWindowWidth:800,subWindowHeight:550,gridName:"BaseDataType",subWindowTitle:"基础数据类型信息",desktop:this.desktop,baseParams:{queryId:"backsys.mapper.CommonDataMapper.queryBaseDataTypePlan"}};this.BaseDataTypeGrid=new Ext.ux.EasyGrid(d);var b={region:"east",xtype:"easygrid",fields:baseDataElementsConfigs.getBaseData(),noAutoLoad:true,showTbar:true,showUpateBtn:true,showRemoveBtn:true,showSaveBtn:false,overrideRemove:true,parentPanel:this,recordId:"id",width:400,disabledBtn:true,noNeedDbClick:true,superior:"baseDataTypeId",subWindowWidth:800,subWindowHeight:550,gridName:"BaseData",subWindowTitle:"基础数据信息",desktop:this.desktop,url:"commonDataAction!queryData.action"};this.BaseDataGridGrid=new Ext.ux.EasyGrid(b);this.add(this.BaseDataTypeForm);this.add(this.BaseDataTypeGrid);this.add(this.BaseDataGridGrid)},doBaseQuery:function(){this.BaseDataGridGrid.setDisabledBtn(true);Ext.Easy.doEasyQuery(this.BaseDataTypeGrid,this.BaseDataTypeForm)},dbClickFun:function(a){this.BaseDataGridGrid.setDisabledBtn(false);this.BaseDataGridGrid.getStore().load({params:{id:a.get("id"),model:"BaseData"}})},getSuperId:function(){return this.BaseDataTypeGrid.getSelectedRecord().get("id")},updateRecord:function(d,f,b,e,a){e.submit({url:"commonDataAction!save.action?model="+a,success:function(g,h){Ext.Easy.alertMsg(true)},failure:function(g,h){Ext.Easy.alertMsg(false)},scope:this});for(var c in b){f.set(c,b[c])}},addRecord:function(c,d,b,a){d.submit({url:"commonDataAction!save.action?model="+a,success:function(e,f){Ext.Easy.alertMsg(true)},failure:function(e,f){Ext.Easy.alertMsg(false)},scope:this})},removeRecord:function(c,b,a){if(a=="BaseDataType"){var e="commonDataAction!deleteById.action";var d=false;Ext.Easy.easyAjax(e,{id:b.get("id"),model:a+"ToList"},function(f,g){var h=Ext.decode(f.responseText);d=h.success},this,true);Ext.Easy.easyAjax(e,{id:b.get("id"),model:a},function(f,g){var h=Ext.decode(f.responseText);d=h.success},this,true);return d}else{var e="commonDataAction!deleteById.action";var d=false;Ext.Easy.easyAjax(e,{id:b.get("id"),model:a},function(f,g){var h=Ext.decode(f.responseText);d=h.success},this,true);return d}}});Ext.define("Ext.Base.BrandCategoryPanel",{extend:"Ext.panel.Panel",initComponent:function(){this.border=false;this.bodyPadding=5;this.layout={type:"table",columns:2};var a=Ext.Easy.getEasyComboCfg("种类列表","selectColor",null,CDM.category,null,null,true,230);this.combo=new Ext.ux.EasyCombo(Ext.apply(a,{labelWidth:60}));this.items=[this.combo,{xtype:"button",text:"增加此种类",iconCls:"accept",handler:Ext.bind(this.addColor,this)},Ext.Easy.getEasyLabel("温馨提示：可输入种类编码/种类级别/种类名称,查找种类")];this.fbar=[{xtype:"button",text:"完成并返回",iconCls:"back",handler:Ext.bind(this.closeWin,this)}];this.callParent()},addColor:function(){var a=this.combo.getValue();var c=this.combo.getRawValue().split("/");var b=this.parentPanel.brandCategoryGrid.getStore();var g=false;b.each(function(h){if(h.get("categoryCode")==c[0]){g=true;return false}},this);if(g){Ext.Msg.alert("操作提示","已有此种类，请增加其它种类!")}else{var f={categoryId:a,id:a,categoryCode:c[0],categoryLevel:c[1],categoryName:c[2],brandId:this.parentPanel.brandGrid.getSelectedRecord().get("id")};var e="commonDataAction!save.action";b.loadData([f],true);var d=false;Ext.Easy.easyAjax(e,{brandId:f.brandId,model:"BrandCategory",categoryId:a},function(h,i){var j=Ext.decode(h.responseText);d=j.success},this,true);return d}},closeWin:function(){this.parentWin.close()},setParentWin:function(a){this.parentWin=a}});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Ext.Product.ProductData",{extend:"Ext.ux.desktop.Module",uses:["Ext.Product.ProductDataMainPanel"],id:"product-win",init:function(){this.launcher={text:"产品管理",iconCls:"product",handler:this.createWindow,scope:this}},createWindow:function(){var d=this.app.getDesktop();var c=d.getWindow(this.id);if(!c){var b=midwindowWidth;var a=new Ext.Product.ProductDataMainPanel({parentWinWidth:b,desktop:d});c=d.createWindow({id:this.id,title:this.launcher.text,width:b,height:windowHight,iconCls:this.launcher.iconCls,animCollapse:false,border:false,hideMode:"offsets",layout:"fit",items:a});a.parentWin=c}c.show();return c}});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Ext.Product.ProductDataElementsConfigs",{extend:"Ext.util.MixedCollection",constructor:function(a){a=a||{};Ext.apply(this,a);this.callParent();this.loadBaseData()},loadBaseData:function(){Ext.Ajax.request({url:"commonDataAction!loadBaseDatas.action",async:false,success:function(a,b){var c=Ext.decode(a.responseText);CDM.brandName=[];Ext.each(c.result.Brand,function(d){CDM.brandName.push([d.brandCode,d.brandName])});CDM.sizeGroup=[];Ext.each(c.result.SizeGroup,function(d){CDM.sizeGroup.push([d.sizeGroupCode,d.sizeGroupName+"-"+d.sizeGroupCode])});CDM.season=[];Ext.each(c.result.Season,function(d){CDM.season.push([d.seasonCode,d.seasonName+"-"+d.seasonCode])});CDM.color=[];Ext.each(c.result.Color,function(d){CDM.color.push([d.id,d.colorCode+"/"+d.engDesc+"/"+d.chnDesc])});CDM.category=[];CDM.oneType=[];CDM.twoType=[];CDM.threeType=[];Ext.each(c.result.Category,function(d){if(d.categoryLevel==1){CDM.oneType.push([d.categoryCode,d.categoryName+"-"+d.categoryCode+""])}if(d.categoryLevel==2){CDM.twoType.push([d.categoryCode,d.categoryName+"-"+d.categoryCode+""])}if(d.categoryLevel==3){CDM.threeType.push([d.categoryCode,d.categoryName+"-"+d.categoryCode+""])}CDM.category.push([d.id,d.categoryCode+"/"+d.categoryLevel+"/"+d.categoryName])});this.init()},failure:loadBaseDataFailureFun,scope:this})},init:function(){this.add("ID",{xtype:"hidden",fieldLabel:"ID",name:"ID"});this.add("productCode",{fieldLabel:"产品编号",name:"productCode",required:true});this.add("productName",{fieldLabel:"产品名称",name:"productName"});this.add("defaultImage",{fieldLabel:"产品图片",name:"defaultImage"});this.add("brandCode",Ext.apply(Ext.Easy.getEasyComboCfg("品牌","brandCode",null,CDM.brandName,true),{required:true,columnWidth:0.6}));this.add("brandName",{fieldLabel:"品牌名称",name:"brandName",columnWidth:0.4});this.add("categoryCode1",Ext.apply(Ext.Easy.getEasyComboCfg("一级分类","oneType",null,CDM.oneType,true,null,true),{columnWidth:0.6}));this.add("categoryCode2",Ext.apply(Ext.Easy.getEasyComboCfg("二级分类","twoType",null,CDM.twoType,true,null,true),{columnWidth:0.6}));this.add("categoryCode3",Ext.apply(Ext.Easy.getEasyComboCfg("三级分类","threeType",null,CDM.threeType,true,null,true),{columnWidth:0.6}));this.add("oneTypeName",{fieldLabel:"一级分类名称",name:"oneTypeName",columnWidth:0.4});this.add("twoTypeName",{fieldLabel:"二级分类名称",name:"twoTypeName",columnWidth:0.4});this.add("threeTypeName",{fieldLabel:"三级分类名称",name:"threeTypeName",columnWidth:0.4});this.add("categoryCode",{fieldLabel:"种类名称",name:"categoryCode"});this.add("sizeGroup",Ext.apply(Ext.Easy.getEasyComboCfg("尺寸组编号","sizeGroup",null,CDM.sizeGroup,null,null,true),{required:true,columnWidth:0.6}));this.add("sizeRatios",{fieldLabel:"尺寸组名称",name:"sizeRatios",columnWidth:0.4});this.add("year",Ext.apply(Ext.Easy.getEasyComboCfg("年份季节","year",null,CDM.season,null,null,true),{columnWidth:0.6}));this.add("season",{fieldLabel:"季节",name:"season",columnWidth:0.4});this.add("sellingPoints",{xtype:"textarea",fieldLabel:"保养说明",name:"sellingPoints"});this.add("description",{xtype:"textarea",fieldLabel:"产品描述",name:"description"});this.add("genderCode",Ext.apply(Ext.Easy.getEasyComboCfg("性别编号","gender",null,CDM.gender),{columnWidth:0.6}));this.add("gender",{fieldLabel:"性别",name:"genderName",columnWidth:0.4});this.add("currencyCode",Ext.apply(Ext.Easy.getEasyComboCfg("币种","currency",null,CDM.currency,true),{columnWidth:0.6}));this.add("currency",{fieldLabel:"币种名称",name:"currencyName",columnWidth:0.4});this.add("retailPrice",{xtype:"numberfield",hideTrigger:true,fieldLabel:"吊牌价",name:"retailPrice"});this.add("webRetailPrice",{xtype:"numberfield",hideTrigger:true,fieldLabel:"网站售价",flex:1,name:"webRetailPrice"});this.add("webDiscount",{xtype:"numberfield",hideTrigger:true,fieldLabel:"网站折扣率",name:"webDiscount"});this.add("referencePrice",{xtype:"numberfield",hideTrigger:true,fieldLabel:"参考成本",name:"referencePrice"});this.add("colors",{fieldLabel:"颜色",name:"colors"});this.add("materials",{fieldLabel:"原料成份",name:"materials"});this.add("neckType",Ext.Easy.getEasyComboCfg("领形","neckType",null,CDM.neckType));this.add("toMarketDate",Ext.Easy.getEasyDateCfg("上市日期","toMarketDate"));this.add("toWebDate",Ext.Easy.getEasyDateCfg("上架日期","toWebDate"));this.add("productLevel",Ext.Easy.getEasyComboCfg("产品等级","productLevel",null,CDM.productLevel));this.add("origin",Ext.Easy.getEasyComboCfg("货品来源","origin",null,CDM.origin));this.add("factureNo",{fieldLabel:"工艺号",name:"factureNo"});this.add("costAccountingType",{xtype:"radiogroup",fieldLabel:"成本计算方法",items:[{boxLabel:"先进先出",name:"costAccountingType",inputValue:"1",checked:true},{boxLabel:"后进先出",name:"costAccountingType",inputValue:"2"}]});this.add("salesVolume",{fieldLabel:"销量",name:"salesVolume"});this.add("appraiseLevel",{fieldLabel:"评价级别",name:"appraiseLevel"});this.add("beShow",{xtype:"radiogroup",fieldLabel:"网站是否展示",columns:3,items:[{boxLabel:"是",name:"beShow",inputValue:"1"},{boxLabel:"否",name:"beShow",inputValue:"0",checked:true}]});this.add("beSale",{xtype:"radiogroup",fieldLabel:"网站是否售卖",columns:3,items:[{boxLabel:"是",name:"beSale",inputValue:"1"},{boxLabel:"否",name:"beSale",inputValue:"0",checked:true}]});this.add("designColor",{fieldLabel:"花色",name:"designColor"});this.add("exeStandard",Ext.Easy.getEasyComboCfg("执行标准","exeStandard",null,CDM.exeStandard));this.add("safetyType",Ext.Easy.getEasyComboCfg("安全类别","safetyType",null,CDM.safetyType));this.add("createTime",{fieldLabel:"创建时间",name:"createTime"});this.add("createBy",{fieldLabel:"创建人",name:"createBy"});this.add("updateBy",{fieldLabel:"修改人",name:"updateBy"});this.add("updateTime",{fieldLabel:"修改时间",name:"updateTime"});this.add("questionsRandDate",Ext.Easy.getRandFields({fieldLabel:"咨询日期",name1:"questBeginDate",name2:"questEndDate"}));this.add("replyRandDate",Ext.Easy.getRandFields({fieldLabel:"回复日期",name1:"replyBeginDate",name2:"replyEndDate"}));this.add("commentsRandDate",Ext.Easy.getRandFields({fieldLabel:"评论日期"}));var j=new Ext.util.MixedCollection();j.add("colorCode",{fieldLabel:"色号",name:"colorCode"});j.add("engDesc",{fieldLabel:"颜色英文名",name:"colorEN"});j.add("chnDesc",{fieldLabel:"颜色中文名",name:"colorCN"});j.add("sizeCode",{fieldLabel:"尺寸代码",name:"sizeCode"});j.add("size",{fieldLabel:"尺寸名称",name:"sizeName"});j.add("barCode",{fieldLabel:"产品条形码",name:"barCode"});this.barCodes=j;var e=new Ext.util.MixedCollection();e.add("imageName",{fieldLabel:"图片名称",name:"imageName",anchor:"98%",required:true});e.add("colorCode",Ext.apply(Ext.Easy.getEasyComboCfg("图片对应的产品颜色","colorCode",null,null,null,null,true),{required:true}));e.add("imageType",Ext.apply(Ext.Easy.getEasyComboCfg("图片分类","imageType",null,CDM.imageType,null,null,null,152),{required:true}));e.add("imageOrder",Ext.apply(Ext.Easy.getEasyComboCfg("展示顺序","imageOrder",null,CDM.imageOrder,null,null,true,66),{required:true}));e.add("ID",this.getBaseConfigByName("ID"));e.add("imagePath",{xtype:"hidden",fieldLabel:"图片路径",name:"imagePath"});this.image=e;var a=new Ext.util.MixedCollection();a.add(this.getBaseConfigByName("ID"));a.add("colorId",{fieldLabel:"颜色ID",name:"colorId",hiddenColumn:true});a.add("colorCode",{fieldLabel:"色号",name:"colorCode"});a.add("engDesc",{fieldLabel:"英文名称",name:"engDesc"});a.add("chnDesc",{fieldLabel:"中文名称",name:"chnDesc"});this.colors=a;var d=new Ext.util.MixedCollection();d.add("updateBy",{fieldLabel:"修改人",name:"updateBy"});d.add("updateBy",{fieldLabel:"修改人",name:"updateBy"});d.add("updateBy",{fieldLabel:"修改人",name:"updateBy"});d.add("updateBy",{fieldLabel:"修改人",name:"updateBy"});d.add("updateBy",{fieldLabel:"修改人",name:"updateBy"});d.add("updateBy",{fieldLabel:"修改人",name:"updateBy"});d.add("updateBy",{fieldLabel:"修改人",name:"updateBy"});this.productMaintain=d;var g=new Ext.util.MixedCollection();g.add(this.getBaseConfigByName("currencyCode"));g.add("retailPrice",{xtype:"numberfield",hideTrigger:true,fieldLabel:"售价",name:"retailPrice"});g.add("channel",Ext.Easy.getEasyComboCfg("渠道","channel","NT",CDM.channel,true));g.add(this.getBaseConfigByName("ID"));this.price=g;var f=new Ext.util.MixedCollection();f.add("updateBy",{fieldLabel:"修改人",name:"updateBy",flex:1});f.add("updateTime",{fieldLabel:"修改时间",name:"updateTime",flex:2});f.add("content",{xtype:"textarea",fieldLabel:"修改内容",name:"content",colspan:2,width:450,flex:4});this.log=f;var c=10;var b=function(k){if(k&&k.length>c){return k.substring(0,c)+"..."}return k};var i=new Ext.util.MixedCollection();i.add("commentsName",{fieldLabel:"评论人",name:"commentsName",flex:2});i.add("commentsTime",{fieldLabel:"评论时间",name:"commentsTime",flex:3});i.add("comfortable",{fieldLabel:"舒适度评分",name:"comfortable",flex:1});i.add("appearance",{fieldLabel:"外观评分",name:"appearance",flex:1});i.add("sizeDeviation",{fieldLabel:"尺码适度",name:"sizeDeviation",flex:1});i.add("levelNum",{xtype:"numberfield",hideTrigger:true,readOnly:false,flex:1,fieldLabel:"展示等级",name:"levelNum",hiddenColumn:true});i.add("commentsContent",{xtype:"textarea",colspan:2,width:450,grow:true,flex:4,fieldLabel:"评论内容 ",name:"commentsContent",renderer:b});this.comments=i;var h=new Ext.util.MixedCollection();h.add("questionsName",{fieldLabel:"咨询人",name:"questionsName",flex:2});h.add("questionsTime",{fieldLabel:"咨询时间",name:"questionsTime",flex:3});h.add("replyName",{fieldLabel:"答复人",name:"replyName",hiddenColumn:true});h.add("replyTime",{fieldLabel:"答复时间",name:"replyTime",hiddenColumn:true});h.add("questionsContent",{xtype:"textarea",colspan:2,width:450,flex:4,grow:true,fieldLabel:"咨询内容",name:"questionsContent",renderer:b});h.add("replyContent",{xtype:"textarea",colspan:2,width:450,flex:4,grow:true,fieldLabel:"答复内容 ",name:"replyContent",readOnly:false,renderer:b});h.add(this.getBaseConfigByName("ID"));this.add("isreply",Ext.Easy.getEasyComboCfg("已回复","isreply"));this.consulting=h},getConfigByName:function(b,c){var a=Ext.apply({},this.get(b));if(a.required){Ext.apply(a,{allowBlank:false,blankText:"此字段不能为空",labelSeparator:'<font color="red">*</font>'})}if(c){a=Ext.apply(a,{colspan:c,width:650,grow:true})}return a},getProductByName:function(a){var b=new Ext.util.MixedCollection();b.add(this.getBaseConfigByName("productCode"));b.add(this.getBaseConfigByName("productName"));return b},getBaseConfigByName:function(a){return Ext.apply({},this.get(a))},getColorConfig:function(){return this.colors},getImageConfigByName:function(b){var a=Ext.apply({},this.image.get(b));if(a.required){Ext.apply(a,{allowBlank:false,blankText:"此字段不能为空",labelSeparator:'<font color="red">*</font>'})}return a},getPriceConfig:function(){return this.price},getBarcodesConfig:function(){return this.barCodes},getLog:function(){return this.log},getImage:function(){return this.image},getQueryProductFields:function(){var a=new Ext.util.MixedCollection();a.add(Ext.apply({colspan:2},this.get("productCode")));a.add(Ext.apply({flex:1.5},this.getBaseConfigByName("productName")));a.add(this.getBaseConfigByName("brandName"));a.add(this.getBaseConfigByName("factureNo"));a.add(Ext.apply(this.getBaseConfigByName("webDiscount"),{hiddenColumn:true}));a.add(Ext.apply(this.getBaseConfigByName("sizeGroup"),{hiddenColumn:true}));a.add(Ext.apply(this.getBaseConfigByName("retailPrice"),{hiddenColumn:true}));a.add(Ext.apply(this.getBaseConfigByName("webRetailPrice"),{hiddenColumn:true}));a.add(Ext.apply(this.getBaseConfigByName("categoryCode1"),{hiddenColumn:true}));a.add(Ext.apply(this.getBaseConfigByName("categoryCode2"),{hiddenColumn:true}));a.add(Ext.apply(this.getBaseConfigByName("categoryCode3"),{hiddenColumn:true}));a.add(this.get("ID"));return a},getQueryConsultingFields:function(b){if(b){var a=new Ext.util.MixedCollection();a.add(Ext.apply({colspan:2},this.get("productCode")));a.add(Ext.Easy.getCopyConfig(this.consulting.get("questionsName")));a.add(this.consulting.get("questionsTime"));a.add(Ext.applyIf({hiddenColumn:false},this.consulting.get("replyName")));a.add(Ext.applyIf({hiddenColumn:false},this.consulting.get("replyTime")));a.add(this.consulting.get("questionsContent"));a.add(this.consulting.get("replyContent"));a.add(this.get("ID"));return a}return this.consulting},getQueryConsultingConditionsItems:function(){return[this.getBaseConfigByName("productCode"),Ext.Easy.getCopyConfig(this.consulting.get("questionsName")),Ext.Easy.getCopyConfig(this.consulting.get("replyName")),this.getBaseConfigByName("isreply"),this.get("questionsRandDate"),this.get("replyRandDate")]},getQueryCommentsFields:function(b){if(b){var a=new Ext.util.MixedCollection();a.add(Ext.apply({colspan:2},this.get("productCode")));a.add(this.comments.get("commentsName"));a.add(this.comments.get("commentsTime"));a.add(this.comments.get("comfortable"));a.add(this.comments.get("appearance"));a.add(this.comments.get("sizeDeviation"));a.add(Ext.applyIf({hiddenColumn:false},this.comments.get("levelNum")));a.add(this.comments.get("commentsContent"));a.add(this.getBaseConfigByName("ID"));return a}return this.comments},getQueryCommentsConditionsItems:function(){return[this.getBaseConfigByName("productCode"),this.get("commentsRandDate"),Ext.Easy.getCopyConfig(this.comments.get("comfortable")),Ext.Easy.getCopyConfig(this.comments.get("appearance")),Ext.Easy.getCopyConfig(this.comments.get("commentsName")),Ext.Easy.getCopyConfig(this.comments.get("sizeDeviation"))]},getInventoryPre:function(){var a=new Ext.util.MixedCollection();a.add("productColorNo",{fieldLabel:"色号",name:"productColorNo"});a.add("productColorEn",{fieldLabel:"颜色英文名",name:"productColorEn",flex:1});a.add("productColorCn",{fieldLabel:"颜色中文名",name:"productColorCn",flex:1});return a},getInventoryTailf:function(){var a=new Ext.util.MixedCollection();a.add("totalCount",{fieldLabel:"总数量",name:"totalCount"});return a},getSizeRefPre:function(){var a=new Ext.util.MixedCollection();a.add({fieldLabel:"部位",name:"part"});return a},getSizeRefTailf:function(){var a=new Ext.util.MixedCollection();a.add({xtype:"hidden",fieldLabel:"ID",name:"id"});return a}});Ext.define("Ext.ux.ProductTrigger",{extend:"Ext.form.field.Trigger",alias:"widget.producttrigger",triggerCls:"x-form-date-trigger",initComponent:function(){this.onTriggerClick=Ext.bind(this.clickFun,this);this.callParent()},clickFun:function(){if(!this.pwin){this.queryForm=Ext.Easy.getEasyQueryForm(Ext.bind(this.doQuery,this),[productDataElementsConfigs.getBaseConfigByName("productCode"),productDataElementsConfigs.getBaseConfigByName("brandCode"),productDataElementsConfigs.getBaseConfigByName("productName"),productDataElementsConfigs.getBaseConfigByName("factureNo")],2);var a={xtype:"easygridquery",region:"center",showBbar:true,overrideView:true,parentPanel:this,noNeddForceFit:true,baseParams:{queryId:"backsys.mapper.ProductManageMapper.queryProductPlan"},fields:productDataElementsConfigs.getQueryProductFields()};this.easyGrid=new Ext.ux.EasyGridQuery(a);this.pwin=Ext.widget("window",{width:600,height:500,closeAction:"hide",title:"产品查找",layout:"border",items:[this.queryForm,this.easyGrid]})}this.pwin.show()},viewRecord:function(a){this.parentPanel.loadData(a.get("ID"),a);this.pwin.hide()},doQuery:function(){Ext.Easy.doEasyQuery(this.easyGrid,this.queryForm)}});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Ext.Product.ProductDataMainPanel",{extend:"Ext.tab.Panel",requires:["Ext.Product.ProductDataElementsConfigs","Ext.ux.IconBrowser"],initComponent:function(){var a=this;this.border=false;this.frame=false;this.activeItem=8;this.isNew=true;a.callParent();this.createProductPanel();this.createColorsPanel();this.createImagePanel();this.createBarCodesPanel();this.createInventoryPanel();this.createSizeRefPanel();this.createCommentsPanel();this.createLogPanel();new Ext.util.DelayedTask(function(){this.setActiveTab(0);this.on("beforetabchange",Ext.bind(this.onTabActive,this))},this).delay(1000)},createProductPanel:function(){var c=Ext.create("Ext.ux.ProductTrigger",Ext.apply({parentPanel:this},productDataElementsConfigs.getConfigByName("productCode")));var b=[c,productDataElementsConfigs.getConfigByName("productName"),Ext.Easy.getFieldcontainer("品牌",[productDataElementsConfigs.getConfigByName("brandCode"),productDataElementsConfigs.getConfigByName("brandName")],2),Ext.Easy.getFieldcontainer("一级分类",[productDataElementsConfigs.getConfigByName("categoryCode1"),productDataElementsConfigs.getConfigByName("oneTypeName")],2),Ext.Easy.getFieldcontainer("性别",[productDataElementsConfigs.getConfigByName("genderCode"),productDataElementsConfigs.getConfigByName("gender")],2),Ext.Easy.getFieldcontainer("二级分类",[productDataElementsConfigs.getConfigByName("categoryCode2"),productDataElementsConfigs.getConfigByName("twoTypeName")],2),Ext.Easy.getFieldcontainer("尺寸组",[productDataElementsConfigs.getConfigByName("sizeGroup"),productDataElementsConfigs.getConfigByName("sizeRatios")],2),Ext.Easy.getFieldcontainer("三级分类",[productDataElementsConfigs.getConfigByName("categoryCode3"),productDataElementsConfigs.getConfigByName("threeTypeName")],2),Ext.Easy.getFieldcontainer("年份季节",[productDataElementsConfigs.getConfigByName("year"),productDataElementsConfigs.getConfigByName("season")],2),Ext.Easy.getFieldcontainer("币种名称",[productDataElementsConfigs.getConfigByName("currencyCode"),productDataElementsConfigs.getConfigByName("currency")],2),productDataElementsConfigs.getConfigByName("retailPrice"),productDataElementsConfigs.getConfigByName("webRetailPrice"),productDataElementsConfigs.getConfigByName("webDiscount"),productDataElementsConfigs.getConfigByName("referencePrice"),productDataElementsConfigs.getConfigByName("neckType"),productDataElementsConfigs.getConfigByName("toMarketDate"),productDataElementsConfigs.getConfigByName("productLevel"),productDataElementsConfigs.getConfigByName("toWebDate"),productDataElementsConfigs.getConfigByName("origin"),productDataElementsConfigs.getConfigByName("costAccountingType"),productDataElementsConfigs.getConfigByName("safetyType"),productDataElementsConfigs.getConfigByName("beShow"),productDataElementsConfigs.getConfigByName("exeStandard"),productDataElementsConfigs.getConfigByName("beSale"),productDataElementsConfigs.getConfigByName("factureNo"),{xtype:"label"},productDataElementsConfigs.getConfigByName("materials"),{xtype:"label"},productDataElementsConfigs.getConfigByName("sellingPoints",2),productDataElementsConfigs.getConfigByName("description",2),productDataElementsConfigs.getConfigByName("ID")];var d=Ext.Easy.getEasyForm({items:b,columnSize:2});this.baseInfoForm=d;var a=d.query("easycombo");Ext.each(a,function(e){e.on("select",function(g){this.doLayout()},this)},d);Ext.Easy.initFormEvents(this.baseInfoForm,this);Ext.Easy.suspendOrResumeEvents(false,this);this.add({title:"产品基本资料",tabName:"productInfo",layout:"fit",items:d,fbar:[{xtype:"label",html:'<font color="green" size="2">注意：选择网站售卖时，应确保产品信息已完善!</font>'},{text:"新增",iconCls:"add",handler:Ext.bind(this.addProduct,this)},{text:"保存",iconCls:"accept",handler:Ext.bind(this.save,this)}]})},createImagePanel:function(){this.ImagePanel=new Ext.Product.ImagePanel({parentPanel:this});this.add({title:"产品图片",tabName:"ImagePanel",layout:"fit",items:this.ImagePanel})},createColorsPanel:function(){this.ColorPricePanel=new Ext.Product.ColorPricePanel({parentPanel:this});this.add({title:"颜色和价格",tabName:"ColorPricePanel",layout:"fit",items:this.ColorPricePanel})},createBarCodesPanel:function(){this.BarCodesPanel=new Ext.Product.BarCodesPanel({parentPanel:this});this.add({title:"产品条形码",tabName:"BarCodesPanel",layout:"fit",items:this.BarCodesPanel})},createMaintainPanel:function(){this.MaintainPanel=new Ext.Product.MaintainPanel({parentPanel:this});this.add({title:"产品保养说明",tabName:"MaintainPanel",layout:"fit",items:this.MaintainPanel})},createSizeRefPanel:function(){this.SizeRefPanel=new Ext.Product.SizeRefPanel({parentPanel:this});this.add({title:"尺码计算参照",tabName:"SizeRefPanel",layout:"fit",items:this.SizeRefPanel})},createCommentsPanel:function(){this.CommentsPanel=new Ext.Product.CommentsPanel({parentPanel:this});this.add({title:"咨询与评论",tabName:"CommentsPanel",layout:"fit",items:this.CommentsPanel})},createInventoryPanel:function(){this.InventoryPanel=new Ext.Product.InventoryPanel({parentPanel:this});this.add({title:"产品库存查询",tabName:"InventoryPanel",layout:"fit",items:this.InventoryPanel})},createLogPanel:function(){var a={xtype:"easygrid",fields:productDataElementsConfigs.getLog(),formItemsReadOnly:true,noNeddForceFit:true,noAutoLoad:true,subWindowTitle:"日志窗口"};this.easyLogGrid=new Ext.ux.EasyGrid(a);this.add({title:"操作日志",tabName:"logTab",layout:"fit",items:this.easyLogGrid})},getBaseInfoFrom:function(){var a=[productDataElementsConfigs.getBaseConfigByName("productCode"),productDataElementsConfigs.getConfigByName("productName")];return Ext.Easy.getEasyForm({items:a,columnSize:2,region:"north",readOnly:true})},save:function(){if(!Ext.Easy.isFormValid(this.baseInfoForm)){return}if(this.isNew){this.baseInfoForm.submit({url:"productOperateAction!saveProductInfo.action",success:function(d,e){Ext.Easy.alertMsg(true);this.loadData(e.result.id)},failure:function(d,e){Ext.Easy.alertMsg(false)},scope:this})}else{var c=Ext.apply({},this.baseData);if(this.modifyCount==0){return}Ext.apply(c,this.modifyParams);var b=function(g,e,f){var d=e.modifyCount++;c["name_"+d]=g;c["newValue_"+d]=c[f.replace("name","boxLabel")]};for(var a in c){if(c[a]=="sizeGroup"){b("sizeRatios",this,a)}else{if(c[a]=="brandCode"){b("brandName",this,a)}else{if(c[a]=="oneType"){b("oneTypeName",this,a)}else{if(c[a]=="twoType"){b("twoTypeName",this,a)}else{if(c[a]=="threeType"){b("threeTypeName",this,a)}else{if(c[a]=="year"){b("season",this,a)}}}}}}}c.modefiyCount=this.modifyCount;Ext.Easy.easyAjax("productOperateAction!updateProductInfo.action",c,function(d,e){var f=Ext.decode(d.responseText);Ext.Easy.alertMsg(f.success);this.loadData(f.id)},this)}},loadData:function(a){Ext.Easy.easyAjax("productOperateAction!loadProductById.action",{id:a},function(b,c){Ext.Easy.suspendOrResumeEvents(false,this);var e=Ext.decode(b.responseText);var d=e.object;this.baseInfoForm.getForm().setValues(d);this.baseData={productCode:d.productCode,productName:d.productName,id:d.ID};this.sizeGroups=e.sizeGroups;this.sizeGroupsCode=d.sizeGroup;this.isNew=false;this.baseInfoForm.doLayout();Ext.Easy.loadGridData(this.easyLogGrid.getStore(),d.logs);Ext.Easy.suspendOrResumeEvents(true,this)},this)},addProduct:function(){Ext.Easy.suspendOrResumeEvents(false,this);this.baseInfoForm.getForm().reset();this.baseData={productCode:null,productName:null};this.isNew=true;Ext.Easy.loadGridData(this.easyLogGrid.getStore(),[])},onTabActive:function(b,a){if(Ext.isEmpty(this.baseData)||Ext.isEmpty(this.baseData.productCode)){Ext.Msg.alert("操作提示","请先加载产品信息!");return false}if(!this.dtask){this.dtask=new Ext.util.DelayedTask(this)}this.dtask.delay(500,function(){if(this[a.tabName]&&Ext.isFunction(this[a.tabName].loadData)){this[a.tabName].loadData(this.baseData)}},this)},doQuery:function(){}});Ext.define("Ext.Product.BarCodesPanel",{extend:"Ext.panel.Panel",initComponent:function(){this.border=false;this.layout="border";this.callParent();this.baseInfoForm=this.parentPanel.getBaseInfoFrom();var c=[],a=[];Ext.Easy.getColumnsConfigAndFields(productDataElementsConfigs.getBarcodesConfig(),c,a);this.myGrid=Ext.Easy.createMyGrid(a,c,"",null,null,null,true);var b=[{xtype:"button",text:"生成条形码",iconCls:"query",handler:Ext.bind(this.genBarCodes,this)}];this.myForm=Ext.Easy.getEasyForm({items:productDataElementsConfigs.getBarcodesConfig().items,columnSize:1,region:"east",width:140,fbar:b,readOnly:true,labelAlign:"top"});this.myGrid.on("itemclick",function(e,d){this.myForm.loadRecord(d)},this);this.add(this.baseInfoForm);this.add(this.myGrid);this.add(this.myForm)},genBarCodes:function(){Ext.Msg.confirm("提示","确定生成条形,请确保颜色和尺码已选择?",function(a){if(a=="yes"){Ext.Easy.easyAjax("productOperateAction!createProductAllBarCode.action",this.baseData,function(b,c){var d=Ext.decode(b.responseText);this.myGrid.getStore().loadData(d.result)},this)}},this)},loadData:function(a){this.baseData=a;this.baseInfoForm.getForm().setValues(a);Ext.Easy.easyAjax("productOperateAction!queryBarCodeByProductCode.action",a,function(b,c){var d=Ext.decode(b.responseText);this.myGrid.getStore().loadData(d.result)},this)}});Ext.define("Ext.Product.CommentsPanel",{extend:"Ext.panel.Panel",initComponent:function(){this.border=false;this.layout="border";this.callParent();this.baseInfoForm=this.parentPanel.getBaseInfoFrom();var a={region:"center",xtype:"easygrid",region:"center",title:"相关咨询",subWindowTitle:"咨询详情",gridName:"Consulting",showBbar:true,noAutoLoad:true,formItemsReadOnly:true,noNeddForceFit:true,showFormBtn:true,parentPanel:this,overrideUpdate:true,baseParams:{queryId:"backsys.mapper.ProductCommentMapper.queryConsulting"},fields:productDataElementsConfigs.getQueryConsultingFields()};this.ConsultingGrid=new Ext.ux.EasyGrid(a);a={region:"east",xtype:"easygrid",width:this.parentPanel.parentWinWidth/2,title:"相关评论",noNeddForceFit:true,fields:productDataElementsConfigs.getQueryCommentsFields(),showBbar:true,noAutoLoad:true,formItemsReadOnly:true,gridName:"Comments",subWindowTitle:"评论详情",baseParams:{queryId:"backsys.mapper.ProductCommentMapper.queryComments"}};this.CommentsGrid=new Ext.ux.EasyGrid(a);this.add(this.baseInfoForm);this.add(this.ConsultingGrid);this.add(this.CommentsGrid)},loadData:function(a){this.baseData=a;this.baseInfoForm.getForm().setValues(a);if(!this.isLoadData||this.oldProductCode!=a.productCode){Ext.Easy.doEasyQuery(this.ConsultingGrid,null,a);Ext.Easy.doEasyQuery(this.CommentsGrid,null,a);this.isLoadData=true;this.oldProductCode=a.productCode}},updateRecord:function(b,c,a){var d={id:c.get("ID"),replyContent:a.replyContent};Ext.Easy.easyAjax("productOperateAction!replyConsultingQuestion.action",d,function(e,f){var g=Ext.decode(e.responseText);Ext.Easy.doEasyQuery(this.ConsultingGrid);Ext.Easy.alertMsg(g.success)},this)}});Ext.define("Ext.Product.MaintainPanel",{extend:"Ext.panel.Panel",initComponent:function(){this.border=false;this.callParent();this.baseInfoForm=this.parentPanel.getBaseInfoFrom();this.add(this.baseInfoForm)},loadData:function(a){this.baseData=a;this.baseInfoForm.getForm().setValues(a)}});Ext.define("Ext.Product.ImagePanel",{extend:"Ext.panel.Panel",initComponent:function(){this.border=false;this.layout="border";this.callParent();this.baseInfoForm=this.parentPanel.getBaseInfoFrom();var d=/\.([jJ][pP][gG]){1}$|\.([jJ][pP][eE][gG]){1}$|\.([gG][iI][fF]){1}$|\.([pP][nN][gG]){1}$|\.([bB][mM][pP]){1}$/;var b=[{xtype:"box",id:"browseImage",autoEl:{height:150,style:"margin: 10px;",tag:"input",type:"image",src:Ext.BLANK_IMAGE_URL}},{id:"upload",name:"upload",fieldLabel:"上传图片",xtype:"filefield",msgTarget:"side",anchor:"98%",buttonText:"",buttonConfig:{iconCls:"upload-icon"}},productDataElementsConfigs.getImageConfigByName("imageName"),productDataElementsConfigs.getImageConfigByName("colorCode"),{xtype:"fieldcontainer",fieldLabel:"图片分类及展示顺序",width:218,layout:"column",fieldDefaults:{hideLabel:true},items:[Ext.apply(productDataElementsConfigs.getImageConfigByName("imageType"),{columnWidth:0.7}),Ext.apply(productDataElementsConfigs.getImageConfigByName("imageOrder"),{columnWidth:0.3})]},productDataElementsConfigs.getImageConfigByName("ID"),productDataElementsConfigs.getImageConfigByName("imagePath")];var a=Ext.create("Ext.form.Panel",{fileUpload:true,defaultType:"textfield",region:"east",width:250,id:"fileUploadForm",defaults:{labelAlign:"top"},items:b,buttons:[{text:"删除图片",iconCls:"remove",handler:Ext.bind(this.uploadImages,this,["remove"])},{text:"更新图片",iconCls:"save",handler:Ext.bind(this.uploadImages,this,["update"])},{text:"新增图片",iconCls:"add",handler:Ext.bind(this.uploadImages,this,["add"])}]});this.imageForm=a;a.on("render",function(e){e.form.findField("upload").on("render",function(){Ext.get("upload").on("change",function(g,f){var h=f.value;if(d.test(h)){Ext.get("browseImage").dom.src=f.files[0].getAsDataURL()}else{Ext.Msg.alert("操作提示","请选择图片上传!")}},this);Ext.getDom("browseImage").onclick=function(){window.open(this.src,"viewwin")}},this)},this);this.iconbrowser=Ext.create("Ext.ux.IconBrowser",{xtype:"iconbrowser",region:"center",id:"img-chooser-view",fieldMixs:productDataElementsConfigs.getImage(),autoScroll:true,listeners:{scope:this,selectionchange:this.onIconSelect}});var c={xtype:"panel",region:"center",autoScroll:true,split:true,layout:"border",id:"img-chooser-dlg",items:[this.iconbrowser,a]};this.add(this.baseInfoForm);this.add(c)},onIconSelect:function(a,c){var b=c[0];if(b){this.imageForm.loadRecord(b);Ext.get("browseImage").dom.src=b.data.imagePath}},loadImages:function(a){this.iconbrowser.getStore().loadData(a.zoomImages);this.iconbrowser.getStore().loadData(a.indexImages,true);this.iconbrowser.getStore().loadData(a.modelImages,true);this.iconbrowser.getStore().loadData(a.orderImagesList,true);this.iconbrowser.getStore().loadData(a.backImages,true)},uploadImages:function(a){var b=this.imageForm.getForm();var c=Ext.apply({operation:a},this.baseData);if(b.isValid()){b.submit({url:"productOperateAction!uploadImages.action",params:c,method:"post",waitMsg:"上传图片中...",success:function(d,e){this.loadImages(e.result.images);Ext.Msg.alert("成功","操作成功!");d.reset()},failure:function(d,e){Ext.Msg.alert("失败","上传失败，文件类型不对或文件太大，请重试!")},scope:this})}},loadData:function(a){this.baseData=a;this.baseInfoForm.getForm().setValues(a);Ext.Easy.easyAjax("productOperateAction!queryImages.action",this.baseData,function(c,e){var f=Ext.decode(c.responseText);var d=this.imageForm.getForm().findField("colorCode").store;var b=[];Ext.each(f.color,function(g){b.push([g.colorCode,g.colorCode+"/"+g.engDesc+"/"+g.chnDesc])},this);d.loadData(b);this.loadImages(f.images)},this)}});Ext.define("Ext.Product.ColorPricePanel",{extend:"Ext.panel.Panel",initComponent:function(){this.border=false;this.layout="border";this.callParent();this.baseInfoForm=this.parentPanel.getBaseInfoFrom();this.baseInfoForm.add(Ext.Easy.getEasyLabel("温馨提示：数据确认删除后将不可恢复!"));var a={region:"center",xtype:"easygridquery",fields:productDataElementsConfigs.getColorConfig(),showTbar:true,showRemoveBtn:true,noNeedDbClick:true,overrideRemove:true,showSaveBtn:true,gridName:"ProductColor",subWindowWidth:380,subWindowHeight:130,subWindowTitle:"颜色选择窗口",viewPanelClass:"Ext.Product.SelectColorPanel",parentPanel:this,data:[{}],desktop:this.desktop};this.ProductColorGrid=new Ext.ux.EasyGridQuery(a);var b={region:"east",xtype:"easygrid",fields:productDataElementsConfigs.getPriceConfig(),showTbar:true,showRemoveBtn:true,showSaveBtn:true,overrideRemove:true,parentPanel:this,gridName:"ProductPrice",subWindowTitle:"多币种价格",data:[{}],desktop:this.desktop};this.ProductPriceGrid=new Ext.ux.EasyGrid(b);this.add(this.baseInfoForm);this.add(this.ProductColorGrid);this.add(this.ProductPriceGrid)},loadData:function(a){this.baseData=a;this.baseInfoForm.getForm().setValues(a);Ext.Easy.easyAjax("productOperateAction!queryColorAndPrice.action",a,function(b,c){var d=Ext.decode(b.responseText);this.ProductColorGrid.getStore().loadData(d.color);this.ProductPriceGrid.getStore().loadData(d.price)},this)},saveRecords:function(b,a){var f=Ext.apply({},this.baseData);var c="productOperateAction!update"+a+".action";var e=this[a+"Grid"];var d=Ext.Easy.getRecordsToParams(b,f,"ID",true,e);f.itemNewCount=d[0];f.itemModefiyCount=d[1];if((this.modifyCount+d[0]+d[1])==0){return}Ext.Easy.easyAjax(c,f,function(g,h){var i=Ext.decode(g.responseText);e.getStore().loadData(i.result);Ext.Easy.alertMsg(i.success)},this)},removeRecord:function(c,b,a){var e="productOperateAction!delete"+a+"ById.action";var d=false;Ext.Easy.easyAjax(e,{id:b.get("ID"),productCode:this.baseData.productCode},function(f,g){var h=Ext.decode(f.responseText);d=h.success},this,true);return d}});Ext.define("Ext.Product.InventoryPanel",{extend:"Ext.panel.Panel",initComponent:function(){this.border=false;this.layout="border";this.callParent();this.baseInfoForm=this.parentPanel.getBaseInfoFrom();var c=productDataElementsConfigs.getInventoryTailf();var a={region:"center",fields:c,noNeddForceFit:true,parentPanel:this,noAutoLoad:true};this.inventoryGrid=new Ext.ux.EasyGrid(a);this.sizeGroupsCode="";var b={region:"east",xtype:"easygrid",fields:salesDataElementsConfigs.getChannelInventoryFields(true),width:this.parentPanel.parentWinWidth*2/5,noAutoLoad:true,noNeedDbClick:true,baseParams:{queryId:"web.mapper.WebMapper.queryInventoryByColorAndSizeCodeNotPagin"}};this.channelInventoryGrid=new Ext.ux.EasyGrid(b);this.add(this.baseInfoForm);this.add(this.inventoryGrid);this.add(this.channelInventoryGrid)},dbClickFun:function(a){Ext.Easy.doEasyQuery(this.channelInventoryGrid,null,{productCD:this.baseData.productCode,productsColorCode:a.get("productColorNo")})},loadData:function(b){this.baseData=b;this.baseInfoForm.getForm().setValues(b);this.channelInventoryGrid.getStore().removeAll();if(this.parentPanel.sizeGroupsCode!=this.sizeGroupsCode){this.sizeGroupsCode=this.parentPanel.sizeGroupsCode;var a=this.parentPanel.sizeGroups;Ext.Easy.reConfigGridBySizes(this.inventoryGrid,a,productDataElementsConfigs.getInventoryPre(),productDataElementsConfigs.getInventoryTailf())}var c="";Ext.Easy.easyAjax("productOperateAction!queryProductInventory.action",b,function(f,d){var g=Ext.decode(f.responseText);stocks=g.result;var h=[],i;Ext.each(stocks,function(m){i=h[m.productColorNo];if(!Ext.isDefined(i)){i={productColorNo:m.productColorNo,productColorCn:m.productColorCn,productColorEn:m.productColorEn,totalCount:0};h[i.productColorNo]=i}i[m.productSizeNo]=m.productNum;c+=m.productSizeNo+",";i.totalCount=i.totalCount+m.productNum});var j=[];for(i in h){j.push(h[i])}this.inventoryGrid.getStore().loadData(j);var e=this.inventoryGrid.headerCt.items.items;for(var l=4;l<e.length-1;l++){var k=e[l];if(c.indexOf(k.initialConfig.dataIndex+",")==-1){k.hide()}}},this,true)}});Ext.define("Ext.Product.SizeRefPanel",{extend:"Ext.panel.Panel",initComponent:function(){this.border=false;this.layout="border";this.callParent();this.baseInfoForm=this.parentPanel.getBaseInfoFrom();var b=productDataElementsConfigs.getSizeRefPre();var a={region:"center",xtype:"easygrid",fields:b,showTbar:true,noNeedDbClick:true,noShowUpdateBtn:true,overrideRemove:true,recordId:"id",showRemoveBtn:true,showSaveBtn:true,overrideRemove:true,parentPanel:this,gridName:"SizeRef",subWindowTitle:"尺码计算",data:[{}],desktop:this.desktop};this.SizeRefGrid=new Ext.ux.EasyGrid(a);this.sizeGroupsCode="";this.add(this.baseInfoForm);this.add(this.SizeRefGrid)},loadData:function(c){this.baseData=c;this.baseInfoForm.getForm().setValues(c);if(this.parentPanel.sizeGroupsCode!=this.sizeGroupsCode){this.sizeGroupsCode=this.parentPanel.sizeGroupsCode;var a=this.parentPanel.sizeGroups;var b=Ext.Easy.reConfigGridBySizes(this.SizeRefGrid,a,productDataElementsConfigs.getSizeRefPre(),productDataElementsConfigs.getSizeRefTailf());this.SizeRefGrid.setFields(b);this.allFields=b}Ext.Easy.easyAjax("productOperateAction!queryProductSizeRef.action",this.baseData,function(d,e){var f=Ext.decode(d.responseText);this.setData(f.result)},this)},setData:function(b){var a=[];Ext.each(b,function(f){var g=f.sizeValues.split(",");var e=f.sizeCodes.split(",");var d={part:f.part,id:f.id};for(var c=0;c<e.length;c++){d[e[c]]=g[c]}a.push(d)},this);this.SizeRefGrid.getStore().loadData(a)},saveRecords:function(a){var c=Ext.applyIf({id:0},this.baseData);var b=this.getRecordsToParamsSize(a,c,true);if(b==0){return}Ext.Easy.easyAjax("productOperateAction!saveProductSizeRef.action",c,function(d,e){var f=Ext.decode(d.responseText);this.setData(f.result);Ext.Easy.alertMsg(f.success)},this)},removeRecord:function(a,c){var b=false;Ext.Easy.easyAjax("productOperateAction!deleteSizeRefById.action",{id:c.get("id")},function(d,e){var f=Ext.decode(d.responseText);b=f.success},this,true);return b},getRecordsToParamsSize:function(c,e,d,b){b=b||"id";var a=0;c.each(function(h){var f=h.get(b);if(d&&!(Ext.isEmpty(f)||h.dirty)){return true}var n=h.fields.keys;var o=[],j=[],k=[];for(var g=0;g<n.length;g++){var m=n[g];var l=h.get(m);if(Ext.isEmpty(l)){continue}if(g==0||g==(n.length-1)){if(a==0){e[m]=l}else{e[m+"_"+a]=l}}else{o.push(m);j.push(this.allFields.get(m).fieldLabel);k.push(l)}}if(a==0){e.sizeCodes=o.join(",");e.sizeNames=j.join(",");e.sizeValues=k.join(",")}else{e["sizeCodes_"+a]=o.join(",");e["sizeNames_"+a]=j.join(",");e["sizeValues_"+a]=k.join(",")}a++},this);e.itemNewCount=a;return a}});Ext.define("Ext.Product.SelectColorPanel",{extend:"Ext.panel.Panel",initComponent:function(){this.border=false;this.bodyPadding=5;this.layout={type:"table",columns:2};var a=Ext.Easy.getEasyComboCfg("颜色列表","selectColor",null,CDM.color,null,null,true,230);this.combo=new Ext.ux.EasyCombo(Ext.apply(a,{labelWidth:60}));this.items=[this.combo,{xtype:"button",text:"增加此颜色",iconCls:"accept",handler:Ext.bind(this.addColor,this)},Ext.Easy.getEasyLabel("温馨提示：可输入色号/英文/中文名称查找颜色")];this.fbar=[{xtype:"button",text:"完成并返回",iconCls:"back",handler:Ext.bind(this.closeWin,this)}];this.callParent()},addColor:function(){var e=this.combo.getValue();var c=this.parentPanel.ProductColorGrid.getStore();var d=false;c.each(function(f){if(f.get("colorId")==e){d=true;return false}},this);if(d){Ext.Msg.alert("操作提示","已有此颜色，请增加其它颜色!")}else{var a=this.combo.getRawValue().split("/");var b={colorId:e,colorCode:a[0],engDesc:a[1],chnDesc:a[2]};c.loadData([b],true)}},closeWin:function(){this.parentWin.close()},setParentWin:function(a){this.parentWin=a}});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Ext.Member.MemberData",{extend:"Ext.ux.desktop.Module",uses:["Ext.Member.MemberDataMainPanel"],id:"member-win",init:function(){this.launcher={text:"会员管理",iconCls:"member",handler:this.createWindow,scope:this}},createWindow:function(){var b=this.app.getDesktop();var a=b.getWindow(this.id);if(!a){a=b.createWindow({id:this.id,title:this.launcher.text,width:minwindowWidth,height:windowHight,iconCls:this.launcher.iconCls,animCollapse:false,border:false,hideMode:"offsets",layout:"fit",items:new Ext.Member.MemberDataMainPanel({desktop:b,iconCls:this.launcher.iconCls})})}a.show();return a}});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Ext.Member.MemberDataElementsConfigs",{extend:"Ext.util.MixedCollection",constructor:function(a){a=a||{};Ext.apply(this,a);this.callParent();this.init()},init:function(){this.add("ID",{xtype:"hidden",fieldLabel:"会员ID",name:"ID"});this.add("memberCd",{fieldLabel:"会员编号",name:"memberCd"});this.add("memberName",{fieldLabel:"姓名",name:"memberName"});this.add("sex",Ext.Easy.getEasyComboCfg("性别","sex",null,memberCDM.sex));this.add("petName",{fieldLabel:"昵称",name:"petName"});this.add("memberLevel",Ext.Easy.getEasyComboCfg("会员级别","memberLevel",null,memberCDM.memberLevel));this.add("empiricValue",{fieldLabel:"购物经验值",name:"empiricValue"});this.add("creditRating",{fieldLabel:"信用等级",name:"creditRating"});this.add("email",{fieldLabel:"电子邮箱",name:"email",vtype:"email"});this.add("mobile",{fieldLabel:"手机号码",name:"mobile"});this.add("qq",{fieldLabel:"QQ号",name:"qq"});this.add("msn",{fieldLabel:"MSN",name:"msn"});this.add("idCard",{fieldLabel:"身份证号码",name:"idCard"});this.add("country",{fieldLabel:"国家",name:"country"});this.add("province",{fieldLabel:"省/直辖市",name:"province"});this.add("city",{fieldLabel:"城市",name:"city"});this.add("district",{fieldLabel:"县/区 ",name:"district"});this.add("addressType",Ext.Easy.getEasyComboCfg("地址类型","addressType",null,memberCDM.addressType));this.add("address",{fieldLabel:"详细地址",name:"address"});this.add("postcode",{fieldLabel:"邮政编码",name:"postcode"});this.add("phone",{fieldLabel:"固定电话",name:"phone"});this.add("birthday",Ext.Easy.getEasyDateCfg("出生日期","birthday"));this.add("high",Ext.Easy.getEasyComboCfg("身高","high",null,memberCDM.high));this.add("weight",Ext.Easy.getEasyComboCfg("体重","weight",null,memberCDM.weight));this.add("marriage",Ext.Easy.getEasyComboCfg("婚姻状况","marriage",null,memberCDM.marriage));this.add("education",Ext.Easy.getEasyComboCfg("教育程度","education",null,memberCDM.education));this.add("work",Ext.Easy.getEasyComboCfg("从事职业","work",null,memberCDM.work));this.add("trade",Ext.Easy.getEasyComboCfg("工作所属行业","trade",null,memberCDM.trade));this.add("monthlyPay",Ext.Easy.getEasyComboCfg("月均收入","monthlyPay",null,memberCDM.monthlyPay));this.add("shoesSize",Ext.Easy.getEasyComboCfg("所穿鞋码","shoesSize",null,memberCDM.shoesSize));this.add("loveBrand",{fieldLabel:"喜欢的服装品牌",name:"loveBrand"});this.add("interest",{fieldLabel:"兴趣爱好",name:"interest"});this.add("selfIntroduce",{fieldLabel:"自我介绍",name:"selfIntroduce"});this.add("acceptSpread",Ext.Easy.getEasyComboCfg("是否接受推广","acceptSpread",null,memberCDM.acceptSpread));this.add("introMemberId",{fieldLabel:"推荐人会员ID",name:"introMemberId",readOnly:true});this.add("createTime",Ext.Easy.getEasyDateCfg("注册日期","createTime","yyyy-mm-dd hh:mm:ss"));this.add("createBeginDate",Ext.Easy.getEasyDateCfg("注册起始日期","createBeginDate"));this.add("createEndDate",Ext.Easy.getEasyDateCfg("注册截止日期","createEndDate"));this.add("createRandDate",Ext.Easy.getRandFields({fieldLabel:"注册日期",name1:"createBeginDate",name2:"createEndDate"}));this.add("linkmanId",{xtype:"hidden",fieldLabel:"联系人ID",name:"ID"});this.add("linkmanName",{fieldLabel:"收货人姓名",name:"name"});this.add("linkmanPhone",{fieldLabel:"固定电话",name:"phone"});this.add("linkmanMobile",{fieldLabel:"手机",name:"mobile"});this.add("linkmanEmail",{fieldLabel:"电子邮箱",name:"email"});this.add("linkmanProvince",{fieldLabel:"省份/直辖市",name:"province"});this.add("linkmanCity",{fieldLabel:"城市",name:"city"});this.add("linkmanDistrict",{fieldLabel:"县/区",name:"district"});this.add("linkmanAddress",{fieldLabel:"详细地址",name:"address"});this.add("linkmanPostcode",{fieldLabel:"邮编",name:"postcode"});this.add("integralAmount",{fieldLabel:"积分总量",name:"integralAmount",readOnly:true});this.add("integralListNum",{fieldLabel:"积分数",name:"integral"});this.add("integralBeginTime",Ext.Easy.getEasyDateCfg("有效起始日期","beginTime"));this.add("integralEndTime",Ext.Easy.getEasyDateCfg("有效结束日期","endTime"));this.add("integralSource",Ext.Easy.getEasyComboCfg("积分来源","source",null,memberCDM.integralSource,true));this.add("integralStatus",Ext.Easy.getEasyComboCfg("积分状态","status",null,memberCDM.integralStatus,true));this.add("integralTradeType",Ext.Easy.getEasyComboCfg("交易类型","tradeType",null,memberCDM.integralTradeType,true));this.add("integralTradeAmount",{fieldLabel:"交易量",name:"amount"});this.add("integralTradeBalance",{fieldLabel:"剩余积分",name:"balance"});this.add("integralTradeTime",Ext.Easy.getEasyDateCfg("交易时间","tradeTime","yyyy-mm-dd hh:mm:ss"));this.add("integralTradeOrderCd",{fieldLabel:"定单编号",name:"orderCd"})},getConfigByName:function(b,c){var a=Ext.apply({},this.get(b));if(a.required){Ext.apply(a,{allowBlank:false,blankText:"此字段不能为空",labelSeparator:'<font color="red">*</font>'})}if(c){a=Ext.apply(a,{colspan:c,anchor:"85%"})}return a},getBaseConfigByName:function(a){return Ext.apply({},this.get(a))},getQueryMemberResultCfg:function(){var a=new Ext.util.MixedCollection();a.add(this.get("memberCd"));a.add(this.get("memberName"));a.add(this.get("email"));a.add(this.get("mobile"));a.add(this.get("phone"));a.add(this.get("createTime"));a.add(this.get("ID"));return a},getQueryLinkmanResultCfg:function(){var a=new Ext.util.MixedCollection();a.add(this.getConfigByName("linkmanName"));a.add(this.getConfigByName("linkmanPhone"));a.add(this.getConfigByName("linkmanMobile"));a.add(this.getConfigByName("linkmanEmail"));a.add(this.getConfigByName("linkmanProvince"));a.add(this.getConfigByName("linkmanCity"));a.add(this.getConfigByName("linkmanDistrict"));a.add(this.getConfigByName("linkmanAddress"));a.add(this.getConfigByName("linkmanPostcode"));a.add(this.getConfigByName("linkmanId"));return a},getQueryIntegralListResultCfg:function(){var a=new Ext.util.MixedCollection();a.add(this.getConfigByName("integralListNum"));a.add(this.getConfigByName("integralSource"));a.add(this.getConfigByName("integralBeginTime"));a.add(this.getConfigByName("integralEndTime"));return a},getQueryIntegralLogResultCfg:function(){var a=new Ext.util.MixedCollection();a.add(this.getConfigByName("integralTradeType"));a.add(this.getConfigByName("integralTradeAmount"));a.add(this.getConfigByName("integralTradeBalance"));a.add(this.getConfigByName("integralTradeTime"));a.add(this.getConfigByName("integralTradeOrderCd"));return a}});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Ext.Member.MemberDataMainPanel",{extend:"Ext.tab.Panel",requires:["Ext.Member.MemberDataElementsConfigs"],initComponent:function(){var a=this;this.border=false;this.frame=false;this.isNew=true;a.callParent();this.createQueryMemberPanel();new Ext.util.DelayedTask(function(){},this).delay(1000)},createQueryMemberPanel:function(){this.queryMemberForm=Ext.Easy.getEasyQueryForm(Ext.bind(this.doQuery,this),[memberDataElementsConfigs.getBaseConfigByName("memberCd"),memberDataElementsConfigs.getBaseConfigByName("memberName"),memberDataElementsConfigs.getBaseConfigByName("email"),memberDataElementsConfigs.getBaseConfigByName("mobile"),memberDataElementsConfigs.getBaseConfigByName("createBeginDate"),memberDataElementsConfigs.getBaseConfigByName("createEndDate")],2);var a={xtype:"easygridquery",viewPanelClass:"Ext.Member.MemberPanel",noAutoLoad:true,region:"center",showBbar:true,showTbar:true,showUpateBtn:true,showRemoveBtn:true,overrideRemove:true,otherBtn:[{btnValue:"收货人列表",disPanel:"Ext.Member.LinkmanPanel",subWinTitle:"收货人列表"},{btnValue:"积分明细",disPanel:"Ext.Member.IntegralPanel",subWinTitle:"积分明细"}],parentPanel:this,subWindowWidth:midwindowWidth,subWindowHeight:windowHight,desktop:this.desktop,subWindowTitle:"会员信息详情",baseParams:{queryId:"member.mapper.MemberMapper.queryMembers"},fields:memberDataElementsConfigs.getQueryMemberResultCfg()};this.easyGrid=new Ext.ux.EasyGridQuery(a);this.add({title:"查询会员",layout:"border",items:[this.queryMemberForm,this.easyGrid]})},doQuery:function(){var b=this.easyGrid.getStore();var a=this.queryMemberForm.getForm().getValues();b.proxy.extraParams={queryId:b.proxy.extraParams.queryId};Ext.apply(b.proxy.extraParams,a);b.loadPage(1)},removeRecord:function(c,b,a){var e="memberAction!abateMember.action";var d=false;Ext.Easy.easyAjax(e,{memberId:b.get("ID")},function(f,g){var h=Ext.decode(f.responseText);d=h.success},this,true);return d}});Ext.define("Ext.Member.MemberPanel",{extend:"Ext.panel.Panel",initComponent:function(){var e=this;this.border=false;this.frame=false;this.autoScroll=true;e.callParent();var b=Ext.widget("textfield",memberDataElementsConfigs.getConfigByName("email"));var a=Ext.widget("textfield",memberDataElementsConfigs.getConfigByName("mobile"));var d=Ext.widget("hidden",memberDataElementsConfigs.getConfigByName("ID"));b.on("blur",Ext.bind(this.validEmailOnly,this,[b,d]));a.on("blur",Ext.bind(this.validMobileOnly,this,[a,d]));this.emailObj=b;this.mobileObj=a;var c=[memberDataElementsConfigs.getConfigByName("memberName"),memberDataElementsConfigs.getConfigByName("sex"),memberDataElementsConfigs.getConfigByName("petName"),b,a,memberDataElementsConfigs.getConfigByName("qq"),memberDataElementsConfigs.getConfigByName("msn"),memberDataElementsConfigs.getConfigByName("idCard"),memberDataElementsConfigs.getConfigByName("phone"),memberDataElementsConfigs.getConfigByName("birthday"),memberDataElementsConfigs.getConfigByName("country"),memberDataElementsConfigs.getConfigByName("province"),memberDataElementsConfigs.getConfigByName("city"),memberDataElementsConfigs.getConfigByName("district"),memberDataElementsConfigs.getConfigByName("addressType"),memberDataElementsConfigs.getConfigByName("address"),memberDataElementsConfigs.getConfigByName("postcode"),memberDataElementsConfigs.getConfigByName("high"),memberDataElementsConfigs.getConfigByName("weight"),memberDataElementsConfigs.getConfigByName("marriage"),memberDataElementsConfigs.getConfigByName("education"),memberDataElementsConfigs.getConfigByName("work"),memberDataElementsConfigs.getConfigByName("trade"),memberDataElementsConfigs.getConfigByName("monthlyPay"),memberDataElementsConfigs.getConfigByName("shoesSize"),memberDataElementsConfigs.getConfigByName("acceptSpread"),memberDataElementsConfigs.getConfigByName("loveBrand"),memberDataElementsConfigs.getConfigByName("interest"),memberDataElementsConfigs.getConfigByName("selfIntroduce"),memberDataElementsConfigs.getConfigByName("introMemberId"),d];var f=Ext.Easy.getEasyForm({items:c,columnSize:2,fbar:[{text:"保存",iconCls:"accept",handler:Ext.bind(this.save,this)}]});this.baseInfoForm=f;this.add(f)},validEmailOnly:function(b,c){var d=Ext.String.trim(b.value);var a=c.value;if(d==""){return}Ext.Easy.easyAjax("memberAction!validEmailOnly.action",{email:d,memberId:a},function(e,f){var g=Ext.decode(e.responseText);this.emailValidResult=g.success},this)},validMobileOnly:function(d,c){var b=Ext.String.trim(d.value);var a=c.value;if(b==""){return}Ext.Easy.easyAjax("memberAction!validMobileOnly.action",{mobile:b,memberId:a},function(e,f){var g=Ext.decode(e.responseText);this.mobileValidResult=g.success},this)},loadFormRecord:function(b,a){Ext.Easy.easyAjax("memberAction!queryMemberById.action",{ID:b},function(c,d){var f=Ext.decode(c.responseText);var e=f.member;this.baseInfoForm.getForm().setValues(e)},this)},getRecordKey:function(){return"ID"},save:function(){if(!Ext.Easy.isFormValid(this.baseInfoForm)){return}if((this.emailObj.value==undefined||Ext.String.trim(this.emailObj.value)=="")&&(this.mobileObj.value==undefined||Ext.String.trim(this.mobileObj.value)=="")){Ext.Msg.alert("填写提示","手机与email必须填写一个!");return}else{if((this.emailObj.value!=undefined&&Ext.String.trim(this.emailObj.value)!="")&&this.emailValidResult==false){Ext.Msg.alert("填写提示","该email已注册，请改用另一个email!");return}if((this.mobileObj.value!=undefined&&Ext.String.trim(this.mobileObj.value)!="")&&this.mobileValidResult==false){Ext.Msg.alert("填写提示","该手机号已注册，请改用另一个手机号!");return}}this.baseInfoForm.submit({url:"memberAction!saveMember.action",success:function(a,b){Ext.Easy.alertMsg(true)},failure:function(a,b){Ext.Easy.alertMsg(false)}})}});Ext.define("Ext.Member.LinkmanPanel",{extend:"Ext.panel.Panel",initComponent:function(){var b=this;this.border=false;this.frame=false;this.autoScroll=true;b.callParent();var a={region:"center",xtype:"easygrid",fields:memberDataElementsConfigs.getQueryLinkmanResultCfg(),showTbar:false,parentPanel:this,gridName:"linkman",subWindowTitle:"收货人详细信息",data:[{}],desktop:this.desktop};this.linkmanGrid=new Ext.ux.EasyGrid(a);this.add(this.linkmanGrid)},loadFormRecord:function(b,a){Ext.Easy.easyAjax("memberAction!queryLinkmansByMemberId.action",{memberId:b},function(c,d){var e=Ext.decode(c.responseText);this.linkmanGrid.getStore().loadData(e.linkmanList)},this)},getRecordKey:function(){return"ID"}});Ext.define("Ext.Member.IntegralPanel",{extend:"Ext.panel.Panel",initComponent:function(){var b=this;this.border=false;this.frame=false;this.autoScroll=true;b.callParent();var d=Ext.widget("textfield",memberDataElementsConfigs.getConfigByName("integralAmount"));this.integralAmount=d;var a={region:"center",xtype:"easygrid",fields:memberDataElementsConfigs.getQueryIntegralListResultCfg(),noAutoLoad:true,parentPanel:this,gridName:"integralList",subWindowTitle:"",desktop:this.desktop,title:"有效积分明细"};this.integralListGrid=new Ext.ux.EasyGrid(a);var c={region:"center",xtype:"easygrid",noAutoLoad:true,fields:memberDataElementsConfigs.getQueryIntegralLogResultCfg(),showTbar:false,parentPanel:this,gridName:"integralList",subWindowTitle:"",desktop:this.desktop,title:"积分交易明细"};this.integralLogGrid=new Ext.ux.EasyGrid(c);this.add(this.integralAmount);this.add(this.integralListGrid);this.add(this.integralLogGrid)},loadFormRecord:function(b,a){Ext.Easy.easyAjax("memberAction!queryIntegralByMemberId.action",{memberId:b},function(c,d){var e=Ext.decode(c.responseText);this.integralAmount.setValue(e.integralAmount);this.integralListGrid.getStore().loadData(e.integralList);this.integralLogGrid.getStore().loadData(e.integralLogList)},this)},getRecordKey:function(){return"ID"}});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Ext.CustomerCenter.CustomerCenterData",{extend:"Ext.ux.desktop.Module",uses:["Ext.CustomerCenter.CustomerCenterDataMainPanel"],id:"customercenter-win",init:function(){this.launcher={text:"客服中心",iconCls:"customer",handler:this.createWindow,scope:this}},createWindow:function(){var d=this.app.getDesktop();var c=d.getWindow(this.id);if(!c){var b=miderwindowWidth;var a=new Ext.CustomerCenter.CustomerCenterDataMainPanel({desktop:d,parentWinWidth:b,iconCls:this.launcher.iconCls});c=d.createWindow({id:this.id,title:this.launcher.text,width:b,height:windowHight,iconCls:this.launcher.iconCls,animCollapse:false,border:false,hideMode:"offsets",layout:"fit",items:a});a.parentWin=c}c.show();return c}});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Ext.CustomerCenter.CustomerCenterDataElementsConfigs",{extend:"Ext.util.MixedCollection",constructor:function(a){a=a||{};Ext.apply(this,a);this.callParent();this.init()},init:function(){var h=110;var a=[60,80,60];this.add("ID",{xtype:"hidden",fieldLabel:"ID",name:"ID"});this.add("orderCd",{fieldLabel:"订单编号",name:"orderCd",columnWidth:128});this.add("source",Ext.apply(Ext.Easy.getEasyComboCfg("订单来源","source",null,CDM.source,true,null,true),{required:true}));this.add("type",Ext.Easy.getEasyComboCfg("订单类型","type",1,CDM.orderType,true,null,true));this.add("receiver",{fieldLabel:"收货人姓名",name:"receiver",required:true});this.add("receiverMobile",{fieldLabel:"收货人手机",name:"receiverMobile"});this.add("receiverPhone",{fieldLabel:"收货人电话",name:"receiverPhone",required:true});this.add("receiverAddress",{fieldLabel:"收货人地址",name:"receiverAddress",colspan:2,width:500,required:true});this.add("receiverPostcode",{fieldLabel:"收货人邮编",name:"receiverPostcode"});this.add("receiverEmail",{fieldLabel:"收货人邮箱",name:"receiverEmail"});this.add("expressCompany",Ext.Easy.getEasyComboCfg("快递公司","expressCompany",null,CDM.expressCompany,true,null,true));this.add("expressFee",{xtype:"numberfield",hideTrigger:true,fieldLabel:"快递费用",name:"expressFee"});this.add("virtualAccount",{xtype:"numberfield",hideTrigger:true,fieldLabel:"虚拟账户抵金额",name:"virtualAccount"});this.add("orderAmount",{xtype:"numberfield",hideTrigger:true,fieldLabel:"订单总金额",name:"orderAmount"});this.add("originalPriceSum",{xtype:"numberfield",hideTrigger:true,fieldLabel:"售价合计",name:"originalPriceSum"});this.add("voucher",{xtype:"numberfield",hideTrigger:true,fieldLabel:"代金券抵用金额",name:"voucher"});this.add("discountAmount",{xtype:"numberfield",hideTrigger:true,fieldLabel:"活动优惠金额",name:"discountAmount"});this.add("actuallyPaidAmount",{xtype:"numberfield",hideTrigger:true,fieldLabel:"实付金额",name:"actuallyPaidAmount"});this.add("currency",Ext.Easy.getEasyComboCfg("币种","currency","RMB",CDM.currency,true));this.add("memberCd",{fieldLabel:"会员编号",name:"memberCd"});this.add("memberName",{fieldLabel:"会员名称",name:"memberName"});this.add("paymentMethod",Ext.apply(Ext.Easy.getEasyComboCfg("支付方式","paymentMethod",null,CDM.paymentMethod,true,null,true),{required:true}));this.add("onlinePayment",Ext.Easy.getEasyComboCfg("支付渠道","onlinePayment",null,CDM.onlinePayment,true));this.add("invoiceTag",Ext.Easy.getEasyComboCfg("是否开具发票","invoiceTag"));this.add("invoiceTitle",{fieldLabel:"发票抬头",name:"invoiceTitle"});this.add("invoiceType",Ext.Easy.getEasyComboCfg("发票类型","invoiceType",null,CDM.invoiceType));this.add("deliveryTime",Ext.Easy.getEasyComboCfg("送货时间","deliveryTime",1,CDM.deliveryTime));this.add("cancelReason",Ext.Easy.getEasyComboCfg("取消原因 ","cancelReason",null,CDM.chgOrRefudReason));this.add("hasRejection",Ext.Easy.getEasyComboCfg("是否拒收","hasRejection",null,"",true,null,true));this.add("idRefundDiffer",Ext.Easy.getEasyComboCfg("退换货有差异","idRefundDiffer",null,"",true,null,true));this.add("rejectionReason",Ext.Easy.getEasyComboCfg("拒收原因","rejectionReason",null,CDM.rejectionReason));this.add("confirmationStatus",Ext.Easy.getEasyComboCfg("客人确认状态","confirmationStatus",2,CDM.confirmationStatus,true,null,true));this.add("payStatus",Ext.Easy.getEasyComboCfg("支付状态","payStatus",1,CDM.payStatus,true,null,true));this.add("prepareGoodsStatus",Ext.Easy.getEasyComboCfg("配货状态","prepareGoodsStatus",1,CDM.prepareGoodsStatus,true,null,true));this.add("logisticsStatus",Ext.Easy.getEasyComboCfg("物流状态","logisticsStatus",1,CDM.logisticsStatus,true,null,true));this.add("refundStatus",Ext.Easy.getEasyComboCfg("退库状态","refundStatus",null,CDM.refundStatus,true,null,true));this.add("receivingStatus",Ext.Easy.getEasyComboCfg("客人收货状态","receivingStatus",1,CDM.receivingStatus,true,null,true));this.add("orderStatus",Ext.Easy.getEasyComboCfg("订单状态","orderStatus",null,CDM.orderStatus,true,null,true));this.add("createTime",{fieldLabel:"下单时间",name:"createTime"});this.add("remarks",{xtype:"textarea",fieldLabel:"备注信息",name:"remarks"});this.add("isFreeFreight",Ext.Easy.getEasyComboCfg("是否免运费","isFreeFreight",null,"",true,null,true));this.add("isAllPromotion",Ext.Easy.getEasyComboCfg("是否有全场活动","isAllPromotion",null,"",true,null,true));this.add("promotionIdStr",{fieldLabel:"活动ID",name:"promotionIdStr"});this.add("promotionNameStr",{fieldLabel:"活动名称",name:"promotionNameStr"});this.add("operaterId",{fieldLabel:"当前操作人ID",name:"operaterId",hiddenColumn:true});this.add("operater",{fieldLabel:"当前操作人",name:"operater"});this.add("orderRandDate",Ext.Easy.getRandFields({fieldLabel:"下单日期",name1:"beginDate",name2:"endDate",value1:Ext.Easy.getNewDate(-7),value2:new Date()}));var b=new Ext.util.MixedCollection();b.add("brandName",{fieldLabel:"品牌",name:"brandName"});b.add("productNo",{xtype:"producttrigger",fieldLabel:"产品编号",name:"productNo"});b.add("productName",{fieldLabel:"产品名称",name:"productName"});b.add("colorCode",Ext.Easy.getEasyComboCfg("色号","colorCode",null,[]));b.add("colorName",{fieldLabel:"颜色",name:"colorName",allowBlank:false,readOnly:true});b.add("sizeCode",Ext.Easy.getEasyComboCfg("尺码","sizeCode",null,[]));b.add("sizeName",{fieldLabel:"尺码名称",name:"sizeName",allowBlank:false,readOnly:true});b.add("bookCount",{xtype:"numberfield",hideTrigger:true,fieldLabel:"订购数量 ",name:"bookCount"});b.add("barcode",{fieldLabel:"条形码",name:"barcode"});b.add("unitPrice",{xtype:"numberfield",hideTrigger:true,fieldLabel:"单价",name:"unitPrice"});b.add("status",Ext.Easy.getEasyComboCfg("状态","status",null,CDM.orderItemStatus,true));b.add("hasRejection",Ext.Easy.getEasyComboCfg("是否拒收","hasRejection",null,null,true));b.add("rejectionReason",Ext.Easy.getEasyComboCfg("拒收原因","rejectionReason",null,[]));b.add("changeSize",{fieldLabel:"换出尺码",name:"changeSize"});b.add("changeColor",{fieldLabel:"换出颜色 ",name:"changeColor"});b.add("hasGift",Ext.Easy.getEasyComboCfg("是否赠品 ","hasGift",null,null,true));b.add(this.get("ID"));this.orderItem=b;var f=new Ext.util.MixedCollection();f.add("type",Ext.apply(Ext.Easy.getEasyComboCfg("类型","type",1,CDM.priceDetailType,true),{readOnly:true}));f.add("productNo",Ext.Easy.getCopyConfig(this.orderItem.get("productNo")));f.add("productName",Ext.Easy.getCopyConfig(this.orderItem.get("productName")));f.add("colorCode",Ext.Easy.getCopyConfig(this.orderItem.get("colorCode")));f.add("colorName",Ext.Easy.getCopyConfig(this.orderItem.get("colorName")));f.add("sizeCode",Ext.Easy.getCopyConfig(this.orderItem.get("sizeCode")));f.add("sizeName",Ext.Easy.getCopyConfig(this.orderItem.get("sizeName")));f.add("bookNum",{xtype:"numberfield",hideTrigger:true,enableKeyEvents:true,fieldLabel:"订购数量 ",name:"bookNum",allowBlank:false});f.add("marketPrice",{xtype:"numberfield",hideTrigger:true,fieldLabel:"市场价",name:"marketPrice"});f.add("eventsPrice",{xtype:"numberfield",hideTrigger:true,enableKeyEvents:true,fieldLabel:"实付价",name:"eventsPrice",readOnly:true});f.add("netSalePrice",{xtype:"numberfield",hideTrigger:true,enableKeyEvents:true,fieldLabel:"销售价",name:"netSalePrice",allowBlank:false});f.add("eventsPriceSum",{xtype:"numberfield",hideTrigger:true,fieldLabel:"优惠价总计",name:"eventsPriceSum",readOnly:true});f.add("discountRate",{xtype:"numberfield",hideTrigger:true,fieldLabel:"折扣率",name:"discountRate"});f.add("netSalePriceSum",{xtype:"numberfield",hideTrigger:true,fieldLabel:"销售价总计",name:"netSalePriceSum",readOnly:true});f.add("promotionName",{fieldLabel:"活动名称",name:"promotionName",readOnly:true});f.add("promotionId",{fieldLabel:"活动ID",name:"promotionId",xtype:"hidden"});f.add("brandName",{xtype:"hidden",fieldLabel:"品牌",name:"brandName"});f.add(this.get("ID"));this.priceItem=f;var e=new Ext.util.MixedCollection();e.add("operater",{fieldLabel:"修改人",name:"operater",flex:1});e.add("operaTime",{fieldLabel:"修改时间",name:"operaTime",flex:2});e.add("content",{xtype:"textarea",fieldLabel:"修改内容",name:"content",colspan:2,width:450,flex:2});this.log=e;this.add("changeType",Ext.apply({allowBlank:false},Ext.Easy.getEasyComboCfg("退换货类型","type",null,CDM.refundType,true,null,true)));this.add("hasSignIn",Ext.Easy.getEasyComboCfg("订单是否签收 ","hasSignIn"));this.add("hasPayment",Ext.Easy.getEasyComboCfg("订单是否付款 ","hasPayment"));this.add("expressName",{fieldLabel:"快递公司",name:"expressName"});this.add("expressNo",{fieldLabel:"快递单号",name:"expressNo"});this.add("hasOneAddress",Ext.Easy.getEasyComboCfg("配送地址一致 ","hasOneAddress"));this.add("refundReceiver",{fieldLabel:"收货人名称",name:"receiver"});this.add("refundReceiverMobile",{fieldLabel:"联系电话",name:"receiverMobile"});this.add("refundReceiverAddress",{fieldLabel:"收货人地址",name:"receiverAddress"});this.add("refundReceiverPostCode",{fieldLabel:"邮编",name:"receiverPostCode"});this.add("orderId",{xtype:"hidden",fieldLabel:"orderId",name:"orderId"});this.add("refundSource",Ext.Easy.getEasyComboCfg("来源 ","source",null,CDM.refundSource,true,null,true));this.add("applicationStatus",Ext.Easy.getEasyComboCfg("申请状态","applicationStatus",null,CDM.applicationStatus,true,null,true));this.add("creatorIdRefund",{fieldLabel:"创建人ID",name:"creatorId"});this.add("creatorRefund",{fieldLabel:"创建人",name:"creator"});this.add("createTimeRefund",{fieldLabel:"创建时间",name:"createTime"});this.add("modiferIdRefund",{fieldLabel:"修改人ID",name:"modiferId"});this.add("modiferRefund",{fieldLabel:"修改人",name:"modifer"});this.add("modifeTimeRefund",{fieldLabel:"修改时间",name:"modifeTime"});this.add("refundCd",{fieldLabel:"退换货单CD",name:"refundCd"});this.add("toCCRemark",{xtype:"textareafield",fieldLabel:"给客服的备注",name:"toCCRemark",width:600,colspan:3});this.add("toWarehouseRemark",{xtype:"textareafield",fieldLabel:"给仓库的备注 ",name:"toWarehouseRemark",width:600,colspan:3});this.add("remark",{xtype:"textareafield",fieldLabel:"备注",name:"remark",width:600,colspan:3});this.add("isDiffer",Ext.Easy.getEasyComboCfg("是否有差异","isDiffer",null,"",true,null,true));this.add("createTimeRefundRand",Ext.Easy.getRandFields({fieldLabel:"创建时间",name1:"beginCreateDate",name2:"endCreateDate"}));this.add("modifeTimeRefundRand",Ext.Easy.getRandFields({fieldLabel:"修改时间",name1:"beginModifeDate",name2:"endModifeDate"}));var g=new Ext.util.MixedCollection();g.add("productNameRefund",{fieldLabel:"产品名称 ",name:"productName",readOnly:true});g.add("productNoRefund",{fieldLabel:"产品编号",name:"productNo",readOnly:true});g.add("colorCodeRefund",{fieldLabel:"色号",name:"colorCode",readOnly:true});g.add("colorNameRefund",{fieldLabel:"颜色名称",name:"colorName",readOnly:true});g.add("sizeCodeRefund",{fieldLabel:"尺码号",name:"sizeCode",readOnly:true});g.add("sizeNameRefund",{fieldLabel:"尺码名称",name:"sizeName",readOnly:true});g.add("bookNumRefund",{fieldLabel:"数量",name:"bookNum",readOnly:true});g.add("returnedGoods",Ext.Easy.getEasyComboCfg("退货","returnedGoods",null,CDM.returnedGoods,true));g.add("replacinggoods",Ext.Easy.getEasyComboCfg("换货","replacinggoods",null,CDM.returnedGoods,true));g.add("chgOrRefudReason",Ext.apply({allowBlank:false},Ext.Easy.getEasyComboCfg("退换货原因","chgOrRefudReason",null,CDM.chgOrRefudReason,true)));g.add("swapOutColorCode",Ext.apply({editor:"combo"},Ext.Easy.getEasyComboCfg("换出色号","swapOutColorCode",null,[])));g.add("swapOutColorName",{fieldLabel:"换出颜色名称",name:"swapOutColorName"});g.add("swapOutSizeCode",Ext.apply({editor:"combo"},Ext.Easy.getEasyComboCfg("换出尺码号","swapOutSizeCode",null,[])));g.add("swapOutSizeName",{fieldLabel:"换出尺码名称",name:"swapOutSizeName"});g.add("orderItmId",{xtype:"hidden",fieldLabel:"orderItmId",name:"orderItmId"});g.add(this.get("ID"));this.refundItem=g;var d=new Ext.util.MixedCollection();d.add("payment",Ext.apply(this.getBaseConfigByName("paymentMethod"),{name:"payment"}));d.add("onlineType",Ext.apply(this.getBaseConfigByName("onlinePayment"),{name:"onlineType"}));d.add("payMoney",{fieldLabel:"支付金额",name:"payMoney"});d.add("status",Ext.apply(this.getBaseConfigByName("payStatus"),{name:"status"}));d.add("paySequenceId",{fieldLabel:"支付流水号",name:"paySequenceId"});d.add("currency",this.getBaseConfigByName("currency"));d.add("type",Ext.Easy.getEasyComboCfg("支付类型","type",null,CDM.payItemType,true));d.add("createDate",{fieldLabel:"创建时间",name:"createDate"});d.add(this.get("ID"));this.payItem=d;var c=new Ext.util.MixedCollection();c.add("voucherCode",{fieldLabel:"代金券编码",name:"voucherCode"});c.add("voucherName",{fieldLabel:"代金券名称 ",name:"voucherName"});c.add("voucherValue",{fieldLabel:"代金券面值",name:"voucherValue"});c.add("startDate",{fieldLabel:"代金券开始日期",name:"startDate"});c.add("endDate",{fieldLabel:"代金券结束日期",name:"endDate"});c.add("status",Ext.Easy.getEasyComboCfg("状态","status",null,memberCDM.voucherStatus,true));c.add("currencyType",Ext.apply(this.getBaseConfigByName("currency"),{name:"currencyType"}));c.add(this.get("ID"));this.voucher=c;this.add("refundsMethod",Ext.apply(Ext.Easy.getEasyComboCfg("退款方式","refundsMethod",null,CDM.refundsMethod,true,null,true),{required:true}));this.add("accountBank",{fieldLabel:"开户行名称",name:"accountBank"});this.add("bankCardAddress",{fieldLabel:"办卡所在地",name:"bankCardAddress"});this.add("bankCardNo",{fieldLabel:"卡号",name:"bankCardNo"});this.add("accountName",{fieldLabel:"卡户名 ",name:"accountName"});this.add("amountRefunded",{fieldLabel:"退款金额",name:"amountRefunded"});this.add("noneyStatus",Ext.Easy.getEasyComboCfg("状态","status",null,CDM.noneyStatus,true,null,true));this.add("applicant",{fieldLabel:"申请人",name:"applicant"});this.add("applicantDate",{fieldLabel:"申请时间",name:"applicantDate"});this.add("modifyDate",{fieldLabel:"修改时间",name:"modifyDate"});this.add("createDateNoney",{fieldLabel:"创建时间",name:"createDate"});this.add("noneyRefundsource",{xtype:"hidden",fieldLabel:"source",name:"source"});this.add("sourceNoney",Ext.apply(Ext.Easy.getEasyComboCfg("来源","source",null,CDM.sourceNoney,true,null,true),{required:true}));this.add("remarksNoney",{xtype:"textareafield",fieldLabel:"备注",name:"remarks",width:600,colspan:3});this.add("applicantDateRand",Ext.Easy.getRandFields({fieldLabel:"申请时间",name1:"beginApplicantDate",name2:"endApplicantDate"}))},getConfigByName:function(b,d,c){var a=Ext.apply({},this.get(b));if(a.required){Ext.apply(a,{allowBlank:false,blankText:"此字段不能为空",labelSeparator:'<font color="red">*</font>'})}if(b=="orderCd"){a.value="系统生成"}if(d){a=Ext.apply(a,{colspan:d,width:c||650,grow:true})}return a},getBaseConfigByName:function(a){return Ext.apply({},this.get(a))},getQueryOrderItems:function(){return[this.getBaseConfigByName("orderCd"),this.getBaseConfigByName("orderRandDate"),Ext.apply(this.getBaseConfigByName("prepareGoodsStatus"),{value:null}),this.getBaseConfigByName("memberCd"),this.getBaseConfigByName("source"),this.getBaseConfigByName("expressCompany"),this.getBaseConfigByName("receiver"),Ext.apply(this.getBaseConfigByName("type"),{value:null}),this.getBaseConfigByName("paymentMethod"),this.getBaseConfigByName("receiverPhone"),Ext.apply(this.getBaseConfigByName("payStatus"),{value:null}),this.getBaseConfigByName("orderStatus"),Ext.apply(this.getBaseConfigByName("confirmationStatus"),{value:null}),Ext.apply(this.getBaseConfigByName("logisticsStatus"),{value:null}),this.getBaseConfigByName("refundStatus"),Ext.apply(this.getBaseConfigByName("receivingStatus"),{value:null}),this.getBaseConfigByName("hasRejection"),this.getBaseConfigByName("idRefundDiffer")]},getViewOrderFields:function(){var a=new Ext.util.MixedCollection();a.add(this.getBaseConfigByName("orderCd"));a.add(this.getBaseConfigByName("memberCd"));a.add(this.getBaseConfigByName("receiver"));a.add(this.getBaseConfigByName("receiverPhone"));a.add(this.getBaseConfigByName("source"));a.add(this.getBaseConfigByName("type"));a.add(this.getBaseConfigByName("orderStatus"));a.add(this.getBaseConfigByName("confirmationStatus"));a.add(this.getBaseConfigByName("prepareGoodsStatus"));a.add(this.getBaseConfigByName("logisticsStatus"));a.add(this.getBaseConfigByName("receivingStatus"));a.add(this.getBaseConfigByName("refundStatus"));a.add(this.getBaseConfigByName("idRefundDiffer"));a.add(this.getBaseConfigByName("payStatus"));a.add(this.getBaseConfigByName("paymentMethod"));a.add(this.getBaseConfigByName("onlinePayment"));a.add(this.getBaseConfigByName("hasRejection"));a.add(this.getBaseConfigByName("operater"));a.add(this.getBaseConfigByName("createTime"));a.add(this.getBaseConfigByName("ID"));a.add(this.getBaseConfigByName("operaterId"));return a},getViewRefundFields:function(){var a=new Ext.util.MixedCollection();a.add(this.getBaseConfigByName("refundCd"));a.add(this.getBaseConfigByName("orderCd"));a.add(this.getBaseConfigByName("changeType"));a.add(this.getBaseConfigByName("refundSource"));a.add(this.getBaseConfigByName("applicationStatus"));a.add(this.getBaseConfigByName("isDiffer"));a.add(this.getBaseConfigByName("hasSignIn"));a.add(this.getBaseConfigByName("hasPayment"));a.add(this.getBaseConfigByName("expressName"));a.add(this.getBaseConfigByName("expressNo"));a.add(this.getBaseConfigByName("creatorIdRefund"));a.add(this.getBaseConfigByName("creatorRefund"));a.add(this.getBaseConfigByName("createTimeRefund"));a.add(this.getBaseConfigByName("ID"));return a},getViewOrderLockFields:function(){var a=new Ext.util.MixedCollection();a.add(Ext.apply(this.getBaseConfigByName("orderCd"),{flex:1}));a.add(Ext.apply(this.getBaseConfigByName("operater"),{flex:1}));a.add({fieldLabel:"锁定时间",name:"operaTime",flex:1});a.add(this.getBaseConfigByName("ID"));return a},getPriceItemFields:function(){return this.priceItem},getOrderItemFields:function(){return this.orderItem},getRefundItem:function(){return this.refundItem},getPayItem:function(){return this.payItem},getVoucher:function(){return this.voucher},getNoney:function(){var a=new Ext.util.MixedCollection();a.add(this.getBaseConfigByName("refundsMethod"));a.add(this.getBaseConfigByName("accountBank"));a.add(this.getBaseConfigByName("bankCardAddress"));a.add(this.getBaseConfigByName("bankCardNo"));a.add(this.getBaseConfigByName("accountName"));a.add(this.getBaseConfigByName("amountRefunded"));a.add(this.getBaseConfigByName("noneyStatus"));a.add(this.getBaseConfigByName("applicant"));a.add(this.getBaseConfigByName("applicantDate"));a.add(this.getBaseConfigByName("ID"));return a},getQueryNoney:function(){var a=new Ext.util.MixedCollection();a.add(this.getBaseConfigByName("orderCd"));a.add(this.getBaseConfigByName("sourceNoney"));a.add(this.getBaseConfigByName("noneyStatus"));a.add(this.getBaseConfigByName("amountRefunded"));a.add(this.getBaseConfigByName("refundsMethod"));a.add(this.getBaseConfigByName("applicant"));a.add(this.getBaseConfigByName("applicantDate"));a.add(this.getBaseConfigByName("accountBank"));a.add(this.getBaseConfigByName("bankCardAddress"));a.add(this.getBaseConfigByName("bankCardNo"));a.add(this.getBaseConfigByName("accountName"));a.add(this.getBaseConfigByName("creatorRefund"));a.add(this.getBaseConfigByName("ID"));return a},getLog:function(){return this.log}});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Ext.CustomerCenter.ChangOrRefundDataMainPanel",{extend:"Ext.panel.Panel",requires:[],initComponent:function(){var a=this;this.border=false;this.frame=false;this.layout="border";this.activeItem=0;a.callParent();this.queryChgOrRefdPanel()},queryChgOrRefdPanel:function(){var a=[customercenterDataElementsConfigs.getBaseConfigByName("refundCd"),customercenterDataElementsConfigs.getBaseConfigByName("orderCd"),customercenterDataElementsConfigs.getBaseConfigByName("createTimeRefundRand"),customercenterDataElementsConfigs.getBaseConfigByName("changeType"),customercenterDataElementsConfigs.getBaseConfigByName("expressNo"),customercenterDataElementsConfigs.getBaseConfigByName("modifeTimeRefundRand"),customercenterDataElementsConfigs.getBaseConfigByName("applicationStatus"),customercenterDataElementsConfigs.getBaseConfigByName("expressName"),customercenterDataElementsConfigs.getBaseConfigByName("modiferRefund"),customercenterDataElementsConfigs.getBaseConfigByName("hasPayment"),customercenterDataElementsConfigs.getBaseConfigByName("refundSource"),customercenterDataElementsConfigs.getBaseConfigByName("creatorRefund"),customercenterDataElementsConfigs.getBaseConfigByName("hasSignIn"),customercenterDataElementsConfigs.getBaseConfigByName("isDiffer")];var c=Ext.Easy.getEasyQueryForm(Ext.bind(this.doQueryChgOrRefd,this),a,3);this.genChangeForm=c;var b={xtype:"easygridquery",viewPanelClass:"Ext.CustomerCenter.editChangOrRefundDataMainPanel",parentPanel:this,desktop:this.desktop,noAutoLoad:true,region:"center",showBbar:true,iconCls:this.iconCls,subWindowWidth:midwindowWidth,subWindowHeight:windowHight,subWindowTitle:"退换货申请单详情",baseParams:{queryId:"customercenter.mapper.ChangOrRefundMapper.queryChangOrRefund"},fields:customercenterDataElementsConfigs.getViewRefundFields()};this.easyGridChgOrRefund=new Ext.ux.EasyGridQuery(b);this.add([this.genChangeForm,this.easyGridChgOrRefund])},doQueryChgOrRefd:function(){var b=this.easyGridChgOrRefund.getStore();var a=this.genChangeForm.getForm().getValues();b.proxy.extraParams={queryId:b.proxy.extraParams.queryId};Ext.apply(b.proxy.extraParams,a);b.loadPage(1)}});Ext.define("Ext.CustomerCenter.editChangOrRefundDataMainPanel",{extend:"Ext.panel.Panel",requires:[],initComponent:function(){var a=this;this.border=false;this.frame=false;this.autoScroll=true;this.genDelBtn=Ext.widget("button",{text:"删除",iconCls:"remove",handler:Ext.bind(this.removeChangOrRefund,this)});this.genPassBtn=Ext.widget("button",{text:"通过申请生成退换货单",iconCls:"accept",handler:Ext.bind(this.passApplicationAndGenChgRefdOrder,this)});this.genNoPassBtn=Ext.widget("button",{text:"驳回申请",iconCls:"remove",handler:Ext.bind(this.noPassApplicationAndGenChgRefdOrder,this)});this.genSaveBtn=Ext.widget("button",{text:"保存",iconCls:"accept",handler:Ext.bind(this.updateChgRefund,this)});this.fbar=[this.genDelBtn,this.genPassBtn,this.genNoPassBtn,this.genSaveBtn];a.callParent();this.queryChgOrRefdPanel()},queryChgOrRefdPanel:function(){var a=[customercenterDataElementsConfigs.getConfigByName("refundCd"),customercenterDataElementsConfigs.getConfigByName("orderCd"),customercenterDataElementsConfigs.getConfigByName("changeType"),customercenterDataElementsConfigs.getConfigByName("refundSource"),customercenterDataElementsConfigs.getConfigByName("applicationStatus"),customercenterDataElementsConfigs.getConfigByName("isDiffer"),customercenterDataElementsConfigs.getConfigByName("hasSignIn"),customercenterDataElementsConfigs.getConfigByName("hasPayment"),customercenterDataElementsConfigs.getConfigByName("expressName"),customercenterDataElementsConfigs.getConfigByName("expressNo"),customercenterDataElementsConfigs.getConfigByName("hasOneAddress"),customercenterDataElementsConfigs.getConfigByName("refundReceiver"),customercenterDataElementsConfigs.getConfigByName("refundReceiverMobile"),customercenterDataElementsConfigs.getConfigByName("refundReceiverAddress"),customercenterDataElementsConfigs.getConfigByName("refundReceiverPostCode"),customercenterDataElementsConfigs.getConfigByName("creatorIdRefund"),customercenterDataElementsConfigs.getConfigByName("creatorRefund"),customercenterDataElementsConfigs.getConfigByName("createTimeRefund"),customercenterDataElementsConfigs.getConfigByName("modiferIdRefund"),customercenterDataElementsConfigs.getConfigByName("modiferRefund"),customercenterDataElementsConfigs.getConfigByName("modifeTimeRefund"),customercenterDataElementsConfigs.getConfigByName("remark"),customercenterDataElementsConfigs.getConfigByName("toCCRemark"),customercenterDataElementsConfigs.getConfigByName("toWarehouseRemark")];var d=Ext.Easy.getEasyForm({items:a,columnSize:3,region:"north"});this.genChangeForm=d;Ext.Easy.initFormEvents(this.genChangeForm,this);Ext.Easy.suspendOrResumeEvents(false,this);var c={xtype:"easygrid",parentPanel:this,noAutoLoad:true,height:100,region:"center",subWindowTitle:"明细详情",fields:customercenterDataElementsConfigs.getRefundItem()};this.easyGridChgOrRefund=new Ext.ux.EasyGrid(c);var b=function(g,f){var e=g.nextSibling("textfield");e.setValue(g.rawValue)};this.easyGridChgOrRefund.getForm().findField("swapOutColorCode").on("change",b,this);this.easyGridChgOrRefund.getForm().findField("swapOutSizeCode").on("change",b,this);this.add([this.genChangeForm,this.easyGridChgOrRefund])},loadFormRecord:function(b,a){this.chagRefundId=b;Ext.Ajax.request({url:"changOrRefundAction!loadChangOrRefundById.action",params:{id:b},success:function(c,d){this.key=b;var e=Ext.decode(c.responseText);if(e.success){this.setFormData(e)}else{Ext.Msg.alert("操作提示","读取信息失败!");this.closeWin()}},failure:function(c,d){Ext.Msg.alert("操作提示","读取信息失败,服务不可用!");this.closeWin()},scope:this})},setFormData:function(a){Ext.Easy.suspendOrResumeEvents(false,this);this.initFbar(a.changOrRefundobject.applicationStatus);this.genChangeForm.form.setValues(a.changOrRefundobject);this.easyGridChgOrRefund.getStore().loadData(a.lstChangOrRefundDetail);Ext.Easy.suspendOrResumeEvents(true,this)},initFbar:function(a){this.genPassBtn.setVisible(a=="1"||a=="3");this.genNoPassBtn.setVisible(a=="1");this.genDelBtn.setVisible(a=="1"||a=="3");this.setFieldReadOnly()},setFieldReadOnly:function(){this.genChangeForm.form.findField("refundCd").setReadOnly(true);this.genChangeForm.form.findField("orderCd").setReadOnly(true);this.genChangeForm.form.findField("type").setReadOnly(true);this.genChangeForm.form.findField("source").setReadOnly(true);this.genChangeForm.form.findField("applicationStatus").setReadOnly(true);this.genChangeForm.form.findField("isDiffer").setReadOnly(true);this.genChangeForm.form.findField("creatorId").setReadOnly(true);this.genChangeForm.form.findField("creator").setReadOnly(true);this.genChangeForm.form.findField("createTime").setReadOnly(true);this.genChangeForm.form.findField("modiferId").setReadOnly(true);this.genChangeForm.form.findField("modifer").setReadOnly(true);this.genChangeForm.form.findField("modifeTime").setReadOnly(true)},afterWinShow:function(c,b,d){var a=d.productNo;Ext.Easy.easyAjax("purchasePlanAction!queryColorSizePriceByProductCode.action",{productCode:a},function(f){var i=Ext.decode(f.responseText);var j=i.colorList;var g=[];Ext.each(j,function(k){g.push([k.colorCode,k.chnDesc])},this);this.easyGridChgOrRefund.getForm().findField("swapOutColorCode").getStore().loadData(g);var e=i.sizeList;var h=[];Ext.each(e,function(k){h.push([k.sizeCode,k.sizeName])},this);this.easyGridChgOrRefund.getForm().findField("swapOutSizeCode").getStore().loadData(h);c.setValues(d)},this)},openInitRowEdit:function(){var a=this.easyGridChgOrRefund.getForm().findField("productNo").getValue();Ext.Easy.easyAjax("purchasePlanAction!queryColorSizePriceByProductCode.action",{productCode:a},function(c){var f=Ext.decode(c.responseText);var g=f.colorList;var d=[];Ext.each(g,function(h){d.push([h.colorCode,h.chnDesc])},this);this.easyGridChgOrRefund.getForm().findField("swapOutColorCode").getStore().loadData(d);var b=f.sizeList;var e=[];Ext.each(b,function(h){e.push([h.sizeCode,h.sizeName])},this);this.easyGridChgOrRefund.getForm().findField("swapOutSizeCode").getStore().loadData(e)},this)},removeChangOrRefund:function(){var b={};var a="changOrRefundAction!deleteChangOrRefundById.action";b.id=this.chagRefundId;Ext.Ajax.request({url:a,params:b,success:function(c,d){var e=Ext.decode(c.responseText);if(e.success){Ext.Msg.alert("操作提示","操作成功!",function(){this.closeWin();this.parentPanel.doQueryChgOrRefd()},this)}else{Ext.Msg.alert("操作提示","数据异常!");return}},failure:function(c,d){Ext.Msg.alert("操作提示","操作失败,服务不可用!")},scope:this})},updateChgRefund:function(){if(!Ext.Easy.isFormValid(this.genChangeForm)){return}var c=this.validateRefundItemGird(this.easyGridChgOrRefund);if(!c){Ext.Msg.alert("提示:","请输入需要退换货的信息！");return}var d=Ext.apply({},this.modifyParams);var a="changOrRefundAction!updateRefundInfo.action";var b=Ext.Easy.getRecordsToParams(this.easyGridChgOrRefund.getStore(),d,"ID",true,this.easyGridChgOrRefund);d.itemNewCount=b[0];d.itemModefiyCount=b[1];d.modefiyCount=this.modifyCount;d.id=this.chagRefundId;if((this.modifyCount+b[0]+b[1])==0){return}Ext.Ajax.request({url:a,params:d,success:function(e,f){var g=Ext.decode(e.responseText);if(g.success){Ext.Msg.alert("操作提示","操作成功!",function(){this.closeWin();this.parentPanel.doQueryChgOrRefd()},this)}else{Ext.Msg.alert("操作提示","数据异常!");return}},failure:function(e,f){Ext.Msg.alert("操作提示","操作失败,服务不可用!")},scope:this})},passApplicationAndGenChgRefdOrder:function(){Ext.Msg.confirm("操作提示","确认通过退换货申请，并生成退换货订单吗？",function(b){if(b=="yes"){var c={id:this.chagRefundId,appliStatus:"2"};var a="changOrRefundAction!passApplicationAndGenChgRefdOrder.action";Ext.Ajax.request({url:a,params:c,success:function(d,e){var f=Ext.decode(d.responseText);if(f.success){Ext.Msg.alert("操作提示","操作成功!",function(){this.closeWin();this.parentPanel.doQueryChgOrRefd()},this)}else{Ext.Msg.alert("操作提示","数据异常!");return}},failure:function(d,e){Ext.Msg.alert("操作提示","操作失败,服务不可用!")},scope:this})}},this)},noPassApplicationAndGenChgRefdOrder:function(){Ext.Msg.confirm("操作提示","确认驳回退换货申请吗？",function(b){if(b=="yes"){var c={id:this.chagRefundId,appliStatus:"3"};var a="changOrRefundAction!passApplicationAndGenChgRefdOrder.action";Ext.Ajax.request({url:a,params:c,success:function(d,e){var f=Ext.decode(d.responseText);if(f.success){Ext.Msg.alert("操作提示","操作成功!",function(){this.closeWin();this.parentPanel.doQueryChgOrRefd()},this)}else{Ext.Msg.alert("操作提示","数据异常!");return}},failure:function(d,e){Ext.Msg.alert("操作提示","操作失败,服务不可用!")},scope:this})}},this)},validateRefundItemGird:function(c){var b=c.getStore().getCount();var a=0;c.getStore().each(function(d){if((null==d.data.returnedGoods||""==d.data.returnedGoods)&&(null==d.data.replacinggoods||""==d.data.replacinggoods)||null==d.data.chgOrRefudReason||""==d.data.chgOrRefudReason){a++}},this);return b>a?true:false},closeWin:function(){this.parentWin.close()},setParentWin:function(a){this.parentWin=a},getRecordKey:function(){return"ID"}});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Ext.easy.ComplaintCommonData",{singleton:true,alternateClassName:"complaintCDM",auditStatus:[["","请选择"],["1","待审核"],["2","审核通过"]],isOver:[["","请选择"],[1,"否"],[2,"是"]],isAudit:[["","请选择"],[1,"否"],[2,"是"]],auditMans:[["","请选择"],["admin","admin"],["CC","CC"]]});Ext.define("Ext.CustomerCenter.ComplaintConfig",{extend:"Ext.util.MixedCollection",constructor:function(a){a=a||{};Ext.apply(this,a);this.callParent();this.init()},init:function(){this.add("ID",{xtype:"hidden",fieldLabel:"投诉建议ID",name:"ID"});this.add("complaintNo",{fieldLabel:"投诉单编号",name:"complaintNo",readOnly:true});this.add("orderCd",{fieldLabel:"订单编号",name:"orderCd"});this.add("complaintContent",{xtype:"textarea",fieldLabel:"投诉内容",name:"complaintContent",colspan:2,width:450,flex:4});this.add("processingScheme",{xtype:"textarea",fieldLabel:"处理方案",name:"processingScheme",colspan:2,width:450,flex:4});this.add("memberCd",{fieldLabel:"会员编号",name:"memberCd"});this.add("guestName",{fieldLabel:"客人姓名",name:"guestName"});this.add("guestMobile",{fieldLabel:"客人手机号",name:"guestMobile"});this.add("isAudit",Ext.Easy.getEasyComboCfg("需要审核","isAudit",null,complaintCDM.isAudit));this.add("auditor",Ext.Easy.getEasyComboCfg("审核人","auditor",null,complaintCDM.auditMans));this.add("auditTime",Ext.Easy.getEasyDateCfg("审核时间","auditTime","yyyy-mm-dd hh:mm:ss"));this.add("auditStatus",Ext.Easy.getEasyComboCfg("审核状态","auditStatus",null,complaintCDM.auditStatus));this.add("creatorId",Ext.Easy.getEasyComboCfg("创建人ID","creatorId",null,null));this.add("creator",Ext.Easy.getEasyComboCfg("创建人","creator",null,null));this.add("createTime",Ext.Easy.getEasyDateCfg("创建时间","createTime","yyyy-mm-dd hh:mm:ss"));this.add("modifferId",Ext.Easy.getEasyComboCfg("修改人ID","modifferId",null,null));this.add("modiffer",Ext.Easy.getEasyComboCfg("修改人","modiffer",null,null));this.add("modiffeTime",Ext.Easy.getEasyDateCfg("修改时间","modiffeTime","yyyy-mm-dd hh:mm:ss"));this.add("remarks",{xtype:"textarea",fieldLabel:"备注",name:"remarks",colspan:2,width:450,flex:4});this.add("isOver",Ext.Easy.getEasyComboCfg("处理完毕","isOver",null,complaintCDM.isOver))},getConfigByName:function(b,c){var a=Ext.apply({},this.get(b));if(a.required){Ext.apply(a,{allowBlank:false,blankText:"此字段不能为空",labelSeparator:'<font color="red">*</font>'})}if(c){a=Ext.apply(a,{colspan:c,anchor:"85%"})}return a},getBaseConfigByName:function(a){return Ext.apply({},this.get(a))},getQueryComplaintResultField:function(){var a=new Ext.util.MixedCollection();a.add(this.get("complaintNo"));a.add(this.get("guestName"));a.add(this.get("guestMobile"));a.add(this.get("complaintContent"));a.add(this.get("processingScheme"));a.add(this.get("orderCd"));a.add(this.get("memberCd"));a.add(this.get("createTime"));a.add(this.get("ID"));return a}});var complaintConfig=new Ext.CustomerCenter.ComplaintConfig();
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Ext.CustomerCenter.ComplaintPanel",{extend:"Ext.panel.Panel",requires:["Ext.CustomerCenter.ComplaintConfig"],initComponent:function(){var a=this;this.border=false;this.frame=false;this.layout="border";this.isNew=true;a.callParent();this.createQueryComplaintPanel()},createQueryComplaintPanel:function(){this.queryComplaintForm=Ext.Easy.getEasyQueryForm(Ext.bind(this.doQuery,this),[complaintConfig.getBaseConfigByName("complaintNo"),complaintConfig.getBaseConfigByName("isAudit"),complaintConfig.getBaseConfigByName("memberCd"),complaintConfig.getBaseConfigByName("guestMobile"),complaintConfig.getBaseConfigByName("auditStatus"),complaintConfig.getBaseConfigByName("orderCd"),complaintConfig.getBaseConfigByName("guestName"),complaintConfig.getBaseConfigByName("isOver")],3);var a={viewPanelClass:"SIU.ComplaintDetailPanel",noAutoLoad:true,region:"center",showUpateBtn:true,showBbar:true,showTbar:true,overrideRemove:false,parentPanel:this,subWindowTitle:"投诉建议详细信息",baseParams:{queryId:"customercenter.mapper.ComplaintMapper.queryComplaint"},fields:complaintConfig.getQueryComplaintResultField()};this.easyGrid=new Ext.ux.EasyGridQuery(a);this.add([this.queryComplaintForm,this.easyGrid])},doQuery:function(){var b=this.easyGrid.getStore();var a=this.queryComplaintForm.getForm().getValues();b.proxy.extraParams={queryId:b.proxy.extraParams.queryId};Ext.apply(b.proxy.extraParams,a);b.loadPage(1)}});Ext.define("SIU.ComplaintDetailPanel",{extend:"Ext.panel.Panel",initComponent:function(){var b=this;this.border=false;this.frame=false;this.autoScroll=true;b.callParent();var a=[complaintConfig.getConfigByName("guestName"),complaintConfig.getConfigByName("guestMobile"),complaintConfig.getConfigByName("orderCd"),complaintConfig.getConfigByName("memberCd"),complaintConfig.getConfigByName("isAudit"),complaintConfig.getConfigByName("auditor"),complaintConfig.getConfigByName("auditStatus"),complaintConfig.getConfigByName("isOver"),complaintConfig.getConfigByName("complaintContent"),complaintConfig.getConfigByName("processingScheme"),complaintConfig.getConfigByName("remarks"),complaintConfig.getConfigByName("complaintNo"),complaintConfig.getConfigByName("ID")];var c=Ext.Easy.getEasyForm({items:a,columnSize:2,fbar:[{text:"保存投诉建议",iconCls:"accept",handler:Ext.bind(this.save,this)},{text:"关闭窗口",iconCls:"back",handler:Ext.bind(this.close,this)}]});this.baseInfoForm=c;this.add(c)},loadFormRecord:function(b,a){Ext.Easy.easyAjax("complaintOperateAction!queryComplaintById.action",{ID:b},function(c,d){var f=Ext.decode(c.responseText);var e=f.complaint;this.baseInfoForm.getForm().setValues(e)},this)},getRecordKey:function(){return"ID"},save:function(){if(!Ext.Easy.isFormValid(this.baseInfoForm)){return}var c=this.baseInfoForm.getForm().findField("guestName");var b=this.baseInfoForm.getForm().findField("guestMobile");var a=this.baseInfoForm.getForm().findField("complaintContent");if((c.value==undefined||Ext.String.trim(c.value)=="")){Ext.Msg.alert("错误","客人名字不能为空");return}if((b.value!=undefined&&Ext.String.trim(b.value)!="")&&b.value.length!=11){Ext.Msg.alert("错误","手机号码应该为11位数字");return}if((a.value==undefined||Ext.String.trim(a.value)=="")){Ext.Msg.alert("错误","投诉内容不能为空");return}this.baseInfoForm.submit({url:"complaintOperateAction!saveComplaint.action",success:function(d,e){Ext.Easy.alertMsg(true)},failure:function(d,e){Ext.Easy.alertMsg(false)}})},close:function(){this.pwin.close();this.parentPanel.easyGrid.getStore().load()},setParentWin:function(a){this.pwin=a}});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Ext.CustomerCenter.MemberPanel",{extend:"Ext.panel.Panel",requires:["Ext.Member.MemberDataElementsConfigs"],initComponent:function(){var a=this;this.border=false;this.frame=false;this.layout="border";this.isNew=true;a.callParent();this.createQueryMemberPanel();new Ext.util.DelayedTask(function(){},this).delay(1000)},createQueryMemberPanel:function(){this.queryMemberForm=Ext.Easy.getEasyQueryForm(Ext.bind(this.doQuery,this),[memberDataElementsConfigs.getBaseConfigByName("memberCd"),memberDataElementsConfigs.getBaseConfigByName("email"),memberDataElementsConfigs.getBaseConfigByName("memberName"),memberDataElementsConfigs.getBaseConfigByName("mobile"),memberDataElementsConfigs.getBaseConfigByName("createRandDate")],3);var a={xtype:"easygridquery",viewPanelClass:"SIU.MemberPanel",noAutoLoad:true,region:"center",showBbar:true,showTbar:true,showUpateBtn:true,showRemoveBtn:false,overrideRemove:true,otherBtn:[{btnValue:"收货人列表",disPanel:"SIU.LinkmanPanel",subWinTitle:"收货人列表"},{btnValue:"积分明细",disPanel:"SIU.IntegralPanel",subWinTitle:"积分明细"}],parentPanel:this,subWindowWidth:midwindowWidth,subWindowHeight:windowHight,desktop:this.desktop,subWindowTitle:"会员信息详情",baseParams:{queryId:"member.mapper.MemberMapper.queryMembers"},fields:memberDataElementsConfigs.getQueryMemberResultCfg()};this.easyGrid=new Ext.ux.EasyGridQuery(a);this.add([this.queryMemberForm,this.easyGrid])},doQuery:function(){var b=this.easyGrid.getStore();var a=this.queryMemberForm.getForm().getValues();b.proxy.extraParams={queryId:b.proxy.extraParams.queryId};Ext.apply(b.proxy.extraParams,a);b.loadPage(1)},removeRecord:function(c,b,a){var e="memberOperateAction!abateMember.action";var d=false;Ext.Easy.easyAjax(e,{memberId:b.get("ID")},function(f,g){var h=Ext.decode(f.responseText);d=h.success},this,true);return d}});Ext.define("SIU.MemberPanel",{extend:"Ext.panel.Panel",initComponent:function(){var e=this;this.border=false;this.frame=false;this.autoScroll=true;e.callParent();var b=Ext.widget("textfield",memberDataElementsConfigs.getConfigByName("email"));var a=Ext.widget("textfield",memberDataElementsConfigs.getConfigByName("mobile"));var d=Ext.widget("hidden",memberDataElementsConfigs.getConfigByName("ID"));b.on("blur",Ext.bind(this.validEmailOnly,this,[b,d]));a.on("blur",Ext.bind(this.validMobileOnly,this,[a,d]));this.emailObj=b;this.mobileObj=a;var c=[memberDataElementsConfigs.getConfigByName("memberName"),memberDataElementsConfigs.getConfigByName("sex"),memberDataElementsConfigs.getConfigByName("petName"),b,a,memberDataElementsConfigs.getConfigByName("phone"),memberDataElementsConfigs.getConfigByName("birthday"),memberDataElementsConfigs.getConfigByName("country"),memberDataElementsConfigs.getConfigByName("province"),memberDataElementsConfigs.getConfigByName("city"),memberDataElementsConfigs.getConfigByName("district"),memberDataElementsConfigs.getConfigByName("addressType"),memberDataElementsConfigs.getConfigByName("address"),memberDataElementsConfigs.getConfigByName("postcode"),memberDataElementsConfigs.getConfigByName("high"),memberDataElementsConfigs.getConfigByName("weight"),memberDataElementsConfigs.getConfigByName("marriage"),memberDataElementsConfigs.getConfigByName("education"),memberDataElementsConfigs.getConfigByName("work"),memberDataElementsConfigs.getConfigByName("trade"),memberDataElementsConfigs.getConfigByName("monthlyPay"),memberDataElementsConfigs.getConfigByName("shoesSize"),memberDataElementsConfigs.getConfigByName("loveBrand"),memberDataElementsConfigs.getConfigByName("interest"),memberDataElementsConfigs.getConfigByName("selfIntroduce"),memberDataElementsConfigs.getConfigByName("introMemberId"),d];var f=Ext.Easy.getEasyForm({items:c,columnSize:2,fbar:[{text:"保存",iconCls:"accept",handler:Ext.bind(this.save,this)}]});this.baseInfoForm=f;this.add(f)},validEmailOnly:function(b,c){var d=Ext.String.trim(b.value);var a=c.value;if(d==""){return}Ext.Easy.easyAjax("memberOperateAction!validEmailOnly.action",{email:d,memberId:a},function(e,f){var g=Ext.decode(e.responseText);this.emailValidResult=g.success},this)},validMobileOnly:function(d,c){var b=Ext.String.trim(d.value);var a=c.value;if(b==""){return}Ext.Easy.easyAjax("memberOperateAction!validMobileOnly.action",{mobile:b,memberId:a},function(e,f){var g=Ext.decode(e.responseText);this.mobileValidResult=g.success},this)},loadFormRecord:function(b,a){Ext.Easy.easyAjax("memberOperateAction!queryMemberById.action",{ID:b},function(c,d){var f=Ext.decode(c.responseText);var e=f.member;this.baseInfoForm.getForm().setValues(e)},this)},getRecordKey:function(){return"ID"},save:function(){if(!Ext.Easy.isFormValid(this.baseInfoForm)){return}if((this.emailObj.value==undefined||Ext.String.trim(this.emailObj.value)=="")&&(this.mobileObj.value==undefined||Ext.String.trim(this.mobileObj.value)=="")){Ext.Msg.alert("填写提示","手机与email必须填写一个!");return}else{if((this.emailObj.value!=undefined&&Ext.String.trim(this.emailObj.value)!="")&&this.emailValidResult==false){Ext.Msg.alert("填写提示","该email已注册，请改用另一个email!");return}if((this.mobileObj.value!=undefined&&Ext.String.trim(this.mobileObj.value)!="")&&this.mobileValidResult==false){Ext.Msg.alert("填写提示","该手机号已注册，请改用另一个手机号!");return}}this.baseInfoForm.submit({url:"memberOperateAction!saveMember.action",success:function(a,b){Ext.Easy.alertMsg(true)},failure:function(a,b){Ext.Easy.alertMsg(false)}})}});Ext.define("SIU.LinkmanPanel",{extend:"Ext.panel.Panel",initComponent:function(){var b=this;this.border=false;this.frame=false;this.autoScroll=true;b.callParent();var a={region:"center",xtype:"easygrid",fields:memberDataElementsConfigs.getQueryLinkmanResultCfg(),showTbar:false,parentPanel:this,gridName:"linkman",subWindowTitle:"收货人详细信息",data:[{}],desktop:this.desktop};this.linkmanGrid=new Ext.ux.EasyGrid(a);this.add(this.linkmanGrid)},loadFormRecord:function(b,a){Ext.Easy.easyAjax("memberOperateAction!queryLinkmansByMemberId.action",{memberId:b},function(c,d){var e=Ext.decode(c.responseText);this.linkmanGrid.getStore().loadData(e.linkmanList)},this)},getRecordKey:function(){return"ID"}});Ext.define("SIU.IntegralPanel",{extend:"Ext.panel.Panel",initComponent:function(){var b=this;this.border=false;this.frame=false;this.autoScroll=true;b.callParent();var d=Ext.widget("textfield",memberDataElementsConfigs.getConfigByName("integralAmount"));this.integralAmount=d;var a={region:"center",xtype:"easygrid",fields:memberDataElementsConfigs.getQueryIntegralListResultCfg(),noAutoLoad:true,parentPanel:this,gridName:"integralList",subWindowTitle:"",desktop:this.desktop,title:"有效积分明细"};this.integralListGrid=new Ext.ux.EasyGrid(a);var c={region:"center",xtype:"easygrid",noAutoLoad:true,fields:memberDataElementsConfigs.getQueryIntegralLogResultCfg(),showTbar:false,parentPanel:this,gridName:"integralList",subWindowTitle:"",desktop:this.desktop,title:"积分交易明细"};this.integralLogGrid=new Ext.ux.EasyGrid(c);this.add(this.integralAmount);this.add(this.integralListGrid);this.add(this.integralLogGrid)},loadFormRecord:function(b,a){Ext.Easy.easyAjax("memberOperateAction!queryIntegralByMemberId.action",{memberId:b},function(c,d){var e=Ext.decode(c.responseText);this.integralAmount.setValue(e.integralAmount);this.integralListGrid.getStore().loadData(e.integralList);this.integralLogGrid.getStore().loadData(e.integralLogList)},this)},getRecordKey:function(){return"ID"}});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Ext.CustomerCenter.NoneyReturnedMainPanel",{extend:"Ext.panel.Panel",requires:[],initComponent:function(){var a=this;this.border=false;this.frame=false;this.layout="border";this.activeItem=0;a.callParent();this.queryNoneyReturnedPanel()},queryNoneyReturnedPanel:function(){var a=[customercenterDataElementsConfigs.getBaseConfigByName("orderCd"),customercenterDataElementsConfigs.getBaseConfigByName("sourceNoney"),customercenterDataElementsConfigs.getBaseConfigByName("noneyStatus"),customercenterDataElementsConfigs.getBaseConfigByName("applicant"),customercenterDataElementsConfigs.getBaseConfigByName("applicantDateRand"),customercenterDataElementsConfigs.getBaseConfigByName("refundsMethod"),customercenterDataElementsConfigs.getBaseConfigByName("creatorRefund")];var c=Ext.Easy.getEasyQueryForm(Ext.bind(this.doQueryNoneyReturned,this),a,3);this.queryNoneyReturnedForm=c;var b={xtype:"easygridquery",viewPanelClass:"Ext.CustomerCenter.editNoneyReturnedPanel",parentPanel:this,desktop:this.desktop,noAutoLoad:true,region:"center",showBbar:true,iconCls:this.iconCls,subWindowWidth:midwindowWidth,subWindowHeight:windowHight-220,subWindowTitle:"退款申请详情",baseParams:{queryId:"customercenter.mapper.NoneyReturnedMapper.queryNoneyReturned"},fields:customercenterDataElementsConfigs.getQueryNoney()};this.easyGridNoneyReturned=new Ext.ux.EasyGridQuery(b);this.add([this.queryNoneyReturnedForm,this.easyGridNoneyReturned])},doQueryNoneyReturned:function(){var b=this.easyGridNoneyReturned.getStore();var a=this.queryNoneyReturnedForm.getForm().getValues();b.proxy.extraParams={queryId:b.proxy.extraParams.queryId};Ext.apply(b.proxy.extraParams,a);b.loadPage(1)}});Ext.define("Ext.CustomerCenter.editNoneyReturnedPanel",{extend:"Ext.panel.Panel",requires:[],initComponent:function(){var a=this;this.border=false;this.frame=false;this.autoScroll=true;this.gendelBtn=Ext.widget("button",{text:"删除",iconCls:"remove",handler:Ext.bind(this.removeNoneyReturned,this)});this.genPassBtn=Ext.widget("button",{text:"通过申请",iconCls:"accept",handler:Ext.bind(this.vlidateNoney,this,[2])});this.genNoPassBtn=Ext.widget("button",{text:"驳回申请",iconCls:"remove",handler:Ext.bind(this.vlidateNoney,this,[4])});this.genSaveBtn=Ext.widget("button",{text:"保存",iconCls:"accept",handler:Ext.bind(this.vlidateNoney,this,[])});this.fbar=[this.gendelBtn,this.genPassBtn,this.genNoPassBtn,this.genSaveBtn];a.callParent();this.editNoneyReturnedPanel()},editNoneyReturnedPanel:function(){var a=[customercenterDataElementsConfigs.getConfigByName("orderCd"),customercenterDataElementsConfigs.getConfigByName("sourceNoney"),customercenterDataElementsConfigs.getConfigByName("noneyStatus"),customercenterDataElementsConfigs.getConfigByName("amountRefunded"),customercenterDataElementsConfigs.getConfigByName("refundsMethod"),customercenterDataElementsConfigs.getConfigByName("applicant"),customercenterDataElementsConfigs.getConfigByName("applicantDate"),customercenterDataElementsConfigs.getConfigByName("accountBank"),customercenterDataElementsConfigs.getConfigByName("bankCardAddress"),customercenterDataElementsConfigs.getConfigByName("bankCardNo"),customercenterDataElementsConfigs.getConfigByName("accountName"),customercenterDataElementsConfigs.getConfigByName("creatorIdRefund"),customercenterDataElementsConfigs.getConfigByName("creatorRefund"),customercenterDataElementsConfigs.getConfigByName("createDateNoney"),customercenterDataElementsConfigs.getConfigByName("modiferIdRefund"),customercenterDataElementsConfigs.getConfigByName("modiferRefund"),customercenterDataElementsConfigs.getConfigByName("modifyDate"),{xtype:"label"},customercenterDataElementsConfigs.getConfigByName("remarksNoney"),customercenterDataElementsConfigs.getConfigByName("orderId")];var b=Ext.Easy.getEasyForm({items:a,columnSize:3,region:"north"});this.editNoneyReturnedForm=b;Ext.Easy.initFormEvents(this.editNoneyReturnedForm,this);Ext.Easy.suspendOrResumeEvents(false,this);this.add([this.editNoneyReturnedForm])},loadFormRecord:function(b,a){this.noneyReturnedId=b;Ext.Ajax.request({url:"noneyReturnedAction!loadNoneyReturnedById.action",params:{id:b},success:function(c,d){this.key=b;var e=Ext.decode(c.responseText);if(e.success){this.setFormData(e)}else{Ext.Msg.alert("操作提示","读取信息失败!");this.closeWin()}},failure:function(c,d){Ext.Msg.alert("操作提示","读取信息失败,服务不可用!");this.closeWin()},scope:this})},setFormData:function(a){Ext.Easy.suspendOrResumeEvents(false,this);this.initFbar(a.noneyReturnedObj.status);this.editNoneyReturnedForm.form.setValues(a.noneyReturnedObj);Ext.Easy.suspendOrResumeEvents(true,this)},initFbar:function(a){this.gendelBtn.setVisible(a==1||a==4);this.genSaveBtn.setVisible(a==1||a==4);this.genPassBtn.setVisible(a==1||a==4);this.genNoPassBtn.setVisible(a==1);this.setFieldReadOnly()},setFieldReadOnly:function(){this.editNoneyReturnedForm.form.findField("orderCd").setReadOnly(true);this.editNoneyReturnedForm.form.findField("status").setReadOnly(true);this.editNoneyReturnedForm.form.findField("applicant").setReadOnly(true);this.editNoneyReturnedForm.form.findField("applicantDate").setReadOnly(true);this.editNoneyReturnedForm.form.findField("creatorId").setReadOnly(true);this.editNoneyReturnedForm.form.findField("creator").setReadOnly(true);this.editNoneyReturnedForm.form.findField("createDate").setReadOnly(true);this.editNoneyReturnedForm.form.findField("modiferId").setReadOnly(true);this.editNoneyReturnedForm.form.findField("modifer").setReadOnly(true);this.editNoneyReturnedForm.form.findField("modifyDate").setReadOnly(true);this.editNoneyReturnedForm.form.findField("source").setReadOnly(true)},vlidateNoney:function(a){Ext.Msg.confirm("操作提示",this.genTipStr(a),function(d){if(d=="yes"){if(!Ext.Easy.isFormValid(this.editNoneyReturnedForm)){return}if(null!=a&&""!=a){var b=this.editNoneyReturnedForm.form.findField("status");b.setValue(a);Ext.Easy.setFieldValue(this,b)}var e=Ext.apply({},this.modifyParams);e.ID=this.noneyReturnedId;e.amountRefunded=this.editNoneyReturnedForm.form.findField("amountRefunded").getValue();e.orderId=this.editNoneyReturnedForm.form.findField("orderId").getValue();e.modefiyCount=this.modifyCount;if(this.modifyCount==0){return}var c="noneyReturnedAction!vildateNoneyMoney.action";Ext.Ajax.request({url:c,params:e,success:function(f,h){var i=Ext.decode(f.responseText);if(i.success){if(null!=i.tipStr&&""!=i.tipStr){if(a==4){this.updateNoneyReturned(e)}else{var g="输入的退款金额："+this.editNoneyReturnedForm.form.findField("amountRefunded").getValue()+" 与系统计算的退款金额："+i.tipStr+"有差异！确定继续执行此操作吗？";Ext.Msg.confirm("操作提示",g,function(j){if(j=="yes"){this.updateNoneyReturned(e)}},this)}}else{this.updateNoneyReturned(e)}}else{Ext.Msg.alert("操作提示","数据异常!");return}},failure:function(f,g){Ext.Msg.alert("操作提示","操作失败,服务不可用!")},scope:this})}},this)},updateNoneyReturned:function(b){var a="noneyReturnedAction!updateNoneyReturned.action";Ext.Ajax.request({url:a,params:b,success:function(c,d){var e=Ext.decode(c.responseText);if(e.success){Ext.Msg.alert("操作提示","操作成功!",function(){this.closeWin();this.parentPanel.doQueryNoneyReturned()},this)}else{Ext.Msg.alert("操作提示","获取数据异常!");return}},failure:function(c,d){Ext.Msg.alert("操作提示","操作失败,服务不可用!")},scope:this})},removeNoneyReturned:function(){var a=this.editNoneyReturnedForm.form.findField("status").getValue();if(a==2||a==3){Ext.Msg.alert("操作提示","申请已通过记录的无法删除！");return}Ext.Msg.confirm("操作提示","确定要删除该退款申请吗？",function(c){if(c=="yes"){var d={};var b="noneyReturnedAction!deleteNoneyReturnedById.action";d.id=this.noneyReturnedId;Ext.Ajax.request({url:b,params:d,success:function(e,f){var g=Ext.decode(e.responseText);if(g.success){Ext.Msg.alert("操作提示","操作成功!",function(){this.closeWin();this.parentPanel.doQueryNoneyReturned()},this)}else{Ext.Msg.alert("操作提示","获取数据异常!");return}},failure:function(e,f){Ext.Msg.alert("操作提示","操作失败,服务不可用!")},scope:this})}},this)},genTipStr:function(b){var a="";if(b==2){a="确定通过申请吗？"}else{if(b==4){a="确定驳回申请吗？"}else{a="确定输入无误！保存？"}}return a},closeWin:function(){this.parentWin.close()},setParentWin:function(a){this.parentWin=a},getRecordKey:function(){return"ID"}});Ext.define("Ext.CustomerCenter.OrderPanel",{extend:"Ext.tab.Panel",initComponent:function(){this.border=false;this.activeItem=2;this.callParent();this.isNew=true;this.createOrderInfoPanel();this.createOrderItemsPanel();this.createLogPanel();this.delayTask=new Ext.util.DelayedTask(function(){this.setActiveTab(0)},this);this.delayTask.delay(1000);this.on("beforetabchange",Ext.bind(this.onTabActive,this));this.on("destroy",Ext.bind(this.onDestroyFun,this));this.baseData={id:null}},onTabActive:function(b,a){if(Ext.isEmpty(this.baseData)||Ext.isEmpty(this.baseData.id)){Ext.Msg.alert("操作提示","请先加载订单基本信息!");return false}if(a.tabName!="orderItemsTab"){return}if(!this.dtask){this.dtask=new Ext.util.DelayedTask(this)}this.dtask.delay(500,this.loadOrderOtherItems,this)},onDestroyFun:function(a){if(!a.isNew){Ext.Easy.easyAjax("orderOperateAction!unLockOrder.action",{orderIds:this.baseData.id},Ext.emptyFn)}},createOrderInfoPanel:function(){var b=[Ext.Easy.getEasyFieldSetCfg("基本信息",[customercenterDataElementsConfigs.getConfigByName("orderCd"),customercenterDataElementsConfigs.getConfigByName("orderAmount"),customercenterDataElementsConfigs.getConfigByName("type"),customercenterDataElementsConfigs.getConfigByName("memberCd"),customercenterDataElementsConfigs.getConfigByName("expressFee"),customercenterDataElementsConfigs.getConfigByName("source"),customercenterDataElementsConfigs.getConfigByName("memberName"),customercenterDataElementsConfigs.getConfigByName("originalPriceSum"),customercenterDataElementsConfigs.getConfigByName("currency"),customercenterDataElementsConfigs.getConfigByName("voucher"),customercenterDataElementsConfigs.getConfigByName("discountAmount"),customercenterDataElementsConfigs.getConfigByName("paymentMethod"),customercenterDataElementsConfigs.getConfigByName("virtualAccount"),customercenterDataElementsConfigs.getConfigByName("actuallyPaidAmount"),customercenterDataElementsConfigs.getConfigByName("onlinePayment")],3),Ext.Easy.getEasyFieldSetCfg("配送信息",[customercenterDataElementsConfigs.getConfigByName("deliveryTime"),customercenterDataElementsConfigs.getConfigByName("expressCompany"),{xtype:"label"},customercenterDataElementsConfigs.getConfigByName("receiver"),customercenterDataElementsConfigs.getConfigByName("receiverAddress"),customercenterDataElementsConfigs.getConfigByName("receiverPhone"),customercenterDataElementsConfigs.getConfigByName("receiverPostcode")],3),Ext.Easy.getEasyFieldSetCfg("订单状态",[customercenterDataElementsConfigs.getConfigByName("confirmationStatus"),customercenterDataElementsConfigs.getConfigByName("payStatus"),customercenterDataElementsConfigs.getConfigByName("prepareGoodsStatus"),customercenterDataElementsConfigs.getConfigByName("receivingStatus"),customercenterDataElementsConfigs.getConfigByName("logisticsStatus"),customercenterDataElementsConfigs.getConfigByName("refundStatus"),customercenterDataElementsConfigs.getConfigByName("orderStatus")],3,false,"orderStatusId"),Ext.Easy.getEasyFieldSetCfg("其它信息",[customercenterDataElementsConfigs.getConfigByName("cancelReason"),customercenterDataElementsConfigs.getConfigByName("hasRejection"),customercenterDataElementsConfigs.getConfigByName("rejectionReason"),customercenterDataElementsConfigs.getConfigByName("invoiceTag"),customercenterDataElementsConfigs.getConfigByName("invoiceType"),customercenterDataElementsConfigs.getConfigByName("invoiceTitle"),customercenterDataElementsConfigs.getConfigByName("remarks",3,this.windowWidth-190)],3)];var a={region:"center",xtype:"easygrid",noNeedRowNumber:true,showTbar:true,fields:customercenterDataElementsConfigs.getPriceItemFields(),noAutoLoad:true,height:108,parentPanel:this,subWindowTitle:"明细详情"};this.priceDetailGrid=new Ext.ux.EasyGrid(a);var c=function(g,f){var e=g.nextSibling("textfield");e.setValue(g.rawValue)};this.priceDetailGrid.getForm().findField("colorCode").on("change",c,this);this.priceDetailGrid.getForm().findField("sizeCode").on("change",c,this);var d=function(i){var g=this.priceDetailGrid.getForm().findField("bookNum").getValue()||0;var j=this.priceDetailGrid.getForm().findField("eventsPrice").getValue()||0;var h=this.priceDetailGrid.getForm().findField("netSalePrice").getValue()||0;var e=this.priceDetailGrid.getForm().findField("eventsPriceSum");var f=this.priceDetailGrid.getForm().findField("netSalePriceSum");e.setValue(g*j);f.setValue(g*h)};this.priceDetailGrid.getForm().findField("bookNum").on("keyup",d,this);this.priceDetailGrid.getForm().findField("eventsPrice").on("keyup",d,this);this.priceDetailGrid.getForm().findField("netSalePrice").on("keyup",d,this);b.push(Ext.Easy.getEasyFieldSetCfg("价格明细",[this.priceDetailGrid],1,true));this.orderForm=Ext.widget("form",{bodyStyle:"padding:5px 5px 0",autoScroll:true,items:b});Ext.Easy.initFormEvents(this.orderForm,this);Ext.Easy.suspendOrResumeEvents(false,this);this.cancelBtn=Ext.widget("button",{text:"撤销订单",iconCls:"remove",handler:Ext.bind(this.orderCancel,this)});this.genChangeBtn=Ext.widget("button",{text:"生成退换货申请",iconCls:"edit",handler:Ext.bind(this.genChange,this)});this.newNoneyReturnedBtn=Ext.widget("button",{text:"新增退款申请",iconCls:"edit",handler:Ext.bind(this.newNoneyReturned,this)});this.comfirmBtn=Ext.widget("button",{text:"订单确认",iconCls:"accept",handler:Ext.bind(this.orderConfirm,this)});this.add({title:"订单基本信息",border:false,layout:"fit",items:[this.orderForm],fbar:[this.cancelBtn,this.genChangeBtn,this.newNoneyReturnedBtn,this.comfirmBtn,{text:"关闭",iconCls:"back",handler:Ext.bind(this.closeWin,this)},{text:"保存",iconCls:"save",handler:Ext.bind(this.save,this)}]})},loadProductData:function(c,a){var b={brandName:a.data.brandName,productNo:a.data.productCode,productName:a.data.productName,marketPrice:a.data.retailPrice,netSalePrice:a.data.webRetailPrice,discountRate:a.data.webDiscount};this.priceDetailGrid.getForm().setValues(b);Ext.Easy.easyAjax("productOperateAction!queryColorAndSizes.action",{productSizeGroup:a.data.sizeGroup,productCode:a.data.productCode},function(e,g){var h=Ext.decode(e.responseText);var f=[],d=[];Ext.each(h.sizes,function(i){f.push([i.sizeCode,i.sizeName])});Ext.each(h.colors,function(i){d.push([i.colorCode,i.chnDesc])});this.priceDetailGrid.getForm().findField("colorCode").getStore().loadData(d);this.priceDetailGrid.getForm().findField("sizeCode").getStore().loadData(f)},this)},createOrderItemsPanel:function(){var b=[];var a={region:"center",xtype:"easygrid",noNeedRowNumber:true,formItemsReadOnly:true,showTbar:false,height:108,fields:customercenterDataElementsConfigs.getOrderItemFields(),noAutoLoad:true,parentPanel:this,subWindowTitle:"明细详情"};this.orderItemGrid=new Ext.ux.EasyGrid(a);b.push(Ext.Easy.getEasyFieldSetCfg("订单明细",this.orderItemGrid,1,true));a.fields=customercenterDataElementsConfigs.getPayItem();this.payItemGrid=new Ext.ux.EasyGrid(a);b.push(Ext.Easy.getEasyFieldSetCfg("支付明细",this.payItemGrid,1,true));a.fields=customercenterDataElementsConfigs.getNoney();this.noneyGrid=new Ext.ux.EasyGrid(a);b.push(Ext.Easy.getEasyFieldSetCfg("退款申请",this.noneyGrid,1,true));a.fields=customercenterDataElementsConfigs.getVoucher();this.voucherGrid=new Ext.ux.EasyGrid(a);b.push(Ext.Easy.getEasyFieldSetCfg("代金券明细",this.voucherGrid,1,true));this.orderItemsForm=Ext.widget("form",{bodyStyle:"padding:5px 5px 0",autoScroll:true,items:b});this.add({title:"订单其它信息",border:false,tabName:"orderItemsTab",layout:"fit",items:[this.orderItemsForm]})},createLogPanel:function(){var a={xtype:"easygrid",fields:customercenterDataElementsConfigs.getLog(),formItemsReadOnly:true,noNeddForceFit:true,noAutoLoad:true,subWindowTitle:"日志窗口"};this.easyLogGrid=new Ext.ux.EasyGrid(a);this.add({title:"操作日志",tabName:"logTab",layout:"fit",items:this.easyLogGrid})},save:function(){var b=this.orderForm;if(!Ext.Easy.isFormValid(this.orderForm)){return}this.pricesSumFun();if(this.isNew){var a=b.getForm().findField("source").getValue();if(a=="CC"||a=="NT"){Ext.Msg.alert("操作提示","CC与网站的订单请从网站下单! ");return}Ext.Msg.confirm("提示","确定订单金额无误且保存吗?",function(f){if(f=="yes"){var e=this.priceDetailGrid;var g={};var d=Ext.Easy.getRecordsToParams(e.getStore(),g,"ID",true,e);g.itemNewCount=d[0];b.submit({url:"orderOperateAction!saveOrder.action",params:g,success:function(h,i){Ext.Easy.alertMsg(true);this.loadFormRecord(i.result.order.ID)},failure:function(h,i){Ext.Easy.alertMsg(false)},scope:this})}},this)}else{var c=Ext.apply({},this.baseData);if(this.modifyCount==0){return}Ext.apply(c,this.modifyParams);c.modefiyCount=this.modifyCount;Ext.Easy.easyAjax("orderOperateAction!updateOrder.action",c,function(d,e){var f=Ext.decode(d.responseText);Ext.Easy.alertMsg(f.success);this.loadFormRecord(f.order.ID)},this)}},pricesSumFun:function(){var b=0,c=0,a=0;this.priceDetailGrid.getStore().each(function(d){a+=d.get("netSalePriceSum")},this);this.orderForm.getForm().findField("originalPriceSum").setValue(a);this.orderForm.getForm().findField("actuallyPaidAmount").setValue(a);this.orderForm.getForm().findField("orderAmount").setValue(a)},loadFormRecord:function(a,b){var c={id:a};if(b){if(!Ext.isEmpty(b.get("operaterId"))&&(b.get("operaterId")!=c_privileges.loginUserId)){Ext.Msg.alert("操作提示","此订单已被 "+b.get("operater")+" 锁住，请稍后再操作!",function(){this.closeWin()},this);this.parentWin.hide();this.parentPanel.doOrderQuery();return}c.oldOrderId=this.baseData.id}Ext.Easy.easyAjax("orderOperateAction!loadOrdertById.action",c,function(d,e){var g=Ext.decode(d.responseText);var f=g.order;if(g.isLock){Ext.Msg.alert("操作提示","此订单已被 "+f+" 锁住，请稍后再操作!");this.closeWin()}else{this.setFormData(f)}},this)},loadOrderOtherItems:function(){var a=this.orderItemsForm.query("fieldset");Ext.each(a,function(b){b.collapse()},this);Ext.Easy.easyAjax("orderOperateAction!getOtherOrderDetails.action",this.baseData,function(b,c){var d=Ext.decode(b.responseText);this.orderItemGrid.getStore().loadData(d.lstOrderItem);this.payItemGrid.getStore().loadData(d.lstPayItem);this.noneyGrid.getStore().loadData(d.lstNoneyReturned);this.voucherGrid.getStore().loadData(d.lstOrderVoucherRecords)},this)},setFormData:function(a){Ext.Easy.suspendOrResumeEvents(false,this);this.orderForm.getForm().setValues(a);this.isNew=false;this.setOrderFieldsReadOnly(a);this.baseData={id:a.ID,orderCd:a.orderCd};this.priceDetailGrid.getStore().loadData(a.lstPriceDetail);this.easyLogGrid.getStore().loadData(a.lstLogs);Ext.Easy.suspendOrResumeEvents(true,this);this.delayTask.delay(500)},setOrderFieldsReadOnly:function(a){if(!this.setOrdertask){this.setOrdertask=new Ext.util.DelayedTask(this)}this.setOrdertask.delay(600,function(){var c=this.orderForm.query("#orderStatusId > easycombo");Ext.each(c,function(d){d.setReadOnly(!this.isNew)},this)},this);this.priceDetailGrid.setFormBtnsVisible(this.isNew,this.isNew);var b=this.priceDetailGrid.getDockedComponent(1);if(this.isNew){b.show()}else{b.hide()}this.comfirmBtn.setVisible(!this.isNew&&(a&&a.confirmationStatus==1));this.cancelBtn.setVisible(!this.isNew&&(a&&a.type==1&&a.logisticsStatus==1));this.genChangeBtn.setVisible(!this.isNew&&(a&&a.type==1&&!a.hasGenChgOrRefd))},createRecord:function(){this.setActiveTab(0);Ext.Easy.suspendOrResumeEvents(false,this);this.orderForm.getForm().reset();this.isNew=true;this.setOrderFieldsReadOnly();this.baseData={id:null};this.easyLogGrid.getStore().loadData([]);this.priceDetailGrid.getStore().loadData([])},getRecordKey:function(){return"ID"},closeWin:function(){this.parentWin.close()},setParentWin:function(a){this.parentWin=a},genChange:function(){this.newChangOrRefundDataMainPanel=new Ext.CustomerCenter.newChangOrRefundDataMainPanel(Ext.apply({parentPanel:this},this.baseData))},newNoneyReturned:function(){this.NewNoneyReturnedPanel=new Ext.CustomerCenter.NewNoneyReturnedPanel(Ext.apply({parentPanel:this},this.baseData))},confirmOrCancelOrder:function(a){var b=Ext.apply({},this.baseData);Ext.apply(b,this.modifyParams);b.modefiyCount=this.modifyCount;Ext.Msg.confirm("提示","确认提交此操作吗?",function(c){if(c=="yes"){Ext.Ajax.request({url:a,params:b,success:function(d,e){var f=Ext.decode(d.responseText);Ext.Easy.alertMsg(f.success);if(f.success){this.closeWin();this.parentPanel.doOrderQuery()}},failure:function(d,e){Ext.Msg.alert("操作提示","读取信息失败,服务不可用!");this.closeWin()},scope:this})}},this)},orderConfirm:function(){this.confirmOrCancelOrder("orderOperateAction!orderConfirm.action")},orderCancel:function(){this.confirmOrCancelOrder("orderOperateAction!orderCancel.action")}});Ext.define("Ext.CustomerCenter.newChangOrRefundDataMainPanel",{extend:"Ext.panel.Panel",requires:["Ext.Product.ProductDataElementsConfigs","Ext.CustomerCenter.MemberPanel","Ext.CustomerCenter.CustomerCenterDataElementsConfigs"],initComponent:function(){var a=this;this.border=false;this.frame=false;this.layout="fit";this.activeItem=0;a.callParent();this.newChgOrRefdPanel()},newChgOrRefdPanel:function(){var a=[customercenterDataElementsConfigs.getConfigByName("orderCd"),customercenterDataElementsConfigs.getConfigByName("changeType"),customercenterDataElementsConfigs.getConfigByName("hasSignIn"),customercenterDataElementsConfigs.getConfigByName("hasPayment"),customercenterDataElementsConfigs.getConfigByName("expressName"),customercenterDataElementsConfigs.getConfigByName("expressNo"),customercenterDataElementsConfigs.getConfigByName("hasOneAddress"),customercenterDataElementsConfigs.getConfigByName("refundReceiver"),customercenterDataElementsConfigs.getConfigByName("refundReceiverMobile"),customercenterDataElementsConfigs.getConfigByName("refundReceiverAddress"),customercenterDataElementsConfigs.getConfigByName("refundReceiverPostCode"),customercenterDataElementsConfigs.getConfigByName("orderId"),customercenterDataElementsConfigs.getConfigByName("remark"),customercenterDataElementsConfigs.getConfigByName("toWarehouseRemark")];var d=Ext.Easy.getEasyForm({items:a,columnSize:3,region:"north"});this.genChangeForm=d;this.genChangeForm.getForm().findField("orderCd").setValue(this.orderCd).setReadOnly(true);this.genChangeForm.getForm().findField("orderId").setValue(this.id);var c={xtype:"easygrid",parentPanel:this,noAutoLoad:true,height:100,region:"center",subWindowTitle:"明细详情",fields:customercenterDataElementsConfigs.getRefundItem()};this.easyGridPurchasePlan=new Ext.ux.EasyGrid(c);var b=function(h,g){var f=h.nextSibling("textfield");f.setValue(h.rawValue)};this.easyGridPurchasePlan.getForm().findField("swapOutColorCode").on("change",b,this);this.easyGridPurchasePlan.getForm().findField("swapOutSizeCode").on("change",b,this);var e;if(!e){e=Ext.create("widget.window",{title:"新增退换货申请",closeAction:"hide",width:midwindowWidth,height:windowHight,resizable:true,modal:true,autoScroll:true,layout:"border",border:false,minimizable:true,maximizable:true,items:[{region:"north",border:false,items:this.genChangeForm},{region:"center",layout:"fit",border:false,items:this.easyGridPurchasePlan}],fbar:[{xtype:"button",text:"确定",iconCls:"add",handler:Ext.bind(this.saveChgRefund,this)},{xtype:"button",text:"返回",iconCls:"close",handler:function(){e.hide()}}]}).show()}this.chgRefdWin=e;this.loadRefundFormRecord(this.id)},afterWinShow:function(){this.openInitRowEdit()},loadRefundFormRecord:function(b,a){Ext.Ajax.request({url:"changOrRefundAction!genRefundByOrderItem.action",params:{id:b},success:function(c,d){this.key=b;var e=Ext.decode(c.responseText);if(e.success){this.setRefundFormData(e)}else{Ext.Msg.alert("操作提示","读取信息失败!");this.closeWin()}},failure:function(c,d){Ext.Msg.alert("操作提示","读取信息失败,服务不可用!");this.closeWin()},scope:this})},setRefundFormData:function(a){Ext.Easy.suspendOrResumeEvents(false,this);this.easyGridPurchasePlan.getStore().loadData(a.lstRefundItems);Ext.Easy.suspendOrResumeEvents(true,this)},openInitRowEdit:function(){var a=this.easyGridPurchasePlan.getForm().findField("productNo").getValue();Ext.Easy.easyAjax("purchasePlanAction!queryColorSizePriceByProductCode.action",{productCode:a},function(c){var f=Ext.decode(c.responseText);var g=f.colorList;var d=[];Ext.each(g,function(h){d.push([h.colorCode,h.chnDesc])},this);this.easyGridPurchasePlan.getForm().findField("swapOutColorCode").getStore().loadData(d);var b=f.sizeList;var e=[];Ext.each(b,function(h){e.push([h.sizeCode,h.sizeName])},this);this.easyGridPurchasePlan.getForm().findField("swapOutSizeCode").getStore().loadData(e)},this)},saveChgRefund:function(){if(!Ext.Easy.isFormValid(this.genChangeForm)){return}var b=this.easyGridPurchasePlan;var c=this.validateRefundItemGird(b);if(!c){Ext.Msg.alert("提示:","请选择需退换货的商品！");return}var d=Ext.apply({},this.modifyParams);var a=Ext.Easy.getRecordsToParams(b.getStore(),d,"ID",true,b);d.itemNewCount=a[0];d.itemModefiyCount=a[1];d.modefiyCount=this.modifyCount;this.genChangeForm.submit({url:"changOrRefundAction!saveRefundInfo.action",params:d,success:function(e,f){if(f.result.success){if(f.result.lockFlag!=""&&f.result.lockFlag!=null){Ext.Msg.alert("操作提示","所换商品"+f.result.lockFlag+"库存不足，换货失败!");return}this.parentPanel.parentPanel.setActiveTab(5);this.parentPanel.parentPanel.changOrRefundDataMainPanel.doQueryChgOrRefd();Ext.Msg.alert("操作提示","保存成功!",function(){this.chgRefdWin.hide();this.parentPanel.parentWin.close()},this)}else{Ext.Msg.alert("操作提示","数据异常!");return}},failure:function(e,f){Ext.Easy.alertMsg(false)},scope:this})},validateRefundItemGird:function(c){var b=c.getStore().getCount();var a=0;c.getStore().each(function(d){if((null==d.data.returnedGoods||""==d.data.returnedGoods)&&(null==d.data.replacinggoods||""==d.data.replacinggoods)||null==d.data.chgOrRefudReason||""==d.data.chgOrRefudReason){a++}},this);return b>a?true:false},closeWin:function(){this.parentWin.close()},setParentWin:function(a){this.parentWin=a},getRecordKey:function(){return"ID"}});Ext.define("Ext.CustomerCenter.NewNoneyReturnedPanel",{extend:"Ext.panel.Panel",requires:["Ext.Product.ProductDataElementsConfigs","Ext.CustomerCenter.MemberPanel","Ext.CustomerCenter.CustomerCenterDataElementsConfigs"],initComponent:function(){var a=this;this.border=false;this.frame=false;this.layout="fit";this.activeItem=0;a.callParent();this.newNoneyReturnedPanel()},newNoneyReturnedPanel:function(){var b=[customercenterDataElementsConfigs.getConfigByName("orderCd"),customercenterDataElementsConfigs.getConfigByName("amountRefunded"),customercenterDataElementsConfigs.getConfigByName("applicant"),customercenterDataElementsConfigs.getConfigByName("refundsMethod"),customercenterDataElementsConfigs.getConfigByName("accountBank"),customercenterDataElementsConfigs.getConfigByName("bankCardAddress"),customercenterDataElementsConfigs.getConfigByName("bankCardNo"),customercenterDataElementsConfigs.getConfigByName("accountName"),customercenterDataElementsConfigs.getConfigByName("orderId"),customercenterDataElementsConfigs.getConfigByName("noneyRefundsource"),{xtype:"label"},{xtype:"label"},customercenterDataElementsConfigs.getConfigByName("remarksNoney")];var a=Ext.Easy.getEasyForm({items:b,columnSize:3,region:"north"});this.newNoneyReturnedForm=a;this.newNoneyReturnedForm.getForm().findField("orderCd").setValue(this.orderCd).setReadOnly(true);this.newNoneyReturnedForm.getForm().findField("orderId").setValue(this.id);var c;if(!c){c=Ext.create("widget.window",{title:"新增退款申请",closeAction:"hide",width:midwindowWidth,height:windowHight-300,resizable:true,modal:true,border:false,minimizable:true,maximizable:true,items:[{region:"center",border:false,items:this.newNoneyReturnedForm}],fbar:[{xtype:"button",text:"确定",iconCls:"add",handler:Ext.bind(this.validateNoneyReturned,this)},{xtype:"button",text:"返回",iconCls:"close",handler:function(){c.hide()}}]}).show()}this.chgRefdWin=c;this.loadRefundFormRecord(this.id)},loadRefundFormRecord:function(b,a){Ext.Ajax.request({url:"noneyReturnedAction!validateNoneyMoney.action",params:{orderId:b},success:function(c,d){this.key=b;var e=Ext.decode(c.responseText);if(e.success){this.setRefundFormData(e)}else{Ext.Msg.alert("操作提示","读取信息失败!");this.closeWin()}},failure:function(c,d){Ext.Msg.alert("操作提示","读取信息失败,服务不可用!");this.closeWin()},scope:this})},setRefundFormData:function(a){Ext.Easy.suspendOrResumeEvents(false,this);this.newNoneyReturnedForm.getForm().findField("amountRefunded").setValue(a.noneyMoney);this.newNoneyReturnedForm.getForm().findField("source").setValue(a.refundsource);Ext.Easy.suspendOrResumeEvents(true,this)},validateNoneyReturned:function(){if(!Ext.Easy.isFormValid(this.newNoneyReturnedForm)){return}this.newNoneyReturnedForm.submit({url:"noneyReturnedAction!vildateNoneyMoney.action",success:function(b,c){if(c.result.success){if(c.result.tipStr!=""&&c.result.tipStr!=null){var a="输入的退款金额："+this.newNoneyReturnedForm.form.findField("amountRefunded").getValue()+" 与系统计算的退款金额："+c.result.tipStr+"有差异！确定继续执行此操作吗？";Ext.Msg.confirm("操作提示",a,function(d){if(d=="yes"){this.saveNoneyReturned()}},this)}else{this.saveNoneyReturned()}}else{Ext.Msg.alert("操作提示","数据异常!");return}},failure:function(a,b){Ext.Easy.alertMsg(false)},scope:this})},saveNoneyReturned:function(){if(!Ext.Easy.isFormValid(this.newNoneyReturnedForm)){return}this.newNoneyReturnedForm.submit({url:"noneyReturnedAction!saveNoneyReturnedInfo.action",success:function(a,b){if(b.result.success){this.parentPanel.parentPanel.setActiveTab(6);this.parentPanel.parentPanel.noneyReturnedMainPanel.doQueryNoneyReturned();Ext.Msg.alert("操作提示","保存成功!",function(){this.chgRefdWin.hide();this.parentPanel.parentWin.close()},this)}else{Ext.Msg.alert("操作提示","数据异常!");return}},failure:function(a,b){Ext.Easy.alertMsg(false)},scope:this})},validateRefundItemGird:function(c){var b=c.getStore().getCount();var a=0;c.getStore().each(function(d){if((null==d.data.returnedGoods||""==d.data.returnedGoods)&&(null==d.data.replacinggoods||""==d.data.replacinggoods)||null==d.data.chgOrRefudReason||""==d.data.chgOrRefudReason){a++}},this);return b>a?true:false},closeWin:function(){this.parentWin.close()},setParentWin:function(a){this.parentWin=a},getRecordKey:function(){return"ID"}});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Ext.CustomerCenter.CustomerCenterDataMainPanel",{extend:"Ext.tab.Panel",requires:["Ext.Product.ProductDataElementsConfigs","Ext.CustomerCenter.OrderPanel","Ext.CustomerCenter.ChangOrRefundDataMainPanel","Ext.CustomerCenter.NoneyReturnedMainPanel","Ext.CustomerCenter.MemberPanel","Ext.CustomerCenter.ComplaintPanel","Ext.CustomerCenter.CustomerCenterDataElementsConfigs"],initComponent:function(){var a=this;this.border=false;this.frame=false;this.activeItem=0;a.callParent();this.createConsultingPanel();this.createCommentsPanel();this.createMemberPanel();this.createOrderPanel();this.createOrderLockPanel();this.createChgOrRefdPanel();this.createNoneyReturnedPanel();this.createComplaintPanel();this.createWorkRecordPanel()},createConsultingPanel:function(){this.ConsultingPanel=new Ext.CustomerCenter.ConsultingPanel({parentPanel:this});this.add({title:"产品咨询",tabName:"ConsultingPanel",layout:"fit",items:this.ConsultingPanel})},createCommentsPanel:function(){this.CommentsPanel=new Ext.CustomerCenter.CommentsPanel({parentPanel:this});this.add({title:"产品评论",tabName:"CommentsPanel",layout:"fit",items:this.CommentsPanel})},createMemberPanel:function(){this.MemberPanel=new Ext.CustomerCenter.MemberPanel({parentPanel:this});this.add({title:"会员管理",tabName:"MemberPanel",layout:"fit",items:this.MemberPanel})},createOrderPanel:function(){this.queryForm=Ext.Easy.getEasyQueryForm(Ext.bind(this.doOrderQuery,this),customercenterDataElementsConfigs.getQueryOrderItems(),3);this.queryForm.getForm().findField("prepareGoodsStatus").on("select",function(b){this.doOrderQuery();this.orderGrid.down("#genSellRecordsBtn").setDisabled(!(b.value==1))},this);var a={region:"center",xtype:"easygridquery",fields:customercenterDataElementsConfigs.getViewOrderFields(),showTbar:true,needCheckboxColumn:true,noNeddForceFit:true,noAutoLoad:true,showBbar:true,showUpateBtn:true,iconCls:this.iconCls,checkboxPos:"first",subWindowWidth:miderwindowWidth,subWindowHeight:windowHight,subWindowTitle:"订单详情窗口",viewPanelClass:"Ext.CustomerCenter.OrderPanel",parentPanel:this,desktop:this.desktop,baseParams:{queryId:"customercenter.mapper.OrderMapper.queryOrder"}};this.orderGrid=new Ext.ux.EasyGridQuery(a);this.orderGrid.getDockedComponent(1).add({text:"生成销售出库单",iconCls:"genFile",id:"genSellRecordsBtn",handler:Ext.bind(this.genSellRecords,this)});this.add({title:"订单管理",layout:"border",items:[this.queryForm,this.orderGrid]})},genSellRecords:function(){if(!this.orderGrid.getSelectedRecord()){return}Ext.Msg.confirm("提示","确定为选择的订单生成销售出库单吗?",function(a){if(a=="yes"){var b=this.orderGrid.getSelecteds("ID");var d=this.orderGrid.getSelecteds("orderCd");var c={orderIds:b,orderCds:d};Ext.Easy.easyAjax("orderOperateAction!genSellRecords.action",c,function(e,f){var g=Ext.decode(e.responseText);Ext.Easy.alertMsg(g.success);this.doOrderQuery()},this)}},this)},createOrderLockPanel:function(){this.queryOrderLockForm=Ext.Easy.getEasyQueryForm(Ext.bind(this.doOrderLockQuery,this),[customercenterDataElementsConfigs.getBaseConfigByName("orderCd"),customercenterDataElementsConfigs.getBaseConfigByName("operater")],3);var a={region:"center",xtype:"easygridquery",fields:customercenterDataElementsConfigs.getViewOrderLockFields(),showTbar:true,noShowAddBtn:true,noNeddForceFit:true,needCheckboxColumn:true,noAutoLoad:true,showBbar:true,parentPanel:this,baseParams:{queryId:"customercenter.mapper.OrderMapper.queryOrderLock"}};this.orderLockGrid=new Ext.ux.EasyGridQuery(a);this.orderLockGrid.getDockedComponent(1).add({text:"解锁选择订单",iconCls:"lockopen",handler:Ext.bind(this.unLockOrders,this)});this.add({title:"订单锁管理",layout:"border",items:[this.queryOrderLockForm,this.orderLockGrid]})},doOrderLockQuery:function(){Ext.Easy.doEasyQuery(this.orderLockGrid,this.queryOrderLockForm)},unLockOrders:function(){if(!this.orderLockGrid.getSelectedRecord()){return}var a=this.orderLockGrid.getSelecteds("ID");Ext.Msg.confirm("提示","确定解锁所选订单吗?",function(b){if(b=="yes"){Ext.Easy.easyAjax("orderOperateAction!unLockOrder.action",{orderLockIds:a},function(c,d){var e=Ext.decode(c.responseText);this.doOrderLockQuery();Ext.Easy.alertMsg(e.success)},this)}},this)},createChgOrRefdPanel:function(){this.changOrRefundDataMainPanel=new Ext.CustomerCenter.ChangOrRefundDataMainPanel({parentPanel:this});this.add({title:"退换货申请管理",tabName:"changOrRefundDataMainPanel",layout:"fit",border:false,items:[this.changOrRefundDataMainPanel]})},createNoneyReturnedPanel:function(){this.noneyReturnedMainPanel=new Ext.CustomerCenter.NoneyReturnedMainPanel({parentPanel:this});this.add({title:"退款申请管理",tabName:"noneyReturnedMainPanel",layout:"fit",border:false,items:[this.noneyReturnedMainPanel]})},doOrderQuery:function(){Ext.Easy.doEasyQuery(this.orderGrid,this.queryForm)},createComplaintPanel:function(){this.ComplaintPanel=new Ext.CustomerCenter.ComplaintPanel({parentPanel:this});this.add({title:"投诉建议",tabName:"ComplaintPanel",layout:"fit",items:this.ComplaintPanel})},createWorkRecordPanel:function(){this.CommentsPanel=new Ext.CustomerCenter.CommentsPanel({parentPanel:this});this.add({title:"我的工作记录",tabName:"CommentsPanel",layout:"fit",items:[]})}});Ext.define("Ext.CustomerCenter.CommentsPanel",{extend:"Ext.panel.Panel",initComponent:function(){this.border=false;this.layout="border";this.callParent();this.queryForm=Ext.Easy.getEasyQueryForm(Ext.bind(this.doQuery,this),productDataElementsConfigs.getQueryCommentsConditionsItems(),3);var a={region:"center",xtype:"easygrid",fields:productDataElementsConfigs.getQueryCommentsFields(true),showBbar:true,noAutoLoad:true,parentPanel:this,formItemsReadOnly:true,showFormBtn:true,overrideUpdate:true,subWindowTitle:"评论详情",baseParams:{queryId:"backsys.mapper.ProductCommentMapper.queryComments"}};this.CommentsGrid=new Ext.ux.EasyGrid(a);this.add(this.queryForm);this.add(this.CommentsGrid)},doQuery:function(){Ext.Easy.doEasyQuery(this.CommentsGrid,this.queryForm)},updateRecord:function(b,c,a){var d=a;Ext.Easy.easyAjax("productOperateAction!updateProductComments.action",d,function(e,f){var g=Ext.decode(e.responseText);this.doQuery(this.ConsultingGrid);Ext.Easy.alertMsg(g.success)},this)}});Ext.define("Ext.CustomerCenter.ConsultingPanel",{extend:"Ext.panel.Panel",initComponent:function(){this.border=false;this.layout="border";this.callParent();this.queryForm=Ext.Easy.getEasyQueryForm(Ext.bind(this.doQuery,this),productDataElementsConfigs.getQueryConsultingConditionsItems(),3);var a={region:"center",xtype:"easygrid",fields:productDataElementsConfigs.getQueryConsultingFields(true),showBbar:true,showFormBtn:true,parentPanel:this,overrideUpdate:true,noAutoLoad:true,formItemsReadOnly:true,subWindowTitle:"咨询详情",baseParams:{queryId:"backsys.mapper.ProductCommentMapper.queryConsulting"}};this.ConsultingGrid=new Ext.ux.EasyGrid(a);this.add(this.queryForm);this.add(this.ConsultingGrid)},doQuery:function(){Ext.Easy.doEasyQuery(this.ConsultingGrid,this.queryForm)},updateRecord:function(b,c,a){var d={id:c.get("ID"),replyContent:a.replyContent};Ext.Easy.easyAjax("productOperateAction!replyConsultingQuestion.action",d,function(e,f){var g=Ext.decode(e.responseText);this.doQuery(this.ConsultingGrid);Ext.Easy.alertMsg(g.success)},this)}});Ext.define("Ext.CustomerCenter.ExChangePanel",{extend:"Ext.panel.Panel",initComponent:function(){this.border=false;this.layout="border";this.callParent()}});Ext.define("Ext.Privilege.FunctionNodes",{singleton:true,alternateClassName:"PRIFNS",functionNodes:[{text:"基础数据管理",funCode:"basedataMgr",iconCls:"option",checked:false},{text:"产品管理",funCode:"productMgr",iconCls:"option",checked:false},{text:"销售策略管理",funCode:"salesMgr",iconCls:"option",checked:false},{text:"采购管理",funCode:"purchaseMgr",iconCls:"option",checked:false},{text:"仓储管理",iconCls:"option",checked:false,funCode:"warehouseMgr"},{text:"客服中心管理",funCode:"customerCenterMgr",iconCls:"option",checked:false},{text:"会员管理",funCode:"memberMgr",iconCls:"option",checked:false},{text:"权限管理",funCode:"privilegeMgr",iconCls:"option",checked:false},{text:"代金券管理",funCode:"voucherMgr",iconCls:"option",checked:false}]});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Ext.Privilege.PrivilegeData",{extend:"Ext.ux.desktop.Module",uses:["Ext.Privilege.PrivilegeDataMainPanel"],id:"privilege-win",init:function(){this.launcher={text:"权限管理",iconCls:"privilege",handler:this.createWindow,scope:this}},createWindow:function(){var b=this.app.getDesktop();var a=b.getWindow(this.id);if(!a){a=b.createWindow({id:this.id,title:this.launcher.text,width:midwindowWidth,height:windowHight,iconCls:this.launcher.iconCls,animCollapse:false,border:false,hideMode:"offsets",layout:"fit",items:new Ext.Privilege.PrivilegeDataMainPanel({desktop:b})})}a.show();return a}});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Ext.Privilege.PrivilegeDataElementsConfigs",{extend:"Ext.util.MixedCollection",constructor:function(a){a=a||{};Ext.apply(this,a);this.callParent();this.init()},init:function(){this.staffConfig=new Ext.util.MixedCollection();this.staffConfig.add("chnName",{fieldLabel:"中文名",name:"chnName",flex:1});this.staffConfig.add("engName",{fieldLabel:"英文名",name:"engName",flex:1});this.staffConfig.add("dept",{fieldLabel:"部门",name:"department"});this.staffConfig.add("position",{fieldLabel:"职位",name:"position"});this.staffConfig.add("longinName",{fieldLabel:"工号(登陆名)",flex:1,name:"longinName",allowBlank:false,labelSeparator:'<font color="red">*</font>'});this.staffConfig.add("email",{fieldLabel:"邮箱",name:"email"});this.staffConfig.add("password",{inputType:"password",fieldLabel:"密码",name:"password",hiddenColumn:true,allowBlank:false,labelSeparator:'<font color="red">*</font>',renderer:function(a){return"*******"}});this.staffConfig.add("mobile",{fieldLabel:"手机",name:"mobile"});this.staffConfig.add("ID",{xtype:"hidden",fieldLabel:"主键",name:"ID"})},getBaseConfigByName:function(a){return Ext.apply({},this.staffConfig.get(a))},getQueryStaffFields:function(){return this.staffConfig}});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Ext.Privilege.PrivilegeDataMainPanel",{extend:"Ext.tab.Panel",requires:["Ext.Privilege.PrivilegeDataElementsConfigs","Ext.Privilege.FunctionNodes"],initComponent:function(){var a=this;this.border=false;this.frame=false;a.callParent();this.addPrivilegePanel();this.setActiveTab(0)},addPrivilegePanel:function(){this.queryForm=Ext.Easy.getEasyQueryForm(Ext.bind(this.doQuery,this),[privilegeDataElementsConfigs.getBaseConfigByName("chnName"),privilegeDataElementsConfigs.getBaseConfigByName("dept"),privilegeDataElementsConfigs.getBaseConfigByName("engName"),privilegeDataElementsConfigs.getBaseConfigByName("position")],2);var c={xtype:"easygrid",noAutoLoad:true,region:"center",showTbar:true,showBbar:true,parentPanel:this,noNeddForceFit:true,needCheckboxColumn:true,subWindowTitle:"人员信息详情",baseParams:{queryId:"backsys.mapper.PrivilegeMapper.queryStaffInfo"},fields:privilegeDataElementsConfigs.getQueryStaffFields()};this.easyGrid=new Ext.ux.EasyGrid(c);var d=[];Ext.each(PRIFNS.functionNodes,function(f){var g=[];Ext.each(f.children,function(h){g.push(Ext.apply({},h))});var e={children:g};d.push(Ext.applyIf(e,f))});var b=false;var a=Ext.create("Ext.tree.Panel",{region:"east",width:200,store:Ext.create("Ext.data.TreeStore",{root:{expanded:true,children:d}}),rootVisible:false,listeners:{checkchange:function(f,e){if(f.isLeaf()){if(e){this.parentcheckchange=false;f.parentNode.set("checked",true)}else{var g=true;f.parentNode.eachChild(function(h){if(h.get("checked")){g=false;return}});if(g){this.parentcheckchange=false;f.parentNode.set("checked",false)}}}else{if(this.parentcheckchange){f.eachChild(function(h){h.set("checked",e)})}}this.parentcheckchange=true;a.getStore().sort("checked","DESC")}},dockedItems:[{xtype:"toolbar",dock:"bottom",ui:"footer",items:[{text:"收起/展开全部",iconCls:"accept",handler:function(){if(b){a.expandAll()}else{a.collapseAll()}b=!b}},{text:"保存更改",iconCls:"save",handler:Ext.bind(this.save,this)}]}]});this.tree=a;this.add({title:"人员及权限管理",layout:"border",items:[{layout:"border",region:"center",items:[this.queryForm,this.easyGrid]},this.tree]})},doQuery:function(){this.tree.expandAll();Ext.Easy.doEasyQuery(this.easyGrid,this.queryForm)},save:function(){var d=this.easyGrid.getSelectionModel().getSelection();if(d.length==0){Ext.Msg.alert("操作提示","请选择人员!");return}var b="";Ext.each(d,function(f){if(b.length>0){b+=","}b+=f.get("ID")});var c="",a=this.tree.getChecked();Ext.each(a,function(f){if(c.length>0){c+=","}c+=f.raw.funCode});var e="privilegeOperationAction!savePrivilege.action";Ext.Easy.easyAjax(e,{staffIds:b,privileges:c},function(g,h){var i=Ext.decode(g.responseText);this.doQuery();var f=this.tree.getView().getRecords(this.tree.getView().getNodes());Ext.each(f,function(j){j.set("checked",false)},this);Ext.Easy.alertMsg(i.success)},this)},dbClickFun:function(b){var a="privilegeOperationAction!queryPrivilegeByStaffId.action";Ext.Easy.easyAjax(a,{id:b.get("ID")},function(e,f){var g=Ext.decode(e.responseText);var d=g.result;var c=this.tree.getView().getRecords(this.tree.getView().getNodes());Ext.each(c,function(h){h.set("checked",d[h.raw.funCode])},this)},this)},addRecord:function(c,f,b,a,e){var d="privilegeOperationAction!saveStaffInfo.action";Ext.Easy.easyAjax(d,b,function(g,h){var i=Ext.decode(g.responseText);this.doQuery();Ext.Easy.alertMsg(i.success,"用户名重复或服务不可用!")},this)},updateRecord:function(b,d,a){var c="privilegeOperationAction!updateStaffInfo.action";Ext.Easy.easyAjax(c,a,function(e,f){var g=Ext.decode(e.responseText);this.doQuery();Ext.Easy.alertMsg(g.success)},this)},afterWinShow:function(a){a.findField("longinName").setReadOnly(!a.baseParams.create)},removeRecord:function(b,f,a,e){var g={id:f.get("ID")};var d="privilegeOperationAction!deleteStaffInfo.action";var c=false;Ext.Easy.easyAjax(d,g,function(h,i){var j=Ext.decode(h.responseText);c=j.success;this.doQuery();Ext.Easy.alertMsg(j.success)},this,true);return c}});Ext.define("Ext.Purchasing.PurchaseDetailPanel",{extend:"Ext.panel.Panel",requires:[],initComponent:function(){this.delAry="";var a=this;this.border=false;this.frame=false;this.layout="fit";this.isNew=true;this.autoScroll=true,a.callParent();this.editPurchasePanel()},editPurchasePanel:function(){var c=[purchasingDataElementsConfigs.getBaseConfigByName("purchasePlanCd"),purchasingDataElementsConfigs.getBaseConfigByName("purchaser"),purchasingDataElementsConfigs.getBaseConfigByName("mobile"),purchasingDataElementsConfigs.getBaseConfigByName("phone"),purchasingDataElementsConfigs.getBaseConfigByName("email"),purchasingDataElementsConfigs.getBaseConfigByName("warehouse"),purchasingDataElementsConfigs.getBaseConfigByName("currency"),purchasingDataElementsConfigs.getBaseConfigByName("creator"),purchasingDataElementsConfigs.getBaseConfigByName("createTime"),purchasingDataElementsConfigs.getBaseConfigByName("modifer"),purchasingDataElementsConfigs.getBaseConfigByName("modifeTime"),purchasingDataElementsConfigs.getBaseConfigByName("auditer"),purchasingDataElementsConfigs.getBaseConfigByName("auditTime"),purchasingDataElementsConfigs.getBaseConfigByName("auditStatus"),purchasingDataElementsConfigs.getBaseConfigByName("costPriceTotal"),purchasingDataElementsConfigs.getBaseConfigByName("handTagPriceTotal"),{xtype:"label"},{xtype:"label"},purchasingDataElementsConfigs.getConfigByName("remarks"),purchasingDataElementsConfigs.getConfigByName("ID")];var e=Ext.Easy.getEasyForm({items:c,columnSize:3,region:"north"});this.editPurchaseForm=e;Ext.Easy.initFormEvents(this.editPurchaseForm,this);Ext.Easy.suspendOrResumeEvents(false,this);var d=Ext.create("Ext.grid.plugin.RowEditing",{clicksToMoveEditor:1,errorSummary:false,autoCancel:false});this.rowEditing=d;var f=[],a=[];Ext.Easy.getColumnsConfigAndFields(purchasingDataElementsConfigs.getPurchaseFields(),f,a,null,86);var g=[{text:"新增",iconCls:"add",handler:Ext.bind(this.onAddRecord,this)},{itemId:"removeEmployee",text:"删除",iconCls:"remove",handler:Ext.bind(this.removePurchaseItem,this)},{text:"复制",iconCls:"add",handler:function(){var i=b.getSelectionModel();if(i.selected.length<1){Ext.Msg.alert("提示","请先选择一行记录！");return}d.cancelEdit();var h=i.getSelection()[0];b.getStore().insert(0,Ext.applyIf({ID:null},h.data));d.startEdit(0,0)}}];var b=Ext.Easy.createMyGrid(a,f,null,null,d,g);this.editPurchaseGrid=b;d.on("edit",Ext.bind(this.sumAllMoney,this),this);d.on("beforeedit",function(h,i){d.cancelEdit();this.openInitRowEdit(h)},this);this.genPassBtn=Ext.widget("button",{text:"审核通过",iconCls:"edit",handler:Ext.bind(this.passAudit,this)});this.genNoPassBtn=Ext.widget("button",{text:"审核不通过",iconCls:"edit",handler:Ext.bind(this.noPassAudit,this)});this.genSaveBtn=Ext.widget("button",{text:"保存",iconCls:"accept",handler:Ext.bind(this.updatePurchasePlan,this)});this.add({layout:"border",items:[e,b],fbar:[this.genPassBtn,this.genNoPassBtn,this.genSaveBtn]})},loadFormRecord:function(b,a){Ext.Ajax.request({url:"purchasePlanAction!loadPurchasePlanById.action",params:{id:b},success:function(c,d){this.key=b;var e=Ext.decode(c.responseText);if(e.success){this.setFormData(e)}else{Ext.Msg.alert("操作提示","读取信息失败!");this.closeWin()}},failure:function(c,d){Ext.Msg.alert("操作提示","读取信息失败,服务不可用!");this.closeWin()},scope:this})},setFormData:function(a){Ext.Easy.suspendOrResumeEvents(false,this);this.editPurchaseForm.form.setValues(a.purchaseobject);this.baseData={id:a.purchaseobject.ID};this.editPurchaseGrid.getStore().loadData(a.lstPurchasePlanItems);this.initFbar(a.purchaseobject.auditStatus);Ext.Easy.suspendOrResumeEvents(true,this)},initFbar:function(a){this.genSaveBtn.setVisible(a==1||a==3);this.genPassBtn.setVisible(a==1||a==3);this.genNoPassBtn.setVisible(a==1);this.setFieldReadOnly()},setFieldReadOnly:function(){this.editPurchaseForm.form.findField("purchasePlanCd").setReadOnly(true);this.editPurchaseForm.form.findField("auditStatus").setReadOnly(true);this.editPurchaseForm.form.findField("creator").setReadOnly(true);this.editPurchaseForm.form.findField("createTime").setReadOnly(true);this.editPurchaseForm.form.findField("modifer").setReadOnly(true);this.editPurchaseForm.form.findField("modifeTime").setReadOnly(true);this.editPurchaseForm.form.findField("auditer").setReadOnly(true);this.editPurchaseForm.form.findField("auditTime").setReadOnly(true);this.editPurchaseForm.form.findField("costPriceTotal").setReadOnly(true);this.editPurchaseForm.form.findField("handTagPriceTotal").setReadOnly(true)},updatePurchasePlan:function(){if(!Ext.Easy.isFormValid(this.editPurchaseForm)){return}if(this.editPurchaseGrid.getStore().getCount()<1){Ext.Msg.alert("提示:","请增加采购计划明细信息！");return}var c=this.parentPanel.validatePlanGird(this.editPurchaseGrid);if(!c){Ext.Msg.alert("提示:","请输入采购计划明细信息！");return}var d=Ext.apply({},this.modifyParams);var a="purchasePlanAction!updatePurchasePlanInfo.action";var b=Ext.Easy.getRecordsToParams(this.editPurchaseGrid.getStore(),d,"ID",true,this.editPurchaseGrid);d.itemNewCount=b[0];d.itemModefiyCount=b[1];d.modefiyCount=this.modifyCount;d.purchasePlanId=this.editPurchaseForm.form.findField("ID").getValue();d.delPlanItemId=this.delAry;if((this.modifyCount+b[0]+b[1])==0){return}Ext.Ajax.request({url:a,params:d,success:function(e,f){var g=Ext.decode(e.responseText);if(g.success){Ext.Msg.alert("操作提示","操作成功!",function(){this.closeWin();this.parentPanel.doQueryPurchase()},this)}},failure:function(e,f){Ext.Msg.alert("操作提示","操作失败,服务不可用!")},scope:this})},passAudit:function(){Ext.Msg.confirm("操作提示","确认通过审核?",function(a){if(a=="yes"){Ext.Ajax.request({url:"purchasePlanAction!updatePurPlanStatus.action",params:{id:this.baseData.id,auditStatus:2},success:function(b,c){var d=Ext.decode(b.responseText);if(d.success){Ext.Msg.alert("操作提示","操作成功!",function(){this.closeWin();this.parentPanel.doQueryPurchase()},this)}},failure:function(b,c){Ext.Msg.alert("操作提示","操作失败,服务不可用!")},scope:this})}},this)},noPassAudit:function(){Ext.Msg.confirm("操作提示","确认审核不通过?",function(a){if(a=="yes"){Ext.Ajax.request({url:"purchasePlanAction!updatePurPlanStatus.action",params:{id:this.baseData.id,auditStatus:3},success:function(b,c){var d=Ext.decode(b.responseText);if(d.success){Ext.Msg.alert("操作提示","操作成功!",function(){this.closeWin();this.parentPanel.doQueryPurchase()},this)}},failure:function(b,c){Ext.Msg.alert("操作提示","操作失败,服务不可用!")},scope:this})}},this)},openInitRowEdit:function(g){var e=this.editPurchaseGrid.columns[1].field;var d=this.editPurchaseGrid.columns[2].field;var k=this.editPurchaseGrid.columns[3].field;var f=this.editPurchaseGrid.columns[4].field;var h=this.editPurchaseGrid.columns[5].field;var c=this.editPurchaseGrid.columns[6].field;var b=this.editPurchaseGrid.columns[7].field;var m=this.editPurchaseGrid.columns[8].field;var j=this.editPurchaseGrid.columns[9].field;var i=this.editPurchaseGrid.columns[10].field;var l=this.editPurchaseGrid.columns[12].field;var a=this.editPurchaseGrid.columns[13].field;var n=this.editPurchaseGrid.columns[14].field;e.store.loadData(CDM.brandName);e.on("change",function(q,p,o){if(!p){return}d.setValue(null);k.setValue(null);f.setValue(null);h.setValue(null);c.setValue(null);b.setValue(null);m.setValue(null);j.setValue(null);i.setValue(null);l.setValue(null);a.setValue(null);n.setValue(null);Ext.Easy.easyAjax("purchasePlanAction!queryProductByBrand.action",{brandCode:p},function(s){var v=Ext.decode(s.responseText);var u=v.productList;var t=[];var r=[];Ext.each(u,function(w){t.push([w.productCode,w.productCode]);r.push([w.productCode,w.productName,w.referencePrice,w.retailPrice])},this);d.store.loadData(t);d.setValue(g.record.data.styleNumber);this.styleNameData=r},this)},this);d.on("change",function(q,p,o){if(!p){return}k.setValue(g.record.data.styleName);j.setValue(g.record.data.costPrice);i.setValue(g.record.data.handTagPrice);l.setValue(g.record.data.orderNumber);a.setValue(g.record.data.costPriceSum);n.setValue(g.record.data.handTagPriceSum);Ext.each(this.styleNameData,function(r){if(p==r[0]){k.setValue(r[1]);j.setValue(r[2]);i.setValue(r[3])}});f.setValue(null);h.setValue(null);c.setValue(null);b.setValue(null);m.setValue(null);Ext.Easy.easyAjax("purchasePlanAction!queryColorSizePriceByProductCode.action",{productCode:p},function(u){var x=Ext.decode(u.responseText);var y=x.colorList;var v=[];var t=[];Ext.each(y,function(z){v.push([z.colorCode,z.chnDesc]);t.push([z.colorCode,z.chnDesc,z.engDesc])},this);this.colorArrayData=t;f.store.loadData(v);f.setValue(g.record.data.colorNo);var s=x.sizeList;var w=[];var r=[];Ext.each(s,function(z){w.push([z.sizeCode,z.sizeName]);r.push([z.sizeCode,z.sizeName])},this);this.sizeArrayData=r;b.store.loadData(w);b.setValue(g.record.data.sizeNo)},this)},this);f.on("change",function(q,p,o){if(!p){return}h.setValue(null);c.setValue(null);Ext.each(this.colorArrayData,function(r){if(r[0]==p){h.setValue(r[1]);c.setValue(r[2])}})},this);b.on("change",function(q,p,o){if(!p){return}m.setValue(null);Ext.each(this.sizeArrayData,function(r){if(r[0]==p){m.setValue(r[1])}})},this);l.on("change",function(t,o,p){a.setValue(null);n.setValue(null);if(!l.getValue()){return}var q=Number(l.getValue());if(null!=j.getValue()&&""!=j.getValue()){var s=Number(j.getValue());a.setValue(Ext.util.Format.round(q*s,2))}if(null!=i.getValue()&&""!=i.getValue()){var r=Number(i.getValue());n.setValue(Ext.util.Format.round(q*r,2))}},this);j.on("change",function(s,o,p){a.setValue(null);if(!l.getValue()){return}var q=Number(l.getValue());if(null!=j.getValue()&&""!=j.getValue()){var r=Number(j.getValue());a.setValue(Ext.util.Format.round(q*r,2))}},this);i.on("change",function(s,o,p){n.setValue(null);if(!l.getValue()){return}var q=Number(l.getValue());if(null!=i.getValue()&&""!=i.getValue()){var r=Number(i.getValue());n.setValue(Ext.util.Format.round(q*r,2))}},this)},sumAllMoney:function(){var b=0;var a=0;this.editPurchaseGrid.getStore().each(function(c){if(null!=c.data.brand&&""!=c.data.brand){if(c.data.costPriceSum>0){b+=c.data.costPriceSum}if(c.data.handTagPriceSum>0){a+=c.data.handTagPriceSum}}},this);this.editPurchaseForm.form.findField("costPriceTotal").setValue(b);this.editPurchaseForm.form.findField("costPriceTotal").focus();this.editPurchaseForm.form.findField("handTagPriceTotal").setValue(a);this.editPurchaseForm.form.findField("handTagPriceTotal").focus()},removePurchaseItem:function(){var c=this.editPurchaseGrid.getSelectionModel();if(c.selected.length<1){Ext.Msg.alert("提示","请选择需删除的记录！");return}this.rowEditing.cancelEdit();var b=c.getLastSelected().get("ID");if(null!=b&&""!=b){this.delAry+=b+","}this.editPurchaseGrid.getStore().remove(c.getSelection());var a=this.editPurchaseGrid.getView().getSelectionModel().getSelection()[0];if(a){c.select(0)}this.sumAllMoney()},onAddRecord:function(){this.rowEditing.cancelEdit();this.editPurchaseGrid.getStore().insert(0,{});this.rowEditing.startEdit(0,0);this.openInitRowEdit()},closeWin:function(){this.parentWin.close()},setParentWin:function(a){this.parentWin=a},getRecordKey:function(){return"ID"}});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Ext.Purchasing.PurchasingData",{extend:"Ext.ux.desktop.Module",uses:["Ext.Purchasing.PurchasingDataMainPanel"],id:"purchasing-win",init:function(){this.launcher={text:"采购管理",iconCls:"purchase",handler:this.createWindow,scope:this}},createWindow:function(){var b=this.app.getDesktop();var a=b.getWindow(this.id);if(!a){a=b.createWindow({id:this.id,title:this.launcher.text,width:midwindowWidth,height:windowHight,iconCls:this.launcher.iconCls,animCollapse:false,border:false,hideMode:"offsets",layout:"fit",items:new Ext.Purchasing.PurchasingDataMainPanel({desktop:b})})}a.show();return a}});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Ext.Purchasing.PurchasingDataElementsConfigs",{extend:"Ext.util.MixedCollection",constructor:function(a){a=a||{};Ext.apply(this,a);this.callParent();this.init()},init:function(){this.add("ID",{xtype:"hidden",fieldLabel:"ID",name:"ID"});this.add("purchaser",{fieldLabel:"采购人",name:"purchaser",required:true});this.add("mobile",{fieldLabel:"手机",name:"mobile",required:true});this.add("phone",{fieldLabel:"电话",name:"phone"});this.add("email",{fieldLabel:"Email",name:"email",required:true});this.add("warehouse",Ext.apply({allowBlank:false},Ext.Easy.getEasyComboCfg("入库仓库","warehouse",null,CDM.storagInfo,true,null,true)));this.add("currency",Ext.apply({allowBlank:false},Ext.Easy.getEasyComboCfg("币种","currency",null,CDM.currency,true,null,true)));this.add("costPriceTotal",{xtype:"numberfield",minValue:0,allowDecimals:true,hideTrigger:true,fieldLabel:"成本价总计",name:"costPriceTotal",required:true});this.add("handTagPriceTotal",{xtype:"numberfield",minValue:0,allowDecimals:true,hideTrigger:true,fieldLabel:"吊牌价总计",name:"handTagPriceTotal",required:true});this.add("remarks",{xtype:"textareafield",fieldLabel:"备注",name:"remarks",width:600,colspan:3});this.add("purchasePlanCd",{fieldLabel:"采购计划编号",name:"purchasePlanCd",editor:"text"});this.add("auditStatus",Ext.apply({editor:"combo"},Ext.Easy.getEasyComboCfg("审核状态","auditStatus",null,CDM.auditStatus,true,null,true)));this.add("creator",{fieldLabel:"创建人",name:"creator"});this.add("createTime",{fieldLabel:"创建时间",name:"createTime"});this.add("modifer",{fieldLabel:"修改人",name:"modifer"});this.add("modifeTime",{fieldLabel:"修改时间",name:"modifeTime"});this.add("auditer",{fieldLabel:"审核人",name:"auditer"});this.add("auditTime",Ext.apply({editor:"date"},Ext.Easy.getEasyDateCfg("审核时间","auditTime")));this.add("purchaseStorageCd",{fieldLabel:"采购入库单编号",name:"purchaseStorageCd"});this.add("brand",Ext.apply({editor:"combo"},Ext.Easy.getEasyComboCfg("品牌名称","brand",null,CDM.brandName,true,null,true)));this.add("styleNumber",Ext.apply({editor:"combo"},Ext.Easy.getEasyComboCfg("款号","styleNumber",null,[],null,null,true)));this.add("styleName",{fieldLabel:"款名",name:"styleName",editor:"text"});this.add("colorNo",Ext.apply({editor:"combo"},Ext.Easy.getEasyComboCfg("色号","colorNo",null,[])));this.add("colorCnName",{fieldLabel:"颜色中文名",name:"colorCnName",editor:"text"});this.add("colorEnName",{fieldLabel:"颜色英文名",name:"colorEnName",editor:"text"});this.add("sizeNo",Ext.apply({editor:"combo"},Ext.Easy.getEasyComboCfg("尺码号","sizeNo",null,[])));this.add("sizeMa",{fieldLabel:"尺码",name:"sizeMa",editor:"text"});this.add("costPrice",{xtype:"numberfield",minValue:0,allowDecimals:true,hideTrigger:true,fieldLabel:"成本价",name:"costPrice",required:true,editor:"number"});this.add("handTagPrice",{xtype:"numberfield",minValue:0,allowDecimals:true,hideTrigger:true,fieldLabel:"吊牌价",name:"handTagPrice",required:true,editor:"number"});this.add("orderNumber",{xtype:"numberfield",minValue:1,hideTrigger:true,fieldLabel:"订购数量",name:"orderNumber",required:true,editor:"number"});this.add("costPriceSum",{xtype:"numberfield",minValue:0,allowDecimals:true,hideTrigger:true,fieldLabel:"成本价合计",name:"costPriceSum",required:true,editor:"number"});this.add("handTagPriceSum",{xtype:"numberfield",minValue:0,allowDecimals:true,hideTrigger:true,fieldLabel:"吊牌价合计",name:"handTagPriceSum",required:true,editor:"number"});this.add("channelCode",Ext.apply({editor:"combo"},Ext.Easy.getEasyComboCfg("渠道","channelCode",null,CDM.channel,true)));this.add("deliveryDate",Ext.apply({editor:"date"},Ext.Easy.getEasyDateCfg("交货日期","deliveryDate")));this.add("buyCode",{fieldLabel:"入库编号",name:"buyCode"});this.add("storage",Ext.apply({allowBlank:false},Ext.Easy.getEasyComboCfg("入库仓库","storage",null,CDM.storagInfo,true,null,true)));this.add("productSource",Ext.apply({allowBlank:false},Ext.Easy.getEasyComboCfg("货品来源","productSource",null,CDM.productSource,true,null,true)));this.add("batchNo",{fieldLabel:"批次号",name:"batchNo"});this.add("applicant",{fieldLabel:"申请人",name:"applicant",required:true});this.add("applyDate",Ext.Easy.getEasyDateCfg("申请入库时间","applyDate"));this.add("validateDate",Ext.Easy.getEasyDateCfg("实际验收时间","validateDate"));this.add("enterState",Ext.apply({allowBlank:false},Ext.Easy.getEasyComboCfg("入库单状态","enterState",null,CDM.enterState,true,null,true)));this.add("isBuy",Ext.Easy.getEasyComboCfg("是否入库","isBuy",null,null,true,null,true));this.add("isDifference",Ext.Easy.getEasyComboCfg("是否差异","isDifference"),null,null,true,null,true);this.add("buyNote",{xtype:"textareafield",fieldLabel:"采购备注",name:"buyNote",width:600,colspan:3});this.add("createDate",{fieldLabel:"创建时间",name:"createDate"});this.add("applyRandDate",Ext.Easy.getRandFields({fieldLabel:"申请入库时间",name1:"beginApplyDate",name2:"endApplyDate"}));this.add("validateRandDate",Ext.Easy.getRandFields({fieldLabel:"实际验收时间",name1:"beginValidateDate",name2:"endValidateDate"}));this.add("createRandDate",Ext.Easy.getRandFields({fieldLabel:"创建时间",name1:"beginCreateDate",name2:"endCreateDate"}));this.add("productBrand",Ext.apply({editor:"combo"},Ext.Easy.getEasyComboCfg("货品品牌","productBrand",null,CDM.brandName,true)));this.add("productCd",Ext.apply({editor:"combo"},Ext.Easy.getEasyComboCfg("货品CD","productCd",null,[])));this.add("productName",{fieldLabel:"货品名称",name:"productName",editor:"text"});this.add("productColorNo",Ext.apply({editor:"combo"},Ext.Easy.getEasyComboCfg("货品色号","productColorNo",null,[])));this.add("productColorCn",{fieldLabel:"货品颜色（中文）",name:"productColorCn",editor:"text"});this.add("productColorEn",{fieldLabel:"货品颜色（英文）",name:"productColorEn",editor:"text"});this.add("productSizeNo",Ext.apply({editor:"combo"},Ext.Easy.getEasyComboCfg("货品尺码号","productSizeNo",null,[])));this.add("productSize",{fieldLabel:"货品尺码",name:"productSize",editor:"text"});this.add("productBarcode",{fieldLabel:"货品条形码",name:"productBarcode",editor:"text"});this.add("productPrice",{xtype:"numberfield",minValue:0,allowDecimals:true,hideTrigger:true,fieldLabel:"货品单价",name:"productPrice",required:true,editor:"number"});this.add("productCost",{xtype:"numberfield",minValue:0,allowDecimals:true,hideTrigger:true,fieldLabel:"货品成本价",name:"productCost",required:true,editor:"number"});this.add("projectNum",{xtype:"numberfield",minValue:1,hideTrigger:true,fieldLabel:"货品计划数量",name:"projectNum",required:true,editor:"number"});this.add("realNum",{xtype:"numberfield",minValue:1,hideTrigger:true,fieldLabel:"货品实收数量",name:"realNum",required:true,editor:"number"});this.add("differenceNum",{xtype:"numberfield",minValue:1,hideTrigger:true,fieldLabel:"货品差异数量",name:"differenceNum",required:true,editor:"number"});this.add("isValidate",Ext.apply({editor:"combo"},Ext.Easy.getEasyComboCfg("是否验收","isValidate")));this.add("shelf",{fieldLabel:"入库货架",name:"shelf",editor:"text"});this.add("isProject",{xtype:"hidden",fieldLabel:"isProject",name:"isProject",value:1})},getConfigByName:function(b,c){var a=Ext.apply({},this.get(b));if(a.required){Ext.apply(a,{allowBlank:false,blankText:"此字段不能为空",labelSeparator:'<font color="red">*</font>'})}if(c){a=Ext.apply(a,{colspan:c,anchor:"85%"})}return a},getBaseConfigByName:function(a){return Ext.apply({},this.get(a))},getBrandFields:function(){var a=new Ext.util.MixedCollection();a.add(this.get("purchasePlanCd"));a.add(this.get("purchaser"));a.add(this.get("mobile"));a.add(this.get("phone"));a.add(this.get("email"));a.add(this.get("warehouse"));a.add(this.get("currency"));a.add(this.get("costPriceTotal"));a.add(this.get("handTagPriceTotal"));a.add(this.get("creator"));a.add(this.get("createTime"));a.add(this.get("auditStatus"));a.add(this.get("auditer"));a.add(this.get("auditTime"));a.add(this.get("ID"));return a},getPurchaseFields:function(){var a=new Ext.util.MixedCollection();a.add(this.get("brand"));a.add(this.get("styleNumber"));a.add(this.get("styleName"));a.add(this.get("colorNo"));a.add(this.get("colorCnName"));a.add(this.get("colorEnName"));a.add(this.get("sizeNo"));a.add(this.get("sizeMa"));a.add(this.get("costPrice"));a.add(this.get("handTagPrice"));a.add(this.get("channelCode"));a.add(this.get("orderNumber"));a.add(this.get("costPriceSum"));a.add(this.get("handTagPriceSum"));a.add(this.get("deliveryDate"));a.add(this.get("ID"));return a},getBuyEnterFields:function(){var a=new Ext.util.MixedCollection();a.add(this.get("buyCode"));a.add(this.get("storage"));a.add(this.get("productSource"));a.add(this.get("batchNo"));a.add(this.get("applicant"));a.add(this.get("applyDate"));a.add(this.get("validateDate"));a.add(this.get("enterState"));a.add(this.get("isBuy"));a.add(this.get("isDifference"));a.add(this.get("buyNote"));a.add(this.get("createDate"));a.add(this.get("ID"));return a},getBuyDetailFields:function(){var a=new Ext.util.MixedCollection();a.add(this.get("productBrand"));a.add(this.get("productCd"));a.add(this.get("productName"));a.add(this.get("productColorNo"));a.add(this.get("productColorCn"));a.add(this.get("productColorEn"));a.add(this.get("productSizeNo"));a.add(this.get("productSize"));a.add(this.get("productCost"));a.add(this.get("productPrice"));a.add(this.get("projectNum"));a.add(this.get("productBarcode"));a.add(this.get("isProject"));a.add(this.get("ID"));return a},getBuyDetailModiferFields:function(){var a=new Ext.util.MixedCollection();a.add(this.get("productBrand"));a.add(this.get("productCd"));a.add(this.get("productName"));a.add(this.get("productColorNo"));a.add(this.get("productColorCn"));a.add(this.get("productColorEn"));a.add(this.get("productSizeNo"));a.add(this.get("productSize"));a.add(this.get("productCost"));a.add(this.get("productPrice"));a.add(this.get("projectNum"));a.add(this.get("productBarcode"));a.add(this.get("realNum"));a.add(this.get("differenceNum"));a.add(this.get("isValidate"));a.add(this.get("shelf"));a.add(this.get("ID"));return a}});Ext.define("Ext.Purchasing.StorageDetailPanel",{extend:"Ext.panel.Panel",requires:[],initComponent:function(){this.delAry="";var a=this;this.border=false;this.frame=false;this.layout="fit";this.isNew=true;this.autoScroll=true,a.callParent();this.editPurchasePanel()},editPurchasePanel:function(){var c=[purchasingDataElementsConfigs.getBaseConfigByName("buyCode"),purchasingDataElementsConfigs.getBaseConfigByName("applicant"),purchasingDataElementsConfigs.getBaseConfigByName("applyDate"),purchasingDataElementsConfigs.getBaseConfigByName("batchNo"),purchasingDataElementsConfigs.getBaseConfigByName("enterState"),purchasingDataElementsConfigs.getBaseConfigByName("isBuy"),purchasingDataElementsConfigs.getBaseConfigByName("validateDate"),purchasingDataElementsConfigs.getBaseConfigByName("isDifference"),purchasingDataElementsConfigs.getBaseConfigByName("storage"),purchasingDataElementsConfigs.getBaseConfigByName("productSource"),purchasingDataElementsConfigs.getBaseConfigByName("creator"),purchasingDataElementsConfigs.getBaseConfigByName("createDate"),purchasingDataElementsConfigs.getConfigByName("buyNote"),purchasingDataElementsConfigs.getConfigByName("ID")];var e=Ext.Easy.getEasyForm({items:c,columnSize:3,region:"north"});this.editPurchaseForm=e;Ext.Easy.initFormEvents(this.editPurchaseForm,this);Ext.Easy.suspendOrResumeEvents(false,this);var d=Ext.create("Ext.grid.plugin.RowEditing",{clicksToMoveEditor:1,errorSummary:false,autoCancel:false});this.rowEditing=d;var f=[],a=[];Ext.Easy.getColumnsConfigAndFields(purchasingDataElementsConfigs.getBuyDetailModiferFields(),f,a,null,86);var b=Ext.Easy.createMyGrid(a,f,null,null,d,null);this.editPurchaseGrid=b;d.on("beforeedit",function(g,h){d.cancelEdit();this.openInitRowEdit(g)},this);this.genSaveBtn=Ext.widget("button",{text:"保存",iconCls:"accept",handler:Ext.bind(this.updatePurachaseStorage,this)});this.add({layout:"border",items:[e,b],fbar:[this.genSaveBtn]})},loadFormRecord:function(b,a){Ext.Ajax.request({url:"purchaseStorageAction!loadPurchaseStorageById.action",params:{id:b},success:function(c,d){this.key=b;var e=Ext.decode(c.responseText);if(e.success){this.setFormData(e)}else{Ext.Msg.alert("操作提示","读取信息失败!");this.closeWin()}},failure:function(c,d){Ext.Msg.alert("操作提示","读取信息失败,服务不可用!");this.closeWin()},scope:this})},setFormData:function(a){Ext.Easy.suspendOrResumeEvents(false,this);this.editPurchaseForm.form.setValues(a.purchaseobject);this.baseData={id:a.purchaseobject.ID};this.editPurchaseGrid.getStore().loadData(a.lstPurchasePlanItems);this.initFbar(a.purchaseobject.enterState);Ext.Easy.suspendOrResumeEvents(true,this)},initFbar:function(a){this.genSaveBtn.setVisible(a=="1");this.setFieldReadOnly()},setFieldReadOnly:function(){this.editPurchaseForm.form.findField("buyCode").setReadOnly(true);this.editPurchaseForm.form.findField("batchNo").setReadOnly(true);this.editPurchaseForm.form.findField("validateDate").setReadOnly(true);this.editPurchaseForm.form.findField("enterState").setReadOnly(true);this.editPurchaseForm.form.findField("isBuy").setReadOnly(true);this.editPurchaseForm.form.findField("isDifference").setReadOnly(true);this.editPurchaseForm.form.findField("createDate").setReadOnly(true);this.editPurchaseForm.form.findField("creator").setReadOnly(true)},updatePurachaseStorage:function(){if(!Ext.Easy.isFormValid(this.editPurchaseForm)){return}if(this.editPurchaseGrid.getStore().getCount()<1){Ext.Msg.alert("提示:","请增加采购入库明细信息！");return}var c=this.parentPanel.validateStorageGird(this.editPurchaseGrid);if(!c){Ext.Msg.alert("提示:","请输入采购入库明细信息！");return}var d=Ext.apply({},this.modifyParams);var a="purchaseStorageAction!updatePurchaseStorageInfo.action";var b=Ext.Easy.getRecordsToParams(this.editPurchaseGrid.getStore(),d,"ID",true,this.editPurchaseGrid);d.itemNewCount=b[0];d.itemModefiyCount=b[1];d.modefiyCount=this.modifyCount;d.id=this.baseData.id;if((this.modifyCount+b[0]+b[1])==0){return}Ext.Ajax.request({url:a,params:d,success:function(e,f){var g=Ext.decode(e.responseText);if(g.success){Ext.Msg.alert("操作提示","操作成功!",function(){this.closeWin();this.parentPanel.doQueryPurchaseStorage()},this)}},failure:function(e,f){Ext.Msg.alert("操作提示","操作失败,服务不可用!")},scope:this})},openInitRowEdit:function(j){var h=this.editPurchaseGrid.columns[1].field;var g=this.editPurchaseGrid.columns[2].field;var n=this.editPurchaseGrid.columns[3].field;var i=this.editPurchaseGrid.columns[4].field;var k=this.editPurchaseGrid.columns[5].field;var b=this.editPurchaseGrid.columns[6].field;var a=this.editPurchaseGrid.columns[7].field;var p=this.editPurchaseGrid.columns[8].field;var m=this.editPurchaseGrid.columns[9].field;var l=this.editPurchaseGrid.columns[10].field;var o=this.editPurchaseGrid.columns[11].field;var f=this.editPurchaseGrid.columns[12].field;var e=this.editPurchaseGrid.columns[13].field;var d=this.editPurchaseGrid.columns[14].field;var q=this.editPurchaseGrid.columns[15].field;var c=this.editPurchaseGrid.columns[16].field;h.store.loadData(CDM.brandName);h.on("change",function(t,s,r){if(!s){return}g.setValue(null);n.setValue(null);i.setValue(null);k.setValue(null);b.setValue(null);a.setValue(null);p.setValue(null);m.setValue(null);l.setValue(null);o.setValue(null);f.setValue(null);Ext.Easy.easyAjax("purchasePlanAction!queryProductByBrand.action",{brandCode:s},function(v){var y=Ext.decode(v.responseText);var x=y.productList;var w=[];var u=[];Ext.each(x,function(z){w.push([z.productCode,z.productCode]);u.push([z.productCode,z.productName,z.referencePrice,z.retailPrice])},this);g.store.loadData(w);g.setValue(j.record.data.productCd);this.styleNameData=u},this)},this);g.on("change",function(t,s,r){if(!s){return}o.setValue(null);f.setValue(null);Ext.each(this.styleNameData,function(u){if(s==u[0]){n.setValue(u[1]);m.setValue(u[2]);l.setValue(u[3])}});o.setValue(j.record.data.projectNum);i.setValue(null);k.setValue(null);b.setValue(null);a.setValue(null);p.setValue(null);Ext.Easy.easyAjax("purchasePlanAction!queryColorSizePriceByProductCode.action",{productCode:s},function(x){var A=Ext.decode(x.responseText);var B=A.colorList;var y=[];var w=[];Ext.each(B,function(C){y.push([C.colorCode,C.chnDesc]);w.push([C.colorCode,C.chnDesc,C.engDesc])},this);this.colorArrayData=w;i.store.loadData(y);i.setValue(j.record.data.productColorNo);var v=A.sizeList;var z=[];var u=[];Ext.each(v,function(C){z.push([C.sizeCode,C.sizeName]);u.push([C.sizeCode,C.sizeName])},this);this.sizeArrayData=u;a.store.loadData(z);a.setValue(j.record.data.productSizeNo)},this)},this);i.on("change",function(t,s,r){if(!s){return}k.setValue(null);b.setValue(null);Ext.each(this.colorArrayData,function(u){if(u[0]==s){k.setValue(u[1]);b.setValue(u[2])}})},this);a.on("change",function(t,s,r){if(!s){return}p.setValue(null);if(g.getValue()!=null||g.getValue()!=""||i.getValue()!=null||i.getValue()!=""){f.setValue(g.getValue()+i.getValue()+s)}Ext.each(this.sizeArrayData,function(u){if(u[0]==s){p.setValue(u[1])}})},this)},removePurchaseItem:function(){var c=this.editPurchaseGrid.getSelectionModel();if(c.selected.length<1){Ext.Msg.alert("提示","请选择需删除的记录！");return}this.rowEditing.cancelEdit();var b=c.getLastSelected().get("ID");if(null!=b&&""!=b){this.delAry+=b+","}this.editPurchaseGrid.getStore().remove(c.getSelection());var a=this.editPurchaseGrid.getView().getSelectionModel().getSelection()[0];if(a){c.select(0)}},onAddRecord:function(){this.rowEditing.cancelEdit();this.editPurchaseGrid.getStore().insert(0,{});this.rowEditing.startEdit(0,0);this.openInitRowEdit()},closeWin:function(){this.parentWin.close()},setParentWin:function(a){this.parentWin=a},getRecordKey:function(){return"ID"}});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Ext.Purchasing.PurchasingDataMainPanel",{extend:"Ext.tab.Panel",requires:["Ext.Purchasing.PurchasingDataElementsConfigs","Ext.Purchasing.PurchaseDetailPanel","Ext.Purchasing.StorageDetailPanel"],initComponent:function(){var a=this;this.border=false;this.frame=false;this.activeTab=0;this.layout="border";this.isNew=true;a.callParent();this.queryPurchasePanel();this.queryPurchaseStoragePanel()},queryPurchasePanel:function(){var a=[purchasingDataElementsConfigs.getBaseConfigByName("purchasePlanCd"),purchasingDataElementsConfigs.getBaseConfigByName("purchaser"),purchasingDataElementsConfigs.getBaseConfigByName("auditStatus"),purchasingDataElementsConfigs.getBaseConfigByName("phone"),purchasingDataElementsConfigs.getBaseConfigByName("email"),purchasingDataElementsConfigs.getBaseConfigByName("warehouse"),purchasingDataElementsConfigs.getBaseConfigByName("modifer"),purchasingDataElementsConfigs.getBaseConfigByName("creator"),purchasingDataElementsConfigs.getBaseConfigByName("currency"),purchasingDataElementsConfigs.getBaseConfigByName("auditer"),purchasingDataElementsConfigs.getBaseConfigByName("mobile")];this.queryPurchaseForm=Ext.Easy.getEasyQueryForm(Ext.bind(this.doQueryPurchase,this),a,3);var b={xtype:"easygridquery",viewPanelClass:"Ext.Purchasing.PurchaseDetailPanel",parentPanel:this,desktop:this.desktop,noAutoLoad:true,region:"center",showBbar:true,showTbar:true,showRemoveBtn:true,overrideRemove:true,noShowAddBtn:true,iconCls:this.iconCls,gridName:"PurchasePlan",subWindowWidth:midwindowWidth,subWindowHeight:windowHight,subWindowTitle:"采购计划详情",baseParams:{queryId:"backsys.mapper.PurchasePlanMapper.queryPurchasePlan"},fields:purchasingDataElementsConfigs.getBrandFields()};this.easyGridPurchasePlan=new Ext.ux.EasyGridQuery(b);this.easyGridPurchasePlan.getDockedComponent(1).add({text:"增加",iconCls:"add",id:"genNewPurchasePanel",handler:Ext.bind(this.newPurchasePlPanel,this)});this.add({title:"采购计划管理",layout:"border",items:[this.queryPurchaseForm,this.easyGridPurchasePlan]})},queryPurchaseStoragePanel:function(){var a=[purchasingDataElementsConfigs.getBaseConfigByName("buyCode"),purchasingDataElementsConfigs.getBaseConfigByName("batchNo"),purchasingDataElementsConfigs.getBaseConfigByName("enterState"),purchasingDataElementsConfigs.getBaseConfigByName("applicant"),purchasingDataElementsConfigs.getBaseConfigByName("validateRandDate"),purchasingDataElementsConfigs.getBaseConfigByName("isDifference"),purchasingDataElementsConfigs.getBaseConfigByName("isBuy"),purchasingDataElementsConfigs.getBaseConfigByName("applyRandDate"),purchasingDataElementsConfigs.getBaseConfigByName("storage"),purchasingDataElementsConfigs.getBaseConfigByName("productSource")];this.queryPurchaseStorageForm=Ext.Easy.getEasyQueryForm(Ext.bind(this.doQueryPurchaseStorage,this),a,3);var b={xtype:"easygridquery",viewPanelClass:"Ext.Purchasing.StorageDetailPanel",parentPanel:this,desktop:this.desktop,noAutoLoad:true,region:"center",showBbar:true,showTbar:true,showRemoveBtn:true,overrideRemove:true,noShowAddBtn:true,iconCls:this.iconCls,gridName:"PurchaseStorage",subWindowWidth:midwindowWidth,subWindowHeight:windowHight,subWindowTitle:"采购入库单详情",baseParams:{queryId:"warehouse.mapper.StoragStockMapper.queryBuyEnterListInfo"},fields:purchasingDataElementsConfigs.getBuyEnterFields()};this.easyGridPurchaseStorage=new Ext.ux.EasyGridQuery(b);this.easyGridPurchaseStorage.getDockedComponent(1).add({text:"增加",iconCls:"add",id:"genNewPurchaseStoragePanel",handler:Ext.bind(this.newPurchaseStoragePanel,this)});this.add({title:"采购入库单管理",layout:"border",items:[this.queryPurchaseStorageForm,this.easyGridPurchaseStorage]})},doQueryPurchase:function(){var b=this.easyGridPurchasePlan.getStore();var a=this.queryPurchaseForm.getForm().getValues();b.proxy.extraParams={queryId:b.proxy.extraParams.queryId};Ext.apply(b.proxy.extraParams,a);b.loadPage(1)},doQueryPurchaseStorage:function(){var b=this.easyGridPurchaseStorage.getStore();var a=this.queryPurchaseStorageForm.getForm().getValues();b.proxy.extraParams={queryId:b.proxy.extraParams.queryId};Ext.apply(b.proxy.extraParams,a);b.loadPage(1)},validatePlanGird:function(b){var a=true;b.getStore().each(function(c){if(null==c.data.brand||""==c.data.brand){a=false;return a}},this);return a},validateStorageGird:function(b){var a=true;b.getStore().each(function(c){if(null==c.data.productBrand||""==c.data.productBrand){a=false;return a}},this);return a},removeRecord:function(c,b,a){if(a=="PurchasePlan"){var e="purchasePlanAction!delete"+a+"ById.action"}else{if(a=="PurchaseStorage"){var e="purchaseStorageAction!delete"+a+"ById.action"}}var d=false;Ext.Easy.easyAjax(e,{id:b.get("ID")},function(f,g){var h=Ext.decode(f.responseText);d=h.success},this,true);return d},newPurchasePlPanel:function(){this.newPurchasePlanPanel=new Ext.Purchasing.newPurchasePlanPanel({parentPanel:this})},newPurchaseStoragePanel:function(){this.newPurchaseStoragePanel=new Ext.Purchasing.newPurchaseStoragePanel({parentPanel:this})}});Ext.define("Ext.Purchasing.newPurchasePlanPanel",{extend:"Ext.panel.Panel",requires:["Ext.Purchasing.PurchasingDataElementsConfigs","Ext.Purchasing.PurchaseDetailPanel","Ext.Purchasing.StorageDetailPanel"],initComponent:function(){var a=this;this.border=false;this.frame=false;this.layout="fit";this.activeTab=0;this.isNew=true;a.callParent();this.newPurchasePanel()},newPurchasePanel:function(){var b=[purchasingDataElementsConfigs.getConfigByName("purchaser"),purchasingDataElementsConfigs.getConfigByName("mobile"),purchasingDataElementsConfigs.getConfigByName("phone"),purchasingDataElementsConfigs.getConfigByName("email"),purchasingDataElementsConfigs.getConfigByName("warehouse"),purchasingDataElementsConfigs.getConfigByName("currency"),purchasingDataElementsConfigs.getConfigByName("costPriceTotal"),purchasingDataElementsConfigs.getConfigByName("handTagPriceTotal"),{xtype:"label"},purchasingDataElementsConfigs.getConfigByName("remarks")];var e=Ext.Easy.getEasyForm({items:b,columnSize:3,region:"north"});this.newPurchaseForm=e;var c=Ext.create("Ext.grid.plugin.RowEditing",{clicksToMoveEditor:1,errorSummary:false,autoCancel:false});this.rowEditing=c;c.on("edit",Ext.bind(this.sumAllMoney,this),this);var g=[],a=[];Ext.Easy.getColumnsConfigAndFields(purchasingDataElementsConfigs.getPurchaseFields(),g,a,null,86);var h=[{text:"新增",iconCls:"add",handler:function(){c.cancelEdit();d.getStore().insert(0,{});c.startEdit(0,0);var m=d.columns[1].field;var l=d.columns[2].field;var r=d.columns[3].field;var n=d.columns[4].field;var o=d.columns[5].field;var k=d.columns[6].field;var j=d.columns[7].field;var t=d.columns[8].field;var q=d.columns[9].field;var p=d.columns[10].field;var s=d.columns[12].field;var i=d.columns[13].field;var u=d.columns[14].field;m.store.loadData(CDM.brandName);m.on("change",function(x,w,v){if(!w){return}l.setValue(null);r.setValue(null);n.setValue(null);o.setValue(null);k.setValue(null);j.setValue(null);t.setValue(null);q.setValue(null);p.setValue(null);s.setValue(null);i.setValue(null);u.setValue(null);Ext.Easy.easyAjax("purchasePlanAction!queryProductByBrand.action",{brandCode:w},function(z){var C=Ext.decode(z.responseText);var B=C.productList;var A=[];var y=[];Ext.each(B,function(D){A.push([D.productCode,D.productCode]);y.push([D.productCode,D.productName,D.referencePrice,D.retailPrice])},this);l.store.loadData(A);this.styleNameData=y},this)},this);l.on("change",function(x,w,v){if(!w){return}r.setValue(null);q.setValue(null);p.setValue(null);s.setValue(null);i.setValue(null);u.setValue(null);Ext.each(this.styleNameData,function(y){if(w==y[0]){r.setValue(y[1]);q.setValue(y[2]);p.setValue(y[3])}});n.setValue(null);o.setValue(null);k.setValue(null);j.setValue(null);t.setValue(null);Ext.Easy.easyAjax("purchasePlanAction!queryColorSizePriceByProductCode.action",{productCode:w},function(B){var E=Ext.decode(B.responseText);var F=E.colorList;var C=[];var A=[];Ext.each(F,function(G){C.push([G.colorCode,G.chnDesc]);A.push([G.colorCode,G.chnDesc,G.engDesc])},this);this.colorArrayData=A;n.store.loadData(C);var z=E.sizeList;var D=[];var y=[];Ext.each(z,function(G){D.push([G.sizeCode,G.sizeName]);y.push([G.sizeCode,G.sizeName])},this);this.sizeArrayData=y;j.store.loadData(D)},this)},this);n.on("change",function(x,w,v){if(!w){return}o.setValue(null);k.setValue(null);Ext.each(this.colorArrayData,function(y){if(y[0]==w){o.setValue(y[1]);k.setValue(y[2])}})},this);j.on("change",function(x,w,v){if(!w){return}t.setValue(null);Ext.each(this.sizeArrayData,function(y){if(y[0]==w){t.setValue(y[1])}})},this);s.on("change",function(A,v,w){i.setValue(null);u.setValue(null);if(!s.getValue()){return}var x=Number(s.getValue());if(null!=q.getValue()&&""!=q.getValue()){var z=Number(q.getValue());i.setValue(Ext.util.Format.round(x*z,2))}if(null!=p.getValue()&&""!=p.getValue()){var y=Number(p.getValue());u.setValue(Ext.util.Format.round(x*y,2))}},this)}},{itemId:"removeEmployee",text:"删除",iconCls:"remove",handler:Ext.bind(this.removePurchaseItem,this)},{text:"复制",iconCls:"add",handler:function(){var j=d.getSelectionModel();if(j.selected.length<1){Ext.Msg.alert("提示","请先选择一行记录！");return}c.cancelEdit();var i=j.getSelection()[0];d.getStore().insert(0,Ext.apply({},i.data));c.startEdit(0,0)}}];var d=Ext.Easy.createMyGrid(a,g,null,null,c,h);this.newPurchaseGrid=d;var f;if(!f){f=Ext.create("widget.window",{title:"新建采购计划",closeAction:"hide",width:midwindowWidth,height:windowHight,resizable:true,modal:true,autoScroll:true,layout:"border",border:false,minimizable:true,maximizable:true,items:[{region:"north",border:false,items:this.newPurchaseForm},{region:"center",layout:"fit",border:false,items:this.newPurchaseGrid}],fbar:[{xtype:"button",text:"确定",iconCls:"add",handler:Ext.bind(this.savePlan,this)},{xtype:"button",text:"返回",iconCls:"close",handler:function(){f.hide()}}]}).show()}this.winPurPlan=f},savePlan:function(){if(!Ext.Easy.isFormValid(this.newPurchaseForm)){return}var d={};if(this.isNew){var b=this.newPurchaseGrid;if(b.getStore().getCount()<1){Ext.Msg.alert("提示:","请增加采购计划明细信息！");return}var c=this.parentPanel.validatePlanGird(b);if(!c){Ext.Msg.alert("提示:","请输入采购计划明细信息！");return}var a=Ext.Easy.getRecordsToParams(b.getStore(),d,"ID",true,b);d.itemNewCount=a[0];this.newPurchaseForm.submit({url:"purchasePlanAction!savePurchasePlanInfo.action",params:d,success:function(e,f){Ext.Msg.alert("操作提示","保存成功!",function(){this.winPurPlan.hide();this.parentPanel.doQueryPurchase()},this)},failure:function(e,f){Ext.Easy.alertMsg(false)},scope:this})}},sumAllMoney:function(){var b=0;var a=0;this.newPurchaseGrid.getStore().each(function(c){if(null!=c.data.brand&&""!=c.data.brand){if(c.data.costPriceSum>0){b+=c.data.costPriceSum}if(c.data.handTagPriceSum>0){a+=c.data.handTagPriceSum}}},this);this.newPurchaseForm.form.findField("costPriceTotal").setValue(b);this.newPurchaseForm.form.findField("handTagPriceTotal").setValue(a)},removePurchaseItem:function(){var b=this.newPurchaseGrid.getSelectionModel();if(b.selected.length<1){Ext.Msg.alert("提示","请选择需删除的记录！");return}this.rowEditing.cancelEdit();this.newPurchaseGrid.getStore().remove(b.getSelection());var a=this.newPurchaseGrid.getView().getSelectionModel().getSelection()[0];if(a){b.select(0)}this.sumAllMoney()}});Ext.define("Ext.Purchasing.newPurchaseStoragePanel",{extend:"Ext.panel.Panel",requires:["Ext.Purchasing.PurchasingDataElementsConfigs","Ext.Purchasing.PurchaseDetailPanel","Ext.Purchasing.StorageDetailPanel"],initComponent:function(){var a=this;this.border=false;this.frame=false;this.layout="fit";this.activeTab=0;this.isNew=true;a.callParent();this.newPurchaseStoragePanel()},newPurchaseStoragePanel:function(){var c=[purchasingDataElementsConfigs.getConfigByName("applicant"),purchasingDataElementsConfigs.getConfigByName("applyDate"),purchasingDataElementsConfigs.getConfigByName("storage"),purchasingDataElementsConfigs.getConfigByName("productSource"),purchasingDataElementsConfigs.getConfigByName("buyNote")];var e=Ext.Easy.getEasyForm({items:c,columnSize:2,region:"north"});this.newPurchaseStorageForm=e;var b=Ext.create("Ext.grid.plugin.RowEditing",{clicksToMoveEditor:1,errorSummary:false,autoCancel:false});this.pruStorRowEditing=b;var g=[],a=[];Ext.Easy.getColumnsConfigAndFields(purchasingDataElementsConfigs.getBuyDetailFields(),g,a,null,86);var h=[{text:"新增",iconCls:"add",handler:function(){b.cancelEdit();d.getStore().insert(0,{});b.startEdit(0,0);var m=d.columns[1].field;var l=d.columns[2].field;var r=d.columns[3].field;var n=d.columns[4].field;var o=d.columns[5].field;var j=d.columns[6].field;var i=d.columns[7].field;var t=d.columns[8].field;var q=d.columns[9].field;var p=d.columns[10].field;var s=d.columns[11].field;var k=d.columns[12].field;m.store.loadData(CDM.brandName);m.on("change",function(w,v,u){if(!v){return}l.setValue(null);r.setValue(null);n.setValue(null);o.setValue(null);j.setValue(null);i.setValue(null);t.setValue(null);q.setValue(null);p.setValue(null);s.setValue(null);Ext.Easy.easyAjax("purchasePlanAction!queryProductByBrand.action",{brandCode:v},function(y){var B=Ext.decode(y.responseText);var A=B.productList;var z=[];var x=[];Ext.each(A,function(C){z.push([C.productCode,C.productCode]);x.push([C.productCode,C.productName,C.referencePrice,C.retailPrice])},this);l.store.loadData(z);this.styleNameData=x},this)},this);l.on("change",function(w,v,u){if(!v){return}r.setValue(null);q.setValue(null);p.setValue(null);s.setValue(null);Ext.each(this.styleNameData,function(x){if(v==x[0]){r.setValue(x[1]);q.setValue(x[2]);p.setValue(x[3])}});n.setValue(null);o.setValue(null);j.setValue(null);i.setValue(null);t.setValue(null);Ext.Easy.easyAjax("purchasePlanAction!queryColorSizePriceByProductCode.action",{productCode:v},function(A){var D=Ext.decode(A.responseText);var E=D.colorList;var B=[];var z=[];Ext.each(E,function(F){B.push([F.colorCode,F.chnDesc]);z.push([F.colorCode,F.chnDesc,F.engDesc])},this);this.colorArrayData=z;n.store.loadData(B);var y=D.sizeList;var C=[];var x=[];Ext.each(y,function(F){C.push([F.sizeCode,F.sizeName]);x.push([F.sizeCode,F.sizeName])},this);this.sizeArrayData=x;i.store.loadData(C)},this)},this);n.on("change",function(w,v,u){if(!v){return}o.setValue(null);j.setValue(null);Ext.each(this.colorArrayData,function(x){if(x[0]==v){o.setValue(x[1]);j.setValue(x[2])}})},this);i.on("change",function(w,v,u){if(!v){return}t.setValue(null);if(l.getValue()!=null||l.getValue()!=""||n.getValue()!=null||n.getValue()!=""){k.setValue(l.getValue()+n.getValue()+v)}Ext.each(this.sizeArrayData,function(x){if(x[0]==v){t.setValue(x[1])}})},this)}},{itemId:"removeEmployee",text:"删除",iconCls:"remove",handler:Ext.bind(this.removePurchaseStorage,this)},{text:"复制",iconCls:"add",handler:function(){var j=d.getSelectionModel();if(j.selected.length<1){Ext.Msg.alert("提示","请先选择一行记录！");return}b.cancelEdit();var i=j.getSelection()[0];d.getStore().insert(0,Ext.apply({},i.data));b.startEdit(0,0)}}];var d=Ext.Easy.createMyGrid(a,g,null,null,b,h);this.newPurchaseStorageGrid=d;var f;if(!f){f=Ext.create("widget.window",{title:"新建采购入库单",closeAction:"hide",width:midwindowWidth,height:windowHight,resizable:true,modal:true,autoScroll:true,layout:"border",border:false,minimizable:true,maximizable:true,items:[{region:"north",border:false,items:this.newPurchaseStorageForm},{region:"center",layout:"fit",border:false,items:this.newPurchaseStorageGrid}],fbar:[{xtype:"button",text:"确定",iconCls:"add",handler:Ext.bind(this.saveStorage,this)},{xtype:"button",text:"返回",iconCls:"close",handler:function(){f.hide()}}]}).show()}this.winPurStorage=f},saveStorage:function(){if(!Ext.Easy.isFormValid(this.newPurchaseStorageForm)){return}var d={};if(this.isNew){var b=this.newPurchaseStorageGrid;if(b.getStore().getCount()<1){Ext.Msg.alert("提示:","请增加采购入库明细信息！");return}var c=this.parentPanel.validateStorageGird(b);if(!c){Ext.Msg.alert("提示:","请输入采购入库明细信息！");return}var a=Ext.Easy.getRecordsToParams(b.getStore(),d,"buyDetailId",true,b);d.itemNewCount=a[0];this.newPurchaseStorageForm.submit({url:"purchaseStorageAction!savePurchaseStorageInfo.action",params:d,success:function(e,f){Ext.Msg.alert("操作提示","保存成功!",function(){this.winPurStorage.hide();this.parentPanel.setActiveTab(1);this.parentPanel.doQueryPurchaseStorage()},this)},failure:function(e,f){Ext.Easy.alertMsg(false)},scope:this})}},removePurchaseStorage:function(){var b=this.newPurchaseStorageGrid.getSelectionModel();if(b.selected.length<1){Ext.Msg.alert("提示","请选择需删除的记录！");return}this.pruStorRowEditing.cancelEdit();this.newPurchaseStorageGrid.getStore().remove(b.getSelection());var a=this.newPurchaseStorageGrid.getView().getSelectionModel().getSelection()[0];if(a){b.select(0)}}});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Ext.Sales.SalesData",{extend:"Ext.ux.desktop.Module",uses:["Ext.Sales.SalesDataMainPanel"],id:"sales-win",init:function(){this.launcher={text:"销售策略管理",iconCls:"sales",handler:this.createWindow,scope:this}},createWindow:function(){var d=this.app.getDesktop();var c=d.getWindow(this.id);if(!c){var b=midwindowWidth;var a=new Ext.Sales.SalesDataMainPanel({parentWinWidth:b,desktop:d});c=d.createWindow({id:this.id,title:this.launcher.text,width:b,height:windowHight,iconCls:this.launcher.iconCls,animCollapse:false,border:false,hideMode:"offsets",layout:"fit",items:a});a.parentWin=c}c.show();return c}});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Ext.Sales.SalesDataElementsConfigs",{extend:"Ext.util.MixedCollection",constructor:function(a){a=a||{};Ext.apply(this,a);this.callParent();this.init()},PromotionConfig:null,PromotionLogConfig:null,init:function(){var f=110;var a=[60,80,60];this.add("ID",{fieldLabel:"模版ID",name:"ID",xtype:"hidden"});this.add("modelType",Ext.apply(Ext.Easy.getEasyComboCfg("模版类型","modelType",null,CDM.modelType,true),{required:true}));this.add("modelName",{xtype:"textfield",fieldLabel:"模板名称",name:"modelName",required:true});this.add("modelContent",{fieldLabel:"模板描述",name:"modelContent",xtype:"textareafield",colspan:2,width:618});this.add("oneThingNum",{width:235,disabled:true,xtype:"textfield",fieldLabel:"件数",name:"oneThingNum"});this.add("oneThingRate",{xtype:"textfield",fieldLabel:"折扣",name:"oneThingRate",renderer:function(g){if(g!=0){return g?g:""}}});this.add("twoThingNum",{xtype:"textfield",fieldLabel:"二级件数",name:"twoThingNum"});this.add("twoThingRate",{xtype:"textfield",fieldLabel:"二级折扣",name:"twoThingRate"});this.add("threeThingNum",{xtype:"textfield",fieldLabel:"三级件数",name:"threeThingNum"});this.add("threeThingRate",{fieldLabel:"三级折扣",xtype:"textfield",name:"threeThingRate"});this.add("giftThingNum",{xtype:"textfield",width:235,fieldLabel:"赠品件数",name:"giftThingNum",renderer:function(g){if(g!=0){return g?g:""}}});this.add("sumMoney",{xtype:"textfield",fieldLabel:"总金额",name:"sumMoney",width:235});this.add("twoSumMoney",{xtype:"textfield",fieldLabel:"二级总金额",name:"twoSumMoney"});this.add("therrSumMoney",{xtype:"textfield",fieldLabel:"三级总金额",name:"therrSumMoney"});this.add("insteadMoney",Ext.Easy.getEasyComboCfg("代金券金额","insteadMoney","",CDM.InsteadMoney,true));this.add("twoInsteadMoney",{xtype:"textfield",fieldLabel:"二级代金券金额",name:"twoInsteadMoney"});this.add("therrInsteadMoney",{xtype:"textfield",fieldLabel:"三级代金券金额",name:"therrInsteadMoney"});this.add("isFreight",{xtype:"fieldcontainer",name:"isFreight",fieldLabel:"是否免运费",layout:"hbox",width:235,labelWidth:75,columns:a,items:[{xtype:"radiofield",boxLabel:"是",name:"isFreight",inputValue:"1",checked:false},{xtype:"radiofield",boxLabel:"否",name:"isFreight",inputValue:"0"}]});this.add("reduceMoney",{xtype:"textfield",fieldLabel:"立减金额",name:"reduceMoney",width:235,renderer:function(g){if(g==0){return g=""}}});this.add("addMoney",{xtype:"textfield",fieldLabel:"附加金额",name:"addMoney",width:235});this.add("modelItemType",Ext.apply(Ext.Easy.getEasyComboCfg("明细类型","modelItemType",null,CDM.modelItemType,true),{required:true}));this.add("type",{xtype:"textfield",fieldLabel:"type",name:"type",xtype:"hidden"});this.add("remark",{flex:1,xtype:"textfield",fieldLabel:"备注",name:"remark",colspan:2,width:618});this.add("brandId",{xtype:"textfield",fieldLabel:"品牌id",name:"brandId",xtype:"hidden"});this.add("billingMoney",{fieldLabel:"1.满",name:"billingMoney"});this.add("billingInstead",{fieldLabel:"",name:"billingInstead"});this.add("billingNum",{fieldLabel:"1.满",name:"billingNum"});this.add("billingRate",{fieldLabel:"",name:"billingRate"});this.PromotionConfig=new Ext.util.MixedCollection();this.addPromotionConfig("ID",{fieldLabel:"活动ID",name:"ID",xtype:"hidden"});this.addPromotionConfig("promotionName",{fieldLabel:"活动名称",xtype:"textfield",name:"promotionName",required:true});this.addPromotionConfig("promotionBeginDate",Ext.apply(Ext.Easy.getEasyDateCfg("开始时间","promotionBeginDate"),{required:true}));this.addPromotionConfig("promotionEndDate",Ext.apply(Ext.Easy.getEasyDateCfg("结束时间","promotionEndDate"),{required:true}));this.addPromotionConfig("promotionType",Ext.apply(Ext.Easy.getEasyComboCfg("活动类型","promotionType",null,CDM.promotionType,true),{required:true}));this.addPromotionConfig("promotionContent",{xtype:"textareafield",fieldLabel:"活动描述",name:"promotionContent",colspan:2,width:618});this.addPromotionConfig("brandName",Ext.Easy.getEasyComboCfg("品牌名称","brandName",null,CDM.brandName,true));this.addPromotionConfig("oneTypeName",Ext.Easy.getEasyComboCfg("第一导航","oneTypeName",null,CDM.oneType,true));this.addPromotionConfig("twoTypeName",Ext.Easy.getEasyComboCfg("第二导航","twoTypeName",null,CDM.twoType,true));this.addPromotionConfig("threeTypeName",Ext.Easy.getEasyComboCfg("第三导航","threeTypeName",null,CDM.threeType,true));this.addPromotionConfig("suitThingNum",Ext.Easy.getEasyComboCfg("套装件数","suitThingNum",null,CDM.suitThingNum,true));this.addPromotionConfig("suitThingMoney",{xtype:"numberfield",fieldLabel:"套装金额",name:"suitThingMoney",width:235,hideTrigger:true,nanText:""});this.addPromotionConfig("giftID",{fieldLabel:"赠品ID",name:"giftID"});this.addPromotionConfig("isFreight",Ext.Easy.getEasyComboCfg("是否免运费","isFreight",null,CDM.isFreight,true));this.addPromotionConfig("modelID",{xtype:"textfield",fieldLabel:"模版ID",name:"modelID",xtype:"hidden"});this.addPromotionConfig("oneTypeID",{xtype:"textfield",fieldLabel:"种类ID",name:"oneTypeID",xtype:"hidden"});this.addPromotionConfig("twoTypeID",{xtype:"textfield",fieldLabel:"种类ID2",name:"twoTypeID",xtype:"hidden"});this.addPromotionConfig("threeTypeID",{xtype:"textfield",fieldLabel:"种类ID3",name:"threeTypeID",xtype:"hidden"});this.addPromotionConfig("type",Ext.apply(Ext.Easy.getEasyComboCfg("明细类型","type",null,CDM.modelItemType,true),{required:true}));this.addPromotionConfig("brandName",{xtype:"textfield",fieldLabel:"品牌",name:"brandName",xtype:"hidden"});this.addPromotionConfig("proIDLst",{fieldLabel:"套装产品集合ID",xtype:"textfield",name:"proIDLst",colspan:2});this.PromotionLogConfig=new Ext.util.MixedCollection();this.addLog("logType",Ext.Easy.getEasyComboCfg("日志类型","logType",null,CDM.logType,true));this.addLog("content",{fieldLabel:"操作内容",name:"content",xtype:"textareafield",colspan:2,width:618});this.addLog("operationType",Ext.Easy.getEasyComboCfg("操作类型","operationType",null,CDM.operationType,true));this.addLog("operationName",{fieldLabel:"操作人",name:"operationName"});this.addLog("operationDate",Ext.Easy.getEasyDateCfg("操作时间","operationDate"));this.addLog("modelID",{fieldLabel:"模版ID",name:"modelID"});this.addLog("promotionID",{fieldLabel:"活动ID",name:"promotionID"});var c=function(g){if(g&&g.length>12){return g.substring(0,12)+"..."}return g};this.add("ID",{xtype:"hidden",fieldLabel:"ID",name:"ID"});var e=new Ext.util.MixedCollection();e.add("rankName",Ext.apply(Ext.Easy.getEasyComboCfg("栏目名称","rankName",null,CDM.rankType,true),{colspan:2,flex:1.5,readOnly:false}));e.add("rankDesc",Ext.apply(Ext.Easy.getTextAreaCfg("栏目描述","rankDesc",450),{grow:true,flex:3,readOnly:false,renderer:c}));e.add("updateTime",{fieldLabel:"修改时间",name:"updateTime",flex:2.5,hiddenColumn:true});e.add("updateBy",{fieldLabel:"修改人",name:"updateBy",flex:1.5,hiddenColumn:true});e.add(this.get("ID"));this.rank=e;var d=new Ext.util.MixedCollection();d.add(Ext.apply(productDataElementsConfigs.getBaseConfigByName("productCode"),{xtype:"producttrigger",readOnly:false}));d.add(productDataElementsConfigs.getBaseConfigByName("productName"));d.add(Ext.apply(productDataElementsConfigs.getBaseConfigByName("categoryCode1"),{hiddenColumn:true}));d.add(productDataElementsConfigs.getBaseConfigByName("categoryCode2"));d.add(productDataElementsConfigs.getBaseConfigByName("categoryCode3"));d.add(Ext.apply(Ext.Easy.getEasyComboCfg("颜色","colorCode",null,[]),{readOnly:false,hiddenColumn:true,allowBlank:false}));d.add(productDataElementsConfigs.getBaseConfigByName("webRetailPrice"));d.add("orderNum",{fieldLabel:"顺序",name:"orderNum",flex:1,readOnly:false,allowBlank:false});d.add(this.rank.get("updateBy"));d.add(this.rank.get("updateTime"));d.add({fieldLabel:"颜色",name:"colorName",xtype:"hidden",noHiddenColumn:true});d.add(this.get("ID"));this.rankproduct=d;var b=new Ext.util.MixedCollection();b.add("title",{fieldLabel:"公告标题",name:"title",flex:5});b.add("content",{fieldLabel:"公告内容",name:"content",xtype:"htmleditor",height:380});b.add("updateBy",{fieldLabel:"修改人",name:"updateBy",flex:1});b.add("updateTime",{fieldLabel:"修改时间",name:"updateTime",flex:1.5});this.bulletin=b},getConfigByName:function(b,c){var a=Ext.apply({},this.get(b));if(a.required){Ext.apply(a,{allowBlank:false,blankText:"此字段不能为空",labelSeparator:'<font color="red">*</font>'})}if(c){a=Ext.apply(a,{colspan:c,anchor:"85%"})}return a},getBaseConfigByName:function(a){return Ext.apply({},this.get(a))},getBasePromConfigByName:function(b,c){var a=Ext.apply({},this.PromotionConfig.get(b));if(c){a=Ext.apply(a,{colspan:c,anchor:"85%"})}return a},getModelFields:function(){var a=new Ext.util.MixedCollection();a.add(this.get("modelName"));a.add(this.get("remark"));a.add(this.get("ID"));return a},getLogFields:function(){var a=new Ext.util.MixedCollection();a.add(this.getLogConfigByName("operationType"));a.add(this.get("ID"));a.add(this.getLogConfigByName("operationName"));a.add(this.getLogConfigByName("operationDate"));a.add(this.getLogConfigByName("content"));return a},getPromotionFields:function(){var a=new Ext.util.MixedCollection();a.add(this.getBasePromConfigByName("promotionName"));a.add(this.getBasePromConfigByName("promotionType"));a.add(this.getBasePromConfigByName("type"));a.add(this.getBasePromConfigByName("promotionBeginDate"));a.add(this.getBasePromConfigByName("promotionEndDate"));a.add(this.getBasePromConfigByName("ID"));return a},getPromotionConfigByName:function(b){var a=Ext.apply({},this.PromotionConfig.get(b));if(a.required){Ext.apply(a,{allowBlank:false,blankText:"此字段不能为空",labelSeparator:'<font color="red">*</font>'})}return a},addPromotionConfig:function(b,a){this.PromotionConfig.add(b,a)},addLog:function(b,a){this.PromotionLogConfig.add(b,a)},getLogConfigByName:function(a){return Ext.apply({},this.PromotionLogConfig.get(a))},getRankFields:function(){return this.rank},getRankProductFields:function(){return this.rankproduct},getBulletinFields:function(){var a=new Ext.util.MixedCollection();a.add(this.getBulletinConfigByName("title"));a.add(this.getBulletinConfigByName("updateBy"));a.add(this.getBulletinConfigByName("updateTime"));a.add(this.getBaseConfigByName("ID"));return a},getBulletinConfigByName:function(a,b){return Ext.apply({allowBlank:!b},this.bulletin.get(a))},getStockDetailListFields:function(){var a=new Ext.util.MixedCollection();a.add(warehouseDataElementsConfigs.getBaseConfigByName("productBrand"));a.add(warehouseDataElementsConfigs.getBaseConfigByName("productCd"));a.add(warehouseDataElementsConfigs.getBaseConfigByName("productName"));a.add(warehouseDataElementsConfigs.getBaseConfigByName("productSize"));a.add(warehouseDataElementsConfigs.getBaseConfigByName("productSizeNo"));a.add(warehouseDataElementsConfigs.getBaseConfigByName("productColorCn"));a.add(warehouseDataElementsConfigs.getBaseConfigByName("productColorNo"));a.add(warehouseDataElementsConfigs.getBaseConfigByName("productNum"));return a},getChannelInventoryFields:function(b){var a=new Ext.util.MixedCollection();a.add(Ext.apply(Ext.Easy.getEasyComboCfg("渠道名","channelCode","NT",CDM.channel,true),{allowBlank:false,colspan:2}));if(b){a.add({fieldLabel:"尺码",name:"productsSize"})}a.add({xtype:"numberfield",hideTrigger:true,fieldLabel:"库存数",name:"inventoryNum",allowBlank:false});a.add({fieldLabel:"已售数",name:"totalSaled",hiddenColumn:true,readOnly:true});a.add({xtype:"numberfield",hideTrigger:true,fieldLabel:"已锁数",name:"lockInventoryNum",readOnly:true});a.add({xtype:"hidden",fieldLabel:"是否有效",name:"active"});a.add(this.get("ID"));return a}});Ext.define("Ext.ux.SalesModelTrigger",{extend:"Ext.form.field.Trigger",alias:"widget.salesmodeltrigger",triggerCls:"x-form-date-trigger",initComponent:function(){this.onTriggerClick=Ext.bind(this.clickFun,this);this.callParent()},clickFun:function(){if(!this.pwin){this.queryForm=Ext.Easy.getEasyQueryForm(Ext.bind(this.doQuery,this),[salesDataElementsConfigs.getConfigByName("modelName"),salesDataElementsConfigs.getConfigByName("modelType")],2);var a={xtype:"easygridquery",region:"center",showBbar:true,overrideView:true,parentPanel:this,noNeddForceFit:true,baseParams:{queryId:"backsys.mapper.ProMotionMapper.queryPromotionModelPlan"},fields:salesDataElementsConfigs.getModelFields()};this.easyGrid=new Ext.ux.EasyGridQuery(a);this.pwin=Ext.widget("window",{width:600,height:500,closeAction:"hide",title:"模板查找",layout:"border",items:[this.queryForm,this.easyGrid]})}this.pwin.show()},viewRecord:function(a){this.parentPanel.loadData(a.get("ID"),a);this.pwin.hide()},doQuery:function(){Ext.Easy.doEasyQuery(this.easyGrid,this.queryForm)}});Ext.define("Ext.ux.SalesSuitTrigger",{extend:"Ext.form.field.Trigger",alias:"widget.salessuittrigger",triggerCls:"x-form-date-trigger",initComponent:function(){this.onTriggerClick=Ext.bind(this.clickFun,this);this.callParent()},clickFun:function(){if(!this.pwin){this.queryForm=Ext.Easy.getEasyQueryForm(Ext.bind(this.doQuery,this),[productDataElementsConfigs.getBaseConfigByName("productCode"),productDataElementsConfigs.getBaseConfigByName("brandCode"),productDataElementsConfigs.getBaseConfigByName("productName"),productDataElementsConfigs.getBaseConfigByName("factureNo")],2);var a={xtype:"easygridquery",region:"center",showBbar:true,overrideView:true,parentPanel:this,noNeddForceFit:true,needCheckboxColumn:true,noNeedDbClick:true,baseParams:{queryId:"backsys.mapper.ProductManageMapper.queryProductPlan"},fields:productDataElementsConfigs.getQueryProductFields()};this.easyGrid=new Ext.ux.EasyGridQuery(a);this.pwin=Ext.widget("window",{width:600,height:500,closeAction:"hide",title:"产品查找",layout:"fit",items:[{layout:"border",items:[this.queryForm,this.easyGrid],fbar:[{text:"确定",iconCls:"accept",handler:Ext.bind(this.toSave,this)}]}]})}this.pwin.show()},viewRecord:function(a){this.parentPanel.loadData(a.get("ID"),a);this.pwin.hide()},doQuery:function(){Ext.Easy.doEasyQuery(this.easyGrid,this.queryForm)},toSave:function(){var a=this.easyGrid.getSelecteds("ID");this.parentPanel.saveSuits(a);this.pwin.hide()}});Ext.define("Ext.ux.SalesGiftTrigger",{extend:"Ext.form.field.Trigger",alias:"widget.salesgifttrigger",triggerCls:"x-form-date-trigger",initComponent:function(){this.onTriggerClick=Ext.bind(this.clickFun,this);this.callParent()},clickFun:function(){if(!this.pwin){this.queryForm=Ext.Easy.getEasyQueryForm(Ext.bind(this.doQuery,this),[productDataElementsConfigs.getBaseConfigByName("productCode"),productDataElementsConfigs.getBaseConfigByName("brandCode"),productDataElementsConfigs.getBaseConfigByName("productName"),productDataElementsConfigs.getBaseConfigByName("factureNo")],2);var a={xtype:"easygridquery",region:"center",showBbar:true,overrideView:true,parentPanel:this,noNeddForceFit:true,baseParams:{queryId:"backsys.mapper.ProductManageMapper.queryProductPlan"},fields:productDataElementsConfigs.getQueryProductFields()};this.easyGrid=new Ext.ux.EasyGridQuery(a);this.pwin=Ext.widget("window",{width:600,height:500,closeAction:"hide",title:"赠品查找",layout:"border",items:[this.queryForm,this.easyGrid]})}this.pwin.show()},viewRecord:function(a){this.parentPanel.loadGiftData(a.get("ID"),a);this.pwin.hide()},doQuery:function(){Ext.Easy.doEasyQuery(this.easyGrid,this.queryForm)}});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Ext.Sales.SalesDataMainPanel",{extend:"Ext.tab.Panel",requires:["Ext.Product.ProductDataElementsConfigs","Ext.Sales.SalesDataElementsConfigs"],initComponent:function(){var a=this;this.border=false;this.frame=false;a.callParent();this.createQueryModel();this.createQueryPromotion();this.createChannelInventoryPanel();this.createRankPanel();this.createBulletinPanel();this.setActiveTab(0);this.on("beforetabchange",Ext.bind(this.onTabActive,this))},createQueryModel:function(){var c={region:"center",xtype:"easygrid",fields:salesDataElementsConfigs.getModelFields(),viewPanelClass:"Ext.Sales.SaveOrUpdateModelPanel",noAutoLoad:true,showTbar:true,showBbar:true,showRemoveBtn:true,showSaveBtn:false,overrideRemove:true,parentPanel:this,noNeedDbClick:true,subWindowWidth:800,subWindowHeight:550,gridName:"promModel",subWindowTitle:"模版信息",desktop:this.desktop,baseParams:{queryId:"backsys.mapper.ProMotionMapper.queryPromotionModelPlan"}};this.PromotionModelGrid=new Ext.ux.EasyGridQuery(c);var b=[salesDataElementsConfigs.getBaseConfigByName("modelName"),salesDataElementsConfigs.getBaseConfigByName("modelType")];var a=Ext.Easy.getEasyQueryForm(Ext.bind(this.doQuery,this),b,2);this.proModelForm=a;this.add({title:"模版管理",layout:"border",items:[this.proModelForm,this.PromotionModelGrid]})},createQueryPromotion:function(){var c={region:"center",xtype:"easygrid",fields:salesDataElementsConfigs.getPromotionFields(),viewPanelClass:"Ext.Sales.SaveOrUpdatePromotionPanel",noAutoLoad:true,showTbar:true,showBbar:true,showRemoveBtn:true,showSaveBtn:false,overrideRemove:true,parentPanel:this,subWindowWidth:800,subWindowHeight:550,gridName:"prom",subWindowTitle:"活动信息",desktop:this.desktop,baseParams:{queryId:"backsys.mapper.ProMotionMapper.queryPromotionPlan"}};this.PromotionGrid=new Ext.ux.EasyGridQuery(c);var b=[salesDataElementsConfigs.getBasePromConfigByName("promotionName"),salesDataElementsConfigs.getBasePromConfigByName("promotionType")];var a=Ext.Easy.getEasyQueryForm(Ext.bind(this.doPromQuery,this),b,2);this.promForm=a;this.add({title:"活动管理",layout:"border",items:[this.promForm,this.PromotionGrid]})},doQuery:function(){Ext.Easy.doEasyQuery(this.PromotionModelGrid,this.proModelForm)},doPromQuery:function(){Ext.Easy.doEasyQuery(this.PromotionGrid,this.promForm)},removeRecord:function(c,b,a){var e="promotionAction!deleteById.action";var d=false;Ext.Easy.easyAjax(e,{ID:b.get("ID"),model:a},function(f,g){var h=Ext.decode(f.responseText);d=h.success},this,true);return d},onTabActive:function(b,a){if(!this.dtask){this.dtask=new Ext.util.DelayedTask(this)}this.dtask.delay(500,function(){if(this[a.tabName]&&Ext.isFunction(this[a.tabName].loadData)){this[a.tabName].loadData()}},this)},createRankPanel:function(){this.RankPanel=new Ext.Sales.RankPanel({parentPanel:this});this.add({title:"侧边栏管理",tabName:"RankPanel",layout:"fit",items:this.RankPanel})},createBulletinPanel:function(){this.queryBulletinForm=Ext.Easy.getEasyQueryForm(Ext.bind(this.doBulletinQuery,this),[salesDataElementsConfigs.getBulletinConfigByName("title"),salesDataElementsConfigs.getBulletinConfigByName("updateTime"),salesDataElementsConfigs.getBulletinConfigByName("updateBy")],3);var a={region:"center",xtype:"easygridquery",fields:salesDataElementsConfigs.getBulletinFields(),showTbar:true,showBbar:true,showUpateBtn:true,subWindowWidth:minwindowWidth,subWindowHeight:500,subWindowTitle:"公告栏详情窗口",viewPanelClass:"Ext.Sales.BulletinPanel",parentPanel:this,noAutoLoad:true,desktop:this.desktop,baseParams:{queryId:"web.mapper.WebMapper.queryBulletin"}};this.BulletinGrid=new Ext.ux.EasyGridQuery(a);this.add({title:"公告栏管理",layout:"border",items:[this.queryBulletinForm,this.BulletinGrid]})},doBulletinQuery:function(){Ext.Easy.doEasyQuery(this.BulletinGrid,this.queryBulletinForm)},createChannelInventoryPanel:function(){this.ChannelInventroyPanel=new Ext.Sales.ChannelInventroyPanel({parentPanel:this});this.add({title:"库存调配管理",tabName:"ChannelInventroyPanel",layout:"fit",items:this.ChannelInventroyPanel})}});Ext.define("Ext.Sales.SaveOrUpdateModelPanel",{extend:"Ext.tab.Panel",initComponent:function(){this.border=false;this.ID=null;this.isNew=true;this.callParent();var e=Ext.create("Ext.form.field.Checkbox",{xtype:"checkbox",boxLabel:"总金额达到",hideLabel:true,checked:false,style:"margin-bottom:10px",handler:function(g,f){data=[["sumMoney"]];isAbledFieldChange(data,f)}});var c=Ext.create("Ext.form.field.Checkbox",{xtype:"checkbox",boxLabel:"总件数达到",hideLabel:true,checked:false,style:"margin-bottom:10px",handler:function(g,f){data=[["oneThingNum"]];isAbledFieldChange(data,f)}});var d=Ext.create("Ext.form.field.Checkbox",{xtype:"checkbox",boxLabel:"附加金额",hideLabel:true,checked:false,style:"margin-bottom:10px",handler:function(g,f){data=[["addMoney"]];isAbledFieldChange(data,f)}});var b=[Ext.Easy.getEasyFieldSetCfg("模版说明",[salesDataElementsConfigs.getConfigByName("modelName"),Ext.apply(salesDataElementsConfigs.getConfigByName("modelType"),{width:235}),salesDataElementsConfigs.getConfigByName("modelContent")],2),Ext.Easy.getEasyFieldSetCfg("活动条件",[e,Ext.apply(salesDataElementsConfigs.getConfigByName("sumMoney"),{disabled:true}),c,Ext.apply(salesDataElementsConfigs.getConfigByName("oneThingNum"),{disabled:true}),d,Ext.apply(salesDataElementsConfigs.getConfigByName("addMoney"),{disabled:true})],2),Ext.Easy.getEasyFieldSetCfg("活动内容",[Ext.apply(salesDataElementsConfigs.getConfigByName("modelItemType"),{width:235}),salesDataElementsConfigs.getConfigByName("isFreight"),Ext.apply(salesDataElementsConfigs.getConfigByName("insteadMoney"),{width:235}),Ext.apply(salesDataElementsConfigs.getConfigByName("oneThingRate"),{labelWidth:75,width:235}),Ext.apply(salesDataElementsConfigs.getConfigByName("reduceMoney")),Ext.apply(salesDataElementsConfigs.getConfigByName("giftThingNum"),{labelWidth:75,width:235})],2)];SaveOrUpdateModel=Ext.widget("form",{frame:false,title:"查看活动模版",border:false,autoScroll:true,itemsId:"ModelFormPanel",bodyPadding:5,fieldDefaults:{labelAlign:"right",labelWidth:90,msgTarget:"qtip"},items:b,buttons:[{text:"关闭",handler:Ext.bind(this.closeWin,this)},{text:"保存",iconCls:"add",formBind:true,disabled:true,handler:Ext.bind(this.save,this)}]});var a={xtype:"easygrid",fields:salesDataElementsConfigs.getLogFields(),formItemsReadOnly:true,noAutoLoad:true,subWindowTitle:"日志窗口"};this.easyLogGrid=new Ext.ux.EasyGrid(a);this.SaveOrUpdateModel=SaveOrUpdateModel;Ext.Easy.initFormEvents(this.SaveOrUpdateModel,this);Ext.Easy.suspendOrResumeEvents(false,this);this.add(this.SaveOrUpdateModel)},loadFormRecord:function(b,a){this.ID=b;Ext.Easy.easyAjax("promotionAction!loadPromModelById.action",{ID:this.ID},function(c,d){Ext.Easy.suspendOrResumeEvents(false,this);var f=Ext.decode(c.responseText);var e=f.PromotionModel;this.SaveOrUpdateModel.getForm().setValues(e);this.isNew=false;this.baseData={ID:e.ID,IN:"promModel"};Ext.Easy.suspendOrResumeEvents(true,this)},this);Ext.Easy.easyAjax("promotionAction!loadPromModelLogById.action",{ID:this.ID},function(c,d){Ext.Easy.suspendOrResumeEvents(false,this);var f=Ext.decode(c.responseText);var e=f.logs;Ext.Easy.loadGridData(this.easyLogGrid.getStore(),e);Ext.Easy.suspendOrResumeEvents(true,this)},this)},save:function(){if(!Ext.Easy.isFormValid(this.SaveOrUpdateModel)){return}if(this.isNew){this.SaveOrUpdateModel.submit({url:"promotionAction!save.action",success:function(b,c){Ext.Easy.alertMsg(true);this.closeWin()},failure:function(b,c){Ext.Easy.alertMsg(false)},scope:this})}else{var a=Ext.apply({},this.baseData);if(this.modifyCount==0){return}Ext.apply(a,this.modifyParams);a.modefiyCount=this.modifyCount;Ext.Easy.easyAjax("promotionAction!updateMoel.action",a,function(b,c){var d=Ext.decode(b.responseText);Ext.Easy.alertMsg(d.success)},this)}},closeWin:function(){this.parentWin.close()},setParentWin:function(a){this.parentWin=a},getRecordKey:function(){return"ID"}});Ext.define("Ext.Sales.SaveOrUpdatePromotionPanel",{extend:"Ext.tab.Panel",initComponent:function(){this.border=false;this.callParent();this.ID=null;this.isNew=true;var c=Ext.Easy.getEasyComboCfg("品牌名称","brandName",null,CDM.brandName,null,null,true,230);this.brandCombo=new Ext.ux.EasyCombo(Ext.apply(c,{labelWidth:100,width:235}));this.brandCombo.on("select",Ext.bind(this.DoQueryBrand,this));var e=Ext.create("Ext.form.field.Checkbox",{xtype:"checkbox",boxLabel:"自定义",hideLabel:true,checked:false,style:"margin-bottom:10px",handler:function(g,f){data=[["sumMoney"],["isFreight"],["insteadMoney"],["oneThingRate"],["reduceMoney"],["giftThingNum"]];isAbledFieldChangeProm(data,f)}});var b=Ext.Easy.getEasyComboCfg("活动类型","promotionType",null,CDM.promotionType,null,null,true,230);this.promCombo=new Ext.ux.EasyCombo(Ext.apply(b,{labelWidth:100,width:235,value:"1",allowBlank:false}));this.promCombo.on("select",Ext.bind(this.DoQueryType,this));var d=[Ext.Easy.getEasyFieldSetCfg("活动类型",[Ext.apply(salesDataElementsConfigs.getPromotionConfigByName("promotionName"),{flex:1,labelWidth:100}),this.promCombo,Ext.apply(salesDataElementsConfigs.getPromotionConfigByName("promotionContent"),{labelWidth:100})],2),Ext.Easy.getEasyFieldSetCfg("活动内容",[this.brandCombo,salesDataElementsConfigs.getConfigByName("brandId"),Ext.create("Ext.ux.SalesGiftTrigger",Ext.apply({parentPanel:this},Ext.apply(salesDataElementsConfigs.getPromotionConfigByName("giftID"),{labelWidth:100,width:235}))),Ext.apply(salesDataElementsConfigs.getPromotionConfigByName("oneTypeName"),{labelWidth:100,width:235}),Ext.apply(salesDataElementsConfigs.getPromotionConfigByName("twoTypeName"),{width:235,labelWidth:100}),Ext.apply(salesDataElementsConfigs.getPromotionConfigByName("threeTypeName"),{labelWidth:100,width:235}),Ext.apply(salesDataElementsConfigs.getPromotionConfigByName("promotionBeginDate"),{width:235,labelWidth:100}),Ext.apply(salesDataElementsConfigs.getPromotionConfigByName("promotionEndDate"),{width:235,labelWidth:100}),salesDataElementsConfigs.getPromotionConfigByName("oneTypeID"),salesDataElementsConfigs.getPromotionConfigByName("twoTypeID"),salesDataElementsConfigs.getPromotionConfigByName("threeTypeID"),salesDataElementsConfigs.getPromotionConfigByName("brandName"),salesDataElementsConfigs.getPromotionConfigByName("ID")],2),Ext.Easy.getEasyFieldSetCfg("绑定模版",[Ext.create("Ext.ux.SalesModelTrigger",Ext.apply({parentPanel:this},Ext.apply(salesDataElementsConfigs.getConfigByName("modelName"),{labelWidth:100}))),Ext.apply(salesDataElementsConfigs.getPromotionConfigByName("type"),{readOnly:true}),Ext.apply(salesDataElementsConfigs.getConfigByName("modelContent"),{xtype:"textareafield",labelWidth:100,readOnly:true}),Ext.apply(salesDataElementsConfigs.getConfigByName("remark"),{xtype:"textareafield",labelWidth:100,readOnly:true})],2),Ext.Easy.getEasyFieldSetCfg("规则",[e,salesDataElementsConfigs.getPromotionConfigByName("modelID"),Ext.apply(salesDataElementsConfigs.getConfigByName("sumMoney"),{width:235,readOnly:false}),Ext.apply(salesDataElementsConfigs.getConfigByName("oneThingNum"),{width:235,readOnly:false,disabled:false}),Ext.apply(salesDataElementsConfigs.getBasePromConfigByName("isFreight"),{width:235,readOnly:false}),Ext.apply(salesDataElementsConfigs.getConfigByName("insteadMoney"),{width:235,readOnly:false}),Ext.apply(salesDataElementsConfigs.getConfigByName("oneThingRate"),{labelWidth:75,width:235,readOnly:false}),Ext.apply(salesDataElementsConfigs.getConfigByName("reduceMoney"),{readOnly:false}),Ext.apply(salesDataElementsConfigs.getConfigByName("giftThingNum"),{labelWidth:75,width:235,readOnly:false})],2),Ext.apply(Ext.Easy.getEasyFieldSetCfg("套装设置",[Ext.apply(salesDataElementsConfigs.getPromotionConfigByName("suitThingNum"),{labelWidth:100,width:235}),Ext.apply(salesDataElementsConfigs.getPromotionConfigByName("suitThingMoney"),{width:235}),Ext.apply(Ext.create("Ext.ux.SalesSuitTrigger",Ext.apply({parentPanel:this},salesDataElementsConfigs.getPromotionConfigByName("proIDLst"))),{labelWidth:100,width:235})],2),{name:"suit",disabled:true})];PromotionPanel=Ext.widget("form",{frame:false,autoScroll:true,border:false,title:"查看活动",bodyPadding:5,buttons:[{text:"关闭",handler:Ext.bind(this.close,this)},{text:"保存",iconCls:"add",formBind:true,disabled:true,handler:Ext.bind(this.save,this)}],fieldDefaults:{labelAlign:"right",labelWidth:90,msgTarget:"qtip"},items:d});this.PromotionPanel=PromotionPanel;Ext.Easy.initFormEvents(this.PromotionPanel,this);Ext.Easy.suspendOrResumeEvents(false,this);var a={xtype:"easygrid",fields:salesDataElementsConfigs.getLogFields(),formItemsReadOnly:true,noAutoLoad:true,subWindowTitle:"日志窗口"};this.easyLogGrid=new Ext.ux.EasyGrid(a);this.add(this.PromotionPanel);this.add({title:"操作日志",tabName:"PromlogTab",border:false,layout:"fit",items:this.easyLogGrid})},DoQueryBrand:function(a){this.PromotionPanel.down("[name=brandId]").setValue(a.value)},DoQueryType:function(a){if(a.value=="suit"){this.PromotionPanel.down("[name=suit]").setDisabled(false);this.PromotionPanel.down("[name=suit]").el.animate({opacity:false?0.3:1})}else{this.PromotionPanel.down("[name=suit]").setDisabled(true);this.PromotionPanel.down("[name=suit]").el.animate({opacity:true?0.3:1})}},close:function(){this.pwin.close()},setParentWin:function(a){this.pwin=a},saveSuits:function(a){this.PromotionPanel.down("[name=proIDLst]").setValue(a)},loadData:function(a){Ext.Easy.easyAjax("promotionAction!loadPromModelById.action",{ID:a},function(b,c){var e=Ext.decode(b.responseText);var d=e.PromotionModel;this.PromotionPanel.down("[name=type]").setValue(d.modelItemType);this.PromotionPanel.down("[name=modelID]").setValue(d.ID);data=[["sumMoney"],["isFreight"],["insteadMoney"],["oneThingRate"],["reduceMoney"],["giftThingNum"]];isAbledFieldChangeProm(data,false);this.PromotionPanel.getForm().setValues(d);if(this.isNew){this.PromotionPanel.down("[name=ID]").setValue("")}else{this.PromotionPanel.down("[name=ID]").setValue(this.ID)}},this)},loadGiftData:function(a){this.PromotionPanel.down("[name=giftID]").setValue(a)},loadFormRecord:function(b,a){this.ID=a.get("ID");this.modelId=a.get("modelID");Ext.Easy.easyAjax("promotionAction!loadPromotionById.action",{ID:this.ID},function(c,d){var f=Ext.decode(c.responseText);var e=f.Promotion;this.PromotionPanel.getForm().setValues(e);this.isNew=false;this.baseData={ID:e.ID,IN:"prom"}},this);Ext.Easy.easyAjax("promotionAction!loadPromLogById.action",{ID:this.ID},function(c,d){Ext.Easy.suspendOrResumeEvents(false,this);var f=Ext.decode(c.responseText);var e=f.logs;Ext.Easy.loadGridData(this.easyLogGrid.getStore(),e);Ext.Easy.suspendOrResumeEvents(true,this)},this)},save:function(){if(!Ext.Easy.isFormValid(this.PromotionPanel)){return}if(this.isNew){this.PromotionPanel.submit({url:"promotionAction!savePromotion.action",success:function(b,c){Ext.Easy.alertMsg(true);this.close()},failure:function(b,c){Ext.Easy.alertMsg(false)},scope:this})}else{var a=Ext.apply({},this.baseData);if(this.modifyCount==0){return}Ext.apply(a,this.modifyParams);a.modefiyCount=this.modifyCount;Ext.Easy.easyAjax("promotionAction!updateMoel.action",a,function(b,c){var d=Ext.decode(b.responseText);Ext.Easy.alertMsg(d.success)},this)}},getRecordKey:function(){return"ID"}});function isAbledFieldChange(c,b){for(var a=0;a<c.length;a++){if(b){this.SaveOrUpdateModel.down("[name="+c[a]+"]").setDisabled(false);this.SaveOrUpdateModel.down("[name="+c[a]+"]").el.animate({opacity:false?0.3:1})}else{this.SaveOrUpdateModel.down("[name="+c[a]+"]").setValue("");this.SaveOrUpdateModel.down("[name="+c[a]+"]").setDisabled(true);this.SaveOrUpdateModel.down("[name="+c[a]+"]").el.animate({opacity:true?0.3:1})}}}function isAbledFieldChangeProm(c,b){for(var a=0;a<c.length;a++){if(b){this.PromotionPanel.down("[name="+c[a]+"]").setReadOnly(false)}else{this.PromotionPanel.down("[name="+c[a]+"]").setReadOnly(true)}}}Ext.define("Ext.Sales.RankPanel",{extend:"Ext.panel.Panel",initComponent:function(){this.border=false;this.layout="border";this.callParent();var b={region:"center",xtype:"easygrid",fields:salesDataElementsConfigs.getRankFields(),showTbar:true,showFormBtn:true,noNeddForceFit:true,parentPanel:this,overrideUpdate:true,noDisplayInfo:true,overrideRemove:true,noAutoLoad:true,formItemsReadOnly:true,subWindowTitle:"侧边栏定义",baseParams:{queryId:"web.mapper.WebMapper.queryRankNotPagin"}};this.rankGrid=new Ext.ux.EasyGrid(b);b.fields=salesDataElementsConfigs.getRankProductFields();b.region="east";b.needAjax=true;b.noNeddForceFit=false;b.noNeedDbClick=true;b.noDisplayInfo=false;b.subWindowTitle="侧边栏产品定义";b.width=this.parentPanel.parentWinWidth*3/5;b.baseParams={queryId:"web.mapper.WebMapper.queryRankProductByRankIdNotPagin"};this.rankProductGrid=new Ext.ux.EasyGrid(b);var a=function(e,d){var c=this.rankProductGrid.getForm().findField("colorName");c.setValue(e.rawValue)};this.rankProductGrid.getForm().findField("colorCode").on("change",a,this);this.add(this.rankGrid);this.add(this.rankProductGrid)},afterWinShow:function(b,a){if(a!=this.rankGrid&&!Ext.Easy.getSelectedRecord(this.rankGrid,"请先选择侧边栏类别!")){this.rankProductGrid.hideWindow();return}b.findField("productCode").setReadOnly(!b.baseParams.create)},dbClickFun:function(a){Ext.Easy.doEasyQuery(this.rankProductGrid,null,{ID:a.get("ID")})},loadData:function(){this.rankGrid.getStore().load()},addRecord:function(g,c,h,e,a){var i=this.rankGrid==a;var b="promotionAction!saveOrUpdateRank.action";var d=h;var f=this.rankGrid.getSelectedRecord();if(!i){b="promotionAction!saveOrUpdateRankProduct.action";d.rankId=f.get("ID");d.ID=null}Ext.Easy.easyAjax(b,d,function(j,k){var l=Ext.decode(j.responseText);if(i){this.loadData()}else{this.dbClickFun(f)}Ext.Easy.alertMsg(l.success)},this)},updateRecord:function(h,a,i,d,f,b){var j=this.rankGrid==b;var c="promotionAction!saveOrUpdateRank.action";var e=i;var g=this.rankGrid.getSelectedRecord();if(!j){c="promotionAction!saveOrUpdateRankProduct.action"}Ext.Easy.easyAjax(c,e,function(k,l){var m=Ext.decode(k.responseText);if(j){this.loadData()}else{this.dbClickFun(g)}Ext.Easy.alertMsg(m.success)},this)},removeRecord:function(b,f,a,e){var g=this.rankGrid==e;var d="promotionAction!deleteRankByIdIncludeProduct.action";if(!g){d="promotionAction!deleteRankProductById.action"}var c=false;Ext.Easy.easyAjax(d,{ID:f.get("ID")},function(h,i){var j=Ext.decode(h.responseText);c=j.success;if(g){this.dbClickFun(f)}Ext.Easy.alertMsg(j.success)},this,true);return c},loadProductData:function(b,a){this.rankProductGrid.getForm().setValues(a.data);Ext.Easy.easyAjax("productOperateAction!queryColorAndSizes.action",{productCode:a.data.productCode},function(d,e){var f=Ext.decode(d.responseText);var c=[];Ext.each(f.colors,function(g){c.push([g.colorCode,g.chnDesc])});this.rankProductGrid.getForm().findField("colorCode").getStore().loadData(c)},this)}});Ext.define("Ext.Sales.ChannelInventroyPanel",{extend:"Ext.panel.Panel",initComponent:function(){this.border=false;this.layout="border";this.callParent();this.queryForm=Ext.Easy.getEasyQueryForm(Ext.bind(this.doQuery,this),[warehouseDataElementsConfigs.getBaseConfigByName("productBrand"),warehouseDataElementsConfigs.getBaseConfigByName("productCd"),warehouseDataElementsConfigs.getBaseConfigByName("productName")],3);var b={region:"center",xtype:"easygrid",fields:salesDataElementsConfigs.getStockDetailListFields(),showBbar:true,parentPanel:this,noAutoLoad:true,baseParams:{queryId:"warehouse.mapper.StoragStockMapper.queryStockListInfo"}};this.stockGrid=new Ext.ux.EasyGrid(b);b.showTbar=true;b.fields=salesDataElementsConfigs.getChannelInventoryFields();b.showBbar=false;b.overrideRemove=true;b.region="north";b.noShowRemoveBtn=true;b.height=250;b.width=this.parentPanel.parentWinWidth*2/5;b.baseParams={queryId:"web.mapper.WebMapper.queryInventoryByColorAndSizeCodeNotPagin"};this.channelInventoryGrid=new Ext.ux.EasyGrid(b);var a={xtype:"easygrid",title:"操作日志",region:"center",fields:customercenterDataElementsConfigs.getLog(),formItemsReadOnly:true,noNeddForceFit:true,noDisplayInfo:true,noAutoLoad:true,showBbar:true,baseParams:{queryId:"common.mapper.CommonOperationMapper.queryPublicLog",businessMode:"INAJ"},subWindowTitle:"日志窗口"};this.easyLogGrid=new Ext.ux.EasyGrid(a);this.add(this.queryForm);this.add(this.stockGrid);this.add({xtype:"panel",region:"east",layout:"border",width:this.parentPanel.parentWinWidth*2/5,items:[this.channelInventoryGrid,this.easyLogGrid]})},doQuery:function(){Ext.Easy.doEasyQuery(this.stockGrid,this.queryForm)},afterWinShow:function(b,a){if(a!=this.stockGrid&&!Ext.Easy.getSelectedRecord(this.stockGrid,"请先选择左边产品库存数据!")){this.channelInventoryGrid.hideWindow();return}b.findField("channelCode").setReadOnly(!b.baseParams.create)},dbClickFun:function(b,a){var d,c;if(a==this.stockGrid){d={productCD:b.get("productCd"),productsColorCode:b.get("productColorNo"),productsSizeCode:b.get("productSizeNo")};Ext.Easy.doEasyQuery(this.channelInventoryGrid,null,d)}else{d={parentId:b.get("ID")}}Ext.apply(d,{businessMode:"INAJ"});Ext.Easy.doEasyQuery(this.easyLogGrid,null,d)},loadData:function(){this.stockGrid.getStore().load();this.channelInventoryGrid.getStore().removeAll()},addRecord:function(h,c,i,f,a){var b="promotionAction!saveOrUpdateInventory.action";var j=this.stockGrid.getSelectedRecord();var d=false,g=i.inventoryNum;this.channelInventoryGrid.getStore().each(function(k){g+=k.get("inventoryNum");if(k.get("channelCode")==i.channelCode){d=true}},this);if(d||g>j.get("productNum")){Ext.Msg.alert("操作提示",d?"此渠道已存在库存记录,请重新操作!":"分配的库存数大于仓库总数!");return}var e=Ext.apply(i,{productsCd:j.get("productCd"),productsColorCode:j.get("productColorNo"),productsSizeCode:j.get("productSizeNo"),productsColor:j.get("productColorCn"),productsSize:j.get("productSize")});Ext.Easy.easyAjax(b,e,function(k,l){var m=Ext.decode(k.responseText);this.dbClickFun(j,this.stockGrid);Ext.Easy.alertMsg(m.success)},this)},updateRecord:function(c,f,b){var d="promotionAction!saveOrUpdateInventory.action";var g=b;var a=this.stockGrid.getSelectedRecord();if(g.inventoryNum<g.lockInventoryNum){Ext.Msg.alert("操作提示","库存数不能小于已锁数!");this.dbClickFun(a,this.stockGrid);return}var e=b.inventoryNum;this.channelInventoryGrid.getStore().each(function(h){if(h.get("channelCode")!=b.channelCode){e+=h.get("inventoryNum")}},this);if(e>a.get("productNum")){Ext.Msg.alert("操作提示","分配的库存数大于仓库总数!");return}Ext.Easy.easyAjax(d,g,function(h,i){var j=Ext.decode(h.responseText);this.dbClickFun(a,this.stockGrid);Ext.Easy.alertMsg(j.success)},this)},removeRecord:function(c,g,a,f){var h=g.data;if(h.lockInventoryNum>0){Ext.Msg.alert("操作提示","已锁数不为0,不能删除!");this.dbClickFun(b,this.stockGrid);return}h.active="0";var e="promotionAction!saveOrUpdateInventory.action";var b=this.stockGrid.getSelectedRecord();var d=false;Ext.Easy.easyAjax(e,h,function(i,j){var k=Ext.decode(i.responseText);d=k.success;this.dbClickFun(b,this.stockGrid);Ext.Easy.alertMsg(k.success)},this,true);return d}});Ext.define("Ext.Sales.BulletinPanel",{extend:"Ext.panel.Panel",initComponent:function(){this.border=false;this.layout="fit";this.callParent();this.removeBtn=Ext.widget("button",{text:"删除",iconCls:"remove",handler:Ext.bind(this.removeRecord,this)});this.form=Ext.create("Ext.form.Panel",{bodyPadding:5,layout:"anchor",defaults:{anchor:"100%",labelAlign:"top",labelStyle:"font-weight:bold;"},defaultType:"textfield",items:[salesDataElementsConfigs.getBulletinConfigByName("title",true),salesDataElementsConfigs.getBulletinConfigByName("content",true),salesDataElementsConfigs.getBaseConfigByName("ID")],fbar:[this.removeBtn,{text:"关闭",iconCls:"back",handler:Ext.bind(this.closeWin,this)},{text:"保存",iconCls:"save",handler:Ext.bind(this.save,this)}]});this.add(this.form)},save:function(){if(!Ext.Easy.isFormValid(this.form)){return}this.form.submit({url:"promotionAction!saveOrUpdateBulletin.action",success:function(a,b){Ext.Easy.alertMsg(true);this.parentPanel.doBulletinQuery();this.closeWin()},failure:function(a,b){Ext.Easy.alertMsg(false)},scope:this})},loadFormRecord:function(a,b){Ext.Easy.easyAjax("promotionAction!loadBulletin.action",{ID:a},function(c,d){var e=Ext.decode(c.responseText);this.form.getForm().setValues(e.object);this.bulletinId=e.object.ID;this.removeBtn.setVisible(true)},this)},removeRecord:function(){Ext.Msg.confirm("提示","确认提交此操作吗?",function(a){if(a=="yes"){Ext.Easy.easyAjax("promotionAction!saveOrUpdateBulletin.action",{active:0,ID:this.bulletinId},function(b,c){var d=Ext.decode(b.responseText);Ext.Easy.alertMsg(d.success);this.closeWin();this.parentPanel.doBulletinQuery()},this,true)}},this)},createRecord:function(){this.form.getForm().reset();this.removeBtn.setVisible(false)},closeWin:function(){this.parentWin.close()},setParentWin:function(a){this.parentWin=a},getRecordKey:function(){return"ID"}});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Ext.Voucher.VoucherData",{extend:"Ext.ux.desktop.Module",uses:["Ext.Voucher.VoucherDataMainPanel"],id:"voucher-win",init:function(){this.launcher={text:"代金券管理",iconCls:"voucher",handler:this.createWindow,scope:this}},createWindow:function(){var b=this.app.getDesktop();var a=b.getWindow(this.id);if(!a){a=b.createWindow({id:this.id,title:this.launcher.text,width:minwindowWidth,height:windowHight,iconCls:this.launcher.iconCls,animCollapse:false,border:false,hideMode:"offsets",layout:"fit",items:new Ext.Voucher.VoucherDataMainPanel()})}a.show();return a}});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Ext.Voucher.VoucherDataElementsConfigs",{extend:"Ext.util.MixedCollection",constructor:function(a){a=a||{};Ext.apply(this,a);this.callParent();this.init()},init:function(){this.add("activityId",{xtype:"hidden",fieldLabel:"活动ID",name:"ID"});this.add("activityCode",{fieldLabel:"活动代码",name:"activityCode",required:true,readOnly:true});this.add("activityName",{fieldLabel:"活动名称",name:"activityName",required:true});this.add("explain",{fieldLabel:"活动说明",name:"explain"});this.add("activityType",Ext.Easy.getEasyComboCfg("活动类型","activityType",null,memberCDM.activityType,true));this.add("linkman",{fieldLabel:"联系人",name:"linkman"});this.add("phone",{fieldLabel:"联系电话",name:"phone"});this.add("sponsor",{fieldLabel:"促销主体",name:"sponsor"});this.add("contractNo",{fieldLabel:"合同号",name:"contractNo"});this.add("referendum",{fieldLabel:"内部请示号",name:"referendum"});this.add("activityKind",Ext.Easy.getEasyComboCfg("活动性质","activityKind",null,memberCDM.activityKind));this.add("beginDate",Ext.Easy.getEasyDateCfg("开始日期","beginDate","yyyy-mm-dd"));this.add("endDate",Ext.Easy.getEasyDateCfg("截止日期","endDate","yyyy-mm-dd"));this.add("gainArea",Ext.Easy.getEasyComboCfg("获取范围","gainArea",null,memberCDM.gainArea));this.add("useArea",Ext.Easy.getEasyComboCfg("使用范围","useArea",null,memberCDM.useArea));this.add("joinLimit",Ext.Easy.getEasyComboCfg("参加产品限制","joinLimit",null,memberCDM.joinLimit));this.add("useLimit",Ext.Easy.getEasyComboCfg("使用产品限制","useLimit",null,memberCDM.useLimit));this.add("publishStatus",{xtype:"hidden",fieldLabel:"发布状态",name:"publishStatus"});this.add("webActivCode",{fieldLabel:"网站活动编码",name:"webActivCode"});this.add("voucherDefineId",{xtype:"hidden",fieldLabel:"代金券定义ID",name:"ID"});this.add("defineName",{fieldLabel:"定义名称",name:"defineName",required:true});this.add("defineMoney",{fieldLabel:"代金券金额",name:"money",required:true});this.add("codeType",Ext.Easy.getEasyComboCfg("编码类型","codeType",1,memberCDM.codeType,true));this.add("defineLength",{fieldLabel:"号码位数",name:"defineLength",value:9,required:true});this.add("activation",Ext.Easy.getEasyComboCfg("是否需要激活","activation",null,memberCDM.activation,true));this.add("needPassword",Ext.Easy.getEasyComboCfg("是否需要密码","needPassword",null,memberCDM.needPassword,true));this.add("activateMode",Ext.Easy.getEasyComboCfg("激活方式","activateMode",null,memberCDM.activateMode,true));this.add("publishNum",{fieldLabel:"发行数量",name:"publishNum",required:true});this.add("usefulLife",Ext.Easy.getEasyComboCfg("有效期限","usefulLife",null,memberCDM.usefulLife,true));this.add("voucherId",{xtype:"hidden",fieldLabel:"代金券ID",name:"ID"});this.add("voucherCd",{fieldLabel:"代金券编号",name:"voucherCd"});this.add("voucherMoney",{fieldLabel:"代金券金额",name:"money"});this.add("voucherName",{fieldLabel:"代金券名称",name:"voucherName"});this.add("voucherEndDate",Ext.Easy.getEasyDateCfg("有效期","endDate","yyyy-mm-dd"));this.add("voucherCreateTime",Ext.Easy.getEasyDateCfg("发行日期","createTime","yyyy-mm-dd"));this.add("voucherCreateBeginTime",Ext.Easy.getEasyDateCfg("发行起始日期","createBeginTime","yyyy-mm-dd"));this.add("voucherCreateEndTime",Ext.Easy.getEasyDateCfg("发行截止日期","createEndTime","yyyy-mm-dd"));this.add("voucherStatus",Ext.Easy.getEasyComboCfg("状态","status",null,memberCDM.voucherStatus,true));this.add("bindMemberStatus",Ext.Easy.getEasyComboCfg("绑定会员状态","bindMemberStatus",null,memberCDM.bindMemberStatus));this.add("memberCd",{fieldLabel:"会员编号",name:"memberCd"})},getConfigByName:function(b,c){var a=Ext.apply({},this.get(b));if(a.required){Ext.apply(a,{allowBlank:false,blankText:"此字段不能为空",labelSeparator:'<font color="red">*</font>'})}if(c){a=Ext.apply(a,{colspan:c,anchor:"85%"})}return a},getBaseConfigByName:function(a){return Ext.apply({},this.get(a))},getQueryActivityResultCfg:function(){var a=new Ext.util.MixedCollection();a.add(this.get("activityCode"));a.add(this.get("activityName"));a.add(this.get("activityType"));a.add(this.get("sponsor"));a.add(this.get("activityId"));return a},getQueryDefineResultCfg:function(){var a=new Ext.util.MixedCollection();a.add(this.getConfigByName("defineName"));a.add(this.getConfigByName("defineMoney"));a.add(this.getConfigByName("codeType"));a.add(this.getConfigByName("defineLength"));a.add(this.getConfigByName("activation"));a.add(this.getConfigByName("needPassword"));a.add(this.getConfigByName("activateMode"));a.add(this.getConfigByName("publishNum"));a.add(this.getConfigByName("usefulLife"));a.add(this.getConfigByName("voucherDefineId"));return a},getQueryVoucherResultCfg:function(){var a=new Ext.util.MixedCollection();a.add(this.get("voucherCd"));a.add(this.get("voucherName"));a.add(this.get("voucherMoney"));a.add(this.get("voucherStatus"));a.add(this.get("memberCd"));a.add(this.get("voucherId"));return a}});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Ext.Voucher.VoucherDataMainPanel",{extend:"Ext.tab.Panel",requires:["Ext.Voucher.VoucherDataElementsConfigs"],initComponent:function(){var a=this;this.border=false;this.frame=false;this.isNew=true;a.callParent();this.createQueryActivityPanel();this.createQueryVoucherPanel();new Ext.util.DelayedTask(function(){},this).delay(1000)},createQueryActivityPanel:function(){this.queryActivityForm=Ext.Easy.getEasyQueryForm(Ext.bind(this.queryActivityList,this),[voucherDataElementsConfigs.getBaseConfigByName("activityCode"),voucherDataElementsConfigs.getBaseConfigByName("activityName"),voucherDataElementsConfigs.getBaseConfigByName("activityType"),voucherDataElementsConfigs.getBaseConfigByName("sponsor")],2);var a={xtype:"easygridquery",viewPanelClass:"Ext.Voucher.ActivityEditPanel",noAutoLoad:true,region:"center",showBbar:true,showTbar:true,showUpateBtn:true,showRemoveBtn:true,overrideRemove:true,parentPanel:this,subWindowWidth:midwindowWidth,subWindowHeight:windowHight,desktop:this.desktop,subWindowTitle:"活动信息详情",baseParams:{queryId:"voucher.mapper.VoucherMapper.queryActivitys"},fields:voucherDataElementsConfigs.getQueryActivityResultCfg()};this.easyGrid=new Ext.ux.EasyGridQuery(a);this.add({title:"查询活动",layout:"border",items:[this.queryActivityForm,this.easyGrid]})},createQueryVoucherPanel:function(){this.queryVoucherForm=Ext.Easy.getEasyQueryForm(Ext.bind(this.queryVoucherList,this),[voucherDataElementsConfigs.getBaseConfigByName("voucherName"),voucherDataElementsConfigs.getBaseConfigByName("voucherCd"),voucherDataElementsConfigs.getBaseConfigByName("voucherMoney"),voucherDataElementsConfigs.getBaseConfigByName("voucherStatus"),voucherDataElementsConfigs.getBaseConfigByName("voucherCreateBeginTime"),voucherDataElementsConfigs.getBaseConfigByName("voucherCreateEndTime"),voucherDataElementsConfigs.getBaseConfigByName("bindMemberStatus"),voucherDataElementsConfigs.getBaseConfigByName("memberCd")],2);var a={xtype:"easygrid",noAutoLoad:true,region:"center",showBbar:true,formItemsReadOnly:true,subWindowTitle:"代金券详细信息",baseParams:{queryId:"voucher.mapper.VoucherMapper.queryVouchers"},fields:voucherDataElementsConfigs.getQueryVoucherResultCfg()};this.voucherGrid=new Ext.ux.EasyGrid(a);this.add({title:"查询代金券",layout:"border",items:[this.queryVoucherForm,this.voucherGrid]})},queryActivityList:function(){var b=this.easyGrid.getStore();var a=this.queryActivityForm.getForm().getValues();b.proxy.extraParams={queryId:b.proxy.extraParams.queryId};Ext.apply(b.proxy.extraParams,a);b.loadPage(1)},queryVoucherList:function(){var b=this.voucherGrid.getStore();var a=this.queryVoucherForm.getForm().getValues();b.proxy.extraParams={queryId:b.proxy.extraParams.queryId};Ext.apply(b.proxy.extraParams,a);b.loadPage(1)},removeRecord:function(c,b,a){var e="voucherAction!deleteActivity.action";var d=false;Ext.Easy.easyAjax(e,{activityId:b.get("ID")},function(f,g){var h=Ext.decode(f.responseText);d=h.success},this,true);return d}});Ext.define("Ext.Voucher.ActivityEditPanel",{extend:"Ext.panel.Panel",constructor:function(a){var b=this;a=a||{};Ext.apply(b,a);b.callParent()},initComponent:function(){var d=this;this.border=false;this.frame=false;this.layout="border";this.autoScroll=true;d.callParent();var h=Ext.widget("textfield",voucherDataElementsConfigs.getConfigByName("activityCode"));var g=Ext.widget("textfield",voucherDataElementsConfigs.getConfigByName("activityName"));var b=Ext.widget("hidden",voucherDataElementsConfigs.getConfigByName("activityId"));var e=Ext.widget("hidden",voucherDataElementsConfigs.getConfigByName("publishStatus"));h.on("blur",Ext.bind(this.validActivityCodeOnly,this,[h,b]));g.on("blur",Ext.bind(this.validActivityNameOnly,this,[g,b]));this.codeObj=h;this.nameObj=g;this.activityIdObj=b;this.publishStatusObj=e;var a=[h,g,voucherDataElementsConfigs.getConfigByName("explain"),voucherDataElementsConfigs.getConfigByName("activityType"),voucherDataElementsConfigs.getConfigByName("linkman"),voucherDataElementsConfigs.getConfigByName("phone"),voucherDataElementsConfigs.getConfigByName("sponsor"),voucherDataElementsConfigs.getConfigByName("contractNo"),voucherDataElementsConfigs.getConfigByName("referendum"),voucherDataElementsConfigs.getConfigByName("activityKind"),voucherDataElementsConfigs.getConfigByName("beginDate"),voucherDataElementsConfigs.getConfigByName("endDate"),voucherDataElementsConfigs.getConfigByName("gainArea"),voucherDataElementsConfigs.getConfigByName("useArea"),voucherDataElementsConfigs.getConfigByName("joinLimit"),voucherDataElementsConfigs.getConfigByName("useLimit"),voucherDataElementsConfigs.getConfigByName("webActivCode"),e,b];var f=Ext.Easy.getEasyForm({items:a,columnSize:2,region:"north",fbar:[{text:"保存",iconCls:"accept",handler:Ext.bind(this.saveActivity,this)},{text:"发行",iconCls:"accept",handler:Ext.bind(this.publish,this)}]});var c={region:"center",xtype:"easygrid",fields:voucherDataElementsConfigs.getQueryDefineResultCfg(),showTbar:true,showRemoveBtn:true,showSaveBtn:true,overrideRemove:true,parentPanel:this,gridName:"voucherDefine",subWindowTitle:"代金券定义明细",data:[{}],desktop:this.desktop};this.voucherDefineGrid=new Ext.ux.EasyGrid(c);this.baseInfoForm=f;this.add(f);this.add(this.voucherDefineGrid);Ext.Easy.easyAjax("voucherAction!queryNewActivityCode.action",{},function(i,j){var k=Ext.decode(i.responseText);if(this.codeObj.getValue()==""){this.codeObj.setValue(k.newActivityCode)}},this)},saveRecords:function(b,a){var f={activityId:this.activityIdObj.value};var c="voucherAction!saveVoucherDefine.action";var e=this.voucherDefineGrid;if(b.data.length==0){Ext.Msg.alert("保存提示","你必须至少添加 一项代金券定义!");return}var d=Ext.Easy.getRecordsToParams(b,f,"ID",true,e);f.itemNewCount=d[0];f.itemModefiyCount=d[1];if((this.modifyCount+d[0]+d[1])==0){return}Ext.Easy.easyAjax(c,f,function(g,h){var i=Ext.decode(g.responseText);e.getStore().loadData(i.result);Ext.Easy.alertMsg(i.success)},this)},validActivityCodeOnly:function(b,c){var d=Ext.String.trim(b.value);var a=c.value;if(d==""){return}Ext.Easy.easyAjax("voucherAction!validActivityCodeOnly.action",{activityCode:d,activityId:a},function(e,f){var g=Ext.decode(e.responseText);this.codeValidResult=g.success},this)},validActivityNameOnly:function(b,d){var a=Ext.String.trim(b);var c=d.value;if(a==""){return}Ext.Easy.easyAjax("voucherAction!validActivityNameOnly.action",{activityName:a,activityId:c},function(e,f){var g=Ext.decode(e.responseText);this.nameValidResult=g.success},this)},loadFormRecord:function(b,a){Ext.Easy.easyAjax("voucherAction!queryActivityById.action",{activityId:b},function(c,d){var e=Ext.decode(c.responseText);this.baseInfoForm.getForm().setValues(e.activity);this.voucherDefineGrid.getStore().loadData(e.defineList)},this)},getRecordKey:function(){return"ID"},saveActivity:function(){if(!Ext.Easy.isFormValid(this.baseInfoForm)){return}if((this.codeObj.value!=undefined&&Ext.String.trim(this.codeObj.value)!="")&&this.codeValidResult==false){Ext.Msg.alert("填写提示","该活动代码已使用，请改用另一个!");return}if((this.nameObj.value!=undefined&&Ext.String.trim(this.nameObj.value)!="")&&this.nameValidResult==false){Ext.Msg.alert("填写提示","该活动名称已使用，请改用另一个!");return}this.baseInfoForm.submit({url:"voucherAction!saveActivity.action",success:function(a,b){a.setValues(b.result.activity);Ext.Easy.alertMsg(true)},failure:function(a,b){Ext.Easy.alertMsg(false)}})},validDefineMoneyOnly:function(f,a,c){var e=Ext.String.trim(f.value);var b=a.value;var d=c.value;if(e==""){return}Ext.Easy.easyAjax("voucherAction!validDefineMoneyOnly.action",{money:e,defineId:b,activityId:d},function(g,h){var i=Ext.decode(g.responseText);this.moneyValidResult=i.success},this)},publish:function(){if(this.publishStatusObj.value==2){Ext.Msg.alert("发行提示","该活动的代金券已发行过!");return}if(this.voucherDefineGrid.store.data.length==0){Ext.Msg.alert("发行提示","你必须至少添加 一项代金券定义!");return}Ext.Msg.show({title:"发行提示",msg:"您确定要发行此项活动的代金券吗？",buttons:Ext.Msg.YESNO,fn:Ext.bind(this.publishSubmit,this),icon:Ext.window.MessageBox.QUESTION})},publishSubmit:function(a){if(a=="no"){return}Ext.Easy.easyAjax("voucherAction!addVoucher.action",{activityId:this.activityIdObj.value},function(b,c){var d=Ext.decode(b.responseText);Ext.Easy.alertMsg(d.success)},this)},removeRecord:function(c,b,a){var e="voucherAction!deleteVoucherDefine.action";var d=false;Ext.Easy.easyAjax(e,{defineId:b.get("ID")},function(f,g){var h=Ext.decode(f.responseText);d=h.success},this,true);return d}});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Ext.Warehouse.WarehouseData",{extend:"Ext.ux.desktop.Module",uses:["Ext.Warehouse.WarehouseDataMainPanel"],id:"warehouse-win",init:function(){this.launcher={text:"仓库管理",iconCls:"warehouse",handler:this.createWindow,scope:this}},createWindow:function(){var b=this.app.getDesktop();var a=b.getWindow(this.id);if(!a){a=b.createWindow({id:this.id,title:this.launcher.text,width:miderwindowWidth,height:windowHight,iconCls:this.launcher.iconCls,animCollapse:false,border:false,hideMode:"offsets",layout:"fit",items:new Ext.Warehouse.WarehouseDataMainPanel({desktop:b})})}a.show();return a}});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Ext.Warehouse.WarehouseDataElementsConfigs",{extend:"Ext.util.MixedCollection",constructor:function(a){a=a||{};Ext.apply(this,a);this.callParent();this.loadBaseData();this.init()},loadBaseData:function(){Ext.Ajax.request({url:"stockAction!queryStoragInfo.action",async:false,success:function(a,b){var c=Ext.decode(a.responseText);CDM.storagInfo=[];Ext.each(c.storagList,function(d){CDM.storagInfo.push([d.storagName,d.storagName])})},failure:loadBaseDataFailureFun,scope:this});Ext.Ajax.request({url:"logisticsCompanyAction!queryLogisticsCompany.action",async:false,success:function(a,b){var c=Ext.decode(a.responseText);CDM.logisticsCompanyInfoList=[];Ext.each(c.logisticsCompany,function(d){CDM.logisticsCompanyInfoList.push([d.logisticsCompanyName,d.logisticsCompanyName])})},failure:function(a,b){Ext.Msg.alert("操作提示","服务不可用,读取基础数据失败!")}})},orderWarehouseConfig:null,signWareHouseConfig:null,returnRecordDetailConfig:null,changeOrRefundConfig:null,inventoryConfig:null,inventoryDetailConfig:null,changeOrRefundDetailConfig:null,adjustConfig:null,adjustDetailConfig:null,init:function(){var b=110;var a=[60,80,60];this.add("invoiceCd",{fieldLabel:"发货订单编号",name:"invoiceCd"});this.add("orderCd",{fieldLabel:"订单编号",name:"orderCd"});this.add("invoiceState",Ext.Easy.getEasyComboCfg("发货状态","invoiceState",null,CDM.invoiceState,true));this.add("linkName",{fieldLabel:"收货人姓名",name:"linkName"});this.add("linkMoblie",{fieldLabel:"收货人联系电话",name:"linkMoblie"});this.add("linkTelephone",{fieldLabel:"收货人固定电话",name:"linkTelephone"});this.add("linkAddress",{fieldLabel:"收货人地址",name:"linkAddress"});this.add("linkPostcode",{fieldLabel:"收货人邮编",name:"linkPostcode"});this.add("deliveryType",{fieldLabel:"配送方式",name:"deliveryType"});this.add("deliveryDate",Ext.Easy.getEasyComboCfg("预约配送时间","deliveryDate",null,CDM.deliveryTime,true,null,null,280));this.add("deliveryNote",{fieldLabel:"配送备注",name:"deliveryNote"});this.add("paymentType",{fieldLabel:"付款方式",name:"paymentType"});this.add("productTotalPrice",{fieldLabel:"货品总金额",name:"productTotalPrice"});this.add("deliveryTotalPrice",{fieldLabel:"运费总金额",name:"deliveryTotalPrice"});this.add("packTotalPrice",{fieldLabel:"包装总金额",name:"packTotalPrice"});this.add("point",{fieldLabel:"使用积分",name:"point"});this.add("giftTotalPrice",{fieldLabel:"礼券总金额",name:"giftTotalPrice"});this.add("discountTotalPrice",{fieldLabel:"折扣总金额",name:"discountTotalPrice"});this.add("realTotalPrice",{fieldLabel:"实收总金额",name:"realTotalPrice"});this.add("consignor",{fieldLabel:"配货员",name:"consignor"});this.add("reviewer",{fieldLabel:"复核员",name:"reviewer"});this.add("packer",{fieldLabel:"包装员",name:"packer"});this.add("stamper",{fieldLabel:"打单员",name:"stamper"});this.add("creatorEr",{fieldLabel:"创建人",name:"creator"});this.add("invoiceCreateDate",Ext.Easy.getEasyDateCfg("创建时间","createDate"));this.add("Othernote",{xtype:"textareafield",fieldLabel:"其它备注",name:"note",width:400,colspan:2});this.add("productName",{fieldLabel:"货品名称",name:"productName"});this.add("detailType",{fieldLabel:"明细类型",name:"detailType"});this.add("sellTotalPrice",{fieldLabel:"销售总价",name:"sellTotalPrice"});this.add("realTotalPrice",{fieldLabel:"应收总价",name:"realTotalPrice"});this.add("discount",{fieldLabel:"折扣率",name:"discount"});this.add("productCd",{fieldLabel:"货品CD",name:"discount"});this.add("productSize",{fieldLabel:"货品尺码",name:"discount"});this.add("productColorCn",{fieldLabel:"货品颜色",name:"productColorCn"});this.add("productNum",{fieldLabel:"货品数量",name:"productNum"});this.add("price",{fieldLabel:"销售单价",name:"price"});this.add("ID",{xtype:"hidden",fieldLabel:"ID",name:"ID"});this.add("buyCode",{fieldLabel:"采购入库编号",name:"buyCode"});this.add("buyStorageName",Ext.Easy.getEasyComboCfg("入库仓库","storage",null,CDM.storagInfo,true));this.add("enterState",Ext.Easy.getEasyComboCfg("入库状态","enterState",null,CDM.enterState,true));this.add("createDateFrom",Ext.Easy.getEasyDateCfg("申请入库时间","applyDate"));this.add("createDateTo",{fieldLabel:"",name:"applyDate"});this.add("buyQueryDate",Ext.Easy.getRandFields({fieldLabel:"申请入库时间",name1:"beginApplyDate",name2:"endApplyDate"}));this.add("validateDate",{fieldLabel:"实际入库时间",name:"validateDate"});this.add("isBuy",Ext.Easy.getEasyComboCfg("是否入库","isBuy",null,CDM.isBuy,true));this.add("isDifference",Ext.Easy.getEasyComboCfg("是否差异","isDifference",null,CDM.isDifference,true));this.add("productSource",{fieldLabel:"货品来源",name:"productSource"});this.add("buyNote",{xtype:"textareafield",fieldLabel:"采购备注",name:"buyNote",width:400,colspan:2});this.add("barCode",{fieldLabel:"条形码",name:"barCode"});this.add("projectNum",{fieldLabel:"计划数量",name:"projectNum"});this.add("realNum",{fieldLabel:"实收数量",name:"realNum"});this.add("differenceNum",{fieldLabel:"差异数量",name:"differenceNum"});this.add("buyDetailShelf",{fieldLabel:"入库货架",name:"shelf"});this.add("isProject",Ext.Easy.getEasyComboCfg("是否计划","isProject",null,CDM.isProject,true));this.add("updateStockNote",{fieldLabel:"库存情况",name:"updateStockNote"});this.add("sellId",{xtype:"hidden",fieldLabel:"sellId",name:"sellId"});this.add("buyId",{xtype:"hidden",fieldLabel:"buyId",name:"buyId"});this.add("sellCode",{fieldLabel:"出库单编号",name:"sellCode"});this.add("sellDate",{fieldLabel:"发货日期",name:"sellDate"});this.add("sellQueryDate",Ext.Easy.getRandFields({fieldLabel:"发货日期",name1:"sellDateFrom",name2:"sellDateTo"}));this.add("sellState",Ext.Easy.getEasyComboCfg("拣货状态","sellState",null,CDM.sellState,true));this.add("orderTotalNum",{fieldLabel:"总订单数",name:"orderTotalNum"});this.add("sellStorage",Ext.Easy.getEasyComboCfg("出库仓库","storage",null,CDM.storagInfo,true));this.add("outShelf",{fieldLabel:"出库货架",name:"outShelf"});this.add("factOutNum",{fieldLabel:"实际出库数量",name:"factOutNum"});this.add("orderCd",{fieldLabel:"订单编号",name:"orderCd"});this.add("outNum",{fieldLabel:"计划出库数量",name:"outNum"});this.add("outState",Ext.Easy.getEasyComboCfg("出库明细状态","outState",null,CDM.outState,true));this.add("sellCreateDate",{fieldLabel:"创建时间",name:"createDate"});this.add("allocateCode",{fieldLabel:"调拨记录编号",name:"allocateCode"});this.add("allocateType",{fieldLabel:"调拨类型",name:"allocateType"});this.add("foldStorage",Ext.Easy.getEasyComboCfg("发货仓库","foldStorage",null,CDM.storagInfo,true));this.add("depositaryStorage",Ext.Easy.getEasyComboCfg("收货仓库","depositaryStorage",null,CDM.storagInfo,true));this.add("allocateState",Ext.apply(Ext.Easy.getEasyComboCfg("调拨状态","allocateState",null,CDM.allocateState,true)));this.add("allocateCreateDate",{fieldLabel:"创建时间",name:"createDate"});this.add("foldShelf",{fieldLabel:"出货货架",name:"foldShelf"});this.add("depositaryShelf",{fieldLabel:"入库货架",name:"depositaryShelf"});this.add("foidDate",{fieldLabel:"入库时间",name:"foidDate"});this.add("allocateNum",{fieldLabel:"调拨数量",name:"allocateNum"});this.add("checkCode",{fieldLabel:"出入库编号",name:"checkCode"});this.add("checkType",Ext.apply(Ext.Easy.getEasyComboCfg("出入库类型","checkType",null,CDM.checkType,true),{required:true}));this.add("checkDate",{fieldLabel:"出入库时间",name:"checkDate"});this.add("queryCheckDate",Ext.Easy.getRandFields({fieldLabel:"出入库时间",name1:"checkDateFrom",name2:"checkDateTo"}));this.add("checkStorage",Ext.apply(Ext.Easy.getEasyComboCfg("出入库仓库","checkStorage",null,CDM.storagInfo,true),{required:true}));this.add("checkState",Ext.Easy.getEasyComboCfg("出入库状态","checkState",null,CDM.checkState,true));this.add("checkNum",{fieldLabel:"出入库数量",name:"checkNum"});this.add("checkShelf",{fieldLabel:"出入库货架",name:"checkShelf"});this.add("checkDetailNote",{fieldLabel:"出入库明细信息",name:"checkDetailNote"});this.add("checkId",{xtype:"hidden",fieldLabel:"checkId",name:"checkId"});this.add("batchNo",{fieldLabel:"批次号",name:"batchNo"});this.add("productNum",{fieldLabel:"货品数量",name:"productNum"});this.add("stockStorage",Ext.Easy.getEasyComboCfg("入库仓库","storage",null,CDM.storagInfo,true));this.add("stockShelf",{fieldLabel:"入库货架",name:"shelf"});this.add("productCd",{fieldLabel:"货品编号",name:"productCd"});this.add("productName",{fieldLabel:"货品名称",name:"productName"});this.add("productBrand",{fieldLabel:"货品品牌",name:"productBrand"});this.add("productSize",{fieldLabel:"货品尺码",name:"productSize"});this.add("productSizeNo",{fieldLabel:"货品尺码号",name:"productSizeNo"});this.add("productColorCn",{fieldLabel:"颜色（中文）",name:"productColorCn"});this.add("productColorEn",{fieldLabel:"颜色（英文）",name:"productColorEn"});this.add("productColorNo",{fieldLabel:"货品色号",name:"productColorNo"});this.add("productBarcode",{fieldLabel:"货品条形码",name:"productBarcode"});this.add("productPrice",{fieldLabel:"货品单价",name:"productPrice"});this.add("productCost",{fieldLabel:"货品成本价",name:"productCost"});this.add("productNote",{fieldLabel:"货品备注",name:"productNote"});this.add("storage",{fieldLabel:"入库仓库",name:"storage"});this.add("realNum",{fieldLabel:"实际数量",name:"realNum",editor:{xtype:"textfield"}});this.add("storagId",{xtype:"hidden",fieldLabel:"仓库ID",name:"storagId"});this.add("storagCode",{fieldLabel:"仓库编号",name:"storagCode"});this.add("storagName",{fieldLabel:"仓库名称",name:"storagName",required:true});this.add("storagType",Ext.Easy.getEasyComboCfg("仓库类型","storagType",null,CDM.storagType,true));this.add("functionary",{fieldLabel:"仓库负责人",name:"functionary",required:true});this.add("address",{fieldLabel:"仓库地址",name:"address",required:true});this.add("phone",{fieldLabel:"仓库电话",name:"phone"});this.add("shelfNum",{fieldLabel:"仓库货架数",name:"shelfNum"});this.add("contentNum",{fieldLabel:"仓库容量数",name:"contentNum"});this.add("storagNote",{xtype:"textareafield",fieldLabel:"仓库备注",name:"storagNote",width:400,colspan:2});this.add("storagState",Ext.Easy.getEasyComboCfg("仓库状态","storagState",null,CDM.storagState,true));this.add("shelfId",{xtype:"hidden",fieldLabel:"货架ID",name:"shelfId"});this.add("shelfName",{fieldLabel:"货架名称",name:"shelfName",required:true});this.add("storagShelfName",Ext.Easy.getEasyComboCfg("仓库名称","storagName",null,CDM.storagInfo,true));this.add("shelfNote",{xtype:"textareafield",fieldLabel:"货架备注",name:"shelfNote",width:400,colspan:2});this.add("creator",{fieldLabel:"创建人",name:"creator",required:true});this.add("createDate",Ext.Easy.getEasyDateCfg("创建时间","createDate"));this.add("shelfState",Ext.Easy.getEasyComboCfg("货架状态","shelfState",null,CDM.shelfState,true));this.add("logisticsCompanyId",{xtype:"hidden",fieldLabel:"公司ID",name:"logisticsCompanyId"});this.add("logisticsCompanyName",{fieldLabel:"公司名称",name:"logisticsCompanyName",required:true});this.add("logisticsCompanyAddress",{fieldLabel:"公司地址",name:"logisticsCompanyAddress"});this.add("logisticsCompanyOne",{fieldLabel:"公司第一负责人",name:"logisticsCompanyOne"});this.add("logisticsCompanyTwo",{fieldLabel:"公司第二负责人",name:"logisticsCompanyTwo"});this.add("logisticsCompanyMoblie",{fieldLabel:"公司电话",name:"logisticsCompanyMoblie"});this.add("logisticsCompanyTelephone",{fieldLabel:"公司固定电话",name:"logisticsCompanyTelephone"});this.add("logisticsCompanyNote",{xtype:"textareafield",fieldLabel:"其它说明",name:"logisticsCompanyNote",width:400,colspan:2});this.add("price",{fieldLabel:"物流运费",name:"price",required:true});this.add("areaId",{xtype:"hidden",fieldLabel:"配送ID",name:"areaId"});this.add("province",{fieldLabel:"省份",name:"province",required:true});this.add("city",{fieldLabel:"城市",name:"city",required:true});this.add("area",{fieldLabel:"地区",name:"area",required:true});this.add("note",{xtype:"textareafield",fieldLabel:"配送说明",name:"note",width:400,colspan:2});this.add("areaLogisticsCompanyName",Ext.Easy.getEasyComboCfg("公司名称","logisticsCompanyName",null,CDM.logisticsCompanyInfoList,true));this.orderWarehouseConfig=new Ext.util.MixedCollection();this.addOrderConfig("logisticsCd",{fieldLabel:"物流单编号 ",name:"logisticsCd"});this.addOrderConfig("orderCode",{fieldLabel:"订单编号",name:"orderCode",required:true});this.addOrderConfig("logisticsNo",{fieldLabel:"快递单号",name:"logisticsNo",required:true});this.addOrderConfig("productNote",{xtype:"textareafield",fieldLabel:"货品说明",name:"productNote",width:400,colspan:2});this.addOrderConfig("productWeight",{fieldLabel:"货品重量",name:"productWeight",required:true});this.addOrderConfig("linkName",{fieldLabel:"收货人姓名",name:"linkName",required:true});this.addOrderConfig("linkAddress",{fieldLabel:"收货人地址",name:"linkAddress",required:true});this.addOrderConfig("linkMobile",{fieldLabel:"收货人电话",name:"linkMobile",required:true});this.addOrderConfig("logisticsSignId",{fieldLabel:"物流签收ID ",name:"logisticsSignId"});this.addOrderConfig("bindId",{fieldLabel:"绑定主键",name:"bindId"});this.addOrderConfig("creator",{fieldLabel:"创建人 ",name:"creator"});this.addOrderConfig("createDate",Ext.Easy.getEasyDateCfg("创建时间","createDate"));this.addOrderConfig("logisticsState",Ext.Easy.getEasyComboCfg("物流状态","logisticsState",null,CDM.logisticsState,true));this.addOrderConfig("logisticsType",Ext.apply(Ext.Easy.getEasyComboCfg("物流类型","logisticsType",null,CDM.logisticsType,true),{required:true}));this.addOrderConfig("returnSignState",Ext.Easy.getEasyComboCfg("签收状态","returnSignState",null,CDM.returnSignState,true));this.addOrderConfig("queryOrderDate",Ext.Easy.getRandFields({fieldLabel:"创建时间",name1:"createBeginDate",name2:"createEndDate"}));this.addOrderConfig("ID",{fieldLabel:"物流ID",name:"ID",xtype:"hidden"});this.signWareHouseConfig=new Ext.util.MixedCollection();this.addSignConfig("operator",{fieldLabel:"经办人",name:"operator",required:true});this.addSignConfig("totalNum",{fieldLabel:"总件数",name:"totalNum"});this.addSignConfig("logisticsCompany",Ext.apply(Ext.Easy.getEasyComboCfg("物流公司","logisticsCompany",null,CDM.logisticsCompanyInfoList,true),{required:true}));this.addSignConfig("subscriber",{fieldLabel:"物流公司签收人",name:"subscriber",required:true});this.addSignConfig("signDate",Ext.apply(Ext.Easy.getEasyDateCfg("签收时间","signDate"),{required:true}));this.addSignConfig("note",{xtype:"textareafield",fieldLabel:"备注",name:"note",width:500,colspan:2});this.addSignConfig("createDate",{fieldLabel:"创建时间",name:"createDate"});this.addSignConfig("queryCreateDate",Ext.Easy.getRandFields({fieldLabel:"创建时间",name1:"createBeginDate",name2:"createEndDate"}));this.addSignConfig("querySignDate",Ext.Easy.getRandFields({fieldLabel:"签收时间",name1:"signeBeginDate",name2:"signEndDate"}));this.addSignConfig("ID",{fieldLabel:"物流签收ID",name:"ID",xtype:"hidden"});this.returnRecordDetailConfig=new Ext.util.MixedCollection();this.addReturnRecordDetailConfig("productName",{fieldLabel:"货品名称",name:"productName"});this.addReturnRecordDetailConfig("productBrand",{fieldLabel:"货品品牌",name:"productBrand"});this.addReturnRecordDetailConfig("productBarcode",{fieldLabel:"货品条形码",name:"productBarcode"});this.addReturnRecordDetailConfig("productNum",{fieldLabel:"货品数量",name:"productNum"});this.addReturnRecordDetailConfig("productColorCn",{fieldLabel:"货品颜色",name:"productColorCn"});this.addReturnRecordDetailConfig("note",{fieldLabel:"备注",name:"note"});this.addReturnRecordDetailConfig("returnRecordDetailId",{fieldLabel:"退换货明细ID",name:"returnRecordDetailId",xtype:"hidden"});this.changeOrRefundConfig=new Ext.util.MixedCollection();this.addChangeOrRefundConfig("orderCd",{fieldLabel:"订单CD",name:"orderCd"});this.addChangeOrRefundConfig("receiver",{fieldLabel:"收货人名称",name:"receiver"});this.addChangeOrRefundConfig("expressName",Ext.Easy.getEasyComboCfg("物流公司","expressName",null,CDM.logisticsCompanyInfoList,true));this.addChangeOrRefundConfig("expressNo",{fieldLabel:"快递单号",name:"expressNo"});this.addChangeOrRefundConfig("receiverMobile",{fieldLabel:"收货人电话",name:"receiverMobile"});this.addChangeOrRefundConfig("type",Ext.Easy.getEasyComboCfg("类型","type",null,CDM.refundType,true));this.addChangeOrRefundConfig("orderId",{fieldLabel:"订单ID",name:"orderId",xtype:"hidden"});this.addChangeOrRefundConfig("ID",{fieldLabel:"退换货申请ID",name:"ID",xtype:"hidden"});this.changeOrRefundDetailConfig=new Ext.util.MixedCollection();this.addChangeOrRefundDetailConfig("productName",{fieldLabel:"原产品名称",name:"productName"});this.addChangeOrRefundDetailConfig("productNo",{fieldLabel:"原产品编号",name:"productNo"});this.addChangeOrRefundDetailConfig("colorCode",{fieldLabel:"色号",name:"colorCode"});this.addChangeOrRefundDetailConfig("colorName",{fieldLabel:"颜色名称",name:"colorName"});this.addChangeOrRefundDetailConfig("sizeCode",{fieldLabel:"尺码号",name:"sizeCode"});this.addChangeOrRefundDetailConfig("orderCd",{fieldLabel:"尺码名称",name:"orderCd"});this.addChangeOrRefundDetailConfig("bookNum",{fieldLabel:"数量",name:"bookNum"});this.addChangeOrRefundDetailConfig("swapOutColorCode",{fieldLabel:"换出色号",name:"swapOutColorCode"});this.addChangeOrRefundDetailConfig("swapOutColorName",{fieldLabel:"换出颜色名称",name:"swapOutColorName"});this.addChangeOrRefundDetailConfig("swapOutSizeCode",{fieldLabel:"换出尺码号",name:"swapOutSizeCode"});this.addChangeOrRefundDetailConfig("swapOutSizeName",{fieldLabel:"换出尺码名称",name:"swapOutSizeName"});this.addChangeOrRefundDetailConfig("swapOutNum",{fieldLabel:"换出数量",name:"swapOutNum"});this.addChangeOrRefundDetailConfig("chgOrRefudReason",{fieldLabel:"退换货原因",name:"chgOrRefudReason"});this.addChangeOrRefundDetailConfig("orderItmId",{fieldLabel:"订单明细ID",name:"orderItmId",xtype:"hidden"});this.addChangeOrRefundDetailConfig("ID",{fieldLabel:"退换货申请明细ID",name:"ID",xtype:"hidden"});this.inventoryConfig=new Ext.util.MixedCollection();this.addInventoryConfig("inventoryStorage",{fieldLabel:"盘点仓库",name:"inventoryStorage"});this.addInventoryConfig("operator",{fieldLabel:"盘点人",name:"operator"});this.addInventoryConfig("inventoryDate",{fieldLabel:"盘点时间",name:"inventoryDate"});this.addInventoryConfig("inventoryBeginDate",Ext.Easy.getEasyDateCfg("盘点起始时间","inventoryBeginDate"));this.addInventoryConfig("inventoryEndDate",Ext.Easy.getEasyDateCfg("盘点截止时间","inventoryEndDate"));this.addInventoryConfig("isAdjust",Ext.Easy.getEasyComboCfg("是否有平帐单","isAdjust",null,CDM.isAdjust,true));this.addInventoryConfig("adjustState",Ext.Easy.getEasyComboCfg("盘点状态","adjustState",null,CDM.adjustState,true));this.addInventoryConfig("inventoryCode",{fieldLabel:"盘点编号",name:"inventoryCode"});this.addInventoryConfig("inventoryNote",{fieldLabel:"盘点备注",name:"inventoryNote"});this.addInventoryConfig("ID",{fieldLabel:"盘点ID",name:"ID",xtype:"hidden"});this.inventoryDetailConfig=new Ext.util.MixedCollection();this.addInventoryDetailConfig("productName",{fieldLabel:"货品名称",name:"productName"});this.addInventoryDetailConfig("productCd",{fieldLabel:"货品编号",name:"productCd"});this.addInventoryDetailConfig("productBrand",{fieldLabel:"货品品牌",name:"productBrand"});this.addInventoryDetailConfig("productSize",{fieldLabel:"货品尺码",name:"productSize"});this.addInventoryDetailConfig("productColorCn",{fieldLabel:"货品颜色",name:"productColorCn"});this.addInventoryDetailConfig("productNum",{fieldLabel:"系统数量",name:"productNum"});this.addInventoryDetailConfig("realNum",{fieldLabel:"实际数量",name:"realNum"});this.addInventoryDetailConfig("differenceNum",{fieldLabel:"差异数",name:"differenceNum"});this.addInventoryDetailConfig("adjustNum",{fieldLabel:"平帐数量",name:"adjustNum",editor:{xtype:"textfield"}});this.addInventoryDetailConfig("ID",{fieldLabel:"盘点明细ID",name:"ID",xtype:"hidden"});this.adjustConfig=new Ext.util.MixedCollection();this.addAdjustConfig("adjustCode",{fieldLabel:"平帐编号",name:"adjustCode"});this.addAdjustConfig("inventoryCode",{fieldLabel:"盘点编号",name:"inventoryCode"});this.addAdjustConfig("adjustStorag",{fieldLabel:"平帐仓库",name:"adjustStorag"});this.addAdjustConfig("operator",{fieldLabel:"平帐人",name:"operator"});this.addAdjustConfig("operateDate",Ext.Easy.getEasyDateCfg("平帐时间","operateDate"));this.addAdjustConfig("adjustNote",{fieldLabel:"平帐备注",name:"adjustNote"});this.addAdjustConfig("operateBeginDate",Ext.Easy.getEasyDateCfg("平帐起始时间","operateBeginDate"));this.addAdjustConfig("operateEndDate",Ext.Easy.getEasyDateCfg("平帐截止时间","operateEndDate"));this.addAdjustConfig("ID",{fieldLabel:"平帐单ID",name:"ID",xtype:"hidden"});this.adjustDetailConfig=new Ext.util.MixedCollection();this.addAdjustDetailConfig("adjustCode",{fieldLabel:"平帐编号",name:"adjustCode"});this.addAdjustDetailConfig("productName",{fieldLabel:"货品名称",name:"productName"});this.addAdjustDetailConfig("productCd",{fieldLabel:"货品编号",name:"productCd"});this.addAdjustDetailConfig("productBrand",{fieldLabel:"货品品牌",name:"productBrand"});this.addAdjustDetailConfig("productSize",{fieldLabel:"货品尺码",name:"productSize"});this.addAdjustDetailConfig("productColorCn",{fieldLabel:"货品颜色",name:"productColorCn"});this.addAdjustDetailConfig("differenceNum",{fieldLabel:"差异数量",name:"differenceNum"});this.addAdjustDetailConfig("adjustNum",{fieldLabel:"平帐数量",name:"adjustNum"})},getConfigByName:function(b,c){var a=Ext.apply({},this.get(b));if(a.required){Ext.apply(a,{allowBlank:false,blankText:"此字段不能为空",labelSeparator:'<font color="red">*</font>'})}if(c){a=Ext.apply(a,{colspan:c,anchor:"85%"})}return a},getBaseConfigByName:function(a){return Ext.apply({},this.get(a))},getOrderConfigByName:function(b,c){var a=Ext.apply({},this.orderWarehouseConfig.get(b));return a},getOrderConfigByNameValid:function(b,c){var a=Ext.apply({},this.orderWarehouseConfig.get(b));if(a.required){Ext.apply(a,{allowBlank:false,blankText:"此字段不能为空",labelSeparator:'<font color="red">*</font>'})}return a},getSignConfigName:function(b,c){var a=Ext.apply({},this.signWareHouseConfig.get(b));return a},getSignConfigNameValid:function(b,c){var a=Ext.apply({},this.signWareHouseConfig.get(b));if(a.required){Ext.apply(a,{allowBlank:false,blankText:"此字段不能为空",labelSeparator:'<font color="red">*</font>'})}return a},getChangeOrRefundConfigName:function(b,c){var a=Ext.apply({},this.changeOrRefundConfig.get(b));return a},getChangeOrRefundDetailConfigByName:function(b,c){var a=Ext.apply({},this.changeOrRefundDetailConfig.get(b));return a},getInventoryConfigByName:function(b,c){var a=Ext.apply({},this.inventoryConfig.get(b));return a},getInventoryDetailConfigByName:function(b,c){var a=Ext.apply({},this.inventoryDetailConfig.get(b));return a},getAdjustConfigByName:function(b,c){var a=Ext.apply({},this.adjustConfig.get(b));return a},getAdjustDetailConfigByName:function(b,c){var a=Ext.apply({},this.adjustDetailConfig.get(b));return a},getStoragFields:function(){var a=new Ext.util.MixedCollection();a.add(this.get("storagCode"));a.add(this.get("storagName"));a.add(this.get("functionary"));a.add(this.get("address"));a.add(this.get("phone"));a.add(this.get("shelfNum"));a.add(this.get("contentNum"));a.add(this.get("storagType"));a.add(this.get("storagId"));return a},getShelfFields:function(){var a=new Ext.util.MixedCollection();a.add(this.get("creator"));a.add(this.get("storagId"));a.add(this.get("storagName"));a.add(this.get("shelfState"));a.add(this.get("shelfName"));a.add(this.get("createDate"));a.add(this.get("shelfId"));return a},getLogisticsCompanyFields:function(){var a=new Ext.util.MixedCollection();a.add(this.get("logisticsCompanyId"));a.add(this.get("logisticsCompanyName"));a.add(this.get("logisticsCompanyTelephone"));a.add(this.get("logisticsCompanyMoblie"));a.add(this.get("logisticsCompanyOne"));a.add(this.get("logisticsCompanyTwo"));a.add(this.get("logisticsCompanyAddress"));a.add(this.get("logisticsCompanyNote"));a.add(this.get("price"));return a},getLogisticsAreaFields:function(){var a=new Ext.util.MixedCollection();a.add(this.get("areaId"));a.add(this.get("logisticsCompanyId"));a.add(this.get("logisticsCompanyName"));a.add(this.get("province"));a.add(this.get("city"));a.add(this.get("area"));a.add(this.get("note"));return a},getInvoiceFields:function(){var a=new Ext.util.MixedCollection();a.add(this.get("invoiceCd"));a.add(this.get("orderCd"));a.add(this.get("linkName"));a.add(this.get("deliveryType"));a.add(this.get("paymentType"));a.add(this.get("invoiceCd"));a.add(this.get("creatorEr"));a.add(this.get("ID"));return a},getInvoiceDetailFields:function(){var a=new Ext.util.MixedCollection();a.add(this.get("invoiceCd"));a.add(this.get("orderCd"));a.add(this.get("productName"));a.add(this.get("detailType"));a.add(this.get("sellTotalPrice"));a.add(this.get("realTotalPrice"));a.add(this.get("discount"));a.add(this.get("ID"));return a},getProductDetailFields:function(){var a=new Ext.util.MixedCollection();a.add(this.get("orderCd"));a.add(this.get("productName"));a.add(this.get("productCd"));a.add(this.get("productSize"));a.add(this.get("productColorCn"));a.add(this.get("productNum"));a.add(this.get("price"));a.add(this.get("ID"));return a},getBuyEnterListFields:function(){var a=new Ext.util.MixedCollection();a.add(this.get("buyCode"));a.add(this.get("buyStorageName"));a.add(this.get("enterState"));a.add(this.get("createDateFrom"));a.add(this.get("validateDate"));a.add(this.get("isBuy"));a.add(this.get("isDifference"));a.add(this.get("ID"));return a},getSellListFields:function(){var a=new Ext.util.MixedCollection();a.add(this.get("sellCode"));a.add(this.get("sellDate"));a.add(this.get("sellState"));a.add(this.get("orderTotalNum"));a.add(this.get("sellStorage"));a.add(this.get("sellCreateDate"));a.add(this.get("ID"));return a},getAllocateListFields:function(){var a=new Ext.util.MixedCollection();a.add(this.get("allocateCode"));a.add(this.get("allocateType"));a.add(this.get("foldStorage"));a.add(this.get("depositaryStorage"));a.add(this.get("allocateState"));a.add(this.get("allocateCreateDate"));a.add(this.get("ID"));return a},getOtherCheckListFields:function(){var a=new Ext.util.MixedCollection();a.add(this.get("checkCode"));a.add(this.get("checkType"));a.add(this.get("checkDate"));a.add(this.get("checkStorage"));a.add(this.get("checkState"));a.add(this.get("ID"));return a},getNewBuyEnterListFields:function(){var a=new Ext.util.MixedCollection();a.add(this.get("productCd"));a.add(this.get("productName"));a.add(this.get("productBrand"));a.add(this.get("productSize"));a.add(this.get("productSizeNo"));a.add(this.get("productColorCn"));a.add(this.get("productColorEn"));a.add(this.get("productColorNo"));a.add(this.get("productBarcode"));a.add(this.get("productPrice"));a.add(this.get("productCost"));a.add(this.get("productNote"));a.add(this.get("isProject"));a.add(this.get("projectNum"));a.add(this.get("realNum"));a.add(this.get("differenceNum"));a.add(this.get("buyDetailShelf"));a.add(this.get("updateStockNote"));a.add(this.get("ID"));a.add(this.get("buyId"));return a},getStockDetailListFields:function(){var a=new Ext.util.MixedCollection();a.add(this.get("productCd"));a.add(this.get("productName"));a.add(this.get("productBrand"));a.add(this.get("productSize"));a.add(this.get("productSizeNo"));a.add(this.get("productColorCn"));a.add(this.get("productColorEn"));a.add(this.get("productColorNo"));a.add(this.get("productBarcode"));a.add(this.get("productPrice"));a.add(this.get("productCost"));a.add(this.get("productNote"));a.add(this.get("batchNo"));a.add(this.get("productNum"));a.add(this.get("stockStorage"));a.add(this.get("stockShelf"));a.add(this.get("ID"));return a},getSellDetailListFields:function(){var a=new Ext.util.MixedCollection();a.add(this.getBaseConfigByName("orderCd"));a.add(this.get("outState"));a.add(this.get("productCd"));a.add(this.get("productName"));a.add(this.get("productBrand"));a.add(this.get("productSize"));a.add(this.get("productColorCn"));a.add(this.get("productBarcode"));a.add(this.get("outNum"));a.add(this.get("factOutNum"));a.add(this.get("outShelf"));a.add(this.get("ID"));a.add(this.get("sellId"));return a},getOhterDetailListFields:function(){var a=new Ext.util.MixedCollection();a.add(this.get("productCd"));a.add(this.get("productName"));a.add(this.get("productBrand"));a.add(this.get("productSize"));a.add(this.get("productColorCn"));a.add(this.get("productBarcode"));a.add(this.get("checkNum"));a.add(this.get("checkShelf"));a.add(this.get("checkDetailNote"));a.add(this.get("ID"));a.add(this.get("checkId"));return a},getAllocateDetailListFields:function(){var a=new Ext.util.MixedCollection();a.add(this.get("allocateCode"));a.add(this.get("productCd"));a.add(this.get("productName"));a.add(this.get("productBrand"));a.add(this.get("productSize"));a.add(this.get("productColorCn"));a.add(this.get("productBarcode"));a.add(this.get("productPrice"));a.add(this.get("productCost"));a.add(this.get("foldShelf"));a.add(this.get("depositaryShelf"));a.add(this.get("allocateNum"));a.add(this.get("realNum"));a.add(this.get("differenceNum"));a.add(this.get("isDifference"));return a},getOrderWarehouseFields:function(){var a=new Ext.util.MixedCollection();a.add(this.orderWarehouseConfig.get("orderCode"));a.add(this.orderWarehouseConfig.get("logisticsNo"));a.add(this.orderWarehouseConfig.get("logisticsType"));a.add(this.orderWarehouseConfig.get("linkName"));a.add(this.orderWarehouseConfig.get("linkMobile"));a.add(this.orderWarehouseConfig.get("logisticsState"));a.add(this.orderWarehouseConfig.get("productNote"));a.add(this.orderWarehouseConfig.get("productWeight"));a.add(this.orderWarehouseConfig.get("createDate"));a.add(this.orderWarehouseConfig.get("ID"));return a},getChoiceLogisticsFields:function(){var a=new Ext.util.MixedCollection();a.add(this.orderWarehouseConfig.get("orderCode"));a.add(this.orderWarehouseConfig.get("logisticsNo"));a.add(this.orderWarehouseConfig.get("logisticsState"));a.add(this.orderWarehouseConfig.get("linkName"));a.add(this.orderWarehouseConfig.get("linkAddress"));a.add(this.orderWarehouseConfig.get("linkMobile"));a.add(this.orderWarehouseConfig.get("productWeight"));a.add(this.orderWarehouseConfig.get("ID"));a.add(this.orderWarehouseConfig.get("productNote"));return a},getReturnRecordFields:function(){var a=new Ext.util.MixedCollection();a.add(this.orderWarehouseConfig.get("logisticsCd"));a.add(this.orderWarehouseConfig.get("orderCode"));a.add(this.orderWarehouseConfig.get("logisticsNo"));a.add(this.orderWarehouseConfig.get("logisticsState"));a.add(this.orderWarehouseConfig.get("logisticsType"));a.add(this.orderWarehouseConfig.get("linkName"));a.add(this.orderWarehouseConfig.get("linkAddress"));a.add(this.orderWarehouseConfig.get("linkMobile"));a.add(this.orderWarehouseConfig.get("productNote"));a.add(this.orderWarehouseConfig.get("productWeight"));a.add(this.orderWarehouseConfig.get("createDate"));a.add(this.orderWarehouseConfig.get("ID"));return a},getReturnRecordDetailFields:function(){var a=new Ext.util.MixedCollection();a.add(this.returnRecordDetailConfig.get("productName"));a.add(this.returnRecordDetailConfig.get("productBrand"));a.add(this.returnRecordDetailConfig.get("productBarcode"));a.add(this.returnRecordDetailConfig.get("productNum"));a.add(this.returnRecordDetailConfig.get("productColorCn"));a.add(this.returnRecordDetailConfig.get("note"));a.add(this.returnRecordDetailConfig.get("returnRecordDetailId"));return a},getChangeOrRefundFields:function(){var a=new Ext.util.MixedCollection();a.add(this.changeOrRefundConfig.get("orderCd"));a.add(this.changeOrRefundConfig.get("receiver"));a.add(this.changeOrRefundConfig.get("expressName"));a.add(this.changeOrRefundConfig.get("expressNo"));a.add(this.changeOrRefundConfig.get("receiverMobile"));a.add(this.changeOrRefundConfig.get("type"));a.add(this.changeOrRefundConfig.get("orderId"));a.add(this.changeOrRefundConfig.get("ID"));return a},getChangeOrRefundDetailFields:function(){var a=new Ext.util.MixedCollection();a.add(this.changeOrRefundDetailConfig.get("productName"));a.add(this.changeOrRefundDetailConfig.get("productNo"));a.add(this.changeOrRefundDetailConfig.get("colorCode"));a.add(this.changeOrRefundDetailConfig.get("colorName"));a.add(this.changeOrRefundDetailConfig.get("sizeCode"));a.add(this.changeOrRefundDetailConfig.get("orderCd"));a.add(this.changeOrRefundDetailConfig.get("bookNum"));a.add(this.changeOrRefundDetailConfig.get("swapOutColorCode"));a.add(this.changeOrRefundDetailConfig.get("swapOutColorName"));a.add(this.changeOrRefundDetailConfig.get("swapOutSizeCode"));a.add(this.changeOrRefundDetailConfig.get("swapOutSizeName"));a.add(this.changeOrRefundDetailConfig.get("swapOutNum"));a.add(this.changeOrRefundDetailConfig.get("chgOrRefudReason"));a.add(this.changeOrRefundDetailConfig.get("orderItmId"));a.add(this.changeOrRefundDetailConfig.get("ID"));return a},getInventoryFields:function(){var a=new Ext.util.MixedCollection();a.add(this.inventoryConfig.get("inventoryCode"));a.add(this.inventoryConfig.get("inventoryStorage"));a.add(this.inventoryConfig.get("operator"));a.add(this.inventoryConfig.get("inventoryDate"));a.add(this.inventoryConfig.get("isAdjust"));a.add(this.inventoryConfig.get("adjustState"));a.add(this.inventoryConfig.get("ID"));return a},getChoiceStockFields:function(){var a=new Ext.util.MixedCollection();a.add(this.getConfigByName("productName"));a.add(this.getConfigByName("productCd"));a.add(this.getConfigByName("productBrand"));a.add(this.getConfigByName("productSize"));a.add(this.getConfigByName("productSizeNo"));a.add(this.getConfigByName("productColorCn"));a.add(this.getConfigByName("productColorEn"));a.add(this.getConfigByName("productBarcode"));a.add(this.getConfigByName("productPrice"));a.add(this.getConfigByName("productCost"));a.add(this.getConfigByName("productNum"));a.add(this.getConfigByName("realNum"));a.add(this.getConfigByName("ID"));return a},getChoiceInventoryDetailFields:function(){var a=new Ext.util.MixedCollection();a.add(this.getInventoryDetailConfigByName("productName"));a.add(this.getInventoryDetailConfigByName("productCd"));a.add(this.getInventoryDetailConfigByName("productBrand"));a.add(this.getInventoryDetailConfigByName("productSize"));a.add(this.getInventoryDetailConfigByName("productColorCn"));a.add(this.getInventoryDetailConfigByName("productNum"));a.add(this.getInventoryDetailConfigByName("realNum"));a.add(this.getInventoryDetailConfigByName("differenceNum"));a.add(this.getInventoryDetailConfigByName("adjustNum"));a.add(this.getInventoryDetailConfigByName("ID"));return a},getAdjustFields:function(){var a=new Ext.util.MixedCollection();a.add(this.getAdjustConfigByName("adjustCode"));a.add(this.getAdjustConfigByName("inventoryCode"));a.add(this.getAdjustConfigByName("adjustStorag"));a.add(this.getAdjustConfigByName("operator"));a.add(this.getAdjustConfigByName("operateDate"));a.add(this.getAdjustConfigByName("adjustNote"));a.add(this.getAdjustConfigByName("ID"));return a},getAdjustDetailFields:function(){var a=new Ext.util.MixedCollection();a.add(this.getAdjustDetailConfigByName("productName"));a.add(this.getAdjustDetailConfigByName("productCd"));a.add(this.getAdjustDetailConfigByName("productBrand"));a.add(this.getAdjustDetailConfigByName("productSize"));a.add(this.getAdjustDetailConfigByName("productColorCn"));a.add(this.getAdjustDetailConfigByName("differenceNum"));a.add(this.getAdjustDetailConfigByName("adjustNum"));return a},getSignWarehouseFields:function(){var a=new Ext.util.MixedCollection();a.add(this.signWareHouseConfig.get("operator"));a.add(this.signWareHouseConfig.get("totalNum"));a.add(this.signWareHouseConfig.get("logisticsCompany"));a.add(this.signWareHouseConfig.get("subscriber"));a.add(this.signWareHouseConfig.get("signDate"));a.add(this.signWareHouseConfig.get("createDate"));a.add(this.signWareHouseConfig.get("note"));a.add(this.signWareHouseConfig.get("ID"));return a},addOrderConfig:function(b,a){this.orderWarehouseConfig.add(b,a)},addSignConfig:function(b,a){this.signWareHouseConfig.add(b,a)},addReturnRecordDetailConfig:function(b,a){this.returnRecordDetailConfig.add(b,a)},addChangeOrRefundConfig:function(b,a){this.changeOrRefundConfig.add(b,a)},addChangeOrRefundDetailConfig:function(b,a){this.changeOrRefundDetailConfig.add(b,a)},addInventoryConfig:function(b,a){this.inventoryConfig.add(b,a)},addInventoryDetailConfig:function(b,a){this.inventoryDetailConfig.add(b,a)},addAdjustConfig:function(b,a){this.adjustConfig.add(b,a)},addAdjustDetailConfig:function(b,a){this.adjustDetailConfig.add(b,a)}});Ext.define("Ext.Warehouse.FunctionNodes",{singleton:true,alternateClassName:"WFNS",functionNodes:[{text:"出入库管理",iconCls:"option",children:[{text:"采购入库单查询",id:"Ext.Warehouse.WarehouseDataStockPanel",leaf:true,iconCls:"fun"},{text:"销售出库单查询",id:"Ext.Warehouse.WarehouseDataSellPanel",leaf:true,iconCls:"fun"},{text:"销售订单查询",id:"Ext.Warehouse.WarehouseDataSellOrderPanel",leaf:true,iconCls:"fun"},{text:"销售订单验收",id:"Ext.Warehouse.WarehouseDataNewSellOrderPanel",leaf:true,iconCls:"fun"},{text:"调拨单查询",leaf:true,id:"Ext.Warehouse.WarehouseDataAllocatePanel",iconCls:"fun"},{text:"其它出入库单查询",leaf:true,id:"Ext.Warehouse.WarehouseDataOtherPanel",iconCls:"fun"},{text:"库存查询",leaf:true,id:"Ext.Warehouse.WarehouseDataStockDetailPanel",iconCls:"fun"}]},{text:"盘点管理",iconCls:"option",children:[{text:"盘点单查询",id:"Ext.Warehouse.InventoryPanel",leaf:true,iconCls:"fun"},{text:"平帐单查询",id:"Ext.Warehouse.AdjustPanel",leaf:true,iconCls:"fun"},{text:"仓库月结",leaf:true,iconCls:"fun"}]},{text:"其它信息管理",iconCls:"option",children:[{text:"仓库信息查询",id:"Ext.Warehouse.StoragPanel",leaf:true,iconCls:"fun"},{text:"货架信息查询",id:"Ext.Warehouse.ShelfPanel",leaf:true,iconCls:"fun"},{text:"条形码打印",leaf:true,iconCls:"fun"}]},{text:"物流管理",iconCls:"option",children:[{text:"物流单查询",leaf:true,id:"Ext.Warehouse.OrderWarehousePanel",iconCls:"fun"},{text:"发货订单查询",leaf:true,id:"Ext.Warehouse.InvoiceWarehousePanel",iconCls:"fun"},{text:"物流签收单查询",id:"Ext.Warehouse.SignWarehousePanel",leaf:true,iconCls:"fun"},{text:"退换货品记录单查询",id:"Ext.Warehouse.ReturnRecordPanel",leaf:true,iconCls:"fun"},{text:"退换货申请单查询",id:"Ext.Warehouse.ChangeOrRefundPanel",leaf:true,iconCls:"fun"},{text:"物流公司信息查询",id:"Ext.Warehouse.LogisticsCompanyPanel",leaf:true,iconCls:"fun"},{text:"配送区域信息查询",id:"Ext.Warehouse.LogisticsAreaPanel",leaf:true,iconCls:"fun"}]}]});Ext.define("Ext.Warehouse.WarehouseDataInfoPanel",{});Ext.define("Ext.Warehouse.StoragPanel",{extend:"Ext.panel.Panel",requires:["Ext.Warehouse.WarehouseDataElementsConfigs"],initComponent:function(){var a=this;this.border=false;this.frame=false;this.layout="fit";this.autoScroll=true;a.callParent();this.createQueryStoragPanel();new Ext.util.DelayedTask(function(){},this).delay(1000)},createQueryStoragPanel:function(){this.queryStoragForm=Ext.Easy.getEasyQueryForm(Ext.bind(this.doQuery,this),[warehouseDataElementsConfigs.getBaseConfigByName("storagCode"),warehouseDataElementsConfigs.getBaseConfigByName("storagShelfName"),warehouseDataElementsConfigs.getBaseConfigByName("storagType"),warehouseDataElementsConfigs.getBaseConfigByName("storagState")],2);var a={xtype:"easygridquery",viewPanelClass:"Ext.Storag.StoragPanel",noAutoLoad:true,region:"center",showBbar:true,showTbar:true,showUpateBtn:true,showRemoveBtn:true,parentPanel:this,overrideRemove:true,recordId:"storagId",subWindowWidth:midwindowWidth,subWindowHeight:windowHight,desktop:this.desktop,subWindowTitle:"新增仓库信息",baseParams:{queryId:"warehouse.mapper.StoragInfoMapper.queryStoragInfo"},fields:warehouseDataElementsConfigs.getStoragFields()};this.easyGrid=new Ext.ux.EasyGridQuery(a);this.add({layout:"border",items:[this.queryStoragForm,this.easyGrid]})},doQuery:function(){var b=this.easyGrid.getStore();var a=this.queryStoragForm.getForm().getValues();b.proxy.extraParams={queryId:b.proxy.extraParams.queryId};Ext.apply(b.proxy.extraParams,a);b.loadPage(1)},removeRecord:function(c,b,a){var e="storagAction!deleteStorag.action";var d=false;Ext.Easy.easyAjax(e,{storagId:b.get("storagId")},function(f,g){var h=Ext.decode(f.responseText);d=h.success},this,true);return d}});Ext.define("Ext.Storag.StoragPanel",{extend:"Ext.panel.Panel",initComponent:function(){var b=this;this.border=false;this.frame=false;this.autoScroll=true;b.callParent();var a=[warehouseDataElementsConfigs.getConfigByName("storagName"),warehouseDataElementsConfigs.getBaseConfigByName("storagType"),warehouseDataElementsConfigs.getBaseConfigByName("storagState"),warehouseDataElementsConfigs.getConfigByName("functionary"),warehouseDataElementsConfigs.getConfigByName("address"),warehouseDataElementsConfigs.getBaseConfigByName("phone"),warehouseDataElementsConfigs.getBaseConfigByName("shelfNum"),warehouseDataElementsConfigs.getBaseConfigByName("contentNum"),warehouseDataElementsConfigs.getBaseConfigByName("storagNote")];var c=Ext.Easy.getEasyForm({items:a,columnSize:2,fbar:[{text:"保存",iconCls:"accept",handler:Ext.bind(this.save,this)}]});this.baseInfoForm=c;this.add(c)},loadFormRecord:function(b,a){Ext.Easy.easyAjax("storagAction!queryStoragInfoById.action",{storagId:b},function(c,d){var f=Ext.decode(c.responseText);var e=f.storag;this.baseInfoForm.getForm().setValues(e)},this)},getRecordKey:function(){return"storagId"},save:function(){if(!Ext.Easy.isFormValid(this.baseInfoForm)){return}this.baseInfoForm.submit({url:"storagAction!addStorag.action",success:function(a,b){Ext.Easy.alertMsg(true);this.pwin.close();this.parentPanel.doQuery()},failure:function(a,b){Ext.Easy.alertMsg(false)},scope:this})},setParentWin:function(a){this.pwin=a}});Ext.define("Ext.Warehouse.ShelfPanel",{extend:"Ext.panel.Panel",initComponent:function(){var a=this;this.border=false;this.frame=false;this.layout="fit";this.autoScroll=true;a.callParent();this.createQueryShelfPanel();new Ext.util.DelayedTask(function(){},this).delay(1000)},createQueryShelfPanel:function(){this.queryShelfForm=Ext.Easy.getEasyQueryForm(Ext.bind(this.doQuery,this),[warehouseDataElementsConfigs.getBaseConfigByName("creator"),warehouseDataElementsConfigs.getBaseConfigByName("storagShelfName"),warehouseDataElementsConfigs.getBaseConfigByName("shelfName"),warehouseDataElementsConfigs.getBaseConfigByName("shelfState"),warehouseDataElementsConfigs.getBaseConfigByName("shelfId")],2);var a={xtype:"easygridquery",viewPanelClass:"Ext.Shelf.ShelfPanel",noAutoLoad:true,region:"center",showBbar:true,showTbar:true,showUpateBtn:true,showRemoveBtn:true,parentPanel:this,overrideRemove:true,recordId:"shelfId",subWindowWidth:midwindowWidth,subWindowHeight:windowHight,desktop:this.desktop,subWindowTitle:"新增货架信息",baseParams:{queryId:"warehouse.mapper.StoragInfoMapper.queryShelfInfo"},fields:warehouseDataElementsConfigs.getShelfFields()};this.easyGrid=new Ext.ux.EasyGridQuery(a);this.add({layout:"border",items:[this.queryShelfForm,this.easyGrid]})},doQuery:function(){var b=this.easyGrid.getStore();var a=this.queryShelfForm.getForm().getValues();b.proxy.extraParams={queryId:b.proxy.extraParams.queryId};Ext.apply(b.proxy.extraParams,a);b.loadPage(1)},removeRecord:function(c,b,a){var e="shelfAction!deleteShelf.action";var d=false;Ext.Easy.easyAjax(e,{shelfId:b.get("shelfId")},function(f,g){var h=Ext.decode(f.responseText);d=h.success},this,true);return d}});Ext.define("Ext.Shelf.ShelfPanel",{extend:"Ext.panel.Panel",requires:[],initComponent:function(){var b=this;this.border=false;this.frame=false;this.activeTab=0;this.isNew=true;b.callParent();var a=[warehouseDataElementsConfigs.getConfigByName("shelfName"),warehouseDataElementsConfigs.getConfigByName("creator"),warehouseDataElementsConfigs.getBaseConfigByName("shelfState"),warehouseDataElementsConfigs.getBaseConfigByName("createDate"),warehouseDataElementsConfigs.getBaseConfigByName("storagShelfName"),warehouseDataElementsConfigs.getBaseConfigByName("shelfId"),warehouseDataElementsConfigs.getBaseConfigByName("shelfNote")];var c=Ext.Easy.getEasyForm({items:a,columnSize:2,fbar:[{text:"保存",iconCls:"accept",handler:Ext.bind(this.save,this)}]});this.baseInfoForm=c;this.add(c)},loadFormRecord:function(b,a){Ext.Easy.easyAjax("shelfAction!queryShelfInfoById.action",{shelfId:b},function(c,d){var f=Ext.decode(c.responseText);var e=f.shelf;this.baseInfoForm.getForm().setValues(e)},this)},getRecordKey:function(){return"shelfId"},save:function(){if(!Ext.Easy.isFormValid(this.baseInfoForm)){return}this.baseInfoForm.submit({url:"shelfAction!addShelf.action",success:function(a,b){Ext.Easy.alertMsg(true);this.pwin.close();this.parentPanel.doQuery()},failure:function(a,b){Ext.Easy.alertMsg(false)},scope:this})},setParentWin:function(a){this.pwin=a}});Ext.define("Ext.Warehouse.WarehouseDataInventoryPanel",{});Ext.define("Ext.Warehouse.InventoryPanel",{extend:"Ext.panel.Panel",requires:["Ext.Warehouse.WarehouseDataElementsConfigs"],initComponent:function(){var a=this;this.border=false;this.frame=false;this.layout="fit";this.isNew=true;a.callParent();this.createInventoryPancel()},createInventoryPancel:function(){var a=[warehouseDataElementsConfigs.getInventoryConfigByName("inventoryStorage"),warehouseDataElementsConfigs.getInventoryConfigByName("operator"),warehouseDataElementsConfigs.getInventoryConfigByName("inventoryBeginDate"),warehouseDataElementsConfigs.getInventoryConfigByName("inventoryEndDate"),warehouseDataElementsConfigs.getInventoryConfigByName("isAdjust"),warehouseDataElementsConfigs.getInventoryConfigByName("adjustState")];var c=Ext.Easy.getEasyQueryForm(Ext.bind(this.doQuery,this),a,2);this.searchForm=c;var b={xtype:"easygridquery",viewPanelClass:"Ext.Warehouse.InventoryAddPanel",region:"center",noAutoLoad:true,showTbar:true,showBbar:true,showUpateBtn:false,showRemoveBtn:false,noNeedDbClick:true,otherBtn:[{btnValue:"生成平帐单",disPanel:"Ext.Warehouse.AdjustAddPanel",subWinTitle:"盘点明细列表"}],parentPanel:this,subWindowWidth:800,subWindowHeight:550,gridName:"inventoryGrid",subWindowTitle:"盘点详细信息",desktop:this.desktop,fields:warehouseDataElementsConfigs.getInventoryFields(),baseParams:{queryId:"warehouse.mapper.StoragInventoryMapper.queryInventorys"}};this.dataGrid=new Ext.ux.EasyGridQuery(b);this.add({layout:"border",items:[this.searchForm,this.dataGrid]})},doQuery:function(){var b=this.dataGrid.getStore();var a=this.searchForm.getForm().getValues();b.proxy.extraParams={queryId:b.proxy.extraParams.queryId};Ext.apply(b.proxy.extraParams,a);b.loadPage(1)}});Ext.define("Ext.Warehouse.AdjustPanel",{extend:"Ext.panel.Panel",requires:["Ext.Warehouse.WarehouseDataElementsConfigs"],initComponent:function(){var a=this;this.border=false;this.frame=false;this.layout="fit";this.isNew=true;a.callParent();this.createSearchPancel()},createSearchPancel:function(){var a=[warehouseDataElementsConfigs.getAdjustConfigByName("adjustStorag"),warehouseDataElementsConfigs.getAdjustConfigByName("operator"),warehouseDataElementsConfigs.getAdjustConfigByName("operateBeginDate"),warehouseDataElementsConfigs.getAdjustConfigByName("operateEndDate")];var c=Ext.Easy.getEasyQueryForm(Ext.bind(this.doQuery,this),a,2);this.searchForm=c;var b={xtype:"easygridquery",viewPanelClass:"Ext.Warehouse.AdjustDetailViewPanel",region:"center",noAutoLoad:true,showTbar:false,showBbar:true,showUpateBtn:false,showRemoveBtn:false,parentPanel:this,subWindowWidth:800,subWindowHeight:550,gridName:"inventoryGrid",subWindowTitle:"平帐明细列表",desktop:this.desktop,fields:warehouseDataElementsConfigs.getAdjustFields(),baseParams:{queryId:"warehouse.mapper.StoragInventoryMapper.queryAdjusts"}};this.dataGrid=new Ext.ux.EasyGridQuery(b);this.add({layout:"border",items:[this.searchForm,this.dataGrid]})},doQuery:function(){var b=this.dataGrid.getStore();var a=this.searchForm.getForm().getValues();b.proxy.extraParams={queryId:b.proxy.extraParams.queryId};Ext.apply(b.proxy.extraParams,a);b.loadPage(1)}});Ext.define("Ext.Warehouse.AdjustDetailViewPanel",{extend:"Ext.panel.Panel",requires:["Ext.Warehouse.WarehouseDataElementsConfigs"],initComponent:function(){var a=this;this.border=false;this.frame=false;this.layout="fit";this.isNew=true;a.callParent();this.createPancel()},createPancel:function(){var a={xtype:"easygridquery",region:"center",noAutoLoad:true,showTbar:false,showBbar:true,showUpateBtn:false,showRemoveBtn:false,parentPanel:this,subWindowWidth:800,subWindowHeight:550,gridName:"adjustDetailGrid",subWindowTitle:"",desktop:this.desktop,fields:warehouseDataElementsConfigs.getAdjustDetailFields()};this.dataGrid=new Ext.ux.EasyGridQuery(a);this.add(this.dataGrid)},loadFormRecord:function(b,a){Ext.Easy.easyAjax("inventoryAction!queryAdjustDetails.action",{adjustCode:b},function(c,d){var e=Ext.decode(c.responseText);this.dataGrid.getStore().loadData(e.detailList)},this)},getRecordKey:function(){return"adjustCode"}});Ext.define("Ext.Warehouse.InventoryAddPanel",{extend:"Ext.panel.Panel",requires:["Ext.ux.EasyGridCellEdit"],initComponent:function(){var h=this;this.border=false;this.frame=false;this.autoScroll=true;this.layout="border";h.callParent();var g=new Ext.create("Ext.form.field.Hidden",{name:"productCds"});this.productCdsObj=g;var i=new Ext.create("Ext.form.field.Hidden",{name:"productNames"});this.productNamesObj=i;var b=new Ext.create("Ext.form.field.Hidden",{name:"productBrands"});this.productBrandsObj=b;var c=new Ext.create("Ext.form.field.Hidden",{name:"productSizes"});this.productSizesObj=c;var k=new Ext.create("Ext.form.field.Hidden",{name:"productColorCns"});this.productColorCnsObj=k;var j=new Ext.create("Ext.form.field.Hidden",{name:"productNums"});this.productNumsObj=j;var d=new Ext.create("Ext.form.field.Hidden",{name:"realNums"});this.realNumsObj=d;var l=new Ext.create("Ext.form.field.Hidden",{name:"storages"});this.storagesObj=l;var f=[warehouseDataElementsConfigs.getInventoryConfigByName("inventoryNote"),g,i,b,c,k,j,d,l];var a=Ext.Easy.getEasyForm({items:f,region:"north",columnSize:2,fbar:[{text:"保存",iconCls:"accept",handler:Ext.bind(this.save,this)}]});this.baseInfoForm=a;var e={xtype:"easygridcelledit",noAutoLoad:false,needCheckboxColumn:true,noNeedDbClick:true,region:"center",showBbar:true,noShowAddBtn:true,showTbar:true,showRemoveBtn:true,parentPanel:this,subWindowWidth:midwindowWidth,subWindowHeight:windowHight,desktop:this.desktop,subWindowTitle:"",baseParams:{queryId:"warehouse.mapper.StoragStockMapper.queryStockListInfo"},fields:warehouseDataElementsConfigs.getChoiceStockFields()};this.stockGrid=new Ext.ux.EasyGridCellEdit(e);this.add(a);this.add(this.stockGrid)},save:function(){if(!Ext.Easy.isFormValid(this.baseInfoForm)){return}if(!this.stockGrid.getSelectedRecord()){return}Ext.Msg.show({title:"生成提示",msg:"您确定要生成盘点单吗？",buttons:Ext.Msg.YESNO,fn:Ext.bind(this.formSubmit,this),icon:Ext.window.MessageBox.QUESTION})},formSubmit:function(b){if(b=="no"){return}var a=/,/g;this.productCdsObj.setValue(this.stockGrid.getSelecteds("productCd").replace(a,"~"));this.productNamesObj.setValue(this.stockGrid.getSelecteds("productName").replace(a,"~"));this.productBrandsObj.setValue(this.stockGrid.getSelecteds("productBrand").replace(a,"~"));this.productSizesObj.setValue(this.stockGrid.getSelecteds("productSize").replace(a,"~"));this.productColorCnsObj.setValue(this.stockGrid.getSelecteds("productColorCn").replace(a,"~"));this.productNumsObj.setValue(this.stockGrid.getSelecteds("productNum").replace(a,"~"));this.realNumsObj.setValue(this.stockGrid.getSelecteds("realNum").replace(a,"~"));this.storagesObj.setValue(this.stockGrid.getSelecteds("storage").replace(a,"~"));this.baseInfoForm.submit({url:"inventoryAction!createInventory.action",success:function(c,d){Ext.Easy.alertMsg(true)},failure:function(c,d){Ext.Easy.alertMsg(false)}})}});Ext.define("Ext.Warehouse.AdjustAddPanel",{extend:"Ext.panel.Panel",requires:["Ext.ux.EasyGridCellEdit"],initComponent:function(){var d=this;this.border=false;this.frame=false;this.autoScroll=true;this.layout="border";d.callParent();var e=new Ext.create("Ext.form.field.Hidden",{name:"inventoryDetailIds"});this.inventoryDetailIdsObj=e;var c=new Ext.create("Ext.form.field.Hidden",{name:"adjustNums"});this.adjustNumsObj=c;var b=[warehouseDataElementsConfigs.getAdjustConfigByName("adjustStorag"),warehouseDataElementsConfigs.getAdjustConfigByName("adjustNote"),e,c];this.saveBtn=Ext.widget("button",{text:"生成平帐单",iconCls:"accept",handler:Ext.bind(this.createAdjust,this)});var f=Ext.Easy.getEasyForm({items:b,region:"north",columnSize:2,fbar:[this.saveBtn]});this.baseInfoForm=f;var a={xtype:"easygridcelledit",noAutoLoad:true,needCheckboxColumn:true,noNeedDbClick:true,region:"center",showBbar:true,noShowAddBtn:true,showTbar:true,showRemoveBtn:true,parentPanel:this,subWindowWidth:midwindowWidth,subWindowHeight:windowHight,desktop:this.desktop,subWindowTitle:"",fields:warehouseDataElementsConfigs.getChoiceInventoryDetailFields()};this.inventoryGrid=new Ext.ux.EasyGridCellEdit(a);this.add(f);this.add(this.inventoryGrid)},loadFormRecord:function(b,a){Ext.Easy.easyAjax("inventoryAction!queryInventoryAndDetail.action",{inventoryId:b},function(c,d){var e=Ext.decode(c.responseText);this.baseInfoForm.getForm().findField("adjustStorag").setValue(e.inventoryStorage);this.inventoryGrid.getStore().loadData(e.detailList);if(e.isAdjust==2){this.saveBtn.setVisible(false);alert("该平帐单已存在，无须再次生成!")}},this)},getRecordKey:function(){return"ID"},createAdjust:function(){if(!this.inventoryGrid.getSelectedRecord()){return}Ext.Msg.show({title:"生成提示",msg:"您确定要生成平帐单吗？",buttons:Ext.Msg.YESNO,fn:Ext.bind(this.formSubmit,this),icon:Ext.window.MessageBox.QUESTION})},formSubmit:function(b){if(b=="no"){return}var a=/,/g;this.inventoryDetailIdsObj.setValue(this.inventoryGrid.getSelecteds("ID").replace(a,"~"));this.adjustNumsObj.setValue(this.inventoryGrid.getSelecteds("adjustNum").replace(a,"~"));this.baseInfoForm.submit({url:"inventoryAction!createAdjust.action",success:function(c,d){Ext.Easy.alertMsg(true)},failure:function(c,d){Ext.Easy.alertMsg(false)}})}});Ext.define("Ext.Warehouse.WarehouseDataLogisticsPanel",{});Ext.define("Ext.Warehouse.LogisticsCompanyPanel",{extend:"Ext.panel.Panel",requires:["Ext.Warehouse.WarehouseDataElementsConfigs"],initComponent:function(){var a=this;this.border=false;this.frame=false;this.layout="fit";this.autoScroll=true;a.callParent();this.createQueryLogisticsCompanyPanel()},createQueryLogisticsCompanyPanel:function(){this.queryLogisticsCompanyForm=Ext.Easy.getEasyQueryForm(Ext.bind(this.doQuery,this),[warehouseDataElementsConfigs.getBaseConfigByName("areaLogisticsCompanyName"),warehouseDataElementsConfigs.getBaseConfigByName("logisticsCompanyAddress"),warehouseDataElementsConfigs.getBaseConfigByName("logisticsCompanyOne")],2);var a={xtype:"easygridquery",viewPanelClass:"Ext.LogisticsCompany.LogisticsCompanyPanel",noAutoLoad:true,region:"center",showBbar:true,showTbar:true,showUpateBtn:true,showRemoveBtn:true,parentPanel:this,overrideRemove:true,recordId:"logisticsCompanyId",subWindowWidth:midwindowWidth,subWindowHeight:windowHight,desktop:this.desktop,subWindowTitle:"物流公司信息详情",baseParams:{queryId:"warehouse.mapper.LogisticsCompanyMapper.queryLogisticsCompanyInfo"},fields:warehouseDataElementsConfigs.getLogisticsCompanyFields()};this.easyGrid=new Ext.ux.EasyGridQuery(a);this.add({layout:"border",items:[this.queryLogisticsCompanyForm,this.easyGrid]})},doQuery:function(){var b=this.easyGrid.getStore();var a=this.queryLogisticsCompanyForm.getForm().getValues();b.proxy.extraParams={queryId:b.proxy.extraParams.queryId};Ext.apply(b.proxy.extraParams,a);b.loadPage(1)},removeRecord:function(c,b,a){var e="logisticsCompanyAction!deleteLogisticsCompany.action";var d=false;Ext.Easy.easyAjax(e,{logisticsCompanyId:b.get("logisticsCompanyId")},function(f,g){var h=Ext.decode(f.responseText);d=h.success},this,true);return d}});Ext.define("Ext.Warehouse.LogisticsAreaPanel",{extend:"Ext.panel.Panel",initComponent:function(){var a=this;this.border=false;this.frame=false;this.layout="fit";this.autoScroll=true;a.callParent();this.createQueryAreaPanel();new Ext.util.DelayedTask(function(){},this).delay(1000)},createQueryAreaPanel:function(){this.queryAreaForm=Ext.Easy.getEasyQueryForm(Ext.bind(this.doQuery,this),[warehouseDataElementsConfigs.getBaseConfigByName("province"),warehouseDataElementsConfigs.getBaseConfigByName("city"),warehouseDataElementsConfigs.getBaseConfigByName("areaLogisticsCompanyName")],2);var a={xtype:"easygridquery",viewPanelClass:"Ext.LogisticsArea.LogisticsAreaPanel",noAutoLoad:true,region:"center",showBbar:true,showTbar:true,showUpateBtn:true,showRemoveBtn:true,parentPanel:this,overrideRemove:true,recordId:"areaId",subWindowWidth:midwindowWidth,subWindowHeight:windowHight,desktop:this.desktop,subWindowTitle:"配送地区信息详情",baseParams:{queryId:"warehouse.mapper.LogisticsCompanyMapper.queryLogisticsArea"},fields:warehouseDataElementsConfigs.getLogisticsAreaFields()};this.easyGrid=new Ext.ux.EasyGridQuery(a);this.add({layout:"border",items:[this.queryAreaForm,this.easyGrid]})},doQuery:function(){var b=this.easyGrid.getStore();var a=this.queryAreaForm.getForm().getValues();b.proxy.extraParams={queryId:b.proxy.extraParams.queryId};Ext.apply(b.proxy.extraParams,a);b.loadPage(1)},removeRecord:function(c,b,a){var e="logisticsAreaAction!deleteLogisticsArea.action";var d=false;Ext.Easy.easyAjax(e,{areaId:b.get("areaId")},function(f,g){var h=Ext.decode(f.responseText);d=h.success},this,true);return d}});Ext.define("Ext.LogisticsArea.LogisticsAreaPanel",{extend:"Ext.panel.Panel",initComponent:function(){var b=this;this.border=false;this.frame=false;this.activeTab=0;this.isNew=true;b.callParent();var a=[warehouseDataElementsConfigs.getBaseConfigByName("areaLogisticsCompanyName"),warehouseDataElementsConfigs.getConfigByName("province"),warehouseDataElementsConfigs.getConfigByName("city"),warehouseDataElementsConfigs.getConfigByName("area"),warehouseDataElementsConfigs.getBaseConfigByName("note"),warehouseDataElementsConfigs.getBaseConfigByName("areaId")];var c=Ext.Easy.getEasyForm({items:a,columnSize:2,fbar:[{text:"保存",iconCls:"accept",handler:Ext.bind(this.save,this)}]});this.baseInfoForm=c;this.add(c)},loadFormRecord:function(b,a){Ext.Easy.easyAjax("logisticsAreaAction!queryLogisticsAreaById.action",{areaId:b},function(c,d){var f=Ext.decode(c.responseText);var e=f.logisticsArea;this.baseInfoForm.getForm().setValues(e)},this)},getRecordKey:function(){return"areaId"},save:function(){if(!Ext.Easy.isFormValid(this.baseInfoForm)){return}this.baseInfoForm.submit({url:"logisticsAreaAction!addLogisticsArea.action",success:function(a,b){Ext.Easy.alertMsg(true);this.pwin.close();this.parentPanel.doQuery()},failure:function(a,b){Ext.Easy.alertMsg(false)},scope:this})},setParentWin:function(a){this.pwin=a}});Ext.define("Ext.LogisticsCompany.LogisticsCompanyPanel",{extend:"Ext.panel.Panel",initComponent:function(){var b=this;this.border=false;this.frame=false;this.activeTab=0;this.isNew=true;b.callParent();var a=[warehouseDataElementsConfigs.getConfigByName("logisticsCompanyName"),warehouseDataElementsConfigs.getBaseConfigByName("logisticsCompanyAddress"),warehouseDataElementsConfigs.getBaseConfigByName("logisticsCompanyOne"),warehouseDataElementsConfigs.getBaseConfigByName("logisticsCompanyTwo"),warehouseDataElementsConfigs.getBaseConfigByName("logisticsCompanyMoblie"),warehouseDataElementsConfigs.getBaseConfigByName("logisticsCompanyTelephone"),warehouseDataElementsConfigs.getBaseConfigByName("logisticsCompanyId"),{xtype:"label"},warehouseDataElementsConfigs.getConfigByName("price"),{xtype:"label"},warehouseDataElementsConfigs.getBaseConfigByName("logisticsCompanyNote")];var c=Ext.Easy.getEasyForm({items:a,columnSize:2,fbar:[{text:"保存",iconCls:"accept",handler:Ext.bind(this.save,this)}]});this.baseInfoForm=c;this.add(c)},loadFormRecord:function(b,a){Ext.Easy.easyAjax("logisticsCompanyAction!queryLogisticsCompanyInfoById.action",{logisticsCompanyId:b},function(c,d){var f=Ext.decode(c.responseText);var e=f.logisticsCompany;this.baseInfoForm.getForm().setValues(e)},this)},getRecordKey:function(){return"logisticsCompanyId"},save:function(){if(!Ext.Easy.isFormValid(this.baseInfoForm)){return}this.baseInfoForm.submit({url:"logisticsCompanyAction!addLogisticsCompany.action",success:function(a,b){Ext.Easy.alertMsg(true);this.pwin.close();this.parentPanel.doQuery()},failure:function(a,b){Ext.Easy.alertMsg(false)},scope:this})},setParentWin:function(a){this.pwin=a}});Ext.define("Ext.Warehouse.OrderWarehousePanel",{extend:"Ext.panel.Panel",requires:["Ext.Warehouse.WarehouseDataElementsConfigs"],initComponent:function(){var a=this;this.border=false;this.frame=false;this.layout="fit";a.callParent();this.createOrderWarehouse()},createOrderWarehouse:function(){var c=[warehouseDataElementsConfigs.getOrderConfigByName("orderCode"),warehouseDataElementsConfigs.getOrderConfigByName("linkName"),warehouseDataElementsConfigs.getOrderConfigByName("logisticsNo"),warehouseDataElementsConfigs.getOrderConfigByName("linkMobile"),warehouseDataElementsConfigs.getOrderConfigByName("logisticsType"),warehouseDataElementsConfigs.getOrderConfigByName("queryOrderDate"),warehouseDataElementsConfigs.getOrderConfigByName("logisticsState")];var b=Ext.Easy.getEasyQueryForm(Ext.bind(this.doQueryOrder,this),c,2);this.OrderForm=b;var a={region:"center",xtype:"easygrid",fields:warehouseDataElementsConfigs.getOrderWarehouseFields(),viewPanelClass:"Ext.Warehouse.LogisticsEditPanel",recordId:"ID",noAutoLoad:true,showTbar:true,showBbar:true,showUpateBtn:true,parentPanel:this,formItemsReadOnly:true,gridName:"Order",subWindowTitle:"物流单详情",desktop:this.desktop,baseParams:{queryId:"warehouse.mapper.StoragLogisticsMapper.queryLogisticsByTerm"}};this.OrderGrid=new Ext.ux.EasyGridQuery(a);this.add({layout:"border",items:[this.OrderForm,this.OrderGrid]})},doQueryOrder:function(){Ext.Easy.doEasyQuery(this.OrderGrid,this.OrderForm)}});Ext.define("Ext.Warehouse.LogisticsEditPanel",{extend:"Ext.panel.Panel",constructor:function(a){this.saveBtn=Ext.widget("button",{text:"保存",iconCls:"accept",handler:Ext.bind(this.save,this)});this.dockedItems=[{xtype:"toolbar",dock:"bottom",ui:"footer",layout:{pack:"center"},items:[this.saveBtn]}];Ext.apply(this,a);this.callParent()},initComponent:function(){var b=this;this.border=false;this.frame=false;this.autoScroll=true;b.callParent();var a=[warehouseDataElementsConfigs.getOrderConfigByNameValid("orderCode"),warehouseDataElementsConfigs.getOrderConfigByNameValid("logisticsType"),warehouseDataElementsConfigs.getOrderConfigByNameValid("logisticsNo"),warehouseDataElementsConfigs.getOrderConfigByName("logisticsState"),warehouseDataElementsConfigs.getOrderConfigByNameValid("linkName"),warehouseDataElementsConfigs.getOrderConfigByNameValid("linkAddress"),warehouseDataElementsConfigs.getOrderConfigByNameValid("linkMobile"),warehouseDataElementsConfigs.getOrderConfigByName("creator"),warehouseDataElementsConfigs.getOrderConfigByNameValid("productWeight"),warehouseDataElementsConfigs.getOrderConfigByName("createDate"),warehouseDataElementsConfigs.getOrderConfigByName("productNote"),warehouseDataElementsConfigs.getOrderConfigByName("ID")];var c=Ext.Easy.getEasyForm({items:a,columnSize:2,region:"north"});this.baseInfoForm=c;this.add(c)},loadFormRecord:function(b,a){Ext.Easy.easyAjax("logisticsAction!queryLogisticsById.action",{logisticsId:b},function(c,d){var f=Ext.decode(c.responseText);this.baseInfoForm.getForm().setValues(f.logistics);this.baseInfoForm.getForm().findField("orderCode").setDisabled(true);this.baseInfoForm.getForm().findField("logisticsState").setDisabled(true);this.baseInfoForm.getForm().findField("logisticsType").setDisabled(true);this.baseInfoForm.getForm().findField("creator").setDisabled(true);this.baseInfoForm.getForm().findField("createDate").setDisabled(true);var e=f.logistics.logisticsState;if(e==2){this.saveBtn.setVisible(false)}},this)},createRecord:function(){this.baseInfoForm.getForm().findField("logisticsState").setDisabled(true);this.baseInfoForm.getForm().findField("creator").setDisabled(true);this.baseInfoForm.getForm().findField("createDate").setDisabled(true)},getRecordKey:function(){return"ID"},setParentWin:function(a){this.pwin=a},save:function(){if(!Ext.Easy.isFormValid(this.baseInfoForm)){return}this.baseInfoForm.submit({url:"logisticsAction!updateLogistics.action",success:function(a,b){Ext.Easy.alertMsg(true);this.pwin.close();this.parentPanel.doQueryOrder()},failure:function(a,b){Ext.Easy.alertMsg(false)},scope:this})}});Ext.define("Ext.Warehouse.ReturnRecordPanel",{extend:"Ext.panel.Panel",requires:["Ext.Warehouse.WarehouseDataElementsConfigs"],initComponent:function(){var a=this;this.border=false;this.frame=false;this.layout="fit";this.isNew=true;a.callParent();this.createReturnRecordPancel()},createReturnRecordPancel:function(){var c=[warehouseDataElementsConfigs.getOrderConfigByName("orderCode"),warehouseDataElementsConfigs.getOrderConfigByName("logisticsNo"),warehouseDataElementsConfigs.getOrderConfigByName("linkName"),warehouseDataElementsConfigs.getOrderConfigByName("returnSignState"),warehouseDataElementsConfigs.getOrderConfigByName("queryOrderDate")];var b=Ext.Easy.getEasyQueryForm(Ext.bind(this.doQuery,this),c,2);this.returnRecordForm=b;var a={xtype:"easygridquery",viewPanelClass:"Ext.Warehouse.ReturnEditPanel",region:"center",noAutoLoad:true,showTbar:true,showBbar:true,showUpateBtn:true,showRemoveBtn:false,parentPanel:this,subWindowWidth:800,subWindowHeight:550,gridName:"returnRecordGrid",subWindowTitle:"退换货记录详情",desktop:this.desktop,fields:warehouseDataElementsConfigs.getReturnRecordFields(),baseParams:{queryId:"warehouse.mapper.StoragLogisticsMapper.queryLogisticsReturnRecords"}};this.returnRecordGrid=new Ext.ux.EasyGridQuery(a);this.add({layout:"border",items:[this.returnRecordForm,this.returnRecordGrid]})},doQuery:function(){var b=this.returnRecordGrid.getStore();var a=this.returnRecordForm.getForm().getValues();b.proxy.extraParams={queryId:b.proxy.extraParams.queryId};Ext.apply(b.proxy.extraParams,a);b.loadPage(1)}});Ext.define("Ext.Warehouse.ReturnEditPanel",{extend:"Ext.panel.Panel",constructor:function(a){this.saveBtn=Ext.widget("button",{text:"保存",iconCls:"accept",handler:Ext.bind(this.save,this)});this.dockedItems=[{xtype:"toolbar",dock:"bottom",ui:"footer",layout:{pack:"center"},items:[this.saveBtn]}];Ext.apply(this,a);this.callParent()},initComponent:function(){var d=this;this.border=false;this.frame=false;this.autoScroll=true;this.layout="border";d.callParent();var c=Ext.widget("hidden",warehouseDataElementsConfigs.getOrderConfigByName("ID"));this.logisticsIdObj=c;var a=[warehouseDataElementsConfigs.getOrderConfigByNameValid("logisticsNo"),warehouseDataElementsConfigs.getOrderConfigByName("orderCode"),warehouseDataElementsConfigs.getOrderConfigByName("linkName"),warehouseDataElementsConfigs.getOrderConfigByName("linkAddress"),warehouseDataElementsConfigs.getOrderConfigByName("linkMobile"),warehouseDataElementsConfigs.getOrderConfigByName("productWeight"),warehouseDataElementsConfigs.getOrderConfigByName("productNote"),c];var e=Ext.Easy.getEasyForm({items:a,region:"north",columnSize:2});this.baseInfoForm=e;var b={xtype:"easygrid",noAutoLoad:true,region:"center",showTbar:true,parentPanel:this,subWindowTitle:"退换货记录明细详情",fields:warehouseDataElementsConfigs.getReturnRecordDetailFields()};this.detailGrid=new Ext.ux.EasyGrid(b);this.add(e,this.detailGrid)},removeRecord:function(c,b,a){var e="logisticsAction!deleteReturnRecordDetail.action";var d=false;Ext.Easy.easyAjax(e,{detailId:b.get("returnRecordDetailId")},function(f,g){var h=Ext.decode(f.responseText);d=h.success},this,true);return d},loadFormRecord:function(b,a){Ext.Easy.easyAjax("logisticsAction!queryReturnRecordByLogisId.action",{ID:b},function(c,d){var e=Ext.decode(c.responseText);this.pid=e.logistics.ID;this.baseInfoForm.getForm().setValues(e.logistics);this.detailGrid.getStore().loadData(e.returnDetailList)},this)},getRecordKey:function(){return"ID"},save:function(){if(!Ext.Easy.isFormValid(this.baseInfoForm)){return}var c={};var b=this.detailGrid;var a=Ext.Easy.getRecordsToParams(b.getStore(),c,"KID",true,b);if(a[0]<1){Ext.Msg.alert("提示:","请增加退换货记录明细信息！");return}c.itemNewCount=a[0];c.itemModefiyCount=a[1];c.logisticsId=this.pid;this.baseInfoForm.submit({params:c,url:"logisticsAction!saveReturnRecord.action",success:function(d,e){Ext.Easy.alertMsg(true);this.pwin.close();this.parentPanel.doQuery()},failure:function(d,e){Ext.Easy.alertMsg(false)},scope:this})},setParentWin:function(a){this.pwin=a}});Ext.define("Ext.Warehouse.ChangeOrRefundPanel",{extend:"Ext.panel.Panel",requires:["Ext.Warehouse.WarehouseDataElementsConfigs"],initComponent:function(){var a=this;this.border=false;this.frame=false;this.layout="fit";this.isNew=true;a.callParent();this.createChangeOrRefundPancel()},createChangeOrRefundPancel:function(){var b=[warehouseDataElementsConfigs.getChangeOrRefundConfigName("orderCd"),warehouseDataElementsConfigs.getChangeOrRefundConfigName("receiver"),warehouseDataElementsConfigs.getChangeOrRefundConfigName("expressName"),warehouseDataElementsConfigs.getChangeOrRefundConfigName("receiverMobile"),warehouseDataElementsConfigs.getChangeOrRefundConfigName("expressNo")];var a=Ext.Easy.getEasyQueryForm(Ext.bind(this.doQuery,this),b,2);this.changeOrRefundForm=a;var c={xtype:"easygridquery",viewPanelClass:"Ext.Warehouse.ChangeOrRefundDetailPanel",region:"center",noAutoLoad:true,showTbar:false,showBbar:true,showUpateBtn:true,showRemoveBtn:false,parentPanel:this,subWindowWidth:800,subWindowHeight:550,gridName:"changeOrRefundGrid",subWindowTitle:"退换货申请详情",desktop:this.desktop,fields:warehouseDataElementsConfigs.getChangeOrRefundFields(),baseParams:{queryId:"customercenter.mapper.ChangOrRefundMapper.queryChangOrRefund"}};this.changeOrRefundGrid=new Ext.ux.EasyGridQuery(c);this.add({layout:"border",items:[this.changeOrRefundForm,this.changeOrRefundGrid]})},doQuery:function(){var b=this.changeOrRefundGrid.getStore();var a=this.changeOrRefundForm.getForm().getValues();b.proxy.extraParams={queryId:b.proxy.extraParams.queryId};Ext.apply(b.proxy.extraParams,a);b.loadPage(1)}});Ext.define("Ext.Warehouse.ChangeOrRefundDetailPanel",{extend:"Ext.panel.Panel",initComponent:function(){var g=this;this.border=false;this.frame=false;this.autoScroll=true;this.layout="border";g.callParent();var f={region:"center",xtype:"easygrid",fields:warehouseDataElementsConfigs.getChangeOrRefundDetailFields(),recordId:"ID",parentPanel:this,formItemsReadOnly:true,gridName:"returnRecordDetail",subWindowTitle:"退换货申请明细",data:[{}],desktop:this.desktop};this.changeOrRefundDetailGrid=new Ext.ux.EasyGrid(f);var b=new Ext.create("Ext.form.field.TextArea",{labelAlign:"right",fieldLabel:"异常签收描述",name:"toCCRemark",width:400});var i=new Ext.create("Ext.form.field.Hidden",{name:"bindId"});var h=new Ext.create("Ext.form.field.Hidden",{name:"orderId"});var c=new Ext.create("Ext.form.field.Hidden",{name:"orderCd"});var k=new Ext.create("Ext.form.field.Hidden",{name:"refundType"});var d=new Ext.create("Ext.form.field.Hidden",{name:"orderItmIds"});var j=new Ext.create("Ext.form.field.Hidden",{name:"isDiffer"});var e=[b,i,h,c,k,d,j];var a=Ext.Easy.getEasyForm({items:e,region:"north",columnSize:2,fbar:[{text:"正常签收",iconCls:"accept",handler:Ext.bind(this.sign,this,[0])},{text:"异常签收",iconCls:"accept",handler:Ext.bind(this.sign,this,[1])}]});this.baseInfoForm=a;this.add(this.changeOrRefundDetailGrid);this.add(this.baseInfoForm)},loadFormRecord:function(b,a){Ext.Easy.easyAjax("logisticsAction!queryChangOrRefundDetailByChgId.action",{ID:b,orderId:a.get("orderId"),orderCd:a.get("orderCd"),refundType:a.get("type")},function(c,d){var e=Ext.decode(c.responseText);this.baseInfoForm.form.findField("bindId").setValue(e.bindId);this.baseInfoForm.form.findField("orderId").setValue(e.orderId);this.baseInfoForm.form.findField("orderCd").setValue(e.orderCd);this.baseInfoForm.form.findField("refundType").setValue(e.refundType);this.changeOrRefundDetailGrid.getStore().loadData(e.detailList)},this)},getRecordKey:function(){return"ID"},sign:function(a){if(a==1){if(this.baseInfoForm.form.findField("toCCRemark").getValue()==""){alert("请填写异常签收描述信息!");return}this.baseInfoForm.form.findField("isDiffer").setValue(1)}else{this.baseInfoForm.form.findField("isDiffer").setValue(0)}var b="";this.changeOrRefundDetailGrid.getStore().each(function(c){b+=c.get("orderItmId")+","});if(b!=""){b=b.substring(0,b.length-1)}this.baseInfoForm.form.findField("orderItmIds").setValue(b);this.baseInfoForm.submit({url:"logisticsAction!signChangOrRefund.action",success:function(c,d){Ext.Easy.alertMsg(true)},failure:function(c,d){Ext.Easy.alertMsg(false)}})}});Ext.define("Ext.Warehouse.SignWarehousePanel",{extend:"Ext.panel.Panel",requires:["Ext.Warehouse.WarehouseDataElementsConfigs"],initComponent:function(){var a=this;this.border=false;this.frame=false;this.layout="fit";a.callParent();this.createSignWarehouse()},createSignWarehouse:function(){var b=[warehouseDataElementsConfigs.getSignConfigName("operator"),warehouseDataElementsConfigs.getSignConfigName("logisticsCompany"),warehouseDataElementsConfigs.getSignConfigName("queryCreateDate"),warehouseDataElementsConfigs.getSignConfigName("querySignDate")];var a=Ext.Easy.getEasyQueryForm(Ext.bind(this.doQuerySign,this),b,2);this.SignForm=a;var c={region:"center",xtype:"easygrid",noAutoLoad:true,showTbar:true,showBbar:true,showUpateBtn:false,showRemoveBtn:false,overrideRemove:true,viewPanelClass:"Ext.Warehouse.addSignWarehousePanel",parentPanel:this,subWindowWidth:800,subWindowHeight:550,gridName:"Sign",subWindowTitle:"物流签收单查询",desktop:this.desktop,baseParams:{queryId:"warehouse.mapper.StoragLogisticsMapper.queryLogisticsSignByTerm"},fields:warehouseDataElementsConfigs.getSignWarehouseFields()};this.SignGrid=new Ext.ux.EasyGridQuery(c);this.add({layout:"border",items:[this.SignForm,this.SignGrid]})},doQuerySign:function(){Ext.Easy.doEasyQuery(this.SignGrid,this.SignForm)}});Ext.define("Ext.Warehouse.addSignWarehousePanel",{extend:"Ext.panel.Panel",requires:["Ext.Warehouse.WarehouseDataElementsConfigs"],initComponent:function(){var a=this;this.border=false;this.frame=false;this.layout="fit";a.callParent();this.createAddSignWarehouse()},createAddSignWarehouse:function(){var f=new Ext.create("Ext.form.field.Text",{labelAlign:"right",fieldLabel:"快递单号",name:"logisticsNo",labelStyle:"color:red"});f.on("blur",Ext.bind(this.loadOrder,this));this.logistNoObj=f;var a=new Ext.create("Ext.form.field.Hidden",{name:"logisticsIds"});this.logisticsIdsObj=a;var c=[warehouseDataElementsConfigs.getSignConfigNameValid("logisticsCompany"),warehouseDataElementsConfigs.getSignConfigNameValid("subscriber"),warehouseDataElementsConfigs.getSignConfigNameValid("signDate"),warehouseDataElementsConfigs.getSignConfigNameValid("operator"),warehouseDataElementsConfigs.getSignConfigName("note"),f,a];var d=Ext.Easy.getEasyForm({items:c,columnSize:2,region:"north",labelAlign:"right",labelWidth:80,width:"100%"});this.addSignForm=d;var b={region:"center",xtype:"easygrid",fields:warehouseDataElementsConfigs.getChoiceLogisticsFields(),noAutoLoad:true,showTbar:true,noShowUpdateBtn:true,showRemoveBtn:true,parentPanel:this,subWindowWidth:800,subWindowHeight:550,gridName:"addSign",subWindowTitle:"添加物流签收单",desktop:this.desktop};this.addSignGrid=new Ext.ux.EasyGrid(b);this.saveBtn=Ext.widget("button",{text:"保存",iconCls:"accept",handler:Ext.bind(this.save,this)});var e=Ext.create("Ext.form.Panel",{layout:"border",border:false,items:[this.addSignForm,this.addSignGrid],fbar:[this.saveBtn]});this.baseInfoForm=e;this.add(this.baseInfoForm)},loadFormRecord:function(b,a){Ext.Easy.easyAjax("logisticsAction!queryLogisticsBySignId.action",{ID:b},function(c,d){var e=Ext.decode(c.responseText);this.addSignGrid.getDockedComponent(1).hide();this.saveBtn.setVisible(false);this.logistNoObj.setVisible(false);this.addSignGrid.setFormBtnsVisible(false,false);this.addSignForm.form.setValues(e.logisticsSign);this.addSignGrid.store.loadData(e.logisticsList)},this)},getRecordKey:function(){return"ID"},save:function(){if(!Ext.Easy.isFormValid(this.baseInfoForm)){return}var b=this.addSignGrid.getStore().getCount();if(b==0){Ext.Msg.alert("提示:","请加载要签收的物流单!");return}var a="";this.addSignGrid.getStore().each(function(c){a+=c.get("ID")+"_"});if(a!=""){a=a.substring(0,a.length-1)}this.logisticsIdsObj.setValue(a);this.addSignForm.submit({url:"logisticsAction!addLogisticsSign.action",success:function(c,d){Ext.Easy.alertMsg(true);this.pwin.close();this.parentPanel.doQuerySign()},failure:function(c,d){Ext.Easy.alertMsg(false)},scope:this})},setParentWin:function(a){this.pwin=a},loadOrder:function(){var a=this.logistNoObj.value;if(a==undefined||Ext.String.trim(a)==""){Ext.Msg.alert("提示:","请输入正确的快递单号！");return}else{a=Ext.String.trim(a)}var b=this.addSignGrid.getStore().findRecord("logisticsNo",a);if(b!=null){return}Ext.Easy.easyAjax("logisticsAction!queryLogisticsByLogisNo.action",{logisticsNo:a},function(c,d){var f=Ext.decode(c.responseText);if(f.logistics!=null){var e=f.logistics.logisticsState;if(e==1){this.addSignGrid.getStore().add(f.logistics)}else{Ext.Msg.alert("提示:","物流单的状态不正确，请核对该物流单状态是否正确！");return}}else{Ext.Msg.alert("提示:","查询不到相应的物流单信息，请核对快递单号是否正确！");return}},this)}});Ext.define("Ext.Warehouse.InvoiceWarehousePanel",{extend:"Ext.panel.Panel",initComponent:function(){var a=this;this.border=false;this.frame=false;this.layout="fit";this.isNew=true;a.callParent();this.createInvoicePanel()},createInvoicePanel:function(){var b=[warehouseDataElementsConfigs.getBaseConfigByName("invoiceCd"),warehouseDataElementsConfigs.getBaseConfigByName("orderCd"),warehouseDataElementsConfigs.getBaseConfigByName("invoiceState"),warehouseDataElementsConfigs.getBaseConfigByName("linkName"),warehouseDataElementsConfigs.getBaseConfigByName("creatorEr")];var c=Ext.Easy.getEasyQueryForm(Ext.bind(this.doQuery,this),b,2);this.queryInvoiceForm=c;var a={xtype:"easygridquery",viewPanelClass:"Ext.Warehouse.InvoicePanel",region:"center",noAutoLoad:true,showTbar:false,showBbar:false,showUpateBtn:true,showRemoveBtn:false,parentPanel:this,subWindowWidth:800,subWindowHeight:550,gridName:"this.easyGrid",subWindowTitle:"发货订单详情",desktop:this.desktop,fields:warehouseDataElementsConfigs.getInvoiceFields(),baseParams:{queryId:"warehouse.mapper.StoragLogisticsMapper.queryInvoice"}};this.easyGrid=new Ext.ux.EasyGridQuery(a);this.add({layout:"border",items:[this.queryInvoiceForm,this.easyGrid]})},doQuery:function(){var b=this.easyGrid.getStore();var a=this.queryInvoiceForm.getForm().getValues();b.proxy.extraParams={queryId:b.proxy.extraParams.queryId};Ext.apply(b.proxy.extraParams,a);b.loadPage(1)}});Ext.define("Ext.Warehouse.InvoicePanel",{extend:"Ext.panel.Panel",initComponent:function(){var d=this;this.autoScroll=true;d.callParent();var b=[warehouseDataElementsConfigs.getConfigByName("invoiceCd"),warehouseDataElementsConfigs.getConfigByName("orderCd"),warehouseDataElementsConfigs.getConfigByName("invoiceState"),warehouseDataElementsConfigs.getConfigByName("invoiceCreateDate"),warehouseDataElementsConfigs.getConfigByName("paymentType"),warehouseDataElementsConfigs.getConfigByName("productTotalPrice"),warehouseDataElementsConfigs.getConfigByName("creatorEr"),warehouseDataElementsConfigs.getConfigByName("deliveryTotalPrice"),warehouseDataElementsConfigs.getConfigByName("consignor"),warehouseDataElementsConfigs.getConfigByName("giftTotalPrice"),warehouseDataElementsConfigs.getConfigByName("reviewer"),warehouseDataElementsConfigs.getConfigByName("discountTotalPrice"),warehouseDataElementsConfigs.getConfigByName("packer"),warehouseDataElementsConfigs.getConfigByName("point"),warehouseDataElementsConfigs.getConfigByName("stamper"),warehouseDataElementsConfigs.getConfigByName("realTotalPrice"),warehouseDataElementsConfigs.getConfigByName("linkName"),warehouseDataElementsConfigs.getConfigByName("linkMoblie"),warehouseDataElementsConfigs.getConfigByName("linkAddress"),warehouseDataElementsConfigs.getConfigByName("linkTelephone"),warehouseDataElementsConfigs.getConfigByName("linkPostcode"),warehouseDataElementsConfigs.getConfigByName("deliveryNote"),warehouseDataElementsConfigs.getConfigByName("deliveryType"),warehouseDataElementsConfigs.getConfigByName("deliveryDate"),warehouseDataElementsConfigs.getConfigByName("Othernote")];var a=Ext.Easy.getEasyForm({items:b,columnSize:2,region:"north"});this.newInvoiceForm=a;var c={xtype:"easygrid",noAutoLoad:true,region:"center",height:120,showBbar:false,showTbar:false,formItemsReadOnly:true,parentPanel:this,subWindowTitle:"发货订单明细详情",fields:warehouseDataElementsConfigs.getInvoiceDetailFields()};this.easyGrid=new Ext.ux.EasyGrid(c);var e={xtype:"easygrid",noAutoLoad:true,region:"south",height:120,showBbar:false,showTbar:false,formItemsReadOnly:true,parentPanel:this,subWindowTitle:"发货货品明细详情",fields:warehouseDataElementsConfigs.getProductDetailFields()};this.easyGrid1=new Ext.ux.EasyGrid(e);this.add(this.newInvoiceForm,this.easyGrid,this.easyGrid1)},loadFormRecord:function(b,a){Ext.Easy.easyAjax("logisticsAction!queryInvoiceDetailById.action",{ID:a.get("ID")},function(c,d){var f=Ext.decode(c.responseText);var e=f.invoice;this.newInvoiceForm.getForm().setValues(e);this.easyGrid.getStore().loadData(f.invoiceDetailList);this.easyGrid1.getStore().loadData(f.productDetailList)},this)}});Ext.define("Ext.Warehouse.WarehouseDataStockPanel",{extend:"Ext.panel.Panel",requires:[],initComponent:function(){var a=this;this.border=false;this.frame=false;this.layout="border";this.autoScroll=true;a.callParent();this.createQueryBuyEnterPanel();new Ext.util.DelayedTask(function(){},this).delay(1000)},createQueryBuyEnterPanel:function(){this.queryBuyEnterForm=Ext.Easy.getEasyQueryForm(Ext.bind(this.doQuery,this),[warehouseDataElementsConfigs.getBaseConfigByName("buyCode"),warehouseDataElementsConfigs.getBaseConfigByName("buyStorageName"),warehouseDataElementsConfigs.getBaseConfigByName("buyQueryDate"),warehouseDataElementsConfigs.getBaseConfigByName("enterState")],2);var a={xtype:"easygrid",viewPanelClass:"Ext.Warehouse.WarehouseDataNewBuyEnterPanel",noAutoLoad:true,region:"center",showBbar:true,showTbar:true,showUpateBtn:true,showRemoveBtn:false,noShowAddBtn:true,subWindowWidth:miderwindowWidth,subWindowHeight:windowHight,parentPanel:this,desktop:this.desktop,subWindowTitle:"采购入库单详情",baseParams:{queryId:"warehouse.mapper.StoragStockMapper.queryBuyEnterListInfo"},fields:warehouseDataElementsConfigs.getBuyEnterListFields()};this.easyGrid=new Ext.ux.EasyGridQuery(a);this.add([this.queryBuyEnterForm,this.easyGrid])},doQuery:function(){var b=this.easyGrid.getStore();var a=this.queryBuyEnterForm.getForm().getValues();b.proxy.extraParams={queryId:b.proxy.extraParams.queryId};Ext.apply(b.proxy.extraParams,a);b.loadPage(1)}});Ext.define("Ext.Warehouse.WarehouseDataNewBuyEnterPanel",{extend:"Ext.panel.Panel",constructor:function(a){this.saveBtn=Ext.widget("button",{text:"保存",iconCls:"accept",handler:Ext.bind(this.save,this)});this.updateBtn=Ext.widget("button",{text:"提交",iconCls:"accept",handler:Ext.bind(this.update,this)});this.checkBtn=Ext.widget("button",{text:"验收",iconCls:"accept",handler:Ext.bind(this.check,this)});this.dockedItems=[{xtype:"toolbar",dock:"bottom",ui:"footer",layout:{pack:"center"},items:[this.saveBtn,this.updateBtn,this.checkBtn]}];Ext.apply(this,a);this.callParent()},initComponent:function(){var d=this;this.border=false;this.frame=false;this.layout="border";this.autoScroll=true;d.callParent();var b=Ext.widget("textfield",Ext.apply(warehouseDataElementsConfigs.getConfigByName("barCode"),{labelStyle:"color:red"}));b.on("blur",Ext.bind(this.addRecordByBarcode,this));var a=[warehouseDataElementsConfigs.getConfigByName("buyStorageName"),warehouseDataElementsConfigs.getConfigByName("productSource"),warehouseDataElementsConfigs.getConfigByName("isDifference"),{xtype:"label"},warehouseDataElementsConfigs.getConfigByName("buyNote"),b];var e=Ext.Easy.getEasyForm({items:a,columnSize:2,region:"north"});this.newBuyEnterForm=e;var c={xtype:"easygrid",noAutoLoad:true,region:"center",showTbar:false,parentPanel:this,subWindowTitle:"采购入库明细单详情",fields:warehouseDataElementsConfigs.getNewBuyEnterListFields()};this.easyGrid=new Ext.ux.EasyGrid(c);this.add(e,this.easyGrid)},addRecordByBarcode:function(b){var a=b.getValue();var c=0;if(null==a||""==a){Ext.Msg.alert("提示:","请输入货品条形码！");return false}this.easyGrid.getStore().each(function(g){if(g.get("productBarcode")==a){var f=g.get("realNum")||0;f++;c++;g.set("realNum",f);var h=g.get("realNum")||0;var d=g.get("projectNum")||0;var e=h-d;g.set("differenceNum",e);return false}},this);if(c==0){Ext.Easy.easyAjax("stockAction!queryBuyDetailByBarcode.action",{barcode:a},function(d,e){var g=Ext.decode(d.responseText);var f=g.buyDetail;if(null!=f){this.easyGrid.getStore().loadData([f],true)}else{Ext.Msg.alert("提示:","查询不到该货品，请核对货品条形码是否正确。")}},this)}},save:function(){if(!Ext.Easy.isFormValid(this.newBuyEnterForm)){return}var c={};var b=this.easyGrid;var a=Ext.Easy.getRecordsToParams(b.getStore(),c,"KID",true,b);if(a[0]<1){Ext.Msg.alert("提示:","请增加采购计划明细信息！");return}c.itemNewCount=a[0];c.pid=this.pid;this.newBuyEnterForm.submit({params:c,url:"stockAction!saveBuyEnterInfo.action",success:function(d,e){Ext.Easy.alertMsg(true);this.pwin.close();this.parentPanel.doQuery()},failure:function(d,e){Ext.Easy.alertMsg(false)},scope:this})},update:function(){if(!Ext.Easy.isFormValid(this.newBuyEnterForm)){return}var c={};var b=this.easyGrid;var a=Ext.Easy.getRecordsToParams(b.getStore(),c,"KID",true,b);if(a[0]<1){Ext.Msg.alert("提示:","请增加采购计划明细信息！");return}c.itemNewCount=a[0];c.pid=this.pid;this.newBuyEnterForm.submit({params:c,url:"stockAction!addBuyEnterInfo.action",success:function(d,e){Ext.Easy.alertMsg(true);this.pwin.close();this.parentPanel.doQuery()},failure:function(d,e){Ext.Easy.alertMsg(false)},scope:this})},check:function(){if(!Ext.Easy.isFormValid(this.newBuyEnterForm)){return}var c={};var b=this.easyGrid;var a=Ext.Easy.getRecordsToParams(b.getStore(),c,"KID",false,b);c.itemNewCount=a[0];c.pid=this.pid;this.newBuyEnterForm.submit({params:c,url:"stockAction!checkBuyEnterInfo.action",success:function(d,e){Ext.Easy.alertMsg(true);this.pwin.close();this.parentPanel.doQuery()},failure:function(d,e){Ext.Easy.alertMsg(false)},scope:this})},setParentWin:function(a){this.pwin=a},loadFormRecord:function(b,a){Ext.Easy.easyAjax("stockAction!queryBuyEnterInfo.action",{ID:a.get("ID")},function(c,d){var g=Ext.decode(c.responseText);var f=g.buyEnter;this.pid=f.ID;var e=f.enterState;this.newBuyEnterForm.getForm().setValues(f);this.easyGrid.getStore().loadData(g.buyDetailList);if(e==1){this.saveBtn.setVisible(true);this.updateBtn.setVisible(true);this.checkBtn.setVisible(false)}else{if(e==2){this.saveBtn.setVisible(false);this.updateBtn.setVisible(false);this.checkBtn.setVisible(true)}else{if(e==3){this.saveBtn.setVisible(false);this.updateBtn.setVisible(false);this.checkBtn.setVisible(false)}}}},this)}});Ext.define("Ext.Warehouse.WarehouseDataSellPanel",{extend:"Ext.panel.Panel",requires:[],initComponent:function(){var a=this;this.border=false;this.frame=false;this.layout="border";this.autoScroll=true;a.callParent();this.createQuerySellPanel();new Ext.util.DelayedTask(function(){},this).delay(1000)},createQuerySellPanel:function(){this.querySellForm=Ext.Easy.getEasyQueryForm(Ext.bind(this.doQuery,this),[warehouseDataElementsConfigs.getBaseConfigByName("sellCode"),warehouseDataElementsConfigs.getBaseConfigByName("sellQueryDate"),warehouseDataElementsConfigs.getBaseConfigByName("sellStorage"),warehouseDataElementsConfigs.getBaseConfigByName("sellState")],2);var a={xtype:"easygrid",viewPanelClass:"Ext.Warehouse.WarehouseDataNewSellPanel",noAutoLoad:true,region:"center",showBbar:true,showTbar:true,showUpateBtn:true,showRemoveBtn:false,noShowAddBtn:true,parentPanel:this,subWindowWidth:miderwindowWidth,subWindowHeight:windowHight,desktop:this.desktop,subWindowTitle:"销售出库详情",baseParams:{queryId:"warehouse.mapper.StoragStockMapper.querySellListInfo"},fields:warehouseDataElementsConfigs.getSellListFields()};this.easyGrid=new Ext.ux.EasyGridQuery(a);this.add([this.querySellForm,this.easyGrid])},doQuery:function(){var a=this.easyGrid.getStore();var b=this.querySellForm.getForm().getValues();a.proxy.extraParams={queryId:a.proxy.extraParams.queryId};Ext.apply(a.proxy.extraParams,b);a.loadPage(1)}});Ext.define("Ext.Warehouse.WarehouseDataNewSellPanel",{extend:"Ext.panel.Panel",constructor:function(a){this.okBtn=Ext.widget("button",{text:"拣货完成",iconCls:"accept",handler:Ext.bind(this.ok,this)});this.printBtn=Ext.widget("button",{text:"预览拣货单和分货单",iconCls:"edit",handler:Ext.bind(this.print,this)});this.dockedItems=[{xtype:"toolbar",dock:"bottom",ui:"footer",layout:{pack:"center"},items:[this.printBtn,this.okBtn]}];Ext.apply(this,a);this.callParent()},initComponent:function(){var d=this;this.border=false;this.frame=false;this.layout="border";this.autoScroll=true;d.callParent();var b=[warehouseDataElementsConfigs.getConfigByName("sellCode"),warehouseDataElementsConfigs.getConfigByName("sellStorage"),warehouseDataElementsConfigs.getConfigByName("sellDate"),warehouseDataElementsConfigs.getConfigByName("sellState"),warehouseDataElementsConfigs.getConfigByName("orderTotalNum")];var a=Ext.Easy.getEasyForm({items:b,columnSize:2,region:"north"});this.newSellForm=a;var c={xtype:"easygrid",noAutoLoad:true,region:"center",showTbar:true,noShowAddBtn:true,noShowRemoveBtn:true,parentPanel:this,subWindowTitle:"销售出库明细单",fields:warehouseDataElementsConfigs.getSellDetailListFields()};this.easyGrid=new Ext.ux.EasyGrid(c);this.add(a,this.easyGrid)},ok:function(){if(!Ext.Easy.isFormValid(this.newSellForm)){return}var c={};var b=this.easyGrid;var a=Ext.Easy.getRecordsToParams(b.getStore(),c,"KID",true,b);if(a[0]<1){Ext.Msg.alert("提示:","请增加销售明细信息！");return}c.itemNewCount=a[0];this.newSellForm.submit({params:c,url:"stockAction!okSellInfo.action",success:function(d,e){Ext.Easy.alertMsg(true);this.pwin.close();this.parentPanel.doQuery()},failure:function(d,e){Ext.Easy.alertMsg(false)},scope:this})},print:function(){var a=this.pid;var b="stockAction!printViewSellInfo.action?ID="+a;window.open(b,"打印详情")},setParentWin:function(a){this.pwin=a},loadFormRecord:function(b,a){Ext.Easy.easyAjax("stockAction!querySellInfo.action",{ID:a.get("ID")},function(c,d){var g=Ext.decode(c.responseText);var f=g.sell;this.pid=f.ID;var e=f.sellState;this.newSellForm.getForm().setValues(f);this.easyGrid.getStore().loadData(g.sellDetailList);if(e==3){this.okBtn.setVisible(false)}},this)}});Ext.define("Ext.Warehouse.WarehouseDataSellOrderPanel",{extend:"Ext.panel.Panel",requires:[],initComponent:function(){var a=this;this.border=false;this.frame=false;this.layout="border";this.autoScroll=true;a.callParent();this.createQuerySellOrderPanel();new Ext.util.DelayedTask(function(){},this).delay(1000)},createQuerySellOrderPanel:function(){this.querySellOrderForm=Ext.Easy.getEasyQueryForm(Ext.bind(this.doQuery,this),[warehouseDataElementsConfigs.getBaseConfigByName("orderCd"),warehouseDataElementsConfigs.getBaseConfigByName("productCd"),warehouseDataElementsConfigs.getBaseConfigByName("outState"),warehouseDataElementsConfigs.getBaseConfigByName("productName")],2);var a={xtype:"easygrid",noAutoLoad:true,region:"center",showBbar:true,showTbar:false,parentPanel:this,subWindowWidth:miderwindowWidth,subWindowHeight:windowHight,desktop:this.desktop,formItemsReadOnly:true,subWindowTitle:"销售订单详情",baseParams:{queryId:"warehouse.mapper.StoragStockMapper.querySellDetailOrderListInfo"},fields:warehouseDataElementsConfigs.getSellDetailListFields()};this.easyGrid=new Ext.ux.EasyGrid(a);this.add([this.querySellOrderForm,this.easyGrid])},doQuery:function(){var a=this.easyGrid.getStore();var b=this.querySellOrderForm.getForm().getValues();a.proxy.extraParams={queryId:a.proxy.extraParams.queryId};Ext.apply(a.proxy.extraParams,b);a.loadPage(1)}});Ext.define("Ext.Warehouse.WarehouseDataNewSellOrderPanel",{extend:"Ext.panel.Panel",constructor:function(a){this.dockedItems=[{xtype:"toolbar",dock:"bottom",ui:"footer",layout:{pack:"center"},items:[{text:"提交",iconCls:"accept",handler:Ext.bind(this.save,this)}]}];Ext.apply(this,a);this.callParent()},initComponent:function(){var e=this;this.border=false;this.frame=false;this.layout="border";this.autoScroll=true;e.callParent();var f=Ext.widget("textfield",Ext.apply(warehouseDataElementsConfigs.getConfigByName("orderCd"),{labelStyle:"color:red"}));f.on("blur",Ext.bind(this.addRecordByOrderCd,this));var c=Ext.widget("textfield",Ext.apply(warehouseDataElementsConfigs.getConfigByName("barCode"),{labelStyle:"color:red"}));c.on("blur",Ext.bind(this.addRecordByBarcode,this));var b=[f,c];var a=Ext.Easy.getEasyForm({items:b,columnSize:2,region:"north"});this.newSellForm=a;var d={xtype:"easygrid",noAutoLoad:true,region:"center",showTbar:true,noShowAddBtn:true,noShowRemoveBtn:true,parentPanel:this,subWindowTitle:"销售出库明细单",fields:warehouseDataElementsConfigs.getSellDetailListFields()};this.easyGrid=new Ext.ux.EasyGrid(d);this.add(a,this.easyGrid)},addRecordByOrderCd:function(a){var b=a.getValue();if(null==b||""==b){Ext.Msg.alert("提示:","请输入订单编号！");return}Ext.Easy.easyAjax("stockAction!querySellDetailInfoByOrderCd.action",{orderCd:b},function(c,d){var e=Ext.decode(c.responseText);if(null==e.sellDetailList||""==e.sellDetailList){Ext.Msg.alert("提示:","查找不到相应的订单信息，请核对订单编号是否正确！")}else{this.easyGrid.getStore().loadData(e.sellDetailList)}},this)},addRecordByBarcode:function(b){var a=b.getValue();var c=this.newSellForm.getForm().findField("orderCd").getValue();if(null==c||""==c){Ext.Msg.alert("提示:","请先输入订单编号！");return}this.easyGrid.getStore().each(function(e){if(e.get("productBarcode")==a){var d=e.get("factOutNum")||0;d++;e.set("factOutNum",d);return false}else{Ext.Msg.alert("提示:","请核对货品条形码是否正确！");return}},this)},save:function(){if(!Ext.Easy.isFormValid(this.newSellForm)){return}var e={};var c=this.easyGrid;var b=Ext.Easy.getRecordsToParams(c.getStore(),e,"KID",true,c);if(b[0]<1){Ext.Msg.alert("提示:","请增加销售明细信息！");return}var a=0;var d=0;this.easyGrid.getStore().each(function(f){if(f.get("outState")==2){a++}if(f.get("factOutNum")<=0){d++}},this);if(a==b[0]){Ext.Msg.alert("提示:","该订单出库明细已经完成！");return}if(d>0){Ext.Msg.alert("提示:","实际出库数量请输入大于0的数量！");return}e.itemNewCount=b[0];Ext.Easy.easyAjax("stockAction!saveSellDetailInfo.action",e,function(f,g){var h=Ext.decode(f.responseText);Ext.Easy.alertMsg(h.success);this.addRecordByOrderCd(this.newSellForm.getForm().findField("orderCd"))},this)},afterWinShow:function(a){a.findField("orderCd").setReadOnly(true);a.findField("outState").setReadOnly(true);a.findField("productCd").setReadOnly(true);a.findField("productName").setReadOnly(true);a.findField("productBrand").setReadOnly(true);a.findField("productSize").setReadOnly(true);a.findField("productColorCn").setReadOnly(true);a.findField("productBarcode").setReadOnly(true);a.findField("outNum").setReadOnly(true)}});Ext.define("Ext.Warehouse.WarehouseDataAllocatePanel",{extend:"Ext.panel.Panel",requires:[],initComponent:function(){var a=this;this.border=false;this.frame=false;this.layout="border";this.autoScroll=true;a.callParent();this.createQueryAllocatePanel();new Ext.util.DelayedTask(function(){},this).delay(1000)},createQueryAllocatePanel:function(){this.queryAllocateForm=Ext.Easy.getEasyQueryForm(Ext.bind(this.doQuery,this),[warehouseDataElementsConfigs.getBaseConfigByName("allocateCode"),warehouseDataElementsConfigs.getBaseConfigByName("allocateType"),warehouseDataElementsConfigs.getBaseConfigByName("allocateState"),warehouseDataElementsConfigs.getBaseConfigByName("createDate")],2);var a={xtype:"easygrid",viewPanelClass:"Ext.Warehouse.WarehouseDataNewAllocatePanel",noAutoLoad:true,region:"center",showBbar:true,showTbar:true,showUpateBtn:true,showRemoveBtn:true,parentPanel:this,subWindowWidth:midwindowWidth,subWindowHeight:windowHight,desktop:this.desktop,subWindowTitle:"调拨详情",baseParams:{queryId:"warehouse.mapper.StoragStockMapper.queryAllocateListInfo"},fields:warehouseDataElementsConfigs.getAllocateListFields()};this.easyGrid=new Ext.ux.EasyGridQuery(a);this.add([this.queryAllocateForm,this.easyGrid])},doQuery:function(){var a=this.easyGrid.getStore();var b=this.queryAllocateForm.getForm().getValues();a.proxy.extraParams={queryId:a.proxy.extraParams.queryId};Ext.apply(a.proxy.extraParams,b);a.loadPage(1)}});Ext.define("Ext.Warehouse.WarehouseDataNewAllocatePanel",{extend:"Ext.panel.Panel",constructor:function(a){this.saveBtn=Ext.widget("button",{text:"提交",iconCls:"accept",handler:Ext.bind(this.save,this)});this.checkBtn=Ext.widget("button",{text:"验收",iconCls:"accept",handler:Ext.bind(this.check,this)});this.dockedItems=[{xtype:"toolbar",dock:"bottom",ui:"footer",layout:{pack:"center"},items:[this.saveBtn,this.checkBtn]}];Ext.apply(this,a);this.callParent()},initComponent:function(){var e=this;this.border=false;this.frame=false;this.layout="border";this.autoScroll=true;e.callParent();var c=Ext.widget("textfield",Ext.apply(warehouseDataElementsConfigs.getConfigByName("barCode"),{labelStyle:"color:red"}));c.on("blur",Ext.bind(this.addRecordByBarcode,this));var f=Ext.widget("textfield",Ext.apply(warehouseDataElementsConfigs.getConfigByName("allocateCode")));var b=[f,warehouseDataElementsConfigs.getBaseConfigByName("foldStorage"),warehouseDataElementsConfigs.getBaseConfigByName("allocateType"),warehouseDataElementsConfigs.getBaseConfigByName("depositaryStorage"),c];var a=Ext.Easy.getEasyForm({items:b,columnSize:2,region:"north"});this.newAllocateForm=a;var d={xtype:"easygrid",noAutoLoad:true,region:"center",showTbar:true,parentPanel:this,subWindowTitle:"调拨详情",fields:warehouseDataElementsConfigs.getAllocateDetailListFields()};this.easyGrid=new Ext.ux.EasyGrid(d);this.add(a,this.easyGrid)},addRecordByBarcode:function(b){var a=b.getValue();this.easyGrid.getStore().each(function(d){if(d.get("productBarcode")==a){var c=d.get("factOutNum")||0;c++;d.set("factOutNum",c);return false}else{Ext.Msg.alert("提示:","请核对货品条形码是否正确！")}},this)},save:function(){if(!Ext.Easy.isFormValid(this.newAllocateForm)){return}var c={};var b=this.easyGrid;var a=Ext.Easy.getRecordsToParams(b.getStore(),c,"KID",true,b);if(a[0]<1){Ext.Msg.alert("提示:","请增加调拨明细信息！");return}c.itemNewCount=a[0];this.newAllocateForm.submit({params:c,url:"stockAction!saveAllocateInfo.action",success:function(d,e){Ext.Easy.alertMsg(true);this.pwin.close();this.parentPanel.doQuery()},failure:function(d,e){Ext.Easy.alertMsg(false)},scope:this})},check:function(){if(!Ext.Easy.isFormValid(this.newAllocateForm)){return}var c={};var b=this.easyGrid;var a=Ext.Easy.getRecordsToParams(b.getStore(),c,"KID",false,b);c.itemNewCount=a[0];this.newAllocateForm.submit({params:c,url:"stockAction!okOtherInfo.action",success:function(d,e){Ext.Easy.alertMsg(true);this.pwin.close();this.parentPanel.doQuery()},failure:function(d,e){Ext.Easy.alertMsg(false)},scope:this})},setParentWin:function(a){this.pwin=a},loadFormRecord:function(b,a){Ext.Easy.easyAjax("stockAction!queryAllocateInfo.action",{ID:a.get("ID"),allocateCode:a.get("allocateCode")},function(c,d){var f=Ext.decode(c.responseText);var e=f.allocate;this.newAllocateForm.getForm().setValues(e);this.easyGrid.getStore().loadData(f.allocateDetailList)},this)},createRecord:function(){this.checkBtn.setVisible(false);this.newAllocateForm.getForm().findField("allocateCode").setDisabled(true)}});Ext.define("Ext.Warehouse.WarehouseDataOtherPanel",{extend:"Ext.panel.Panel",requires:[],initComponent:function(){var a=this;this.border=false;this.frame=false;this.layout="border";this.autoScroll=true;a.callParent();this.createQueryOtherPanel();new Ext.util.DelayedTask(function(){},this).delay(1000)},createQueryOtherPanel:function(){this.queryOtherForm=Ext.Easy.getEasyQueryForm(Ext.bind(this.doQuery,this),[warehouseDataElementsConfigs.getBaseConfigByName("checkCode"),warehouseDataElementsConfigs.getBaseConfigByName("checkType"),warehouseDataElementsConfigs.getBaseConfigByName("checkStorage"),warehouseDataElementsConfigs.getBaseConfigByName("checkState"),warehouseDataElementsConfigs.getBaseConfigByName("queryCheckDate")],2);var a={xtype:"easygrid",viewPanelClass:"Ext.Warehouse.WarehouseDataNewOtherPanel",noAutoLoad:true,region:"center",showBbar:true,showTbar:true,showUpateBtn:true,showRemoveBtn:true,parentPanel:this,subWindowWidth:midwindowWidth,subWindowHeight:windowHight,desktop:this.desktop,subWindowTitle:"其它出入库详情",baseParams:{queryId:"warehouse.mapper.StoragStockMapper.queryCheckListInfo"},fields:warehouseDataElementsConfigs.getOtherCheckListFields()};this.easyGrid=new Ext.ux.EasyGridQuery(a);this.add([this.queryOtherForm,this.easyGrid])},doQuery:function(){var a=this.easyGrid.getStore();var b=this.queryOtherForm.getForm().getValues();a.proxy.extraParams={queryId:a.proxy.extraParams.queryId};Ext.apply(a.proxy.extraParams,b);a.loadPage(1)}});Ext.define("Ext.Warehouse.WarehouseDataNewOtherPanel",{extend:"Ext.panel.Panel",constructor:function(a){this.saveBtn=Ext.widget("button",{text:"提交",iconCls:"accept",handler:Ext.bind(this.save,this)});this.checkBtn=Ext.widget("button",{text:"验收",iconCls:"accept",handler:Ext.bind(this.check,this)});this.dockedItems=[{xtype:"toolbar",dock:"bottom",ui:"footer",layout:{pack:"center"},items:[this.saveBtn,this.checkBtn]}];Ext.apply(this,a);this.callParent()},initComponent:function(){var d=this;this.border=false;this.frame=false;this.layout="border";this.autoScroll=true;d.callParent();var b=Ext.widget("textfield",Ext.apply(warehouseDataElementsConfigs.getConfigByName("barCode"),{labelStyle:"color:red"}));b.on("blur",Ext.bind(this.addRecordByBarcode,this));var a=[warehouseDataElementsConfigs.getConfigByName("checkType"),warehouseDataElementsConfigs.getConfigByName("checkStorage"),b];var e=Ext.Easy.getEasyForm({items:a,columnSize:2,region:"north"});this.newOtherForm=e;var c={xtype:"easygrid",noAutoLoad:true,region:"center",showTbar:true,parentPanel:this,subWindowTitle:"出入库明细详情",fields:warehouseDataElementsConfigs.getOhterDetailListFields()};this.easyGrid=new Ext.ux.EasyGrid(c);this.add(e,this.easyGrid)},addRecordByBarcode:function(b){var a=b.getValue();var c=0;if(null==a||""==a){Ext.Msg.alert("提示:","请输入货品条形码！");return false}this.easyGrid.getStore().each(function(e){if(e.get("productBarcode")==a){var d=e.get("checkNum")||0;d++;c++;e.set("checkNum",d);return false}},this);if(c==0){Ext.Easy.easyAjax("stockAction!queryCheckDetailByBarcode.action",{barcode:a},function(d,e){var g=Ext.decode(d.responseText);var f=g.checkDetail;if(null!=f){this.easyGrid.getStore().loadData([f],true)}else{Ext.Msg.alert("提示:","查询不到该货品，请核对货品条形码是否正确。")}},this)}},save:function(){if(!Ext.Easy.isFormValid(this.newOtherForm)){return}var c={};var b=this.easyGrid;var a=Ext.Easy.getRecordsToParams(b.getStore(),c,"KID",false,b);if(a[0]<1){Ext.Msg.alert("提示:","请增加销售明细信息！");return}c.itemNewCount=a[0];this.newOtherForm.submit({params:c,url:"stockAction!saveOtherInfo.action",success:function(d,e){Ext.Easy.alertMsg(true);this.pwin.close();this.parentPanel.doQuery()},failure:function(d,e){Ext.Easy.alertMsg(false)},scope:this})},check:function(){if(!Ext.Easy.isFormValid(this.newOtherForm)){return}var c={};var b=this.easyGrid;var a=Ext.Easy.getRecordsToParams(b.getStore(),c,"KID",false,b);c.itemNewCount=a[0];this.newOtherForm.submit({params:c,url:"stockAction!okOtherInfo.action",success:function(d,e){Ext.Easy.alertMsg(true);this.pwin.close();this.parentPanel.doQuery()},failure:function(d,e){Ext.Easy.alertMsg(false)},scope:this})},setParentWin:function(a){this.pwin=a},loadFormRecord:function(b,a){Ext.Easy.easyAjax("stockAction!queryOtherInfo.action",{ID:a.get("ID")},function(c,e){var g=Ext.decode(c.responseText);var f=g.check;this.newOtherForm.getForm().setValues(f);this.easyGrid.getStore().loadData(g.checkDetailList);var d=f.checkState;if(d==2){this.saveBtn.setVisible(false);this.checkBtn.setVisible(false)}},this)},createRecord:function(){this.checkBtn.setVisible(false)}});Ext.define("Ext.Warehouse.WarehouseDataStockDetailPanel",{extend:"Ext.panel.Panel",requires:[],initComponent:function(){var a=this;this.border=false;this.frame=false;this.layout="border";this.autoScroll=true;a.callParent();this.createQueryStockDetailPanel();new Ext.util.DelayedTask(function(){},this).delay(1000)},createQueryStockDetailPanel:function(){this.queryStockDetailForm=Ext.Easy.getEasyQueryForm(Ext.bind(this.doQuery,this),[warehouseDataElementsConfigs.getBaseConfigByName("productName"),warehouseDataElementsConfigs.getBaseConfigByName("productBrand"),warehouseDataElementsConfigs.getBaseConfigByName("productSize"),warehouseDataElementsConfigs.getBaseConfigByName("productColorCn"),warehouseDataElementsConfigs.getBaseConfigByName("batchNo"),warehouseDataElementsConfigs.getBaseConfigByName("stockStorage"),warehouseDataElementsConfigs.getBaseConfigByName("stockShelf")],2);var a={xtype:"easygrid",noAutoLoad:true,region:"center",showBbar:true,showTbar:true,noShowAddBtn:true,noShowRemoveBtn:true,parentPanel:this,desktop:this.desktop,subWindowTitle:"库存物理调整",baseParams:{queryId:"warehouse.mapper.StoragStockMapper.queryStoragStockListInfo"},fields:warehouseDataElementsConfigs.getStockDetailListFields()};this.easyGrid=new Ext.ux.EasyGrid(a);this.add([this.queryStockDetailForm,this.easyGrid])},doQuery:function(){var a=this.easyGrid.getStore();var b=this.queryStockDetailForm.getForm().getValues();a.proxy.extraParams={queryId:a.proxy.extraParams.queryId};Ext.apply(a.proxy.extraParams,b);a.loadPage(1)},afterWinShow:function(a){a.findField("productCd").setReadOnly(true);a.findField("productName").setReadOnly(true);a.findField("productBrand").setReadOnly(true);a.findField("productSize").setReadOnly(true);a.findField("productSizeNo").setReadOnly(true);a.findField("productColorCn").setReadOnly(true);a.findField("productColorEn").setReadOnly(true);a.findField("productColorNo").setReadOnly(true);a.findField("productBarcode").setReadOnly(true);a.findField("productPrice").setReadOnly(true);a.findField("productCost").setReadOnly(true);a.findField("storage").setReadOnly(true)},updateRecord:function(b,d,a,c){this.easyGrid.getFormPanel().submit({url:"stockAction!updateStockInfo.action",success:function(e,f){Ext.Easy.alertMsg(true);this.doQuery()},failure:function(e,f){Ext.Easy.alertMsg(false)},scope:this})}});Ext.define("Ext.Warehouse.WarehouseDataMainPanel",{extend:"Ext.panel.Panel",requires:["Ext.Warehouse.WarehouseDataElementsConfigs","Ext.Warehouse.FunctionNodes","Ext.Warehouse.WarehouseDataInfoPanel","Ext.Warehouse.WarehouseDataLogisticsPanel","Ext.Warehouse.WarehouseDataStockPanel","Ext.Warehouse.WarehouseDataInventoryPanel"],initComponent:function(){var e=this;this.border=false;this.frame=false;this.layout="border";e.callParent();var d=[];Ext.each(WFNS.functionNodes,function(g){var h=[];Ext.each(g.children,function(i){h.push(Ext.apply({},i))});var f={children:h};d.push(Ext.applyIf(f,g))});var b=Ext.create("Ext.data.TreeStore",{root:{expanded:true,children:d}});var a=Ext.create("Ext.tree.Panel",{title:"仓库物流菜单",region:"west",width:200,store:b,rootVisible:false});this.add(a);a.on("itemdblclick",Ext.bind(this.nodeClickFun,this));var c=Ext.widget("tabpanel",{region:"center",items:[{title:"欢迎您",bodyPadding:10,html:"欢迎您进入思宏电子商务平台仓储系统，请点击左边菜单栏进行操作！"}]});this.tabPanel=c;this.add(c)},nodeClickFun:function(thisView,record){var nodeId=record.data.id,tabId=nodeId+"tab";var tab=this.tabPanel.getComponent(tabId);if(tab){this.tabPanel.setActiveTab(tab)}else{var cls=eval(nodeId);this.tabPanel.insert(0,{title:record.data.text,id:tabId,layout:"fit",closable:true,items:[new cls()]});this.tabPanel.setActiveTab(0)}}});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("MyDesktop.Settings",{extend:"Ext.window.Window",uses:["Ext.tree.Panel","Ext.data.TreeStore","Ext.tree.View","Ext.form.field.Checkbox","Ext.layout.container.Anchor","Ext.layout.container.Border","Ext.ux.desktop.Wallpaper","MyDesktop.WallpaperModel"],layout:"anchor",title:"Change Settings",modal:true,width:640,height:480,border:false,initComponent:function(){var a=this;a.selected=a.desktop.getWallpaper();a.stretch=a.desktop.wallpaper.stretch;a.preview=Ext.create("widget.wallpaper");a.preview.setWallpaper(a.selected);a.tree=a.createTree();a.buttons=[{text:"OK",handler:a.onOK,scope:a},{text:"Cancel",handler:a.close,scope:a}];a.items=[{anchor:"0 -30",border:false,layout:"border",items:[a.tree,{xtype:"panel",title:"Preview",region:"center",layout:"fit",items:[a.preview]}]},{xtype:"checkbox",boxLabel:"Stretch to fit",checked:a.stretch,listeners:{change:function(b){a.stretch=b.checked}}}];a.callParent()},createTree:function(){var b=this;function c(d){return{img:d,text:b.getTextOfWallpaper(d),iconCls:"",leaf:true}}var a=new Ext.tree.Panel({title:"Desktop Background",rootVisible:false,lines:false,autoScroll:true,width:150,region:"west",split:true,minWidth:100,listeners:{afterrender:{fn:this.setInitialSelection,delay:100},select:this.onSelect,scope:this},store:new Ext.data.TreeStore({model:"MyDesktop.WallpaperModel",root:{text:"Wallpaper",expanded:true,children:[{text:"None",iconCls:"",leaf:true},c("farm.jpg"),c("highbuild.jpg"),c("hua.jpg"),c("blue.jpg"),c("desk.jpg"),c("desktop.jpg"),c("windows.jpg"),c("sky.jpg"),c("shine.jpg")]}})});return a},getTextOfWallpaper:function(c){var d=c,b=c.lastIndexOf("/");if(b>=0){d=d.substring(b+1)}var a=d.lastIndexOf(".");d=Ext.String.capitalize(d.substring(0,a));d=d.replace(/[-]/g," ");return d},onOK:function(){var a=this;if(a.selected){a.desktop.setWallpaper(a.selected,a.stretch)}Ext.util.Cookies.set("wallpaper",a.selected,Ext.Easy.getNewDate(28));a.destroy()},onSelect:function(a,b){var c=this;if(b.data.img){c.selected="resources/wallpapers/"+b.data.img}else{c.selected=Ext.BLANK_IMAGE_URL}c.preview.setWallpaper(c.selected)},setInitialSelection:function(){var a=this.desktop.getWallpaper();if(a){var b="/Wallpaper/"+this.getTextOfWallpaper(a);this.tree.selectPath(b,"text")}}});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("MyDesktop.WallpaperModel",{extend:"Ext.data.Model",fields:[{name:"text"},{name:"img"}]});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("MyDesktop.App",{extend:"Ext.ux.desktop.App",requires:["Ext.window.MessageBox","Ext.ux.desktop.ShortcutModel","Ext.easy.Util","Ext.easy.CommonData","Ext.easy.MemberCommonData","MyDesktop.Settings","Ext.NeoEc.BaseData","Ext.Product.ProductData","Ext.Member.MemberData","Ext.Warehouse.WarehouseData","Ext.Sales.SalesData","Ext.Purchasing.PurchasingData","Ext.Privilege.PrivilegeData","Ext.CustomerCenter.CustomerCenterData","Ext.Voucher.VoucherData"],init:function(){this.callParent();windowHight=Ext.getBody().getHeight()-38},getModules:function(){var modules=[];Ext.each(modelDatas,function(item){var cls=eval(item.className);modules.push(new cls())});return modules},getDesktopConfig:function(){var c=this,b=c.callParent();var a=Ext.util.Cookies.get("wallpaper");if(!Ext.isEmpty(a)){Ext.apply(b,{wallpaper:a})}return Ext.applyIf(b,{contextMenuItems:[{text:"Change Settings",handler:c.onSettings,scope:c}],shortcuts:Ext.create("Ext.data.Store",{model:"Ext.ux.desktop.ShortcutModel",data:modelDatas}),wallpaper:"resources/wallpapers/desk.jpg",wallpaperStretch:true})},getStartConfig:function(){var b=this,a=b.callParent();return Ext.apply(a,{title:"欢迎您, "+c_privileges.loginUserName+" ,今天是 "+Ext.util.Format.date(new Date(),"Y-m-d"),iconCls:"user",height:300,toolConfig:{width:100,items:[{text:"设置",iconCls:"settings",handler:b.onSettings,scope:b},"-",{text:"注销",iconCls:"logout",handler:b.onLogout,scope:b}]}})},getTaskbarConfig:function(){var a=this.callParent();return Ext.apply(a,{quickStart:[],trayItems:[{xtype:"trayclock",flex:1}]})},onLogout:function(){Ext.Msg.confirm("登出","确认退出登陆?",function(a){if(a=="yes"){window.location="login.html"}})},onSettings:function(){var a=new MyDesktop.Settings({desktop:this.desktop});a.show()}});Ext.Loader.setConfig({enabled:true});Ext.Loader.setPath({"Ext.ux.desktop":"js/core","Ext.ux":"js/ux","Ext.NeoEc":"modules/basedata","Ext.Product":"modules/product","Ext.Sales":"modules/sales","Ext.Purchasing":"modules/purchasing","Ext.Warehouse":"modules/warehouse","Ext.Privilege":"modules/privilege","Ext.Member":"modules/member","Ext.CustomerCenter":"modules/customercenter","Ext.Logistics":"modules/logistics","Ext.Voucher":"modules/voucher",MyDesktop:"modules/desktop","Ext.easy":"modules/common"});Ext.require("MyDesktop.App");var myDesktopApp;var tabHeight=508;var windowHight;var windowWidth;var midwindowWidth;var miderwindowWidth;var minwindowWidth;var modelDatas=[];var c_privileges;var warehouseDataElementsConfigs;var voucherDataElementsConfigs;var salesDataElementsConfigs;var purchasingDataElementsConfigs;var productDataElementsConfigs;var privilegeDataElementsConfigs;var memberDataElementsConfigs;var logisticsDataElementsConfigs;var customercenterDataElementsConfigs;var baseDataElementsConfigs;Ext.onReady(function(){windowWidth=Ext.getBody().getWidth()-100;midwindowWidth=Ext.getBody().getWidth()*2/3;miderwindowWidth=Ext.getBody().getWidth()*4/5;minwindowWidth=Ext.getBody().getWidth()*3/5;var a=[{name:"基础数据管理",type:"basedataMgr",iconCls:"basedata-shortcut",module:"basedata-win",className:"Ext.NeoEc.BaseData"},{name:"产品管理",type:"productMgr",iconCls:"product-shortcut",module:"product-win",className:"Ext.Product.ProductData"},{name:"销售管理",type:"salesMgr",iconCls:"sales-shortcut",module:"sales-win",className:"Ext.Sales.SalesData"},{name:"采购管理",type:"purchaseMgr",iconCls:"purchase-shortcut",module:"purchasing-win",className:"Ext.Purchasing.PurchasingData"},{name:"仓储管理",type:"warehouseMgr",iconCls:"warehouse-shortcut",module:"warehouse-win",className:"Ext.Warehouse.WarehouseData"},{name:"客服中心",type:"customerCenterMgr",iconCls:"customer-shortcut",module:"customercenter-win",className:"Ext.CustomerCenter.CustomerCenterData"},{name:"会员管理",type:"memberMgr",iconCls:"member-shortcut",module:"member-win",className:"Ext.Member.MemberData"},{name:"权限管理",type:"privilegeMgr",iconCls:"privilege-shortcut",module:"privilege-win",className:"Ext.Privilege.PrivilegeData"},{name:"代金券管理",type:"voucherMgr",iconCls:"voucher-shortcut",module:"voucher-win",className:"Ext.Voucher.VoucherData"}];Ext.Ajax.request({url:"privilegeOperationAction!queryPrivilegeByStaffId.action",async:false,success:function(b,c){var d=Ext.decode(b.responseText);c_privileges=d.result;Ext.each(a,function(e){if(Ext.isDefined(c_privileges[e.type])){modelDatas.push(e)}},this)},failure:function(b,c){Ext.Msg.alert("操作提示","服务不可用,读取权限数据失败!")}});myDesktopApp=new MyDesktop.App();new Ext.util.DelayedTask(function(){initElementsConfigs();Ext.Ajax.on("requestcomplete",function(d,b,c){var e=Ext.decode(b.responseText);if(e.forwardToLogin){Ext.Msg.alert("提示信息","登陆已过期，请重新登陆!");new Ext.util.DelayedTask(function(){window.location="login.html"}).delay(2000)}})},this).delay(2000)});function initElementsConfigs(){warehouseDataElementsConfigs=new Ext.Warehouse.WarehouseDataElementsConfigs();baseDataElementsConfigs=new Ext.NeoEc.BaseDataElementsConfigs();productDataElementsConfigs=new Ext.Product.ProductDataElementsConfigs();voucherDataElementsConfigs=new Ext.Voucher.VoucherDataElementsConfigs();purchasingDataElementsConfigs=new Ext.Purchasing.PurchasingDataElementsConfigs();privilegeDataElementsConfigs=new Ext.Privilege.PrivilegeDataElementsConfigs();memberDataElementsConfigs=new Ext.Member.MemberDataElementsConfigs();salesDataElementsConfigs=new Ext.Sales.SalesDataElementsConfigs();customercenterDataElementsConfigs=new Ext.CustomerCenter.CustomerCenterDataElementsConfigs()};