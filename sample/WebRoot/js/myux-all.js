Ext.define("Ext.ux.ProgressBarPager",{extend:"Object",requires:["Ext.ProgressBar"],width:225,defaultText:"Loading...",constructor:function(a){if(a){Ext.apply(this,a)}},init:function(b){var a;if(b.displayInfo){this.parent=b;a=b.child("#displayItem");if(a){b.remove(a,true)}this.progressBar=Ext.create("Ext.ProgressBar",{text:this.defaultText,width:this.width,animate:this.defaultAnimCfg});b.displayItem=this.progressBar;b.add(b.displayItem);b.doLayout();Ext.apply(b,this.parentOverrides);this.progressBar.on("render",function(c){c.mon(c.getEl().applyStyles("cursor:pointer"),"click",this.handleProgressBarClick,this)},this,{single:true})}},handleProgressBarClick:function(i){var d=this.parent,c=d.displayItem,f=this.progressBar.getBox(),h=i.getXY(),b=h[0]-f.x,a=Math.ceil(d.store.getTotalCount()/d.pageSize),g=Math.ceil(b/(c.width/a));d.store.loadPage(g)},parentOverrides:{updateInfo:function(){if(this.displayItem){var d=this.store.getCount(),b=this.getPageData(),c=d===0?this.emptyMsg:Ext.String.format(this.displayMsg,b.fromRecord,b.toRecord,this.store.getTotalCount()),a=b.currentPage/b.pageCount;this.displayItem.updateProgress(a,c,this.animate||this.defaultAnimConfig)}}}});Ext.define("Ext.ux.EasyCombo",{extend:"Ext.form.field.ComboBox",alias:["widget.easycombo"],constructor:function(a){a=a||{};Ext.applyIf(a,{displayField:"text",editable:false,valueField:"value",hiddenName:a.hiddenName||a.name,triggerAction:"all",autoScroll:true,listConfig:{minWidth:50},queryMode:"local",emptyText:"请选择",store:new Ext.data.ArrayStore({fields:["value","text"],data:a.data})});Ext.apply(this,a);this.callParent()},getStore:function(){return this.store}});Ext.define("Ext.ux.MultiSelectCombo",{extend:"Ext.form.field.ComboBox",alias:["widget.multicombo"],checkField:"checked",separator:",",escape:function(a){if("string"!==typeof a){return a}return a.replace(/([.*+?\^=!:${}()|\[\]\/\\])/g,"\\$1")},constructor:function(a){a=a||{};Ext.applyIf(a,{displayField:"text",editable:true,valueField:"value",hiddenName:a.hiddenName||a.name,triggerAction:"all",mode:"local",hideOnSelect:false,emptyText:"请选择",store:new Ext.data.ArrayStore({fields:["value","text"],data:a.data})});a.listeners=a.listeners||{};Ext.applyIf(a.listeners,{scope:this,beforequery:this.onBeforeQuery,blur:this.onRealBlur});Ext.apply(this,a);this.callParent()},initComponent:function(){if(!this.tpl){this.tpl='<tpl for="."><div class="x-combo-list-item"><img src="'+Ext.BLANK_IMAGE_URL+'" class="ux-lovcombo-icon ux-lovcombo-icon-{[values.'+this.checkField+'?"checked":"unchecked"]}"><div class="ux-lovcombo-item-text">{'+(this.displayField||"text")+":htmlEncode}</div></div></tpl>"}this.callParent()},onBeforeQuery:function(a){a.query=a.query.replace(new RegExp(this.escape(this.getCheckedDisplay())+"[ "+this.separator+"]*"),"")},onRealBlur:function(){this.list.hide();var d=this.getRawValue();var a=d.split(new RegExp(this.escape(this.separator)+" *"));var c=[];var b=this.store.snapshot||this.store.data;Ext.each(a,function(e){b.each(function(f){if(e===f.get(this.displayField)){c.push(f.get(this.valueField))}},this)},this);this.setValue(c.join(this.separator));this.store.clearFilter()},onSelect:function(a,b){if(this.fireEvent("beforeselect",this,a,b)!==false){a.set(this.checkField,!a.get(this.checkField));if(this.store.isFiltered()){this.doQuery(this.allQuery)}this.setValue(this.getCheckedValue());this.fireEvent("select",this,a,b)}},getCheckedValue:function(b){b=b||this.valueField;var d=[];var a=this.store.snapshot||this.store.data;a.each(function(c){if(c.get(this.checkField)){d.push(c.get(b))}},this);return d.join(this.separator)},getCheckedDisplay:function(){var a=new RegExp(this.separator,"g");return this.getCheckedValue(this.displayField).replace(a,this.separator+" ")},setValue:function(a){if(a){a=""+a;if(this.valueField){this.store.clearFilter();this.store.each(function(c){var b=!(!a.match("(^|"+this.separator+")"+this.escape(c.get(this.valueField))+"("+this.separator+"|$)"));c.set(this.checkField,b)},this);this.value=this.getCheckedValue();this.setRawValue(this.getCheckedDisplay());if(this.hiddenField){this.hiddenField.value=this.value}}else{this.value=a;this.setRawValue(a);if(this.hiddenField){this.hiddenField.value=a}}if(this.el){this.el.removeClass(this.emptyClass)}}else{this.clearValue()}}});Ext.define("Ext.ux.EasyGrid",{extend:"Ext.grid.Panel",requires:["Ext.ux.ProgressBarPager","Ext.grid.RowNumberer"],alias:["widget.easygrid"],initComponent:function(){if(!this.noAutoHeight){this.autoHeight=true}this.pageSize=15;if(!this.noNeddForceFit){this.forceFit=true}this.createStore();this.createColumns();this.createTbar();this.createBbar();if(this.needCheckboxColumn){this.selModel=Ext.create("Ext.selection.CheckboxModel",{injectCheckbox:"last"})}this.callParent()},initEvents:function(){this.callParent();if(!this.noNeedDbClick){this.on("itemdblclick",Ext.bind(this.dbClickFun,this))}if(this.disabledBtn){this.setDisabledBtn(true)}},getReaderFields:function(){var a=[];this.fields.each(function(c){var b={name:c.name,defaultValue:c.value||c.defaultValue||""};if(c.xtype=="datefield"){Ext.apply(b,{type:"date",dateFormat:c.format})}a.push(b);return true});return a},createStore:function(){var a={fields:this.getReaderFields(),autoLoad:true};if(this.noAutoLoad){a.autoLoad=false}if(this.data){a.data=this.data}if(!this.data||this.needAjax){a.pageSize=this.pageSize;a.proxy={actionMethods:{create:"POST",destroy:"POST",read:"POST",update:"POST"},type:"ajax",extraParams:this.baseParams,url:this.url||"paginate/query.do",reader:{type:"json",root:"result"}}}this.store=Ext.create("Ext.data.Store",a)},createColumns:function(){var e=[];if(!this.noNeedRowNumber){e.push(new Ext.grid.RowNumberer({width:18,align:"center"}))}var a=this.fields.items;for(var b=0;b<a.length;b++){var d=a[b];var c={header:d.fieldLabel,groupable:false,dataIndex:d.name,menuDisabled:true,align:"center"};if(d.renderer){c.renderer=d.renderer}if(d.flex){c.flex=d.flex}if(d.xtype=="datefield"){Ext.apply(c,{xtype:"datecolumn",format:d.format})}if(d.hiddenColumn||(d.xtype=="hidden"&&!d.noHiddenColumn)){c.hidden=true}if(d.columnWidth&&d.columnWidth>1){c.width=d.columnWidth}e.push(c)}this.columns=e},createTbar:function(){if(this.showTbar){this.tbar=Ext.create("Ext.toolbar.Toolbar");if(!this.noShowAddBtn){var d=new Ext.button.Button({text:"新增",iconCls:"add",handler:Ext.bind(this.createRecord,this)});this.addBtn=d;this.tbar.add(d)}if(!this.noShowUpdateBtn){var e=new Ext.button.Button({text:"修改",iconCls:"edit",handler:Ext.bind(this.updateRecord,this)});this.updateBtn=e;this.tbar.add(e)}if(!this.noShowRemoveBtn){var a=new Ext.button.Button({text:"删除",tooltip:"注意:确认删除后将不中恢复",iconCls:"remove",handler:Ext.bind(this.removeRecord,this)});this.removeBtn=a;this.tbar.add(a)}if(this.showCopyBtn){var c=new Ext.button.Button({text:"复制",iconCls:"genFile",handler:Ext.bind(this.copyRecord,this)});this.copyBtn=c;this.tbar.add(c)}if(this.showReportBtn){var f=new Ext.button.Button({text:"导出Excel",iconCls:"report",handler:Ext.bind(this.reportToExcel,this)});this.reportBtn=f;this.tbar.add(f)}if(this.showSaveBtn){var b=new Ext.button.Button({text:"保存",iconCls:"save",handler:Ext.bind(this.save,this)});this.saveBtn=b;this.tbar.add(b)}}},createBbar:function(){if(this.showBbar){var b=new Ext.ux.EasyCombo({data:CDM.pageSize,width:50,emptyText:15});b.on("select",function(d){var c=d.getValue();Ext.apply(this.store,{pageSize:c,currentPage:1});this.store.load()},this);var a={store:this.store,pageSize:this.pageSize,plugins:Ext.create("Ext.ux.ProgressBarPager",{}),displayInfo:true,height:28,items:["&nbsp;&nbsp;每页显示:",b]};if(this.noDisplayInfo){a.displayInfo=false;a.plugins=[]}this.bbar=Ext.create("Ext.PagingToolbar",a)}},createRecord:function(){if(this.parentPanel&&Ext.isFunction(this.parentPanel.beforeWinShow)){if(!this.parentPanel.beforeWinShow()){return}}this.showWindow(null);var a=this.getForm();a.baseParams={create:true};a.setValues(this.getEmptyRecord());this.setFormBtnsVisible(null,a.baseParams.create);if(this.parentPanel&&Ext.isFunction(this.parentPanel.afterWinShow)){this.parentPanel.afterWinShow(a,this)}},dbClickFun:function(){if(this.parentPanel&&Ext.isFunction(this.parentPanel.dbClickFun)){this.parentPanel.dbClickFun(this.getSelectedRecord(),this)}else{this.updateRecord()}},updateRecord:function(){var b=this.getSelectedRecord();if(b!=false){this.showWindow(b);var a=this.getForm();a.baseParams={create:false};a.loadRecord(b);this.setFormBtnsVisible(null,a.baseParams.create);if(this.parentPanel&&Ext.isFunction(this.parentPanel.afterWinShow)){this.parentPanel.afterWinShow(a,this,b.data)}}},removeRecord:function(){var a=this.getSelectedRecord();if(a!=false){Ext.Msg.confirm("提示","确定删除吗?",function(c){if(c=="yes"){if(Ext.isFunction(this.parentPanel.removeRecord)&&!Ext.isEmpty(a.get(this.recordId||"id"))){var b=this.parentPanel.removeRecord(this.store,a,this.gridName,this);if(b){this.getStore().remove(a)}else{Ext.Msg.alert("提示","服务不可用,无法删除!")}}else{this.getStore().remove(a)}}},this)}},save:function(){this.parentPanel.saveRecords(this.store,this.gridName)},getSelectedRecord:function(){var a=this.getSelectionModel();if(!a.hasSelection()){Ext.Msg.alert("提示","请选择一行数据");return false}else{return a.getLastSelected()}},loadData:function(b,a){if(this.parentPanel&&Ext.isFunction(this.parentPanel.loadProductData)){this.parentPanel.loadProductData(b,a)}else{this.getForm().loadRecord(a)}},copyRecord:function(){var a=this.getSelectedRecord();if(a!=false){var b=Ext.apply({},a.data);b[this.recordId]="";this.store.loadData([b],true)}},getEmptyRecord:function(){var c={};var a=this.getReaderFields();for(var b=0;b<a.length;b++){var d=a[b].name;c[d]=a[b].defaultValue}if(this.superior!=null){c[this.superior]=this.parentPanel.getSuperId()}return c},submitRecord:function(){if(!EasyUtil.isFormValid(this.getFormPanel())){return}var d=this.getForm();var a=d.getFieldValues();if(d.baseParams.create){if(this.parentPanel&&Ext.isFunction(this.parentPanel.addRecord)){this.parentPanel.addRecord(this.store,d,a,this.gridName,this)}else{this.store.loadData([a],true)}this.doLayout()}else{var c=this.getSelectedRecord();if(this.parentPanel&&Ext.isFunction(this.parentPanel.updateRecord)){this.parentPanel.updateRecord(this.store,c,a,d,this.gridName,this)}else{c.beginEdit();for(var b in a){c.set(b,a[b])}c.endEdit()}}this.hideWindow()},getForm:function(){return this.getFormPanel().getForm()},getFormPanel:function(){if(!this.gridForm){this.gridForm=this.createForm()}return this.gridForm},reportToExcel:function(){this.parentPanel.reportToExcel(this)},setAddBtnDisabled:function(a){this.addBtn.setDisabled(a);if(this.copyBtn){this.copyBtn.setDisabled(a)}},getRemoveBtn:function(){return this.removeBtn},getUpdateBtn:function(){return this.updateBtn},setDisabledBtn:function(a){this.updateBtn.setDisabled(a);this.addBtn.setDisabled(a);if(this.removeBtn){this.removeBtn.setDisabled(a)}if(this.copyBtn){this.copyBtn.setDisabled(a)}},createForm:function(){var b=Ext.create("Ext.form.Panel",{bodyPadding:"10 20",defaultType:"textfield",layout:{type:"table",columns:2},defaults:{labelWidth:80,style:{margin:"3px 5px"},readOnly:this.formItemsReadOnly},items:this.fields.items,dockedItems:[{xtype:"toolbar",dock:"bottom",ui:"footer",layout:{pack:"center"},items:[{text:"提交",iconCls:"accept",handler:Ext.bind(this.submitRecord,this)},{text:"重置",iconCls:"edit",handler:function(){b.getForm().reset()}},{text:"关闭",iconCls:"remove",handler:Ext.bind(this.hideWindow,this)}]}]});this.gridForm=b;if(this.formItemsReadOnly&&!this.showFormBtn){this.setFormBtnsVisible(false,false)}var a=b.down("producttrigger");if(a){a.parentPanel=this}return b},setFormBtnsVisible:function(c,a){var b=this.getFormPanel().getDockedItems();if(c!=null){b[0].items.items[0].setVisible(c)}b[0].items.items[1].setVisible(a)},showWindow:function(a){this.getWindow().show();if(this.parentPanel&&Ext.isFunction(this.parentPanel.applyRule)){this.parentPanel.applyRule(a)}},hideWindow:function(){this.getWindow().hide()},getWindow:function(){if(!this.gridWindow){this.gridWindow=this.createWindow()}return this.gridWindow},setFields:function(a){this.fields=a;if(this.gridForm){this.gridForm=null}if(this.gridWindow){this.gridWindow=null}},createWindow:function(){var a=this.getFormPanel();var b=Ext.create("Ext.window.Window",{title:this.subWindowTitle,closeAction:"hide",resizable:false,modal:true,border:false,shim:false,animCollapse:false,items:[a]});return b}});Ext.define("Ext.ux.EasyGridQuery",{extend:"Ext.grid.Panel",alias:["widget.easygridquery"],requires:["Ext.ux.ProgressBarPager","Ext.grid.RowNumberer","Ext.selection.CheckboxModel"],initComponent:function(){this.pageSize=15;if(!this.noNeddForceFit){this.forceFit=true}this.loadMask=true;this.createStore();this.createColumns();this.createTbar();this.createBbar();if(this.needCheckboxColumn){this.selModel=Ext.create("Ext.selection.CheckboxModel",{injectCheckbox:this.checkboxPos||"last"})}this.callParent()},initEvents:function(){this.callParent();if(!this.noNeedDbClick){this.on("itemdblclick",Ext.bind(this.dbClickFun,this))}if(this.disabledBtn){this.setDisabledBtn(true)}},getReaderFields:function(){var a=[];this.fields.each(function(b){a.push({name:b.name});return true});return a},createStore:function(){var a={fields:this.getReaderFields(),autoLoad:true};if(this.noAutoLoad){a.autoLoad=false}if(this.data){a.data=this.data}else{a.pageSize=this.pageSize;a.proxy={actionMethods:{create:"POST",destroy:"POST",read:"POST",update:"POST"},type:"ajax",extraParams:this.baseParams,url:this.url||"paginate/query.do",reader:{type:"json",root:"result"}}}this.store=Ext.create("Ext.data.Store",a)},createColumns:function(){var e=[new Ext.grid.RowNumberer({width:18,align:"center"})];var a=this.fields.items;for(var b=0;b<a.length;b++){var d=a[b];var c={header:d.fieldLabel,dataIndex:d.name,menuDisabled:true,align:"center"};if(d.xtype=="datefield"){Ext.apply(c,{xtype:"datecolumn",format:d.format})}if(d.renderer){c.renderer=d.renderer}if(d.editor){c.field=d.editor}if(d.flex){c.flex=d.flex}if(d.hiddenColumn||d.xtype=="hidden"){c.hidden=true}if(d.columnWidth&&d.columnWidth>1){c.width=d.columnWidth}e.push(c)}this.columns=e},createTbar:function(){if(this.showTbar){this.tbar=Ext.create("Ext.toolbar.Toolbar");if(!this.noShowAddBtn){var e=new Ext.button.Button({text:"新增",iconCls:"add",handler:Ext.bind(this.createRecord,this)});this.addBtn=e;this.tbar.add(e)}if(this.showUpateBtn){var f=new Ext.button.Button({text:"修改",iconCls:"edit",handler:Ext.bind(this.viewRecord,this)});this.updateBtn=f;this.tbar.add(f)}if(this.showRemoveBtn){var c=new Ext.button.Button({text:"删除",tooltip:"注意:确认删除后将不中恢复",iconCls:"remove",handler:Ext.bind(this.removeRecord,this)});this.removeBtn=c;this.tbar.add(c)}if(this.showSaveBtn){var d=new Ext.button.Button({text:"保存",iconCls:"save",handler:Ext.bind(this.save,this)});this.saveBtn=d;this.tbar.add(d)}if(this.showReportBtn){var g=new Ext.button.Button({text:"导出Excel",iconCls:"report",handler:Ext.bind(this.reportToExcel,this)});this.reportBtn=g;this.tbar.add(g)}if(this.otherBtn){for(var b=0;b<this.otherBtn.length;b++){var a=new Ext.button.Button({text:this.otherBtn[b].btnValue,iconCls:"x-group-by-icon",handler:Ext.bind(this.viewOtherRecord,this,[this.otherBtn[b].disPanel,this.otherBtn[b].subWinTitle])});this.tbar.add(a)}}}},createBbar:function(){if(this.showBbar){var a=new Ext.ux.EasyCombo({data:CDM.pageSize,width:50,emptyText:15});a.on("select",function(c){var b=parseInt(c.getValue());Ext.apply(this.store,{pageSize:b,currentPage:1});this.store.load()},this);this.bbar=Ext.create("Ext.PagingToolbar",{store:this.store,height:28,pageSize:this.pageSize,displayInfo:true,plugins:Ext.create("Ext.ux.ProgressBarPager",{}),items:["&nbsp;&nbsp;每页显示:",a]})}},createRecord:function(){this.showWindow();if(Ext.isFunction(this.viewPanel.setIsView)){this.viewPanel.setIsView(false)}if(Ext.isFunction(this.viewPanel.createRecord)){this.viewPanel.createRecord()}},removeRecord:function(){var a=this.getSelectedRecord();if(a!=false){Ext.Msg.confirm("提示","确定删除吗?",function(b){if(b=="yes"){if(!Ext.isEmpty(a.get(this.recordId||"id"))){if(this.parentPanel.removeRecord(this.store,a,this.gridName)){this.getStore().remove(a)}else{Ext.Msg.alert("提示","服务不可用,无法删除!")}}else{this.getStore().remove(a)}}},this)}},dbClickFun:function(){if(this.parentPanel&&Ext.isFunction(this.parentPanel.dbClickFun)){this.parentPanel.dbClickFun(this.getSelectedRecord())}else{this.viewRecord()}},viewRecord:function(){var b=this.getSelectedRecord();if(b!=false){if(this.overrideView){this.parentPanel.viewRecord(b)}else{this.showWindow();if(Ext.isFunction(this.viewPanel.setIsView)){this.viewPanel.setIsView(true)}var a="id";if(Ext.isFunction(this.viewPanel.getRecordKey)){a=this.viewPanel.getRecordKey()}if(Ext.isFunction(this.viewPanel.initialize)){this.viewPanel.initialize()}this.viewPanel.loadFormRecord(b.get(a),b)}}},viewOtherRecord:function(b,a){var d=this.getSelectedRecord();if(d!=false){if(this.overrideView){this.parentPanel.viewRecord(d)}else{this.showOtherWindow(b,a);if(Ext.isFunction(this.viewPanel.setIsView)){this.viewPanel.setIsView(true)}var c="id";if(Ext.isFunction(this.viewPanel.getRecordKey)){c=this.viewPanel.getRecordKey()}if(Ext.isFunction(this.viewPanel.initialize)){this.viewPanel.initialize()}this.viewPanel.loadFormRecord(d.get(c),d)}}},getSelectedRecord:function(){var a=this.getSelectionModel();if(!a.hasSelection()){Ext.Msg.alert("提示","请选择一行数据");return false}else{return a.getLastSelected()}},reportToExcel:function(){this.parentPanel.reportToExcel(this)},viewPanel:null,createViewPanel:function(){var viewPanleClass=eval(this.viewPanelClass);this.viewPanel=new viewPanleClass({desktop:this.desktop,parentPanel:this.parentPanel,parentGrid:this,windowWidth:this.subWindowWidth})},createOtherViewPanel:function(disPanel){var viewPanleClass=eval(disPanel);this.viewPanel=new viewPanleClass({desktop:this.desktop,parentPanel:this.parentPanel})},save:function(){this.parentPanel.saveRecords(this.store,this.gridName)},showWindow:function(){this.getWindow().show()},showOtherWindow:function(b,a){this.getOtherWindow(b,a).show()},getSelecteds:function(a){if(!this.selModel){return}var b=[];Ext.each(this.selModel.getSelection(),function(c){b.push(c.get(a))},this);return b.join(",")},getWindow:function(){var a=this.desktop?this.desktop.getWindow(this.winId):null;if(!a){this.gridWindow=this.createWindow()}return this.gridWindow},getOtherWindow:function(b,a){var c=this.desktop?this.desktop.getWindow(this.winId):null;if(!c){this.gridWindow=this.createOtherWindow(b,a)}return this.gridWindow},setDisabledBtn:function(a){if(this.updateBtn){this.updateBtn.setDisabled(a)}if(this.addBtn){this.addBtn.setDisabled(a)}if(this.removeBtn){this.removeBtn.setDisabled(a)}if(this.saveBtn){this.saveBtn.setDisabled(a)}},createWindow:function(){this.createViewPanel();var a={title:this.subWindowTitle,modal:true,iconCls:this.iconCls||"order-icon",width:this.subWindowWidth,layout:"fit",height:this.subWindowHeight,items:[this.viewPanel]};var b=this.desktop?this.desktop.createWindow(a):new Ext.window.Window(a);this.winId=b.getId();if(Ext.isFunction(this.viewPanel.setParentWin)){this.viewPanel.setParentWin(b)}b.on("beforeclose",function(d,c){d.minimize()});return b},closeWindow:function(){this.getWindow().close()},createOtherWindow:function(b,a){this.createOtherViewPanel(b);var c={title:a,modal:true,iconCls:this.iconCls||"order-icon",width:this.subWindowWidth,layout:"fit",height:this.subWindowHeight,minimizable:true,resizable:false,maximizable:true,items:[this.viewPanel]};var d=this.desktop?this.desktop.createWindow(c):new Ext.window.Window(c);this.winId=d.getId();if(Ext.isFunction(this.viewPanel.setParentWin)){this.viewPanel.setParentWin(d)}return d}});Ext.define("Ext.ux.EasyGridCellEdit",{extend:"Ext.grid.Panel",alias:["widget.easygridcelledit"],requires:["Ext.ux.ProgressBarPager","Ext.grid.RowNumberer","Ext.selection.CheckboxModel"],selType:"cellmodel",plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1})],initComponent:function(){this.pageSize=15;if(!this.noNeddForceFit){this.forceFit=true}this.loadMask=true;this.createStore();this.createColumns();this.createTbar();this.createBbar();if(this.needCheckboxColumn){this.selModel=Ext.create("Ext.selection.CheckboxModel",{injectCheckbox:"last"})}this.callParent()},initEvents:function(){this.callParent();if(!this.noNeedDbClick){this.on("itemdblclick",Ext.bind(this.dbClickFun,this))}if(this.disabledBtn){this.setDisabledBtn(true)}},getReaderFields:function(){var a=[];this.fields.each(function(b){a.push({name:b.name});return true});return a},createStore:function(){var a={fields:this.getReaderFields(),autoLoad:true};if(this.noAutoLoad){a.autoLoad=false}if(this.data){a.data=this.data}else{a.pageSize=this.pageSize;a.proxy={actionMethods:{create:"POST",destroy:"POST",read:"POST",update:"POST"},type:"ajax",extraParams:this.baseParams,url:this.url||"paginateAction.action",reader:{type:"json",root:"result"}}}this.store=Ext.create("Ext.data.Store",a)},createColumns:function(){var e=[new Ext.grid.RowNumberer()];var a=this.fields.items;for(var b=0;b<a.length;b++){var d=a[b];var c={header:d.fieldLabel,dataIndex:d.name,align:"center"};if(d.xtype=="datefield"){Ext.apply(c,{xtype:"datecolumn",format:d.format})}if(d.renderer){c.renderer=d.renderer}if(d.editor){c.field=d.editor}if(d.flex){c.flex=d.flex}if(d.hiddenColumn||d.xtype=="hidden"){c.hidden=true}if(d.columnWidth){c.width=d.columnWidth}e.push(c)}this.columns=e},createTbar:function(){if(this.showTbar){this.tbar=Ext.create("Ext.toolbar.Toolbar");if(!this.noShowAddBtn){var e=new Ext.button.Button({text:"新增",iconCls:"add",handler:Ext.bind(this.createRecord,this)});this.addBtn=e;this.tbar.add(e)}if(this.showUpateBtn){var f=new Ext.button.Button({text:"修改",iconCls:"edit",handler:Ext.bind(this.viewRecord,this)});this.updateBtn=f;this.tbar.add(f)}if(this.showRemoveBtn){var c=new Ext.button.Button({text:"删除",tooltip:"注意:确认删除后将不中恢复",iconCls:"remove",handler:Ext.bind(this.removeRecord,this)});this.removeBtn=c;this.tbar.add(c)}if(this.showSaveBtn){var d=new Ext.button.Button({text:"保存",iconCls:"save",handler:Ext.bind(this.save,this)});this.saveBtn=d;this.tbar.add(d)}if(this.showReportBtn){var g=new Ext.button.Button({text:"导出Excel",iconCls:"report",handler:Ext.bind(this.reportToExcel,this)});this.reportBtn=g;this.tbar.add(g)}if(this.otherBtn){for(var b=0;b<this.otherBtn.length;b++){var a=new Ext.button.Button({text:this.otherBtn[b].btnValue,iconCls:"x-group-by-icon",handler:Ext.bind(this.viewOtherRecord,this,[this.otherBtn[b].disPanel,this.otherBtn[b].subWinTitle])});this.tbar.add(a)}}}},createBbar:function(){if(this.showBbar){this.bbar=Ext.create("Ext.PagingToolbar",{store:this.store,pageSize:this.pageSize,displayInfo:true,plugins:Ext.create("Ext.ux.ProgressBarPager",{})})}},createRecord:function(){this.showWindow();if(Ext.isFunction(this.viewPanel.createRecord)){this.viewPanel.createRecord()}},removeRecord:function(){var a=this.getSelectedRecord();if(a!=false){Ext.Msg.confirm("提示","确定删除吗?",function(b){if(b=="yes"){if(this.overrideRemove&&!Ext.isEmpty(a.get(this.recordId||"ID"))){if(this.parentPanel.removeRecord(this.store,a,this.gridName)){this.getStore().remove(a)}else{Ext.Msg.alert("提示","服务不可用,无法删除!")}}else{this.getStore().remove(a)}}},this)}},dbClickFun:function(){if(this.parentPanel&&Ext.isFunction(this.parentPanel.dbClickFun)){this.parentPanel.dbClickFun(this.getSelectedRecord())}else{this.viewRecord()}},viewRecord:function(){var b=this.getSelectedRecord();if(b!=false){if(this.overrideView){this.parentPanel.viewRecord(b)}else{this.showWindow();if(Ext.isFunction(this.viewPanel.setIsView)){this.viewPanel.setIsView(true)}var a="id";if(Ext.isFunction(this.viewPanel.getRecordKey)){a=this.viewPanel.getRecordKey()}if(Ext.isFunction(this.viewPanel.initialize)){this.viewPanel.initialize()}this.viewPanel.loadFormRecord(b.get(a),b)}}},viewOtherRecord:function(b,a){var d=this.getSelectedRecord();if(d!=false){if(this.overrideView){this.parentPanel.viewRecord(d)}else{this.showOtherWindow(b,a);if(Ext.isFunction(this.viewPanel.setIsView)){this.viewPanel.setIsView(true)}var c="id";if(Ext.isFunction(this.viewPanel.getRecordKey)){c=this.viewPanel.getRecordKey()}if(Ext.isFunction(this.viewPanel.initialize)){this.viewPanel.initialize()}this.viewPanel.loadFormRecord(d.get(c),d)}}},getSelectedRecord:function(){var a=this.getSelectionModel();if(!a.hasSelection()){Ext.Msg.alert("提示","请选择一行数据");return false}else{return a.getLastSelected()}},reportToExcel:function(){this.parentPanel.reportToExcel(this)},viewPanel:null,createViewPanel:function(){var viewPanleClass=eval(this.viewPanelClass);this.viewPanel=new viewPanleClass({desktop:this.desktop,parentPanel:this.parentPanel})},createOtherViewPanel:function(disPanel){var viewPanleClass=eval(disPanel);this.viewPanel=new viewPanleClass({desktop:this.desktop,parentPanel:this.parentPanel})},save:function(){this.parentPanel.saveRecords(this.store,this.gridName)},showWindow:function(){this.getWindow().show()},showOtherWindow:function(b,a){this.getOtherWindow(b,a).show()},getSelecteds:function(a){if(!this.selModel){return}var b=[];Ext.each(this.selModel.getSelection(),function(c){b.push(c.get(a))},this);return b.join(",")},getWindow:function(){var a=this.desktop?this.desktop.getWindow(this.winId):null;if(!a){this.gridWindow=this.createWindow()}return this.gridWindow},getOtherWindow:function(b,a){var c=this.desktop?this.desktop.getWindow(this.winId):null;if(!c){this.gridWindow=this.createOtherWindow(b,a)}return this.gridWindow},setDisabledBtn:function(a){if(this.updateBtn){this.updateBtn.setDisabled(a)}if(this.addBtn){this.addBtn.setDisabled(a)}if(this.removeBtn){this.removeBtn.setDisabled(a)}if(this.saveBtn){this.saveBtn.setDisabled(a)}},createWindow:function(){this.createViewPanel();var a={title:this.subWindowTitle,modal:true,iconCls:this.iconCls||"order-icon",width:this.subWindowWidth,layout:"fit",height:this.subWindowHeight,items:[this.viewPanel]};var b=this.desktop?this.desktop.createWindow(a):new Ext.window.Window(a);this.winId=b.getId();if(Ext.isFunction(this.viewPanel.setParentWin)){this.viewPanel.setParentWin(b)}return b},createOtherWindow:function(b,a){this.createOtherViewPanel(b);var c={title:a,modal:true,iconCls:this.iconCls||"order-icon",width:this.subWindowWidth,layout:"fit",height:this.subWindowHeight,items:[this.viewPanel]};var d=this.desktop?this.desktop.createWindow(c):new Ext.window.Window(c);this.winId=d.getId();if(Ext.isFunction(this.viewPanel.setParentWin)){this.viewPanel.setParentWin(d)}return d}});Ext.define("Ext.ux.IconBrowser",{extend:"Ext.view.View",alias:"widget.iconbrowser",uses:"Ext.data.Store",singleSelect:true,overItemCls:"x-view-over",itemSelector:"div.thumb-wrap",tpls:[['<tpl for=".">','<div class="thumb-wrap">','<div class="thumb">',(!Ext.isIE6?'<img width="100px" height="100px" src="{imagePath}" />':"<div style=\"width:74px;height:74px;filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='{imagePath}')\"></div>"),"</div>","<span>{imageType}-{imageOrder}-{imageName}</span>","</div>","</tpl>"]],initComponent:function(){var a=[];this.fieldMixs.each(function(b){a.push({name:b.name});return true});this.store=Ext.create("Ext.data.Store",{fields:a,proxy:{type:"ajax",url:"icons.json",reader:{type:"json",root:""}}});this.tpl=this.tpls[this.tplIdx||0];this.callParent(arguments);this.store.sort()},getStore:function(){return this.store}});Ext.define("Ext.ux.Util",{singleton:true,alternateClassName:"EasyUtil",requires:["Ext.ux.EasyCombo","Ext.ux.MultiSelectCombo"],getEasyQueryForm:function(d,b,c){if(!Ext.isArray(b)||b.length==0){return}c=c||2;var a=Ext.create("Ext.form.Panel",{border:false,region:"north",autoScroll:true,bodyStyle:"padding: 3px",defaultType:"textfield",style:"background-color: white;width:100%;",layout:{type:"table",columns:c},defaults:{labelAlign:"right",labelWidth:80},items:b,fbar:[{xtype:"button",text:"重置",handler:function(){a.getForm().reset()},iconCls:"edit"},{xtype:"button",text:"查询",iconCls:"query",handler:d}]});return a},doEasyQuery:function(b,a,d){var c=b.getStore();c.proxy.extraParams={queryId:c.proxy.extraParams.queryId};if(a){Ext.apply(c.proxy.extraParams,a.getForm().getValues())}else{if(d){Ext.apply(c.proxy.extraParams,d)}}c.loadPage(1)},getBaseConfig:function(c,b,d){var a={fieldLabel:c,name:b};return Ext.apply(a,d||{})},getEasyForm:function(b){var a={region:b.region||"center",bodyPadding:"10 20",defaultType:"textfield",autoScroll:true,layout:{type:"table",columns:b.columnSize},defaults:{width:b.width||280,style:{margin:"2px 5px"}},items:b.items};if(b.fbar){a.fbar=b.fbar}if(b.height){a.height=b.height}if(b.readOnly){a.defaults.readOnly=true}if(b.labelAlign){a.defaults.labelAlign=b.labelAlign}var c=Ext.create("Ext.form.Panel",a);return c},getEasyFieldSetForm:function(b){var a={region:"center",bodyPadding:"10 10",defaultType:"textfield",autoScroll:true,items:b.items};if(b.fbar){a.fbar=b.fbar}var c=Ext.create("Ext.form.Panel",a);return c},getCloseWinBtnCfg:function(a){return{text:"关闭",iconCls:"back",handler:function(){a.parentGrid.closeWindow()}}},submitForm:function(c,a,b,d){if(EasyUtil.isFormValid(c)){c.submit({url:a,params:d,waitMsg:"数据提交中...",waitTitle:"请稍候",success:function(e,f){EasyUtil.alertMsg(true);if(d.isDoQuery){if(Ext.isFunction(this.doQuery)){this.doQuery()}else{this.parentPanel.doQuery()}}if(d.isCloseWin){this.parentGrid.closeWindow()}},failure:function(e,f){EasyUtil.alertMsg(false)},scope:b})}},getEasyDateCfg:function(c,b,d,e){var a={xtype:"datefield",fieldLabel:c,editable:false,width:218,name:b,format:e||"Y-m-d"};if(d){a.value=d}return a},getEasyFieldSetCfg:function(f,b,c,e,d){var a={xtype:"fieldset",title:f,collapsible:true,collapsed:e,defaultType:"textfield",autoScroll:true,layout:{type:"table",columns:c||2},items:b||[]};if(d){a.id=d}return a},getTextAreaCfg:function(c,b,d,e){var a={xtype:"textareafield",fieldLabel:c,name:b,colspan:2,width:d||600};if(e){a.value=e}return a},getEasyComboCfg:function(c,b,d,e){d=d||[[1,"是"],[0,"否"]];if(d.length>0&&d[0][1]!="请选择"){d=[["","请选择"]].concat(d)}var a={xtype:"easycombo",fieldLabel:c,name:b,width:e.comboxWidth||218,data:d,forceSelection:true,required:e.required,editable:e.editable,value:e.value};if(e.renderer){a.renderer=function(f){return EasyUtil.getComboDesc(d,f)}}if(e.important){a.labelStyle="color:red"}return a},getFieldcontainer:function(c,a,b,d){if(!d){Ext.apply(a[0],{listeners:{change:function(g,f){var e=g.nextSibling("textfield");if(Ext.isEmpty(f)){e.setValue(null);return}var h=EasyUtil.getComboDesc(g.data,f);if(h.indexOf("-")!=-1){h=h.substring(0,h.indexOf("-"))}e.setValue(h)},blur:function(e){e.up("form").doLayout()},select:function(e){e.up("form").doLayout()}}});Ext.apply(a[1],{readOnly:true})}return{xtype:"fieldcontainer",fieldLabel:c,defaultType:"textfield",layout:"column",fieldDefaults:{hideLabel:true,columnWidth:1/b},items:a}},getRandFields:function(c){var b,a;if(!c.type){var f={xtype:"datefield",format:"Y-m-d",width:100,editable:true};b=Ext.apply({name:c.name1||"beginDate",value:c.value1},f);a=Ext.apply({name:c.name2||"endDate",value:c.value2},f)}else{if(c.type=="combo"){var e={xtype:"easycombo",width:100,data:c.data};b=Ext.apply({name:c.name1||"begin",value:c.value1},e);a=Ext.apply({name:c.name2||"end",value:c.value2},e)}else{if(c.type=="number"){var e={xtype:"numberfield",hideTrigger:true,width:80};b=Ext.apply({name:c.name1||"minnum",value:c.value1},e);a=Ext.apply({name:c.name2||"maxnum",value:c.value2},e)}}}var d=[b,{xtype:"displayfield",value:"-"},a];return{xtype:"fieldcontainer",fieldLabel:c.fieldLabel,defaultType:"textfield",layout:{type:"table",columns:3},items:d}},getNewDate:function(b,a){a=a||new Date();return new Date(a.getFullYear(),a.getMonth(),a.getDate()+b)},getEasyLabel:function(b,a){return{xtype:"label",cls:a||"greenLabelTxtCls",text:b}},isFormValid:function(a){var b=a;if(Ext.isFunction(a.getForm)){b=a.getForm()}if(!b.isValid()){Ext.Msg.alert("错误提示","有必输项未填写!");return false}return true},alertMsg:function(b,a){Ext.Msg.alert("操作提示",(b?"操作成功!":"操作失败!"+(a||"")))},setFieldValue:function(k,d,e){var j=k.modifyParams;var b=k.modifyCount;var a=d.fieldLabel;var h=d.getValue();if(d.isXType("radiogroup")){d=d.getChecked()[0];h=d.initialConfig.inputValue}if(d.isXType("datefield")){h=d.rawValue}if(b==0){j.name=d.getName();j.fieldLabel=a;j.newValue=h;if(d.isXType("radiofield")){j.boxLabel=d.boxLabel}else{if(d.isXType("easycombo")){j.boxLabel=EasyUtil.getComboDesc(d.store,h)}}k.modifyCount++}else{var g=false;for(var c=0;c<b;c++){if(c==0){if(j.name==d.getName()){j.newValue=h;j.fieldLabel=a;if(d.isXType("radiofield")){j.boxLabel=d.boxLabel}else{if(d.isXType("easycombo")){j.boxLabel=EasyUtil.getComboDesc(d.store,h)}}g=true}}else{if(j["name_"+c]==d.getName()){j["newValue_"+c]=h;j["fieldLabel_"+c]=a;if(d.isXType("radiofield")){j["boxLabel_"+c]=d.boxLabel}else{if(d.isXType("easycombo")){j["boxLabel_"+c]=EasyUtil.getComboDesc(d.store,h)}}g=true}}}if(!g){j["name_"+b]=d.getName();j["fieldLabel_"+b]=a;j["newValue_"+b]=h;if(d.isXType("radiofield")){j["boxLabel_"+b]=d.boxLabel}else{if(d.isXType("easycombo")){j["boxLabel_"+b]=EasyUtil.getComboDesc(d.store,h)}}k.modifyCount++}}},initFormEvents:function(a,d,g){d.modifyCount=0;d.isListenable=false;d.modifyParams={};var e=a.getForm().getFields();var c=function(j){if(!this.isListenable){return}var h=j.startValue;var i=j.getValue();if(h==i){return}EasyUtil.setFieldValue(this,j)};var b=function(i,j,h){if(!this.isListenable||j[i.items.items[0].name].length>1){return}EasyUtil.setFieldValue(this,i,j)};var f=function(h){if(g&&g[h.getName()]){return true}if(h.isXType("radiogroup")){h.on("change",Ext.bind(b,this))}else{if(!h.isXType("radiofield")){h.on("change",Ext.bind(c,this))}}};e.each(f,d)},suspendOrResumeEvents:function(c,b){if(c){b.modifyCount=0;b.modifyParams={};var a=new Ext.util.DelayedTask(function(d){this.isListenable=d},b,[c]);a.delay(800)}else{b.isListenable=c}},setFormFieldsReaOnly:function(a,f,e){var b=e||{};var c=a.getForm().items;var d=function(g){if(!b[g.getName()]){if(g.isXType("radiogroup")){g.setDisabled(f)}else{if(g.isXType("compositefield")){g.items.each(d)}else{g.setReadOnly(f)}}}};c.each(d)},getSelectedRecord:function(a,b){var c=a.getSelectionModel();if(c.getCount()==0){Ext.Msg.alert("提示",b||"请选择一行数据");return false}else{return c.getLastSelected()}},getColumnsConfigAndFields:function(e,d,a,b,c){if(!b){d.push(Ext.create("Ext.grid.RowNumberer"))}e.each(function(h){if(d){var g={header:h.fieldLabel,dataIndex:h.name,menuDisabled:true,align:"center"};if(h.hidden||h.xtype=="hidden"){g.hidden=true}if(h.renderer){Ext.apply(g,{renderer:h.renderer})}if(h.editor){if(h.editor=="date"){g.editor={xtype:"datefield",allowBlank:false,editable:false,format:h.format}}else{if(h.editor=="text"){g.editor={}}else{if(h.editor=="combo"){g.editor=Ext.apply({allowBlank:false},EasyUtil.getEasyComboCfg("",h.name,null,h.data,h.renderer,null,h.editable))}else{if(h.editor=="number"){g.editor={xtype:"numberfield",allowBlank:!h.required,hideTrigger:true,minValue:h.minValue,allowDecimals:h.allowDecimals}}}}}}if(h.xtype=="datefield"){Ext.apply(g,{xtype:"datecolumn",format:h.format,width:c||85})}if(h.columnWidth){g.width=h.columnWidth}if(c){g.width=c}if(h.flex){g.flex=h.flex}d.push(g)}if(a){a.push({name:h.name})}return true})},createMyGrid:function(a,e,d){var f=Ext.create("Ext.data.Store",{fields:a,proxy:{type:"ajax",url:d.url,reader:{type:"json",root:"result"}}});var b={region:d.region||"center",store:f,columns:e};if(d.forceFit){b.forceFit=true}if(d.tbar){b.tbar=d.tbar}if(d.plugins){b.plugins=d.plugins}var c=Ext.create("Ext.grid.Panel",b);return c},getRecordsToParams:function(d,f,e){var c=d.recordId||"Id";var b=0,a=0;d.getStore().each(function(g){var k=g.get(c);if(e&&!(Ext.isEmpty(k)||g.dirty)){return true}var j=g.fields.keys;var h=g.modified;var i=true;Ext.each(j,function(n){var m=g.fields.get(n);var p=g.get(n);if(Ext.isDate(p)){p=Ext.util.Format.date(p,"Y-m-d")}if(!Ext.isEmpty(k)){var l=h[n];if(Ext.isDefined(l)){i=false;var o;if(Ext.isFunction(d.getForm)){o=d.getForm().findField(n)}if(a==0){f.itemId=k;f.itemName=n;f.itemNewValue=p;if(o){f.itemFieldLabel=o.fieldLabel;if(o.isXType("easycombo")){f.itemBoxLabel=EasyUtil.getComboDesc(o.store,p)}}}else{f["itemId_"+a]=k;f["itemName_"+a]=n;f["itemNewValue_"+a]=p;if(o){f["itemFieldLabel_"+a]=o.fieldLabel;if(o.isXType("easycombo")){f["itemBoxLabel_"+a]=EasyUtil.getComboDesc(o.store,p)}}}a++}}else{if(b==0){f[n]=p}else{f[n+"_"+b]=p}}return true});if(i){b++}});return[b,a]},showOrHideMask:function(b,a){if(a){if(!b.myMask){b.myMask=new Ext.LoadMask(b.getId(),{msg:"正在提交..."})}b.myMask.show()}else{b.myMask.hide()}},getComboDesc:function(a,c,d){if(!a){a=[[0,"否"],[1,"是"]]}var b=c;if(Ext.typeOf(a)=="object"){a.each(function(e){var f=e.get("value");if((Ext.typeOf(f)==Ext.typeOf(c))&&c==f){b=e.get("text");return false}return true})}else{Ext.each(a,function(e){if((Ext.typeOf(e[0])==Ext.typeOf(c))&&c==e[0]){b=e[1];return false}return true})}if(Ext.isDefined(d)&&d==c){return'<font color="red">'+b+"</font>"}return b=="请选择"?"":b},easyAjax:function(b,e,a,c,d){Ext.Ajax.request({url:b,params:e,success:a,async:!d,failure:function(f,g){Ext.Msg.alert("操作提示","服务不可用,操作失败!")},scope:c})},reConfigGridBySizes:function(b,c,f,e){var d=[],a=[],g;if(f){EasyUtil.getColumnsConfigAndFields(f,d,a,false,70);g=f}else{g=new Ext.util.MixedCollection()}Ext.each(c,function(i){d.push({header:i.sizeName,dataIndex:i.sizeCode,align:"center",menuDisabled:true,width:60});a.push({name:i.sizeCode});g.add(i.sizeCode,{fieldLabel:i.sizeName,name:i.sizeCode})});if(e){EasyUtil.getColumnsConfigAndFields(e,d,a,true,60);g.addAll(e.items)}var h=Ext.create("Ext.data.Store",{fields:a,proxy:{type:"ajax",reader:{type:"json",root:"result"}}});b.reconfigure(h,d);return g},initComboLoadData:function(b,a){if(Ext.typeOf(b)=="object"){b.on("afterrender",Ext.bind(EasyUtil.onMyTriggerClick,this))}else{if(Ext.typeOf(b)=="string"){b=[b]}Ext.each(b,function(c){a.getForm().findField(c).on("afterrender",Ext.bind(EasyUtil.onMyTriggerClick,this))},this)}},onMyTriggerClick:function(b,d,c){var a=c_baseDataMix.get(d);if(!Ext.isEmpty(a)){b.getStore().loadData(a);return}Ext.apply(c,{doQuery:true});c.textField=c.textField||c.valueField;EasyUtil.easyAjax("extjsoncontrollersuport/findOrQuery.do",c,function(e,f){var h=Ext.decode(e.responseText);var g=[];Ext.each(h.obj,function(i){g.push([i[c.valueField],i[c.textField]])});b.getStore().loadData(g);c_baseDataMix.add(d,g)},this,true)},redFontRenderer:function(a){return'<font color="red">'+a+"</font>"},hideColumnsMix:function(b,c){var a=new Ext.util.MixedCollection();b.each(function(e){var d=e;if(!c[e.name]){d=Ext.apply({hiddenColumn:true},e)}a.add(d)});return a},copySomePropertis:function(a,b){var d={},a=a||{};for(var c in a){if(b&&b[c]){d[c]=a[c]}}return d}});